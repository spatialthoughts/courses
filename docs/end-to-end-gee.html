<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>End-to-End Google Earth Engine (Full Course)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDGF11RK4Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PDGF11RK4Z');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">End-to-End Google Earth Engine (Full
Course)</h1>
<h3 class="subtitle">A hands-on introduction to applied remote sensing
using Google Earth Engine.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#sign-up-for-google-earth-engine"
id="toc-sign-up-for-google-earth-engine">Sign-up for Google Earth
Engine</a></li>
<li><a href="#complete-the-class-pre-work"
id="toc-complete-the-class-pre-work">Complete the Class
Pre-Work</a></li>
<li><a href="#get-the-course-videos" id="toc-get-the-course-videos">Get
the Course Videos</a>
<ul>
<li><a href="#youtube" id="toc-youtube">YouTube</a></li>
<li><a href="#vimeo" id="toc-vimeo">Vimeo</a></li>
</ul></li>
<li><a href="#get-the-course-materials"
id="toc-get-the-course-materials">Get the Course Materials</a></li>
<li><a href="#module-1-earth-engine-basics"
id="toc-module-1-earth-engine-basics">Module 1: Earth Engine Basics</a>
<ul>
<li><a href="#hello-world" id="toc-hello-world">01. Hello World</a>
<ul>
<li><a href="#exercise" id="toc-exercise">Exercise</a></li>
<li><a href="#saving-your-work" id="toc-saving-your-work">Saving Your
Work</a></li>
</ul></li>
<li><a href="#working-with-image-collections"
id="toc-working-with-image-collections">02. Working with Image
Collections</a>
<ul>
<li><a href="#exercise-1" id="toc-exercise-1">Exercise</a></li>
</ul></li>
<li><a href="#filtering-image-collections"
id="toc-filtering-image-collections">03. Filtering Image Collections</a>
<ul>
<li><a href="#exercise-2" id="toc-exercise-2">Exercise</a></li>
</ul></li>
<li><a href="#creating-mosaics-and-composites-from-imagecollections"
id="toc-creating-mosaics-and-composites-from-imagecollections">04.
Creating Mosaics and Composites from ImageCollections</a>
<ul>
<li><a href="#exercise-3" id="toc-exercise-3">Exercise</a></li>
</ul></li>
<li><a href="#working-with-feature-collections"
id="toc-working-with-feature-collections">05. Working with Feature
Collections</a>
<ul>
<li><a href="#exercise-4" id="toc-exercise-4">Exercise</a></li>
</ul></li>
<li><a href="#importing-data" id="toc-importing-data">06. Importing
Data</a>
<ul>
<li><a href="#exercise-5" id="toc-exercise-5">Exercise</a></li>
</ul></li>
<li><a href="#clipping-images" id="toc-clipping-images">07. Clipping
Images</a>
<ul>
<li><a href="#exercise-6" id="toc-exercise-6">Exercise</a></li>
</ul></li>
<li><a href="#exporting-data" id="toc-exporting-data">08. Exporting
Data</a>
<ul>
<li><a href="#exercise-7" id="toc-exercise-7">Exercise</a></li>
</ul></li>
<li><a href="#assignment-1" id="toc-assignment-1">Assignment 1</a></li>
</ul></li>
<li><a href="#module-2-earth-engine-intermediate"
id="toc-module-2-earth-engine-intermediate">Module 2: Earth Engine
Intermediate</a>
<ul>
<li><a href="#earth-engine-objects" id="toc-earth-engine-objects">01.
Earth Engine Objects</a>
<ul>
<li><a href="#exercise-8" id="toc-exercise-8">Exercise</a></li>
</ul></li>
<li><a href="#calculating-indices" id="toc-calculating-indices">02.
Calculating Indices</a>
<ul>
<li><a href="#exercise-9" id="toc-exercise-9">Exercise</a></li>
</ul></li>
<li><a href="#computation-on-imagecollections"
id="toc-computation-on-imagecollections">03. Computation on
ImageCollections</a>
<ul>
<li><a href="#exercise-10" id="toc-exercise-10">Exercise</a></li>
</ul></li>
<li><a href="#cloud-masking" id="toc-cloud-masking">04. Cloud
Masking</a>
<ul>
<li><a href="#exercise-11" id="toc-exercise-11">Exercise</a></li>
</ul></li>
<li><a href="#reducers" id="toc-reducers">05. Reducers</a>
<ul>
<li><a href="#exercise-12" id="toc-exercise-12">Exercise</a></li>
</ul></li>
<li><a href="#time-series-charts" id="toc-time-series-charts">06.
Time-Series Charts</a>
<ul>
<li><a href="#exercise-13" id="toc-exercise-13">Exercise</a></li>
</ul></li>
<li><a href="#assignment-2" id="toc-assignment-2">Assignment 2</a></li>
</ul></li>
<li><a href="#module-3-supervised-classification"
id="toc-module-3-supervised-classification">Module 3: Supervised
Classification</a>
<ul>
<li><a
href="#introduction-to-machine-learning-and-supervised-classification"
id="toc-introduction-to-machine-learning-and-supervised-classification">Introduction
to Machine Learning and Supervised Classification</a></li>
<li><a href="#basic-supervised-classification"
id="toc-basic-supervised-classification">01. Basic Supervised
Classification</a>
<ul>
<li><a href="#exercise-14" id="toc-exercise-14">Exercise</a></li>
</ul></li>
<li><a href="#accuracy-assessment" id="toc-accuracy-assessment">02.
Accuracy Assessment</a>
<ul>
<li><a href="#exercise-15" id="toc-exercise-15">Exercise</a></li>
</ul></li>
<li><a href="#improving-the-classification"
id="toc-improving-the-classification">03. Improving the
Classification</a>
<ul>
<li><a href="#exercise-16" id="toc-exercise-16">Exercise</a></li>
</ul></li>
<li><a href="#exporting-classification-results"
id="toc-exporting-classification-results">04. Exporting Classification
Results</a>
<ul>
<li><a href="#exercise-17" id="toc-exercise-17">Exercise</a></li>
</ul></li>
<li><a href="#calculating-area" id="toc-calculating-area">05.
Calculating Area</a>
<ul>
<li><a href="#exercise-18" id="toc-exercise-18">Exercise</a></li>
</ul></li>
<li><a href="#assignment-3" id="toc-assignment-3">Assignment 3</a></li>
</ul></li>
<li><a href="#module-4-change-detection"
id="toc-module-4-change-detection">Module 4: Change Detection</a>
<ul>
<li><a href="#introduction-to-change-detection"
id="toc-introduction-to-change-detection">Introduction to Change
Detection</a></li>
<li><a href="#spectral-index-change" id="toc-spectral-index-change">01.
Spectral Index Change</a>
<ul>
<li><a href="#exercise-19" id="toc-exercise-19">Exercise</a></li>
</ul></li>
<li><a href="#spectral-distance-change"
id="toc-spectral-distance-change">02. Spectral Distance Change</a>
<ul>
<li><a href="#exercise-20" id="toc-exercise-20">Exercise</a></li>
</ul></li>
<li><a href="#direct-classification-of-change"
id="toc-direct-classification-of-change">03. Direct Classification of
Change</a>
<ul>
<li><a href="#exercise-21" id="toc-exercise-21">Exercise</a></li>
</ul></li>
<li><a href="#post-classification-comparison"
id="toc-post-classification-comparison">04. Post-classification
Comparison</a>
<ul>
<li><a href="#exercise-22" id="toc-exercise-22">Exercise</a></li>
</ul></li>
</ul></li>
<li><a href="#module-5-earth-engine-apps"
id="toc-module-5-earth-engine-apps">Module 5: Earth Engine Apps</a>
<ul>
<li><a href="#client-vs.-server" id="toc-client-vs.-server">01. Client
vs. Server</a>
<ul>
<li><a href="#exercise-23" id="toc-exercise-23">Exercise</a></li>
</ul></li>
<li><a href="#using-ui-elements" id="toc-using-ui-elements">02. Using UI
Elements</a>
<ul>
<li><a href="#exercise-24" id="toc-exercise-24">Exercise</a></li>
</ul></li>
<li><a href="#building-and-publishing-an-app"
id="toc-building-and-publishing-an-app">03. Building and Publishing an
App</a>
<ul>
<li><a href="#exercise-25" id="toc-exercise-25">Exercise</a></li>
</ul></li>
<li><a href="#publishing-the-app" id="toc-publishing-the-app">04.
Publishing the App</a>
<ul>
<li><a href="#exercise-26" id="toc-exercise-26">Exercise</a></li>
</ul></li>
<li><a href="#create-a-split-panel-app"
id="toc-create-a-split-panel-app">05. Create a Split Panel App</a>
<ul>
<li><a href="#exercise-27" id="toc-exercise-27">Exercise</a></li>
</ul></li>
</ul></li>
<li><a href="#module-6-google-earth-engine-python-api"
id="toc-module-6-google-earth-engine-python-api">Module 6: Google Earth
Engine Python API</a>
<ul>
<li><a href="#introduction-to-the-python-api"
id="toc-introduction-to-the-python-api">Introduction to the Python
API</a>
<ul>
<li><a href="#google-colab" id="toc-google-colab">Google Colab</a></li>
<li><a href="#local-development-environment"
id="toc-local-development-environment">Local Development
Environment</a></li>
</ul></li>
<li><a href="#python-api-syntax" id="toc-python-api-syntax">01. Python
API Syntax</a>
<ul>
<li><a href="#exercise-28" id="toc-exercise-28">Exercise</a></li>
</ul></li>
<li><a href="#automatic-conversion-of-javascript-code-to-python"
id="toc-automatic-conversion-of-javascript-code-to-python">02. Automatic
Conversion of Javascript Code to Python</a>
<ul>
<li><a href="#exercise-29" id="toc-exercise-29">Exercise</a></li>
</ul></li>
<li><a href="#batch-exports" id="toc-batch-exports">03. Batch
Exports</a>
<ul>
<li><a href="#exercise-30" id="toc-exercise-30">Exercise</a></li>
</ul></li>
<li><a href="#using-earth-engine-with-xarray"
id="toc-using-earth-engine-with-xarray">04. Using Earth Engine with
XArray</a>
<ul>
<li><a href="#exercise-31" id="toc-exercise-31">Exercise</a></li>
</ul></li>
<li><a href="#automating-downloads" id="toc-automating-downloads">05.
Automating Downloads</a></li>
<li><a href="#automating-exports" id="toc-automating-exports">06.
Automating Exports</a></li>
<li><a href="#using-the-google-earth-engine-qgis-plugin"
id="toc-using-the-google-earth-engine-qgis-plugin">07. Using the Google
Earth Engine QGIS Plugin</a></li>
</ul></li>
<li><a href="#supplement" id="toc-supplement">Supplement</a></li>
<li><a href="#guided-projects" id="toc-guided-projects">Guided
Projects</a>
<ul>
<li><a href="#get-the-code" id="toc-get-the-code">Get the Code</a></li>
<li><a href="#project-1-calculating-rainfall-deviation"
id="toc-project-1-calculating-rainfall-deviation">Project 1: Calculating
Rainfall Deviation</a></li>
<li><a href="#project-2-flood-mapping"
id="toc-project-2-flood-mapping">Project 2: Flood Mapping</a></li>
<li><a href="#project-3-extracting-time-series"
id="toc-project-3-extracting-time-series">Project 3: Extracting
Time-Series</a></li>
<li><a href="#project-4-landcover-analysis"
id="toc-project-4-landcover-analysis">Project 4: LandCover
Analysis</a></li>
<li><a href="#project-5-extracting-nighttime-lights-statistics"
id="toc-project-5-extracting-nighttime-lights-statistics">Project 5:
Extracting Nighttime Lights Statistics</a></li>
</ul></li>
<li><a href="#learning-resources" id="toc-learning-resources">Learning
Resources</a></li>
<li><a href="#useful-public-repositories"
id="toc-useful-public-repositories">Useful Public Repositories</a></li>
<li><a href="#debugging-errors-and-scaling-your-analysis"
id="toc-debugging-errors-and-scaling-your-analysis">Debugging Errors and
Scaling Your Analysis</a></li>
<li><a href="#data-credits" id="toc-data-credits">Data Credits</a></li>
<li><a href="#references" id="toc-references">References</a>
<ul>
<li><a href="#composites" id="toc-composites">Composites</a></li>
<li><a href="#supervised-classification"
id="toc-supervised-classification">Supervised Classification</a></li>
<li><a href="#time-series-classification"
id="toc-time-series-classification">Time-Series Classification</a></li>
</ul></li>
<li><a href="#license" id="toc-license">License</a></li>
<li><a href="#citing-and-referencing"
id="toc-citing-and-referencing">Citing and Referencing</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Google Earth Engine is a cloud-based platform that enables
large-scale processing of satellite imagery to detect changes, map
trends, and quantify differences on the Earth’s surface. This course
covers the full range of topics in Earth Engine to give the participants
practical skills to master the platform and implement their remote
sensing projects.</p>
<p><a
href="https://www.youtube.com/watch?v=jGuCnu1I2qw&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=1"
target="_blank"><img
src="https://img.youtube.com/vi/jGuCnu1I2qw/mqdefault.jpg"
alt="Watch the video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=jGuCnu1I2qw&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=1"
target="_blank">Watch the Video ↗</a></p>
<p><a
href="https://docs.google.com/presentation/d/1q8HRDTqgQEp3Hmi8IG0T7djPLTC1wRig3jXrwFTmoVE/edit?usp=sharing"
target="_blank">Access the Presentation ↗</a></p>
</div>
<div id="sign-up-for-google-earth-engine" class="section level1">
<h1>Sign-up for Google Earth Engine</h1>
<p>If you already have a Google Earth Engine account, you can skip this
step.</p>
<p>Visit our <a href="gee-sign-up.html" target="_blank">GEE Sign-Up
Guide</a> for step-by-step instructions.</p>
</div>
<div id="complete-the-class-pre-work" class="section level1">
<h1>Complete the Class Pre-Work</h1>
<p>This class needs about 2-hours of pre-work. Please watch the
following videos to get a good understanding of remote sensing and how
Earth Engine works.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=xAyNu9HbK8s"
target="_blank">Introduction to Remote Sensing</a>: This video
introduces the remote sensing concepts, terminology and techniques.</li>
<li><a href="https://www.youtube.com/watch?v=kpfncBHZBto"
target="_blank">Introduction to Google Earth Engine</a>: This video
gives a broad overview of Google Earth Engine with selected case studies
and application. The video also covers the Earth Engine architecture and
how it is different than traditional remote sensing software.</li>
</ul>
</div>
<div id="get-the-course-videos" class="section level1">
<h1>Get the Course Videos</h1>
<p>The course is accompanied by a set of videos covering the all the
modules. These videos are recorded from our live instructor-led classes
and are edited to make them easier to consume for self-study. We have 2
versions of the videos:</p>
<div id="youtube" class="section level2">
<h2>YouTube</h2>
<p>We have created a YouTube Playlist with separate videos for each
module to enable effective online-learning. <a
href="https://www.youtube.com/playlist?list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha"
target="_blank">Access the YouTube Playlist ↗</a></p>
</div>
<div id="vimeo" class="section level2">
<h2>Vimeo</h2>
<p>We are also making the module videos available on Vimeo. These videos
can be downloaded for offline learning. <a
href="https://vimeo.com/showcase/11467828?share=copy"
target="_blank">Access the Vimeo Playlist ↗</a></p>
</div>
</div>
<div id="get-the-course-materials" class="section level1">
<h1>Get the Course Materials</h1>
<p>The course material and exercises are in the form of Earth Engine
scripts shared via a code repository.</p>
<ol style="list-style-type: decimal">
<li><a
href="https://code.earthengine.google.co.in/?accept_repo=users/ujavalgandhi/End-to-End-GEE">Click
this link</a> to open Google Earth Engine code editor and add the
repository to your account.</li>
<li>If successful, you will have a new repository named
<code>users/ujavalgandhi/End-to-End-GEE</code> in the <em>Scripts</em>
tab in the <em>Reader</em> section.</li>
<li>Verify that your code editor looks like below</li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/repository.png" alt="Code Editor After Adding the Class Repository" width="75%" />
<p class="caption">
Code Editor After Adding the Class Repository
</p>
</div>
<p>If you do not see the repository in the <em>Reader</em> section,
click <em>Refresh repository cache</em> button in your <em>Scripts</em>
tab and it will show up.</p>
<div class="figure" style="text-align: center">
<img src="images/common/repository_cache.png" alt="Refresh repository cache" width="50%" />
<p class="caption">
Refresh repository cache
</p>
</div>
<p>There are several slide decks containing useful information and
references. You can access all the presentations used in the course from
the links below.</p>
<ul>
<li>Introduction and course overview [<a
href="https://docs.google.com/presentation/d/1q8HRDTqgQEp3Hmi8IG0T7djPLTC1wRig3jXrwFTmoVE/edit?usp=sharing">Presentation
↗</a>]</li>
<li>Map/Reduce Programming Concepts [<a
href="https://docs.google.com/presentation/d/10qOyxhubkwnsAVjniW54ETgwUHq3DXYKo3HGb6Gemi0/edit?usp=sharing">Presentation
↗</a>]</li>
<li>Introduction to Machine Learning &amp; Supervised Classification [<a
href="https://docs.google.com/presentation/d/19L1b5vsxb38xS8GlHNKOjvPZ0IGqDhv93681btMEL5w/edit?usp=sharing">Presentation
↗</a>]</li>
<li>Introduction to Change Detection [<a
href="https://docs.google.com/presentation/d/1vdFTWJ61yDuVfbfhpnumQ8zuMPGwGcHpHsBTRgo_o5I/edit?usp=sharing">Presentation
↗</a>]</li>
<li>Introduction to Earth Engine Apps [<a
href="https://docs.google.com/presentation/d/1u4Q91OqT9_OS4m1OWMm3uRUgu_oseqDUxHV-8mpzGz4/edit?usp=sharing">Presentation
↗</a>]</li>
<li>Introduction to Google Earth Engine Python API [<a
href="https://docs.google.com/presentation/d/1hPVRnxp2Vp1VHXBtu36SH_UtEOjPz70KcDV-zGIin3U/edit?usp=sharing">Presentation
↗</a>]</li>
</ul>
<div style="page-break-after: always;"></div>
</div>
<div id="module-1-earth-engine-basics" class="section level1">
<h1>Module 1: Earth Engine Basics</h1>
<p>Module 1 is designed to give you basic skills to be able to find
datasets you need for your project, filter them to your region of
interest, apply basic processing and export the results. Mastering this
will allow you to start using Earth Engine for your project quickly and
save a lot of time pre-processing the data.</p>
<p><a
href="https://www.youtube.com/watch?v=daYhxVVIpJU&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=2"
target="_blank"><img
src="https://img.youtube.com/vi/daYhxVVIpJU/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=daYhxVVIpJU&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=2"
target="_blank">Watch the Video ↗</a></p>
<div id="hello-world" class="section level2">
<h2>01. Hello World</h2>
<p>This script introduces the basic Javascript syntax and the video
covers the programming concepts you need to learn when using Earth
Engine. To learn more, visit <a
href="https://developers.google.com/earth-engine/tutorials/tutorial_js_01">Introduction
to JavaScript for Earth Engine</a> section of the Earth Engine User
Guide.</p>
<p>The <em>Code Editor</em> is an Integrated Development Environment
(IDE) for Earth Engine Javascript API.. It offers an easy way to type,
debug, run and manage code. Type the code below and click <em>Run</em>
to execute it and see the output in the <em>Console</em> tab.</p>
<blockquote>
<p>Tip: You can use the keyboard shortcut <em>Ctrl+Enter</em> to run the
code in the Code Editor</p>
</blockquote>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/hello_world.png" alt="Hello World" width="75%" />
<p class="caption">
Hello World
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F01b_Hello_World_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Hello World&#39;</span>)<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">// Variables</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="kw">var</span> city <span class="op">=</span> <span class="st">&#39;Bengaluru&#39;</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">var</span> country <span class="op">=</span> <span class="st">&#39;India&#39;</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">print</span>(city<span class="op">,</span> country)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">var</span> population <span class="op">=</span> <span class="dv">8400000</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">print</span>(population)<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a> </span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">// List</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="kw">var</span> majorCities <span class="op">=</span> [<span class="st">&#39;Mumbai&#39;</span><span class="op">,</span> <span class="st">&#39;Delhi&#39;</span><span class="op">,</span> <span class="st">&#39;Chennai&#39;</span><span class="op">,</span> <span class="st">&#39;Kolkata&#39;</span>]<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">print</span>(majorCities)<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">// Dictionary</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="kw">var</span> cityData <span class="op">=</span> {</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="st">&#39;city&#39;</span><span class="op">:</span> city<span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  <span class="st">&#39;population&#39;</span><span class="op">:</span> <span class="dv">8400000</span><span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="st">&#39;elevation&#39;</span><span class="op">:</span> <span class="dv">930</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fu">print</span>(cityData)<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">// Function</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="kw">var</span> greet <span class="op">=</span> <span class="kw">function</span>(name) {</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&#39;Hello &#39;</span> <span class="op">+</span> name<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">greet</span>(<span class="st">&#39;World&#39;</span>))<span class="op">;</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">// This is a comment</span></span></code></pre></div>
<div id="exercise" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F01c_Hello_World_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">// These are the 5 largest cities in the world: </span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">// Tokyo, Delhi, Shanghai, Mexico City, Sao Paulo</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">// Create a list named &#39;largeCities&#39;</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">// The list should have names of all the above cities</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">// Print the list </span></span></code></pre></div>
</div>
<div id="saving-your-work" class="section level3">
<h3>Saving Your Work</h3>
<p>When you modify any script for the course repository, you may want to
save a copy for yourself. If you try to click the <em>Save</em> button,
you will get an error message like below</p>
<p><img src="images/end_to_end_gee/setup1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>This is because the shared class repository is a <em>Read-only</em>
repository. You can click <em>Yes</em> to save a copy in your
repository. If this is the first time you are using Earth Engine, you
will be prompted to choose a <em>Earth Engine username</em>. Choose the
name carefully, as it cannot be changed once created.</p>
<p><img src="images/end_to_end_gee/setup2.png" width="50%" style="display: block; margin: auto;" /></p>
<p>After entering your username, your home folder will be created. After
that, you will be prompted to enter a new repository. A repository can
help you organize and share code. Your account can have multiple
repositories and each repository can have multiple scripts inside it. To
get started, you can create a repository named <em>default</em>.
Finally, you will be able to save the script.</p>
</div>
</div>
<div id="working-with-image-collections" class="section level2">
<h2>02. Working with Image Collections</h2>
<p>Most datasets in Earth Engine come as a <code>ImageCollection</code>.
An ImageCollection is a dataset that consists of images takes at
different time and locations - usually from the same satellite or data
provider. You can load a collection by searching the <a
href="https://developers.google.com/earth-engine/datasets">Earth Engine
Data Catalog</a> for the <em>ImageCollection ID</em>. Search for the
<em>Sentinel-2 Level 1C</em> dataset and you will find its id
<code>COPERNICUS/S2_SR</code>. Visit the <a
href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2">Sentinel-2,
Level 1C page</a> and see <em>Explore in Earth Engine</em> section to
find the code snippet to load and visualize the collection. This snippet
is a great starting point for your work with this dataset. Click the
<strong>Copy Code Sample</strong> button and paste the code into the
code editor. Click <em>Run</em> and you will see the image tiles load in
the map.</p>
<p><img src="images/end_to_end_gee/image_collection1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>In the code snippet, You will see a function
<code>Map.setCenter()</code> which sets the viewport to a specific
location and zoom level. The function takes the X coordinate
(longitude), Y coordinate (latitude) and Zoom Level parameters. Replace
the X and Y coordinates with the coordinates of your city and click
<em>Run</em> to see the images of your city.</p>
<p><img src="images/end_to_end_gee/image_collection2.png" width="75%" style="display: block; margin: auto;" /></p>
<div id="exercise-1" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F02c_Image_Collections_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co">// Find the &#39;Sentinel-2 Level-1C&#39; dataset page</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">// https://developers.google.com/earth-engine/datasets</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">// Copy/paste the code snippet</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">// Change the code to display images for your home city</span></span></code></pre></div>
</div>
</div>
<div id="filtering-image-collections" class="section level2">
<h2>03. Filtering Image Collections</h2>
<p>The collection contains all imagery ever collected by the sensor. The
entire collections are not very useful. Most applications require a
subset of the images. We use <strong>filters</strong> to select the
appropriate images. There are many types of filter functions, look at
<code>ee.Filter...</code> module to see all available filters. Select a
filter and then run the <code>filter()</code> function with the filter
parameters.</p>
<p>We will learn about 3 main types of filtering techniques</p>
<ul>
<li><strong>Filter by metadata</strong>: You can apply a filter on the
image metadata using filters such as <code>ee.Filter.eq()</code>,
<code>ee.Filter.lt()</code> etc. You can filter by PATH/ROW values,
Orbit number, Cloud cover etc.</li>
<li><strong>Filter by date</strong>: You can select images in a
particular date range using filters such as
<code>ee.Filter.date()</code>.</li>
<li><strong>Filter by location</strong>: You can select the subset of
images with a bounding box, location or geometry using the
<code>ee.Filter.bounds()</code>. You can also use the drawing tools to
draw a geometry for filtering.</li>
</ul>
<p>After applying the filters, you can use the <code>size()</code>
function to check how many images match the filters.</p>
<p><img src="images/end_to_end_gee/filters.png" width="75%" style="display: block; margin: auto;" /></p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F03b_Filtering_Image_Collection_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.60412933051538</span><span class="op">,</span> <span class="fl">12.952912912328241</span>])</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry<span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">// Filter by metadata</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">// Filter by date</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">// Filter by location</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">// Let&#39;s apply all the 3 filters together on the collection</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">// First apply metadata fileter</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="kw">var</span> filtered1 <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))<span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">// Apply date filter on the results</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="kw">var</span> filtered2 <span class="op">=</span> filtered1<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">// Lastly apply the location filter</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="kw">var</span> filtered3 <span class="op">=</span> filtered2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">// Instead of applying filters one after the other, we can &#39;chain&#39; them</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">// Use the . notation to apply all the filters together</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>  </span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="fu">print</span>(filtered<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span></code></pre></div>
<div id="exercise-2" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F03c_Filtering_Image_Collection_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.60412933051538</span><span class="op">,</span> <span class="fl">12.952912912328241</span>])<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="fu">print</span>(filtered<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">// Delete the &#39;geometry&#39; variable</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">// Add a point at your chosen location</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">// Change the filter to find images from January 2023</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">// Note: If you are in a very cloudy region, </span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">// make sure to adjust the CLOUDY_PIXEL_PERCENTAGE</span></span></code></pre></div>
</div>
</div>
<div id="creating-mosaics-and-composites-from-imagecollections"
class="section level2">
<h2>04. Creating Mosaics and Composites from ImageCollections</h2>
<p>The default order of the collection is by date. So when you display
the collection, it implicitly creates a mosaic with the latest pixels on
top. You can call <code>.mosaic()</code> on a ImageCollection to create
a mosaic image from the pixels at the top.</p>
<p>We can also create a composite image by applying selection criteria
to each pixel from all pixels in the stack. Here we use the
<code>median()</code> function to create a composite where each pixel
value is the median of all pixels from the stack.</p>
<blockquote>
<p>Tip: If you need to create a mosaic where the images are in a
specific order, you can use the <code>.sort()</code> function to sort
your collection by a property first.</p>
</blockquote>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/mosaic_composite.png" alt="Mosaic vs. Composite" width="100%" />
<p class="caption">
Mosaic vs. Composite
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F04b_Mosaics_and_Composites_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.60412933051538</span><span class="op">,</span> <span class="fl">12.952912912328241</span>])<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a> </span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="kw">var</span> mosaic <span class="op">=</span> filtered<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a> </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="kw">var</span> medianComposite <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filtered<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Filtered Collection&#39;</span>)<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(mosaic<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Mosaic&#39;</span>)<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(medianComposite<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Median Composite&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-3" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F04c_Mosaics_and_Composites_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">// Create a median composite for the year 2020 and load it to the map</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">// Compare both the composites to see the changes in your city</span></span></code></pre></div>
</div>
</div>
<div id="working-with-feature-collections" class="section level2">
<h2>05. Working with Feature Collections</h2>
<p>Feature Collections are similar to Image Collections - but they
contain <em>Features</em>, not images. They are equivalent to Vector
Layers in a GIS. We can load, filter and display Feature Collections
using similar techniques that we have learned so far.</p>
<p>Search for <em>GAUL Second Level Administrative Boundaries</em> and
load the collection. This is a global collection that contains all
Admin2 boundaries. We can apply a filter using the
<code>ADM1_NAME</code> property to get all Admin2 boundaries
(i.e. Districts) from a state.</p>
<p><img src="images/end_to_end_gee/feature_collection.png" width="75%" style="display: block; margin: auto;" /></p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F05b_Feature_Collections_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">// Use the GAUL 2015 dataset from the GEE Data Catalog</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> admin2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">// Alternatively, use the newer GAUL 2024 dataset from the community catalog</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">// https://gee-community-catalog.org/projects/gaul/</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&quot;projects/sat-io/open-datasets/FAO/GAUL/GAUL_2024_L2&quot;</span>)<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> admin2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;gaul1_name&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="kw">var</span> visParams <span class="op">=</span> {<span class="st">&#39;color&#39;</span><span class="op">:</span> <span class="st">&#39;red&#39;</span>}<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filtered<span class="op">,</span> visParams<span class="op">,</span> <span class="st">&#39;Selected Districts&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-4" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F05c_Feature_Collections_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)<span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(admin2<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;grey&#39;</span>}<span class="op">,</span> <span class="st">&#39;All Admin2 Polygons&#39;</span>)<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">// Exercise </span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">// Apply filters to select your chosen Admin2 region</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">// Display the results in &#39;red&#39; color</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">// Hint1: Switch to the &#39;Inspector&#39; tab and click on any</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">// polygon to know its properties and their values</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">// Hint2: Many countries do not have unique names for</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">// Admin2 regions. Make sure to apply a filter to select</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">// the Admin1 region that contains your chosen Admin2 region</span></span></code></pre></div>
</div>
</div>
<div id="importing-data" class="section level2">
<h2>06. Importing Data</h2>
<p>You can import vector or raster data into Earth Engine. We will now
import a shapefile of <a href="https://bit.ly/ghs-ucdb-shapefile">Urban
Centres</a> from JRC’s GHS Urban Centre Database (GHS-UCDB). Unzip the
<code>ghs_urban_centers.zip</code> into a folder on your computer. In
the Code Editor, go to <em>Assets → New → Table Upload → Shape
Files</em>. Select the <code>.shp</code>, <code>.shx</code>,
<code>.dbf</code> and .<code>prj</code> files. Enter
<code>ghs_urban_centers</code> as the <em>Asset Name</em> and click
<em>Upload</em>. Once the upload and ingest finishes, you will have a
new asset in the <em>Assets</em> tab. The shapefile is imported as a
Feature Collection in Earth Engine. Select the
<code>ghs_urban_centers</code> asset and click <em>Import</em>. You can
then visualize the imported data.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/import.png" alt="Importing a Shapefile" width="75%" />
<p class="caption">
Importing a Shapefile
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F06b_Import_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co">// Let&#39;s import some data to Earth Engine</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">// Upload the &#39;GHS Urban Centers&#39; database from JRC</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">// https://ghsl.jrc.ec.europa.eu/ghs_stat_ucdb2015mt_r2019a.php</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">// Download the shapefile from https://bit.ly/ghs-ucdb-shapefile</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">// Unzip and upload</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">// Import the collection</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="kw">var</span> urban <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>)<span class="op">;</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">// Visualize the collection</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(urban<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span>}<span class="op">,</span> <span class="st">&#39;Urban Areas&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-5" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F06c_Import_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">var</span> urban <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>)<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">print</span>(urban<span class="op">.</span><span class="fu">first</span>())<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">// Apply a filter to select only large urban centers</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">// in your country and display it on the map.</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">// Select all urban centers in your country with</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">// a population greater than 1000000</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">// Hint1: Use the property &#39;CTR_MN_NM&#39; containing country names</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">// Hint2: Use the property &#39;P15&#39; containing 2015 Population</span></span></code></pre></div>
</div>
</div>
<div id="clipping-images" class="section level2">
<h2>07. Clipping Images</h2>
<p>It is often desirable to clip the images to your area of interest.
You can use the <code>clip()</code> function to mask out an image using
a geometry.</p>
<blockquote>
<p>While in a Desktop software, clipping is desirable to remove
unnecessary portion of a large image and save computation time, in Earth
Engine clipping can actually increase the computation time. As described
in the <a
href="https://developers.google.com/earth-engine/guides/best_practices?hl=en#if-you-dont-need-to-clip,-dont-use-clip">Earth
Engine Coding Best Practices</a> guide, avoid clipping the images or do
it at the end of your script.</p>
</blockquote>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/clipping.png" alt="Original vs. Clipped Image" width="100%" />
<p class="caption">
Original vs. Clipped Image
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F07b_Clipping_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="kw">var</span> urban <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>)<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">// Find the name of the urban centre</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">// by adding the layer to the map and using Inspector.</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> urban</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;UC_NM_MN&#39;</span><span class="op">,</span> <span class="st">&#39;Bengaluru&#39;</span>))</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;CTR_MN_NM&#39;</span><span class="op">,</span> <span class="st">&#39;India&#39;</span>))<span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> filtered<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> </span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span> </span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="kw">var</span> clipped <span class="op">=</span> image<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(clipped<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Clipped&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-6" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F07c_Clipping_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">// Add the imported table to the Map</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">// Use the Inspector to find the id of your home city or any urban area of your choice</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">// Change the filter to use the id of the selected feature</span></span></code></pre></div>
</div>
</div>
<div id="exporting-data" class="section level2">
<h2>08. Exporting Data</h2>
<p>Earth Engine allows for exporting both vector and raster data to be
used in an external program. Vector data can be exported as a
<code>CSV</code> or a <code>Shapefile</code>, while Rasters can be
exported as <code>GeoTIFF</code> files. We will now export the
Sentinel-2 Composite as a GeoTIFF file.</p>
<blockquote>
<p>Tip: Code Editor supports autocompletion of API functions using the
combination <em>Ctrl+Space</em>. Type a few characters of a function and
press <em>Ctrl+Space</em> to see autocomplete suggestions. You can also
use the same key combination to fill all parameters of the function
automatically.</p>
</blockquote>
<p>Once you run this script, the <em>Tasks</em> tab will be highlighted.
Switch to the tab and you will see the tasks waiting. Click <em>Run</em>
next to each task to start the process.</p>
<p><img src="images/end_to_end_gee/export_task01.png" width="75%" style="display: block; margin: auto;" /></p>
<p>On clicking the <em>Run</em> button, you will be prompted for a
confirmation dialog. Verify the settings and click <em>Run</em> to start
the export.</p>
<p><img src="images/end_to_end_gee/export_task02.png" width="40%" style="display: block; margin: auto;" /></p>
<p>Once the Export finishes, a GeoTiff file for each export task will be
added to your Google Drive in the specified folder. You can download
them and use it in a GIS software.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/exporting_data.png" alt="Visualized vs. Raw Composite" width="85%" />
<p class="caption">
Visualized vs. Raw Composite
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F08b_Export_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="kw">var</span> urban <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>)<span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> urban</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;UC_NM_MN&#39;</span><span class="op">,</span> <span class="st">&#39;Bengaluru&#39;</span>))</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;CTR_MN_NM&#39;</span><span class="op">,</span> <span class="st">&#39;India&#39;</span>))<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> filtered<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> </span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span> </span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="kw">var</span> clipped <span class="op">=</span> image<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(clipped<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Clipped&#39;</span>)<span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="kw">var</span> exportImage <span class="op">=</span> clipped<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="co">// Export raw image with original pixel values</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>    <span class="dt">image</span><span class="op">:</span> exportImage<span class="op">,</span></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Bangalore_Composite_Raw&#39;</span><span class="op">,</span></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>    <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>    <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;bangalore_composite_raw&#39;</span><span class="op">,</span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>    <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a><span class="co">// Export visualized image as colorized RGB image</span></span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a><span class="co">// Rather than exporting raw bands, we can apply a rendered image</span></span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a><span class="co">// visualize() function allows you to apply the same parameters </span></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a><span class="co">// that are used in earth engine which exports a 3-band RGB image</span></span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a><span class="co">// Note: Visualized images are not suitable for analysis</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a><span class="kw">var</span> visualized <span class="op">=</span> clipped<span class="op">.</span><span class="fu">visualize</span>(rgbVis)<span class="op">;</span></span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a>    <span class="dt">image</span><span class="op">:</span> visualized<span class="op">,</span></span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Bangalore_Composite_Visualized&#39;</span><span class="op">,</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a>    <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>    <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;bangalore_composite_visualized&#39;</span><span class="op">,</span></span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a>    <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div id="exercise-7" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F08c_Export_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">// Write the export function to export the results for your chosen urban area</span></span></code></pre></div>
</div>
</div>
<div id="assignment-1" class="section level2">
<h2>Assignment 1</h2>
<p>Load the Night Lights Data for May 2015 and May 2020. Compare the
imagery for your region and find the changes in the city due to COVID-19
effect.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/assignment1.png" alt="Assignment1 Expected Output" width="85%" />
<p class="caption">
Assignment1 Expected Output
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3AAssignments%2FAssignment1"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co">// Assignment</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">// Export the Night Lights images for May,2015 and May,2020</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">// Workflow:</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">// Load the VIIRS Nighttime Day/Night Band Composites collection</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">// Filter the collection to the date range</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">// Extract the &#39;avg_rad&#39; band which represents the nighttime lights</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">// Clip the image to the geometry of your city</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">// Export the resulting image as a GeoTIFF file.</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">// Hint1: </span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">// There are 2 VIIRS Nighttime Day/Night collections</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">// Use the one that corrects for stray light</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">// Hint2: </span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">// The collection contains 1 global image per month</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">// After filtering for the month, there will be only 1 image in the collection</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="co">// You can use the following technique to extract that image</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co">// var image = ee.Image(filtered.first())</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="module-2-earth-engine-intermediate" class="section level1">
<h1>Module 2: Earth Engine Intermediate</h1>
<p>Module 2 builds on the basic Earth Engine skills you have gained.
This model introduces the parallel programming concepts using Map/Reduce
- which is key in effectively using Earth Engine for analyzing large
volumes of data. You will learn how to use the Earth Engine API for
calculating various spectral indices, do cloud masking and then use
map/reduce to do apply these computations to collections of imagery. You
will also learn how to take long time-series of data and create
charts.</p>
<p><a
href="https://www.youtube.com/watch?v=UW3jinsnLko&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=3"
target="_blank"><img
src="https://img.youtube.com/vi/UW3jinsnLko/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=UW3jinsnLko&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=3"
target="_blank">Watch the Video ↗</a></p>
<div id="earth-engine-objects" class="section level2">
<h2>01. Earth Engine Objects</h2>
<p>This script introduces the basics of the Earth Engine API. When
programming in Earth Engine, you must use the Earth Engine API so that
your computations can use the Google Earth Engine servers. To learn
more, visit <a
href="https://developers.google.com/earth-engine/tutorial_js_02">Earth
Engine Objects and Methods</a> section of the Earth Engine User
Guide.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F01b_Earth_Engine_Objects_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co">// Let&#39;s see how to take a list of numbers and add 1 to each element</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="kw">var</span> myList <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">// Define a function that takes a number and adds 1 to it</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="kw">var</span> myFunction <span class="op">=</span> <span class="kw">function</span>(number) {</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="cf">return</span> number <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">myFunction</span>(<span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">//Re-Define a function using Earth Engine API</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="kw">var</span> myFunction <span class="op">=</span> <span class="kw">function</span>(number) { </span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Number</span>(number)<span class="op">.</span><span class="fu">add</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">// Map the function of the list</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="kw">var</span> newList <span class="op">=</span> myList<span class="op">.</span><span class="fu">map</span>(myFunction)<span class="op">;</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="fu">print</span>(newList)<span class="op">;</span> </span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">// Extracting value from a list</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="kw">var</span> value <span class="op">=</span> newList<span class="op">.</span><span class="fu">get</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="fu">print</span>(value)<span class="op">;</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="co">// Casting</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co">// Let&#39;s try to do some computation on the extracted value</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">//var newValue = value.add(1)</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">//print(newValue)</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co">// You get an error because Earth Engine doesn&#39;t know what is the type of &#39;value&#39;</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co">// We need to cast it to appropriate type first</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a><span class="kw">var</span> value <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(value)<span class="op">;</span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a><span class="kw">var</span> newValue <span class="op">=</span> value<span class="op">.</span><span class="fu">add</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="fu">print</span>(newValue)<span class="op">;</span></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a><span class="co">// Dictionary</span></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a><span class="co">// Convert javascript objects to EE Objects</span></span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a><span class="kw">var</span> data <span class="op">=</span> {<span class="st">&#39;city&#39;</span><span class="op">:</span> <span class="st">&#39;Bengaluru&#39;</span><span class="op">,</span> <span class="st">&#39;population&#39;</span><span class="op">:</span> <span class="dv">8400000</span><span class="op">,</span> <span class="st">&#39;elevation&#39;</span><span class="op">:</span> <span class="dv">930</span>}<span class="op">;</span></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a><span class="kw">var</span> eeData <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(data)<span class="op">;</span></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a><span class="co">// Once converted, you can use the methods from the</span></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="co">// ee.Dictionary module</span></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a><span class="fu">print</span>(eeData<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;city&#39;</span>))<span class="op">;</span></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a><span class="co">// Dates</span></span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a><span class="co">// For any date computation, you should use ee.Date module</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a><span class="kw">var</span> date <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2019-01-01&#39;</span>)<span class="op">;</span></span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a><span class="kw">var</span> futureDate <span class="op">=</span> date<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">;</span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a><span class="fu">print</span>(futureDate)<span class="op">;</span></span></code></pre></div>
<blockquote>
<p>As a general rule, you should always use Earth Engine API methods in
your code, there is one exception where you will need to use client-side
Javascript method. If you want to get the current time, the server
doesn’t know your time. You need to use javascript method and cast it to
an Earth Engine object.</p>
<pre><code>var now = Date.now()
print(now)
var now = ee.Date(now)
print(now)</code></pre>
</blockquote>
<div id="exercise-8" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F01c_Earth_Engine_Objects_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.60412933051538</span><span class="op">,</span> <span class="fl">12.952912912328241</span>])<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="kw">var</span> now <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="kw">var</span> now <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(now)<span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">// Apply another filter to the collection below to filter images</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">// collected in the last 1-month</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">// Do not hard-code the dates, it should always show images</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">// from the past 1-month whenever you run the script</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">// Hint: Use ee.Date.advance() function</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">//   to compute the date 1 month before now</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span></code></pre></div>
</div>
</div>
<div id="calculating-indices" class="section level2">
<h2>02. Calculating Indices</h2>
<p>Spectral Indices are central to many aspects of remote sensing.
Whether you are studying vegetation or tracking fires - you will need to
compute a pixel-wise ratio of 2 or more bands. The most commonly used
formula for calculating an index is the <em>Normalized Difference</em>
between 2 bands. Earth Engine provides a helper function
<code>normalizedDifference()</code> to help calculate normalized
indices, such as Normalized Difference Vegetation Index (NDVI). For more
complex formulae, you can also use the <code>expression()</code>
function to describe the calculation.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/indices.png" alt="MNDWI, SAVI and NDVI images" width="75%" />
<p class="caption">
MNDWI, SAVI and NDVI images
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F02b_Calculating_Indices_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)<span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="kw">var</span> filteredAdmin2 <span class="op">=</span> admin2</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> filteredAdmin2<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="kw">var</span> filteredS2 <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span> </span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">// Calculate  Normalized Difference Vegetation Index (NDVI)</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">// &#39;NIR&#39; (B8) and &#39;RED&#39; (B4)</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndvi&#39;</span>])<span class="op">;</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">// Calculate Modified Normalized Difference Water Index (MNDWI)</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">// &#39;GREEN&#39; (B3) and &#39;SWIR1&#39; (B11)</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="kw">var</span> mndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;mndwi&#39;</span>])<span class="op">;</span> </span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">// Calculate Soil-adjusted Vegetation Index (SAVI)</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">// 1.5 * ((NIR - RED) / (NIR + RED + 0.5))</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a><span class="co">// For more complex indices, you can use the expression() function</span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a><span class="co">// Note: </span></span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a><span class="co">// For the SAVI formula, the pixel values need to converted to reflectances</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a><span class="co">// Multiplyng the pixel values by &#39;scale&#39; gives us the reflectance value</span></span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a><span class="co">// The scale value is 0.0001 for Sentinel-2 dataset</span></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a><span class="kw">var</span> savi <span class="op">=</span> image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a>    <span class="st">&#39;1.5 * ((NIR - RED) / (NIR + RED + 0.5))&#39;</span><span class="op">,</span> {</span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>      <span class="st">&#39;NIR&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)<span class="op">,</span></span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a>      <span class="st">&#39;RED&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)<span class="op">,</span></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a>})<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;savi&#39;</span>)<span class="op">;</span></span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a><span class="kw">var</span> ndviVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;green&#39;</span>]}<span class="op">;</span></span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a><span class="kw">var</span> ndwiVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="fl">0.5</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;blue&#39;</span>]}<span class="op">;</span></span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Image&#39;</span>)<span class="op">;</span></span>
<span id="cb20-45"><a href="#cb20-45" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(mndwi<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> ndwiVis<span class="op">,</span> <span class="st">&#39;mndwi&#39;</span>)<span class="op">;</span></span>
<span id="cb20-46"><a href="#cb20-46" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(savi<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> ndviVis<span class="op">,</span> <span class="st">&#39;savi&#39;</span>)<span class="op">;</span></span>
<span id="cb20-47"><a href="#cb20-47" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(ndvi<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> ndviVis<span class="op">,</span> <span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-9" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F02c_Calculating_Indices_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="kw">var</span> filteredAdmin2 <span class="op">=</span> admin2</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))<span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> filteredAdmin2<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="kw">var</span> filteredS2 <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span> </span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Image&#39;</span>)<span class="op">;</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="co">// Change the filter to select your chosen Admin2 region</span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="co">// Calculate the Normalized Difference Built-Up Index (NDBI) for the image</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="co">// Hint: NDBI = (SWIR1 – NIR) / (SWIR1 + NIR)</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">// Visualize the built-up area using a &#39;red&#39; palette</span></span></code></pre></div>
</div>
</div>
<div id="computation-on-imagecollections" class="section level2">
<h2>03. Computation on ImageCollections</h2>
<p>So far we have learnt how to run computation on single images. If you
want to apply some computation - such as calculating an index - to many
images, you need to use <code>map()</code>. You first define a function
that takes 1 image and returns the result of the computation on that
image. Then you can <code>map()</code> that function over the
ImageCollection which results in a new ImageCollection with the results
of the computation. This is similar to a <em>for-loop</em> that you
maybe familiar with - but using <code>map()</code> allows the
computation to run in parallel. Learn more at <a
href="https://developers.google.com/earth-engine/guides/ic_mapping">Mapping
over an ImageCollection</a></p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/imagecollection_computation.png" alt="NDVI computation on an ImageCollection" width="100%" />
<p class="caption">
NDVI computation on an ImageCollection
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F03b_Computation_on_Image_Collections_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="kw">var</span> admin1 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level1&#39;</span>)<span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>    </span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">// Select an Admin1 region</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="kw">var</span> filteredAdmin1 <span class="op">=</span> admin1<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))<span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> filteredAdmin1<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="kw">var</span> filteredS2 <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">median</span>()<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Admin1 Composite&#39;</span>)<span class="op">;</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a><span class="co">// Write a function that computes NDVI for an image and adds it as a band</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addNDVI</span>(image) {</span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">;</span></span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>}</span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a><span class="co">// Map the function over the collection</span></span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a><span class="kw">var</span> withNdvi <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">map</span>(addNDVI)<span class="op">;</span></span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> withNdvi<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a><span class="kw">var</span> ndviComposite <span class="op">=</span> composite<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [</span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a>  <span class="st">&#39;FFFFFF&#39;</span><span class="op">,</span> <span class="st">&#39;CE7E45&#39;</span><span class="op">,</span> <span class="st">&#39;DF923D&#39;</span><span class="op">,</span> <span class="st">&#39;F1B555&#39;</span><span class="op">,</span> <span class="st">&#39;FCD163&#39;</span><span class="op">,</span> <span class="st">&#39;99B718&#39;</span><span class="op">,</span></span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a>  <span class="st">&#39;74A901&#39;</span><span class="op">,</span> <span class="st">&#39;66A000&#39;</span><span class="op">,</span> <span class="st">&#39;529400&#39;</span><span class="op">,</span> <span class="st">&#39;3E8601&#39;</span><span class="op">,</span> <span class="st">&#39;207401&#39;</span><span class="op">,</span> <span class="st">&#39;056201&#39;</span><span class="op">,</span></span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a>  <span class="st">&#39;004C00&#39;</span><span class="op">,</span> <span class="st">&#39;023B01&#39;</span><span class="op">,</span> <span class="st">&#39;012E01&#39;</span><span class="op">,</span> <span class="st">&#39;011D01&#39;</span><span class="op">,</span> <span class="st">&#39;011301&#39;</span>]<span class="op">;</span></span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a><span class="kw">var</span> ndviVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="fl">0.5</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette }<span class="op">;</span></span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(ndviComposite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> ndviVis<span class="op">,</span> <span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-10" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F03c_Computation_on_Image_Collections_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="kw">var</span> admin1 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level1&#39;</span>)<span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>    </span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">// Select an Admin1 region</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="kw">var</span> filteredAdmin1 <span class="op">=</span> admin1<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))<span class="op">;</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> filteredAdmin1<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="kw">var</span> filteredS2 <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Admin1 Composite&#39;</span>)<span class="op">;</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a><span class="co">// This function calculates both NDVI and NDWI indices</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a><span class="co">// and returns an image with 2 new bands added to the original image.</span></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addIndices</span>(image) {</span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>  <span class="kw">var</span> ndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndwi&#39;</span>)<span class="op">;</span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">.</span><span class="fu">addBands</span>(ndwi)<span class="op">;</span></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>}</span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a><span class="co">// Map the function over the collection</span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a><span class="kw">var</span> withIndices <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">map</span>(addIndices)<span class="op">;</span></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a><span class="co">// Composite</span></span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> withIndices<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a><span class="fu">print</span>(composite)<span class="op">;</span></span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a><span class="co">// Display a map of NDWI for the region</span></span>
<span id="cb23-35"><a href="#cb23-35" tabindex="-1"></a><span class="co">// Select the &#39;ndwi&#39; band and clip it before displaying</span></span>
<span id="cb23-36"><a href="#cb23-36" tabindex="-1"></a><span class="co">// Use a color palette from https://colorbrewer2.org/</span></span>
<span id="cb23-37"><a href="#cb23-37" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" tabindex="-1"></a><span class="co">// Hint: Use .select() function to select a band</span></span></code></pre></div>
</div>
</div>
<div id="cloud-masking" class="section level2">
<h2>04. Cloud Masking</h2>
<p>Masking pixels in an image makes those pixels transparent and
excludes them from analysis and visualization. To mask an image, we can
use the <code>updateMask()</code> function and pass it an image with 0
and 1 values. All pixels where the mask image is 0 will be masked.</p>
<p>Most remote sensing datasets come with a QA or Cloud Mask band that
contains the information on whether pixels is cloudy or not. Your
<em>Code Editor</em> contains pre-defined functions for masking clouds
for popular datasets under <em>Scripts Tab → Examples → Cloud
Masking</em>. To understand how cloud-masking functions work and learn
advanced techniques for bitmasking, please refer to our article on <a
href="https://spatialthoughts.com/2021/08/19/qa-bands-bitmasks-gee/">Working
with QA Bands and Bitmasks in Google Earth Engine</a>.</p>
<p>The script below takes the Sentinel-2 masking function and shows how
to apply it on an image.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/cloud_masking.png" alt="Applying pixel-wise QA bitmask" width="100%" />
<p class="caption">
Applying pixel-wise QA bitmask
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F04b_Cloud_Masking_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.60412933051538</span><span class="op">,</span> <span class="fl">12.952912912328241</span>])<span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>    </span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="kw">var</span> filteredS2 <span class="op">=</span> s2</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">35</span>))</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="co">// Sort the collection and pick the most cloudy image</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="kw">var</span> filteredS2Sorted <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">sort</span>({</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>  <span class="dt">property</span><span class="op">:</span> <span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>  <span class="dt">ascending</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filteredS2Sorted<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(image)<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Full Image&#39;</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a><span class="co">// Write a function for Cloud masking</span></span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)<span class="op">;</span></span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)</span>
<span id="cb24-34"><a href="#cb24-34" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb24-35"><a href="#cb24-35" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])<span class="op">;</span></span>
<span id="cb24-36"><a href="#cb24-36" tabindex="-1"></a>}</span>
<span id="cb24-37"><a href="#cb24-37" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" tabindex="-1"></a><span class="kw">var</span> imageMasked <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="fu">maskS2clouds</span>(image))<span class="op">;</span></span>
<span id="cb24-39"><a href="#cb24-39" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(imageMasked<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Masked Image&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-11" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F04c_Cloud_Masking_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.60412933051538</span><span class="op">,</span> <span class="fl">12.952912912328241</span>])<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    </span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="kw">var</span> filteredS2 <span class="op">=</span> s2</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">35</span>))</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">// Sort the collection and pick the most cloudy image</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="kw">var</span> filteredS2Sorted <span class="op">=</span> filteredS2<span class="op">.</span><span class="fu">sort</span>({</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  <span class="dt">property</span><span class="op">:</span> <span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  <span class="dt">ascending</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filteredS2Sorted<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(image)<span class="op">;</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Full Image&#39;</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="co">// Write a function for Cloud masking</span></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)<span class="op">;</span></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)</span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])<span class="op">;</span></span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>}</span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a><span class="kw">var</span> imageMasked <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="fu">maskS2clouds</span>(image))<span class="op">;</span></span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(imageMasked<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Masked Image (QA60 Band)&#39;</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a><span class="co">// Use Google&#39;s Cloud Score+ Mask</span></span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a><span class="co">// Link S2 and CS+ results.</span></span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a><span class="kw">var</span> imageWithCs <span class="op">=</span> image<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.6</span><span class="op">;</span></span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb25-53"><a href="#cb25-53" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb25-54"><a href="#cb25-54" tabindex="-1"></a>}</span>
<span id="cb25-55"><a href="#cb25-55" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" tabindex="-1"></a><span class="kw">var</span> imageMaskedCs <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="fu">maskLowQA</span>(imageWithCs))<span class="op">;</span></span>
<span id="cb25-57"><a href="#cb25-57" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(imageMaskedCs<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Masked Image (Cloud Score+)&#39;</span>)<span class="op">;</span></span>
<span id="cb25-58"><a href="#cb25-58" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" tabindex="-1"></a><span class="co">// Google CloudScore+ dataset provides state-of-the-art </span></span>
<span id="cb25-60"><a href="#cb25-60" tabindex="-1"></a><span class="co">// cloud masks for Sentinel-2 images.</span></span>
<span id="cb25-61"><a href="#cb25-61" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" tabindex="-1"></a><span class="co">// It grades each image pixel on continuous scale between 0 and 1,</span></span>
<span id="cb25-63"><a href="#cb25-63" tabindex="-1"></a><span class="co">// 0 = &#39;not clear&#39; (occluded), </span></span>
<span id="cb25-64"><a href="#cb25-64" tabindex="-1"></a><span class="co">// 1 = &#39;clear&#39; (unoccluded)</span></span>
<span id="cb25-65"><a href="#cb25-65" tabindex="-1"></a></span>
<span id="cb25-66"><a href="#cb25-66" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb25-67"><a href="#cb25-67" tabindex="-1"></a></span>
<span id="cb25-68"><a href="#cb25-68" tabindex="-1"></a><span class="co">// Delete the &#39;geometry&#39; variable and add a point at your chosen location</span></span>
<span id="cb25-69"><a href="#cb25-69" tabindex="-1"></a><span class="co">// Run the script and compare the results of the CloudScore+ mask with</span></span>
<span id="cb25-70"><a href="#cb25-70" tabindex="-1"></a><span class="co">// the QA60 mask</span></span>
<span id="cb25-71"><a href="#cb25-71" tabindex="-1"></a><span class="co">// Adjust the &#39;clearThreshold&#39; value to suit your scene</span></span>
<span id="cb25-72"><a href="#cb25-72" tabindex="-1"></a></span>
<span id="cb25-73"><a href="#cb25-73" tabindex="-1"></a><span class="co">// Hint:</span></span>
<span id="cb25-74"><a href="#cb25-74" tabindex="-1"></a><span class="co">// clearThreshold values between 0.50 and 0.65 generally work well</span></span>
<span id="cb25-75"><a href="#cb25-75" tabindex="-1"></a><span class="co">// Higher values will remove thin clouds, haze &amp; cirrus shadows.</span></span></code></pre></div>
<blockquote>
<p>Learn more about the <a
href="https://medium.com/google-earth/all-clear-with-cloud-score-bd6ee2e2235e">Cloud
Score+</a> project.</p>
</blockquote>
</div>
</div>
<div id="reducers" class="section level2">
<h2>05. Reducers</h2>
<p>When writing parallel computing code, a <em>Reduce</em> operation
allows you to compute statistics on a large amount of inputs. In Earth
Engine, you need to run reduction operation when creating composites,
calculating statistics, doing regression analysis etc. The Earth Engine
API comes with a large number of built-in reducer functions (such as
<code>ee.Reducer.sum()</code>, <code>ee.Reducer.histogram()</code>,
<code>ee.Reducer.linearFit()</code> etc.) that can perform a variety of
statistical operations on input data. You can run reducers using the
<code>reduce()</code> function. Earth Engine supports running reducers
on all data structures that can hold multiple values, such as Images
(reducers run on different bands), ImageCollection, FeatureCollection,
List, Dictionary etc. The script below introduces basic concepts related
to reducers.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F05b_Reducers_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co">// Computing stats on a list</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="kw">var</span> myList <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">print</span>(myList)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">// Use a reducer to compute average value</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="kw">var</span> mean <span class="op">=</span> myList<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>())<span class="op">;</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="fu">print</span>(mean)<span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>  [<span class="fl">82.60642647743225</span><span class="op">,</span> <span class="fl">27.16350437805251</span>]<span class="op">,</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  [<span class="fl">82.60984897613525</span><span class="op">,</span> <span class="fl">27.1618529901377</span>]<span class="op">,</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>  [<span class="fl">82.61088967323303</span><span class="op">,</span> <span class="fl">27.163695288375266</span>]<span class="op">,</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  [<span class="fl">82.60757446289062</span><span class="op">,</span> <span class="fl">27.16517483230927</span>]</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="co">// Apply a reducer on a image collection</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a><span class="fu">print</span>(filtered<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a><span class="kw">var</span> collMean <span class="op">=</span> filtered<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>())<span class="op">;</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Reducer on Collection&#39;</span><span class="op">,</span> collMean)<span class="op">;</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;COPERNICUS/S2/20190223T050811_20190223T051829_T44RPR&#39;</span>)<span class="op">;</span></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Image&#39;</span>)<span class="op">;</span></span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(geometry<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;red&#39;</span>}<span class="op">,</span> <span class="st">&#39;Farm&#39;</span>)<span class="op">;</span></span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a><span class="co">// If we want to compute the average value in each band,</span></span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a><span class="co">// we can use reduceRegion instead</span></span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e10</span></span>
<span id="cb26-39"><a href="#cb26-39" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb26-40"><a href="#cb26-40" tabindex="-1"></a><span class="fu">print</span>(stats)<span class="op">;</span></span>
<span id="cb26-41"><a href="#cb26-41" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" tabindex="-1"></a><span class="co">// Result of reduceRegion is a dictionary. </span></span>
<span id="cb26-43"><a href="#cb26-43" tabindex="-1"></a><span class="co">// We can extract the values using .get() function</span></span>
<span id="cb26-44"><a href="#cb26-44" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Average value in B4&#39;</span><span class="op">,</span> stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;B4&#39;</span>))<span class="op">;</span></span></code></pre></div>
<div id="exercise-12" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F05c_Reducers_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  [<span class="fl">82.60642647743225</span><span class="op">,</span> <span class="fl">27.16350437805251</span>]<span class="op">,</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  [<span class="fl">82.60984897613525</span><span class="op">,</span> <span class="fl">27.1618529901377</span>]<span class="op">,</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  [<span class="fl">82.61088967323303</span><span class="op">,</span> <span class="fl">27.163695288375266</span>]<span class="op">,</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>  [<span class="fl">82.60757446289062</span><span class="op">,</span> <span class="fl">27.16517483230927</span>]</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>          </span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED/20190223T050811_20190223T051829_T44RPR&#39;</span>)<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Image&#39;</span>)<span class="op">;</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(geometry<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;red&#39;</span>}<span class="op">,</span> <span class="st">&#39;Farm&#39;</span>)<span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="co">// Compute the average NDVI for the farm from the given image</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co">// Hint: Use the reduceRegion() function</span></span></code></pre></div>
</div>
</div>
<div id="time-series-charts" class="section level2">
<h2>06. Time-Series Charts</h2>
<p>Now we can put together all the skills we have learnt so far -
filter, map, reduce, and cloud-masking to create a chart of average NDVI
values for a given farm over 1 year. Earth Engine API comes with support
for charting functions based on the Google Chart API. Here we use the
<code>ui.Chart.image.series()</code> function to create a time-series
chart.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/charts1.png" alt="Computing NDVI Time-series for a Farm" width="100%" />
<p class="caption">
Computing NDVI Time-series for a Farm
</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/charts2.png" alt="NDVI Time-series showing Dual-Cropping Cycle" width="100%" />
<p class="caption">
NDVI Time-series showing Dual-Cropping Cycle
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F06b_Time_Series_Charts_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  [<span class="fl">82.60642647743225</span><span class="op">,</span> <span class="fl">27.16350437805251</span>]<span class="op">,</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  [<span class="fl">82.60984897613525</span><span class="op">,</span> <span class="fl">27.1618529901377</span>]<span class="op">,</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  [<span class="fl">82.61088967323303</span><span class="op">,</span> <span class="fl">27.163695288375266</span>]<span class="op">,</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  [<span class="fl">82.60757446289062</span><span class="op">,</span> <span class="fl">27.16517483230927</span>]</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(geometry<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;red&#39;</span>}<span class="op">,</span> <span class="st">&#39;Farm&#39;</span>)<span class="op">;</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2017-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2018-01-01&#39;</span>))</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a><span class="kw">var</span> maskLowQA <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a><span class="co">// map() the function to mask all images</span></span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)</span>
<span id="cb28-35"><a href="#cb28-35" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb28-36"><a href="#cb28-36" tabindex="-1"></a></span>
<span id="cb28-37"><a href="#cb28-37" tabindex="-1"></a><span class="co">// Function to scale pixel values to reflectance</span></span>
<span id="cb28-38"><a href="#cb28-38" tabindex="-1"></a><span class="kw">var</span> scaleValues <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb28-39"><a href="#cb28-39" tabindex="-1"></a>  <span class="kw">var</span> scaledImage <span class="op">=</span> image<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)<span class="op">;</span></span>
<span id="cb28-40"><a href="#cb28-40" tabindex="-1"></a>  <span class="co">// This creates a new image and we lose the properties</span></span>
<span id="cb28-41"><a href="#cb28-41" tabindex="-1"></a>  <span class="co">// copy the system:time_start property </span></span>
<span id="cb28-42"><a href="#cb28-42" tabindex="-1"></a>  <span class="co">// from the originalimage</span></span>
<span id="cb28-43"><a href="#cb28-43" tabindex="-1"></a>  <span class="cf">return</span> scaledImage</span>
<span id="cb28-44"><a href="#cb28-44" tabindex="-1"></a>    <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])<span class="op">;</span></span>
<span id="cb28-45"><a href="#cb28-45" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-46"><a href="#cb28-46" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" tabindex="-1"></a><span class="co">// Function that computes NDVI for an image and adds it as a band</span></span>
<span id="cb28-48"><a href="#cb28-48" tabindex="-1"></a><span class="kw">var</span> addNDVI <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb28-49"><a href="#cb28-49" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb28-50"><a href="#cb28-50" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">;</span></span>
<span id="cb28-51"><a href="#cb28-51" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb28-52"><a href="#cb28-52" tabindex="-1"></a></span>
<span id="cb28-53"><a href="#cb28-53" tabindex="-1"></a><span class="co">// Map the functions over the collection</span></span>
<span id="cb28-54"><a href="#cb28-54" tabindex="-1"></a><span class="kw">var</span> withNdvi <span class="op">=</span> filteredMasked</span>
<span id="cb28-55"><a href="#cb28-55" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(scaleValues)</span>
<span id="cb28-56"><a href="#cb28-56" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(addNDVI)<span class="op">;</span></span>
<span id="cb28-57"><a href="#cb28-57" tabindex="-1"></a></span>
<span id="cb28-58"><a href="#cb28-58" tabindex="-1"></a><span class="co">// Display a time-series chart</span></span>
<span id="cb28-59"><a href="#cb28-59" tabindex="-1"></a><span class="kw">var</span> chart <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">series</span>({</span>
<span id="cb28-60"><a href="#cb28-60" tabindex="-1"></a>  <span class="dt">imageCollection</span><span class="op">:</span> withNdvi<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">,</span></span>
<span id="cb28-61"><a href="#cb28-61" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb28-62"><a href="#cb28-62" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb28-63"><a href="#cb28-63" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb28-64"><a href="#cb28-64" tabindex="-1"></a>})<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb28-65"><a href="#cb28-65" tabindex="-1"></a>      <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb28-66"><a href="#cb28-66" tabindex="-1"></a>      <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb28-67"><a href="#cb28-67" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDVI Time Series&#39;</span><span class="op">,</span></span>
<span id="cb28-68"><a href="#cb28-68" tabindex="-1"></a>      <span class="dt">interpolateNulls</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb28-69"><a href="#cb28-69" tabindex="-1"></a>      <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDVI&#39;</span>}<span class="op">,</span></span>
<span id="cb28-70"><a href="#cb28-70" tabindex="-1"></a>      <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> <span class="st">&#39;YYYY-MMM&#39;</span>}</span>
<span id="cb28-71"><a href="#cb28-71" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-72"><a href="#cb28-72" tabindex="-1"></a>    </span>
<span id="cb28-73"><a href="#cb28-73" tabindex="-1"></a><span class="fu">print</span>(chart)<span class="op">;</span></span></code></pre></div>
<div id="exercise-13" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A02-Earth-Engine-Intermediate%2F06c_Time_Series_Charts_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co">// Delete the farm boundary from the previous script </span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="co">// and add another farm at a location of your choice</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="co">// Print the chart.</span></span></code></pre></div>
</div>
</div>
<div id="assignment-2" class="section level2">
<h2>Assignment 2</h2>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/assignment2.png" alt="Assignment2 Expected Output" width="75%" />
<p class="caption">
Assignment2 Expected Output
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3AAssignments%2FAssignment2"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="kw">var</span> terraclimate <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;IDAHO_EPSCOR/TERRACLIMATE&quot;</span>)<span class="op">;</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.54849920033682</span><span class="op">,</span> <span class="fl">12.91215102400037</span>])<span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    </span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co">// Assignment</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="co">// Use TerraClimate dataset to chart a 50 year time series</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co">// of temparature at any location</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="co">// Workflow</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="co">// Load the TerraClimate collection</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="co">// Select the &#39;tmmx&#39; band</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="co">// Scale the band values</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="co">// Filter the scaled collection to the desired date range</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="co">// Use ui.Chart.image.series() function to create the chart</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="co">// Hint1</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="co">// The &#39;tmnx&#39; band has a scaling factor of 0.1 as per</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="co">// https://developers.google.com/earth-engine/datasets/catalog/IDAHO_EPSCOR_TERRACLIMATE#bands</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="co">// This means that we need to multiply each pixel value by 0.1</span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="co">// to obtain the actual temparature value</span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a><span class="co">// map() a function and multiply each image</span></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a><span class="kw">var</span> tmax <span class="op">=</span> terraclimate<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;tmmx&#39;</span>)<span class="op">;</span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="co">// Function that applies the scaling factor to the each image </span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a><span class="co">// Multiplying creates a new image that doesn&#39;t have the same properties</span></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a><span class="co">// Use copyProperties() function to copy timestamp to new image</span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a><span class="kw">var</span> scaleImage <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.1</span>)</span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a>    <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span>[<span class="st">&#39;system:time_start&#39;</span>])<span class="op">;</span></span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a><span class="kw">var</span> tmaxScaled <span class="op">=</span> tmax<span class="op">.</span><span class="fu">map</span>(scaleImage)<span class="op">;</span></span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a><span class="co">// Hint2</span></span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a><span class="co">// You will need to specify pixel resolution as the scale parameter </span></span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a><span class="co">// in the charting function</span></span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a><span class="co">// Use projection().nominalScale() to find the </span></span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a><span class="co">// image resolution in meters</span></span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(terraclimate<span class="op">.</span><span class="fu">first</span>())</span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a><span class="fu">print</span>(image<span class="op">.</span><span class="fu">projection</span>()<span class="op">.</span><span class="fu">nominalScale</span>())</span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="module-3-supervised-classification" class="section level1">
<h1>Module 3: Supervised Classification</h1>
<div id="introduction-to-machine-learning-and-supervised-classification"
class="section level2">
<h2>Introduction to Machine Learning and Supervised Classification</h2>
<p>Supervised classification is arguably the most important classical
machine learning techniques in remote sensing. Applications range from
generating Land Use/Land Cover maps to change detection. Google Earth
Engine is unique suited to do supervised classification at scale. The
interactive nature of Earth Engine development allows for iterative
development of supervised classification workflows by combining many
different datasets into the model. This module covers basic supervised
classification workflow, accuracy assessment, hyperparameter tuning and
change detection.</p>
<p><a
href="https://www.youtube.com/watch?v=lULwcRpkMv8&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=4"
target="_blank"><img
src="https://img.youtube.com/vi/lULwcRpkMv8/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=lULwcRpkMv8&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=4"
target="_blank">Watch the Video ↗</a></p>
</div>
<div id="basic-supervised-classification" class="section level2">
<h2>01. Basic Supervised Classification</h2>
<p>We will learn how to do a basic land cover classification using
training samples collected from the Code Editor using the High
Resolution basemap imagery provided by Google Maps. This method requires
no prior training data and is quite effective to generate high quality
classification samples anywhere in the world. The goal is to classify
each source pixel into one of the following classes - urban, bare, water
or vegetation. Using the drawing tools in the code editor, you create 4
new feature collection with points representing pixels of that class.
Each feature collection has a property called <code>landcover</code>
with values of 0, 1, 2 or 3 indicating whether the feature collection
represents urban, bare, water or vegetation respectively. We then train
a <em>Random Forest</em> classifier using these training set to build a
model and apply it to all the pixels of the image to create a 4 class
image.</p>
<blockquote>
<p>Fun fact: The classifiers in Earth Engine API have names starting
with <strong>smile</strong> - such as
<code>ee.Classifier.smileRandomForest()</code>. The <em>smile</em> part
refers to the <a
href="https://haifengl.github.io/index.html">Statistical Machine
Intelligence and Learning Engine (SMILE)</a> JAVA library which is used
by Google Earth Engine to implement these algorithms.</p>
</blockquote>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/classified.png" alt="Supervised Classification Output" width="75%" />
<p class="caption">
Supervised Classification Output
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F01d_Basic_Supervised_Classification_(noimport)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="kw">var</span> bangalore <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>)<span class="op">;</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> bangalore<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="co">// The following collections were created using the </span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="co">// Drawing Tools in the code editor </span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="kw">var</span> urban <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/urban_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="kw">var</span> bare <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/bare_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="kw">var</span> water <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/water_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="kw">var</span> vegetation <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/vegetation_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="co">// Display the input composite.</span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;image&#39;</span>)<span class="op">;</span></span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a><span class="kw">var</span> gcps <span class="op">=</span> urban<span class="op">.</span><span class="fu">merge</span>(bare)<span class="op">.</span><span class="fu">merge</span>(water)<span class="op">.</span><span class="fu">merge</span>(vegetation)<span class="op">;</span></span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> gcps<span class="op">,</span> </span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span> </span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)<span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb31-40"><a href="#cb31-40" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb31-41"><a href="#cb31-41" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span> </span>
<span id="cb31-42"><a href="#cb31-42" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> composite<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb31-43"><a href="#cb31-43" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb31-44"><a href="#cb31-44" tabindex="-1"></a><span class="co">// // Classify the image.</span></span>
<span id="cb31-45"><a href="#cb31-45" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> composite<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb31-46"><a href="#cb31-46" tabindex="-1"></a><span class="co">// Choose a 4-color palette</span></span>
<span id="cb31-47"><a href="#cb31-47" tabindex="-1"></a><span class="co">// Assign a color for each class in the following order</span></span>
<span id="cb31-48"><a href="#cb31-48" tabindex="-1"></a><span class="co">// Urban, Bare, Water, Vegetation</span></span>
<span id="cb31-49"><a href="#cb31-49" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb31-50"><a href="#cb31-50" tabindex="-1"></a></span>
<span id="cb31-51"><a href="#cb31-51" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb31-52"><a href="#cb31-52" tabindex="-1"></a><span class="co">// Display the GCPs</span></span>
<span id="cb31-53"><a href="#cb31-53" tabindex="-1"></a><span class="co">// We use the style() function to style the GCPs</span></span>
<span id="cb31-54"><a href="#cb31-54" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(palette)<span class="op">;</span></span>
<span id="cb31-55"><a href="#cb31-55" tabindex="-1"></a><span class="kw">var</span> landcover <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>])<span class="op">;</span></span>
<span id="cb31-56"><a href="#cb31-56" tabindex="-1"></a></span>
<span id="cb31-57"><a href="#cb31-57" tabindex="-1"></a><span class="kw">var</span> gcpsStyled <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb31-58"><a href="#cb31-58" tabindex="-1"></a>  landcover<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(lc){</span>
<span id="cb31-59"><a href="#cb31-59" tabindex="-1"></a>    <span class="kw">var</span> color <span class="op">=</span> palette<span class="op">.</span><span class="fu">get</span>(landcover<span class="op">.</span><span class="fu">indexOf</span>(lc))<span class="op">;</span></span>
<span id="cb31-60"><a href="#cb31-60" tabindex="-1"></a>    <span class="kw">var</span> markerStyle <span class="op">=</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="dt">pointShape</span><span class="op">:</span> <span class="st">&#39;diamond&#39;</span><span class="op">,</span> </span>
<span id="cb31-61"><a href="#cb31-61" tabindex="-1"></a>      <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">fillColor</span><span class="op">:</span> color}<span class="op">;</span></span>
<span id="cb31-62"><a href="#cb31-62" tabindex="-1"></a>    <span class="cf">return</span> gcps<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;landcover&#39;</span><span class="op">,</span> lc))</span>
<span id="cb31-63"><a href="#cb31-63" tabindex="-1"></a>                <span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(point){</span>
<span id="cb31-64"><a href="#cb31-64" tabindex="-1"></a>                  <span class="cf">return</span> point<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;style&#39;</span><span class="op">,</span> markerStyle)</span>
<span id="cb31-65"><a href="#cb31-65" tabindex="-1"></a>                })</span>
<span id="cb31-66"><a href="#cb31-66" tabindex="-1"></a>      }))<span class="op">.</span><span class="fu">flatten</span>()<span class="op">;</span></span>
<span id="cb31-67"><a href="#cb31-67" tabindex="-1"></a>      </span>
<span id="cb31-68"><a href="#cb31-68" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(gcpsStyled<span class="op">.</span><span class="fu">style</span>({<span class="dt">styleProperty</span><span class="op">:</span><span class="st">&quot;style&quot;</span>})<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;GCPs&#39;</span>)</span>
<span id="cb31-69"><a href="#cb31-69" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(gcpsStyled)</span></code></pre></div>
<div id="exercise-14" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F01c_Basic_Supervised_Classification_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="co">// Perform supervised classification for your city</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co">// Delete the geometry below and draw a polygon</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="co">// over your chosen city</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  [<span class="fl">77.4149</span><span class="op">,</span> <span class="fl">13.1203</span>]<span class="op">,</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  [<span class="fl">77.4149</span><span class="op">,</span> <span class="fl">12.7308</span>]<span class="op">,</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  [<span class="fl">77.8090</span><span class="op">,</span> <span class="fl">12.7308</span>]<span class="op">,</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  [<span class="fl">77.8090</span><span class="op">,</span> <span class="fl">13.1203</span>]</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>          </span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb32-21"><a href="#cb32-21" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb32-23"><a href="#cb32-23" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" tabindex="-1"></a><span class="co">// Display the input composite.</span></span>
<span id="cb32-25"><a href="#cb32-25" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb32-27"><a href="#cb32-27" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;image&#39;</span>)<span class="op">;</span></span>
<span id="cb32-28"><a href="#cb32-28" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb32-30"><a href="#cb32-30" tabindex="-1"></a><span class="co">// Add training points for 4 classes</span></span>
<span id="cb32-31"><a href="#cb32-31" tabindex="-1"></a><span class="co">// Assign the &#39;landcover&#39; property as follows</span></span>
<span id="cb32-32"><a href="#cb32-32" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" tabindex="-1"></a><span class="co">// urban: 0</span></span>
<span id="cb32-34"><a href="#cb32-34" tabindex="-1"></a><span class="co">// bare: 1</span></span>
<span id="cb32-35"><a href="#cb32-35" tabindex="-1"></a><span class="co">// water: 2</span></span>
<span id="cb32-36"><a href="#cb32-36" tabindex="-1"></a><span class="co">// vegetation: 3</span></span>
<span id="cb32-37"><a href="#cb32-37" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" tabindex="-1"></a><span class="co">// After adding points, uncomments lines below</span></span>
<span id="cb32-39"><a href="#cb32-39" tabindex="-1"></a></span>
<span id="cb32-40"><a href="#cb32-40" tabindex="-1"></a><span class="co">// var gcps = urban.merge(bare).merge(water).merge(vegetation);</span></span>
<span id="cb32-41"><a href="#cb32-41" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" tabindex="-1"></a><span class="co">// // Overlay the point on the image to get training data.</span></span>
<span id="cb32-43"><a href="#cb32-43" tabindex="-1"></a><span class="co">// var training = composite.sampleRegions({</span></span>
<span id="cb32-44"><a href="#cb32-44" tabindex="-1"></a><span class="co">//   collection: gcps, </span></span>
<span id="cb32-45"><a href="#cb32-45" tabindex="-1"></a><span class="co">//   properties: [&#39;landcover&#39;], </span></span>
<span id="cb32-46"><a href="#cb32-46" tabindex="-1"></a><span class="co">//   scale: 10,</span></span>
<span id="cb32-47"><a href="#cb32-47" tabindex="-1"></a><span class="co">//   tileScale: 16</span></span>
<span id="cb32-48"><a href="#cb32-48" tabindex="-1"></a><span class="co">// });</span></span>
<span id="cb32-49"><a href="#cb32-49" tabindex="-1"></a><span class="co">// print(training);</span></span>
<span id="cb32-50"><a href="#cb32-50" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" tabindex="-1"></a></span>
<span id="cb32-52"><a href="#cb32-52" tabindex="-1"></a><span class="co">// // Train a classifier.</span></span>
<span id="cb32-53"><a href="#cb32-53" tabindex="-1"></a><span class="co">// var classifier = ee.Classifier.smileRandomForest(50).train({</span></span>
<span id="cb32-54"><a href="#cb32-54" tabindex="-1"></a><span class="co">//   features: training,  </span></span>
<span id="cb32-55"><a href="#cb32-55" tabindex="-1"></a><span class="co">//   classProperty: &#39;landcover&#39;, </span></span>
<span id="cb32-56"><a href="#cb32-56" tabindex="-1"></a><span class="co">//   inputProperties: composite.bandNames()</span></span>
<span id="cb32-57"><a href="#cb32-57" tabindex="-1"></a><span class="co">// });</span></span>
<span id="cb32-58"><a href="#cb32-58" tabindex="-1"></a><span class="co">// // // Classify the image.</span></span>
<span id="cb32-59"><a href="#cb32-59" tabindex="-1"></a><span class="co">// var classified = composite.classify(classifier);</span></span>
<span id="cb32-60"><a href="#cb32-60" tabindex="-1"></a></span>
<span id="cb32-61"><a href="#cb32-61" tabindex="-1"></a><span class="co">// // Choose a 4-color palette</span></span>
<span id="cb32-62"><a href="#cb32-62" tabindex="-1"></a><span class="co">// // Assign a color for each class in the following order</span></span>
<span id="cb32-63"><a href="#cb32-63" tabindex="-1"></a><span class="co">// // Urban, Bare, Water, Vegetation</span></span>
<span id="cb32-64"><a href="#cb32-64" tabindex="-1"></a><span class="co">// var palette = [&#39;#cc6d8f&#39;, &#39;#ffc107&#39;, &#39;#1e88e5&#39;, &#39;#004d40&#39; ];</span></span>
<span id="cb32-65"><a href="#cb32-65" tabindex="-1"></a></span>
<span id="cb32-66"><a href="#cb32-66" tabindex="-1"></a><span class="co">// Map.addLayer(classified.clip(geometry), {min: 0, max: 3, palette: palette}, &#39;2019&#39;);</span></span></code></pre></div>
</div>
</div>
<div id="accuracy-assessment" class="section level2">
<h2>02. Accuracy Assessment</h2>
<p>It is important to get a quantitative estimate of the accuracy of the
classification. To do this, a common strategy is to divide your training
samples into 2 random fractions - one used for <em>training</em> the
model and the other for <em>validation</em> of the predictions. Once a
classifier is trained, it can be used to classify the entire image. We
can then compare the classified values with the ones in the validation
fraction. We can use the <code>ee.Classifier.confusionMatrix()</code>
method to calculate a <em>Confusion Matrix</em> representing expected
accuracy.</p>
<p>Classification results are evaluated based on the following
metrics</p>
<ul>
<li><strong>Overall Accuracy</strong>: How many samples were classified
correctly.</li>
<li><strong>Producer’s Accuracy</strong>: How well did the
classification predict each class.</li>
<li><strong>Consumer’s Accuracy (Reliability)</strong>: How reliable is
the prediction in each class.</li>
<li><strong>Kappa Coefficient</strong>: How well the classification
performed as compared to random assignment.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/accuracy_assessment.png" alt="Accuracy Assessment" width="75%" />
<p class="caption">
Accuracy Assessment
</p>
</div>
<blockquote>
<p>Don’t get carried away tweaking your model to give you the highest
validation accuracy. You must use both qualitative measures (such as
visual inspection of results) along with quantitative measures to assess
the results.</p>
</blockquote>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F02b_Accuracy_Assessment_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="kw">var</span> basin <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&quot;WWF/HydroSHEDS/v1/Basins/hybas_7&quot;</span>)<span class="op">;</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&quot;users/ujavalgandhi/e2e/arkavathy_gcps&quot;</span>)<span class="op">;</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    </span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="kw">var</span> arkavathy <span class="op">=</span> basin<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;HYBAS_ID&#39;</span><span class="op">,</span> <span class="dv">4071139640</span>))<span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> arkavathy<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a> </span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a><span class="co">// Display the input composite.</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;image&#39;</span>)<span class="op">;</span></span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a><span class="co">// Add a random column and split the GCPs into training and validation set</span></span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">randomColumn</span>()<span class="op">;</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a><span class="co">// This being a simpler classification, we take 60% points</span></span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a><span class="co">// for validation. Normal recommended ratio is</span></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a><span class="co">// 70% training, 30% validation</span></span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a><span class="kw">var</span> trainingGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a><span class="kw">var</span> validationGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gte</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a></span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> trainingGcp<span class="op">,</span></span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)</span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a><span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span></span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> composite<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a></span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> composite<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a><span class="co">// Accuracy Assessment</span></span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb33-60"><a href="#cb33-60" tabindex="-1"></a></span>
<span id="cb33-61"><a href="#cb33-61" tabindex="-1"></a><span class="co">// Use classification map to assess accuracy using the validation fraction</span></span>
<span id="cb33-62"><a href="#cb33-62" tabindex="-1"></a><span class="co">// of the overall training set created above.</span></span>
<span id="cb33-63"><a href="#cb33-63" tabindex="-1"></a><span class="kw">var</span> test <span class="op">=</span> classified<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb33-64"><a href="#cb33-64" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> validationGcp<span class="op">,</span></span>
<span id="cb33-65"><a href="#cb33-65" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb33-66"><a href="#cb33-66" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb33-67"><a href="#cb33-67" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb33-68"><a href="#cb33-68" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb33-69"><a href="#cb33-69" tabindex="-1"></a></span>
<span id="cb33-70"><a href="#cb33-70" tabindex="-1"></a><span class="kw">var</span> testConfusionMatrix <span class="op">=</span> test<span class="op">.</span><span class="fu">errorMatrix</span>(<span class="st">&#39;landcover&#39;</span><span class="op">,</span> <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb33-71"><a href="#cb33-71" tabindex="-1"></a><span class="co">// Printing of confusion matrix may time out. Alternatively, you can export it as CSV</span></span>
<span id="cb33-72"><a href="#cb33-72" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Confusion Matrix&#39;</span><span class="op">,</span> testConfusionMatrix)<span class="op">;</span></span>
<span id="cb33-73"><a href="#cb33-73" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Test Accuracy&#39;</span><span class="op">,</span> testConfusionMatrix<span class="op">.</span><span class="fu">accuracy</span>())<span class="op">;</span></span>
<span id="cb33-74"><a href="#cb33-74" tabindex="-1"></a></span>
<span id="cb33-75"><a href="#cb33-75" tabindex="-1"></a><span class="co">// Alternate workflow </span></span>
<span id="cb33-76"><a href="#cb33-76" tabindex="-1"></a><span class="co">// This is similar to machine learning practice</span></span>
<span id="cb33-77"><a href="#cb33-77" tabindex="-1"></a><span class="kw">var</span> validation <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb33-78"><a href="#cb33-78" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> validationGcp<span class="op">,</span></span>
<span id="cb33-79"><a href="#cb33-79" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb33-80"><a href="#cb33-80" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb33-81"><a href="#cb33-81" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb33-82"><a href="#cb33-82" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb33-83"><a href="#cb33-83" tabindex="-1"></a></span>
<span id="cb33-84"><a href="#cb33-84" tabindex="-1"></a><span class="kw">var</span> test <span class="op">=</span> validation<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb33-85"><a href="#cb33-85" tabindex="-1"></a></span>
<span id="cb33-86"><a href="#cb33-86" tabindex="-1"></a><span class="kw">var</span> testConfusionMatrix <span class="op">=</span> test<span class="op">.</span><span class="fu">errorMatrix</span>(<span class="st">&#39;landcover&#39;</span><span class="op">,</span> <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb33-87"><a href="#cb33-87" tabindex="-1"></a><span class="co">// Printing of confusion matrix may time out. Alternatively, you can export it as CSV</span></span>
<span id="cb33-88"><a href="#cb33-88" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Confusion Matrix&#39;</span><span class="op">,</span> testConfusionMatrix)<span class="op">;</span></span>
<span id="cb33-89"><a href="#cb33-89" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Test Accuracy&#39;</span><span class="op">,</span> testConfusionMatrix<span class="op">.</span><span class="fu">accuracy</span>())<span class="op">;</span></span></code></pre></div>
<div id="exercise-15" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F02c_Accuracy_Assessment_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;users/ujavalgandhi/e2e/arkavathy_2019_composite&#39;</span>)<span class="op">;</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">randomColumn</span>()<span class="op">;</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="kw">var</span> trainingGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="kw">var</span> validationGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gte</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> trainingGcp<span class="op">,</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)</span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a><span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> composite<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> composite<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a><span class="co">// Accuracy Assessment</span></span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" tabindex="-1"></a><span class="co">// Use classification map to assess accuracy using the validation fraction</span></span>
<span id="cb34-31"><a href="#cb34-31" tabindex="-1"></a><span class="co">// of the overall training set created above.</span></span>
<span id="cb34-32"><a href="#cb34-32" tabindex="-1"></a><span class="kw">var</span> test <span class="op">=</span> classified<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb34-33"><a href="#cb34-33" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> validationGcp<span class="op">,</span></span>
<span id="cb34-34"><a href="#cb34-34" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb34-35"><a href="#cb34-35" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb34-36"><a href="#cb34-36" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb34-37"><a href="#cb34-37" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb34-38"><a href="#cb34-38" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" tabindex="-1"></a><span class="kw">var</span> testConfusionMatrix <span class="op">=</span> test<span class="op">.</span><span class="fu">errorMatrix</span>(<span class="st">&#39;landcover&#39;</span><span class="op">,</span> <span class="st">&#39;classification&#39;</span>)<span class="op">;</span></span>
<span id="cb34-40"><a href="#cb34-40" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Confusion Matrix&#39;</span><span class="op">,</span> testConfusionMatrix)<span class="op">;</span></span>
<span id="cb34-41"><a href="#cb34-41" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Test Accuracy&#39;</span><span class="op">,</span> testConfusionMatrix<span class="op">.</span><span class="fu">accuracy</span>())<span class="op">;</span></span>
<span id="cb34-42"><a href="#cb34-42" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb34-44"><a href="#cb34-44" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" tabindex="-1"></a><span class="co">// Calculate and print the following assessment metrics</span></span>
<span id="cb34-46"><a href="#cb34-46" tabindex="-1"></a><span class="co">// 1. Producer&#39;s accuracy</span></span>
<span id="cb34-47"><a href="#cb34-47" tabindex="-1"></a><span class="co">// 2. Consumer&#39;s accuracy</span></span>
<span id="cb34-48"><a href="#cb34-48" tabindex="-1"></a><span class="co">// 3. F1-score</span></span>
<span id="cb34-49"><a href="#cb34-49" tabindex="-1"></a></span>
<span id="cb34-50"><a href="#cb34-50" tabindex="-1"></a><span class="co">// Hint: Look at the ee.ConfusionMatrix module for appropriate methods</span></span></code></pre></div>
</div>
</div>
<div id="improving-the-classification" class="section level2">
<h2>03. Improving the Classification</h2>
<p>The Earth Engine data-model is especially well suited for machine
learning tasks because of its ability to easily incorporate data sources
of different spatial resolutions, projections and data types together By
giving additional information to the classifier, it is able to separate
different classes easily. Here we take the same example and augment it
with the following techniques</p>
<ul>
<li><em>Apply Cloud Masking</em></li>
<li><em>Add Spectral Indices</em>: We add bands for different spectral
indices such as - NDVI, NDBI, MNDWI and BSI.</li>
<li><em>Add Elevation and Slope</em>: We also add slope and elevation
bands from the ALOS DEM.</li>
<li><em>Normalize the Inputs</em>: Machine learning models work best
when all the inputs have the same scale. We will divide each band with
the maximum value. This method ensures that all input values are between
0-1. A more <a href="#image-normalization-and-standardization">complete
and robust technique</a> for image normalization is provided in the
course Supplement.</li>
</ul>
<p>Our training features have more parameters and contain values of the
same scale. The result is a much improved classification.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/improving_classification.png" alt="Improved Classification Accuracy with use of Spectral Indices and Elevation Data" width="75%" />
<p class="caption">
Improved Classification Accuracy with use of Spectral Indices and
Elevation Data
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F03b_Improving_the_Classification_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="kw">var</span> basin <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;WWF/HydroSHEDS/v1/Basins/hybas_7&#39;</span>)<span class="op">;</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="kw">var</span> alos <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;JAXA/ALOS/AW3D30/V3_2&#39;</span>)<span class="op">;</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a><span class="kw">var</span> arkavathy <span class="op">=</span> basin<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;HYBAS_ID&#39;</span><span class="op">,</span> <span class="dv">4071139640</span>))<span class="op">;</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> arkavathy<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a>}</span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb35-33"><a href="#cb35-33" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)</span>
<span id="cb35-34"><a href="#cb35-34" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb35-35"><a href="#cb35-35" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filteredMasked<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb35-37"><a href="#cb35-37" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" tabindex="-1"></a><span class="kw">var</span> addIndices <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb35-39"><a href="#cb35-39" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndvi&#39;</span>])<span class="op">;</span></span>
<span id="cb35-40"><a href="#cb35-40" tabindex="-1"></a>  <span class="kw">var</span> ndbi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B11&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndbi&#39;</span>])<span class="op">;</span></span>
<span id="cb35-41"><a href="#cb35-41" tabindex="-1"></a>  <span class="kw">var</span> mndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;mndwi&#39;</span>])<span class="op">;</span> </span>
<span id="cb35-42"><a href="#cb35-42" tabindex="-1"></a>  <span class="kw">var</span> bsi <span class="op">=</span> image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb35-43"><a href="#cb35-43" tabindex="-1"></a>      <span class="st">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span><span class="op">,</span> {</span>
<span id="cb35-44"><a href="#cb35-44" tabindex="-1"></a>        <span class="st">&#39;X&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B11&#39;</span>)<span class="op">,</span> <span class="co">//swir1</span></span>
<span id="cb35-45"><a href="#cb35-45" tabindex="-1"></a>        <span class="st">&#39;Y&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">,</span>  <span class="co">//red</span></span>
<span id="cb35-46"><a href="#cb35-46" tabindex="-1"></a>        <span class="st">&#39;A&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)<span class="op">,</span> <span class="co">// nir</span></span>
<span id="cb35-47"><a href="#cb35-47" tabindex="-1"></a>        <span class="st">&#39;B&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B2&#39;</span>)<span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb35-48"><a href="#cb35-48" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;bsi&#39;</span>)<span class="op">;</span></span>
<span id="cb35-49"><a href="#cb35-49" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">.</span><span class="fu">addBands</span>(ndbi)<span class="op">.</span><span class="fu">addBands</span>(mndwi)<span class="op">.</span><span class="fu">addBands</span>(bsi)<span class="op">;</span></span>
<span id="cb35-50"><a href="#cb35-50" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb35-51"><a href="#cb35-51" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> <span class="fu">addIndices</span>(composite)<span class="op">;</span></span>
<span id="cb35-53"><a href="#cb35-53" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" tabindex="-1"></a><span class="co">// Calculate Slope and Elevation</span></span>
<span id="cb35-55"><a href="#cb35-55" tabindex="-1"></a></span>
<span id="cb35-56"><a href="#cb35-56" tabindex="-1"></a><span class="co">// Use ALOS World 3D v3</span></span>
<span id="cb35-57"><a href="#cb35-57" tabindex="-1"></a></span>
<span id="cb35-58"><a href="#cb35-58" tabindex="-1"></a><span class="co">// This comes as a collection of images</span></span>
<span id="cb35-59"><a href="#cb35-59" tabindex="-1"></a><span class="co">// We mosaic it to create a single image</span></span>
<span id="cb35-60"><a href="#cb35-60" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" tabindex="-1"></a><span class="co">// Need to set the projection correctly on the mosaic</span></span>
<span id="cb35-62"><a href="#cb35-62" tabindex="-1"></a><span class="co">// for the slope computation</span></span>
<span id="cb35-63"><a href="#cb35-63" tabindex="-1"></a><span class="kw">var</span> proj <span class="op">=</span> alos<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">projection</span>()<span class="op">;</span></span>
<span id="cb35-64"><a href="#cb35-64" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" tabindex="-1"></a><span class="kw">var</span> elevation <span class="op">=</span> alos<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;DSM&#39;</span>)<span class="op">.</span><span class="fu">mosaic</span>()</span>
<span id="cb35-66"><a href="#cb35-66" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setDefaultProjection</span>(proj)</span>
<span id="cb35-67"><a href="#cb35-67" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;elev&#39;</span>)<span class="op">;</span></span>
<span id="cb35-68"><a href="#cb35-68" tabindex="-1"></a></span>
<span id="cb35-69"><a href="#cb35-69" tabindex="-1"></a><span class="kw">var</span> slope <span class="op">=</span> ee<span class="op">.</span><span class="at">Terrain</span><span class="op">.</span><span class="fu">slope</span>(elevation)</span>
<span id="cb35-70"><a href="#cb35-70" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;slope&#39;</span>)<span class="op">;</span></span>
<span id="cb35-71"><a href="#cb35-71" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> composite<span class="op">.</span><span class="fu">addBands</span>(elevation)<span class="op">.</span><span class="fu">addBands</span>(slope)<span class="op">;</span></span>
<span id="cb35-73"><a href="#cb35-73" tabindex="-1"></a><span class="kw">var</span> visParams <span class="op">=</span> {<span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">gamma</span><span class="op">:</span> <span class="fl">1.2</span>}<span class="op">;</span></span>
<span id="cb35-74"><a href="#cb35-74" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> visParams<span class="op">,</span> <span class="st">&#39;RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb35-75"><a href="#cb35-75" tabindex="-1"></a></span>
<span id="cb35-76"><a href="#cb35-76" tabindex="-1"></a><span class="co">// Normalize the image </span></span>
<span id="cb35-77"><a href="#cb35-77" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" tabindex="-1"></a><span class="co">// Machine learning algorithms work best on images when all features have</span></span>
<span id="cb35-79"><a href="#cb35-79" tabindex="-1"></a><span class="co">// the same range</span></span>
<span id="cb35-80"><a href="#cb35-80" tabindex="-1"></a></span>
<span id="cb35-81"><a href="#cb35-81" tabindex="-1"></a><span class="co">// Function to Normalize Image</span></span>
<span id="cb35-82"><a href="#cb35-82" tabindex="-1"></a><span class="co">// Pixel Values should be between 0 and 1</span></span>
<span id="cb35-83"><a href="#cb35-83" tabindex="-1"></a><span class="co">// Formula is (x - xmin) / (xmax - xmin)</span></span>
<span id="cb35-84"><a href="#cb35-84" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb35-85"><a href="#cb35-85" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(image){</span>
<span id="cb35-86"><a href="#cb35-86" tabindex="-1"></a>  <span class="kw">var</span> bandNames <span class="op">=</span> image<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb35-87"><a href="#cb35-87" tabindex="-1"></a>  <span class="co">// Compute min and max of the image</span></span>
<span id="cb35-88"><a href="#cb35-88" tabindex="-1"></a>  <span class="kw">var</span> minDict <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb35-89"><a href="#cb35-89" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">min</span>()<span class="op">,</span></span>
<span id="cb35-90"><a href="#cb35-90" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb35-91"><a href="#cb35-91" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb35-92"><a href="#cb35-92" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span><span class="op">,</span></span>
<span id="cb35-93"><a href="#cb35-93" tabindex="-1"></a>    <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb35-94"><a href="#cb35-94" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb35-95"><a href="#cb35-95" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb35-96"><a href="#cb35-96" tabindex="-1"></a>  <span class="kw">var</span> maxDict <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb35-97"><a href="#cb35-97" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>()<span class="op">,</span></span>
<span id="cb35-98"><a href="#cb35-98" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb35-99"><a href="#cb35-99" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb35-100"><a href="#cb35-100" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span><span class="op">,</span></span>
<span id="cb35-101"><a href="#cb35-101" tabindex="-1"></a>    <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb35-102"><a href="#cb35-102" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb35-103"><a href="#cb35-103" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb35-104"><a href="#cb35-104" tabindex="-1"></a>  <span class="kw">var</span> mins <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(minDict<span class="op">.</span><span class="fu">values</span>(bandNames))<span class="op">;</span></span>
<span id="cb35-105"><a href="#cb35-105" tabindex="-1"></a>  <span class="kw">var</span> maxs <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(maxDict<span class="op">.</span><span class="fu">values</span>(bandNames))<span class="op">;</span></span>
<span id="cb35-106"><a href="#cb35-106" tabindex="-1"></a></span>
<span id="cb35-107"><a href="#cb35-107" tabindex="-1"></a>  <span class="kw">var</span> normalized <span class="op">=</span> image<span class="op">.</span><span class="fu">subtract</span>(mins)<span class="op">.</span><span class="fu">divide</span>(maxs<span class="op">.</span><span class="fu">subtract</span>(mins))<span class="op">;</span></span>
<span id="cb35-108"><a href="#cb35-108" tabindex="-1"></a>  <span class="cf">return</span> normalized<span class="op">;</span></span>
<span id="cb35-109"><a href="#cb35-109" tabindex="-1"></a>}</span>
<span id="cb35-110"><a href="#cb35-110" tabindex="-1"></a></span>
<span id="cb35-111"><a href="#cb35-111" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> <span class="fu">normalize</span>(composite)<span class="op">;</span></span>
<span id="cb35-112"><a href="#cb35-112" tabindex="-1"></a><span class="co">// Add a random column and split the GCPs into training and validation set</span></span>
<span id="cb35-113"><a href="#cb35-113" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">randomColumn</span>()<span class="op">;</span></span>
<span id="cb35-114"><a href="#cb35-114" tabindex="-1"></a></span>
<span id="cb35-115"><a href="#cb35-115" tabindex="-1"></a><span class="co">// This being a simpler classification, we take 60% points</span></span>
<span id="cb35-116"><a href="#cb35-116" tabindex="-1"></a><span class="co">// for validation. Normal recommended ratio is</span></span>
<span id="cb35-117"><a href="#cb35-117" tabindex="-1"></a><span class="co">// 70% training, 30% validation</span></span>
<span id="cb35-118"><a href="#cb35-118" tabindex="-1"></a><span class="kw">var</span> trainingGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb35-119"><a href="#cb35-119" tabindex="-1"></a><span class="kw">var</span> validationGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gte</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb35-120"><a href="#cb35-120" tabindex="-1"></a></span>
<span id="cb35-121"><a href="#cb35-121" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb35-122"><a href="#cb35-122" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb35-123"><a href="#cb35-123" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> trainingGcp<span class="op">,</span></span>
<span id="cb35-124"><a href="#cb35-124" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb35-125"><a href="#cb35-125" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb35-126"><a href="#cb35-126" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb35-127"><a href="#cb35-127" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb35-128"><a href="#cb35-128" tabindex="-1"></a><span class="fu">print</span>(training)<span class="op">;</span></span>
<span id="cb35-129"><a href="#cb35-129" tabindex="-1"></a></span>
<span id="cb35-130"><a href="#cb35-130" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb35-131"><a href="#cb35-131" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)</span>
<span id="cb35-132"><a href="#cb35-132" tabindex="-1"></a><span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb35-133"><a href="#cb35-133" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb35-134"><a href="#cb35-134" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span></span>
<span id="cb35-135"><a href="#cb35-135" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> composite<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb35-136"><a href="#cb35-136" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb35-137"><a href="#cb35-137" tabindex="-1"></a></span>
<span id="cb35-138"><a href="#cb35-138" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb35-139"><a href="#cb35-139" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> composite<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb35-140"><a href="#cb35-140" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb35-142"><a href="#cb35-142" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb35-143"><a href="#cb35-143" tabindex="-1"></a></span>
<span id="cb35-144"><a href="#cb35-144" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb35-145"><a href="#cb35-145" tabindex="-1"></a><span class="co">// Accuracy Assessment</span></span>
<span id="cb35-146"><a href="#cb35-146" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb35-147"><a href="#cb35-147" tabindex="-1"></a></span>
<span id="cb35-148"><a href="#cb35-148" tabindex="-1"></a><span class="co">// Use classification map to assess accuracy using the validation fraction</span></span>
<span id="cb35-149"><a href="#cb35-149" tabindex="-1"></a><span class="co">// of the overall training set created above.</span></span>
<span id="cb35-150"><a href="#cb35-150" tabindex="-1"></a><span class="kw">var</span> test <span class="op">=</span> classified<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb35-151"><a href="#cb35-151" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> validationGcp<span class="op">,</span></span>
<span id="cb35-152"><a href="#cb35-152" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb35-153"><a href="#cb35-153" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb35-154"><a href="#cb35-154" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb35-155"><a href="#cb35-155" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb35-156"><a href="#cb35-156" tabindex="-1"></a></span>
<span id="cb35-157"><a href="#cb35-157" tabindex="-1"></a><span class="kw">var</span> testConfusionMatrix <span class="op">=</span> test<span class="op">.</span><span class="fu">errorMatrix</span>(<span class="st">&#39;landcover&#39;</span><span class="op">,</span> <span class="st">&#39;classification&#39;</span>)<span class="op">;</span></span>
<span id="cb35-158"><a href="#cb35-158" tabindex="-1"></a></span>
<span id="cb35-159"><a href="#cb35-159" tabindex="-1"></a><span class="co">// Printing of confusion matrix may time out. Alternatively, you can export it as CSV</span></span>
<span id="cb35-160"><a href="#cb35-160" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Confusion Matrix&#39;</span><span class="op">,</span> testConfusionMatrix)<span class="op">;</span></span>
<span id="cb35-161"><a href="#cb35-161" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Test Accuracy&#39;</span><span class="op">,</span> testConfusionMatrix<span class="op">.</span><span class="fu">accuracy</span>())<span class="op">;</span></span></code></pre></div>
<div id="exercise-16" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F03c_Improving_the_Classification_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="co">// Improve your classification from Exercise 01c </span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="co">// Add different spectral indicies to your composite</span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="co">// by using the function below</span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="kw">var</span> addIndices <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndvi&#39;</span>])<span class="op">;</span></span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>  <span class="kw">var</span> ndbi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B11&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndbi&#39;</span>])<span class="op">;</span></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>  <span class="kw">var</span> mndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;mndwi&#39;</span>])<span class="op">;</span> </span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>  <span class="kw">var</span> bsi <span class="op">=</span> image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>      <span class="st">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span><span class="op">,</span> {</span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>        <span class="st">&#39;X&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B11&#39;</span>)<span class="op">,</span> <span class="co">//swir1</span></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>        <span class="st">&#39;Y&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">,</span>  <span class="co">//red</span></span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a>        <span class="st">&#39;A&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)<span class="op">,</span> <span class="co">// nir</span></span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a>        <span class="st">&#39;B&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B2&#39;</span>)<span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;bsi&#39;</span>)<span class="op">;</span></span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">.</span><span class="fu">addBands</span>(ndbi)<span class="op">.</span><span class="fu">addBands</span>(mndwi)<span class="op">.</span><span class="fu">addBands</span>(bsi)<span class="op">;</span></span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb36-20"><a href="#cb36-20" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" tabindex="-1"></a> </span></code></pre></div>
</div>
</div>
<div id="exporting-classification-results" class="section level2">
<h2>04. Exporting Classification Results</h2>
<p>When working with complex classifiers over large regions, you may get
a <em>User memory limit exceeded</em> or <em>Computation timed out</em>
error in the Code Editor. The reason for this is that there is a fixed
time limit and smaller memory allocated for code that is run with the
<em>On-Demand Computation</em> mode. For larger computations, you can
use the <em>Batch</em> mode with the <code>Export</code> functions.
Exports run in the background and can run longer than 5-minutes time
allocated to the computation code run from the Code Editor. This allows
you to process very large and complex datasets. Here’s an example
showing how to export your classification results to Google Drive.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/export_classification.png" alt="Exported Classification Outputs" width="75%" />
<p class="caption">
Exported Classification Outputs
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F04b_Exporting_Classification_Results_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="kw">var</span> basin <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;WWF/HydroSHEDS/v1/Basins/hybas_7&#39;</span>)<span class="op">;</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="kw">var</span> alos <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;JAXA/ALOS/AW3D30/V3_2&#39;</span>)<span class="op">;</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a><span class="kw">var</span> arkavathy <span class="op">=</span> basin<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;HYBAS_ID&#39;</span><span class="op">,</span> <span class="dv">4071139640</span>))<span class="op">;</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> arkavathy<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb37-36"><a href="#cb37-36" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb37-37"><a href="#cb37-37" tabindex="-1"></a>}</span>
<span id="cb37-38"><a href="#cb37-38" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb37-40"><a href="#cb37-40" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)</span>
<span id="cb37-41"><a href="#cb37-41" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb37-42"><a href="#cb37-42" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filteredMasked<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb37-44"><a href="#cb37-44" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" tabindex="-1"></a><span class="kw">var</span> addIndices <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb37-46"><a href="#cb37-46" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndvi&#39;</span>])<span class="op">;</span></span>
<span id="cb37-47"><a href="#cb37-47" tabindex="-1"></a>  <span class="kw">var</span> ndbi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B11&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndbi&#39;</span>])<span class="op">;</span></span>
<span id="cb37-48"><a href="#cb37-48" tabindex="-1"></a>  <span class="kw">var</span> mndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;mndwi&#39;</span>])<span class="op">;</span> </span>
<span id="cb37-49"><a href="#cb37-49" tabindex="-1"></a>  <span class="kw">var</span> bsi <span class="op">=</span> image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb37-50"><a href="#cb37-50" tabindex="-1"></a>      <span class="st">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span><span class="op">,</span> {</span>
<span id="cb37-51"><a href="#cb37-51" tabindex="-1"></a>        <span class="st">&#39;X&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B11&#39;</span>)<span class="op">,</span> <span class="co">//swir1</span></span>
<span id="cb37-52"><a href="#cb37-52" tabindex="-1"></a>        <span class="st">&#39;Y&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">,</span>  <span class="co">//red</span></span>
<span id="cb37-53"><a href="#cb37-53" tabindex="-1"></a>        <span class="st">&#39;A&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)<span class="op">,</span> <span class="co">// nir</span></span>
<span id="cb37-54"><a href="#cb37-54" tabindex="-1"></a>        <span class="st">&#39;B&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B2&#39;</span>)<span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb37-55"><a href="#cb37-55" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;bsi&#39;</span>)<span class="op">;</span></span>
<span id="cb37-56"><a href="#cb37-56" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">.</span><span class="fu">addBands</span>(ndbi)<span class="op">.</span><span class="fu">addBands</span>(mndwi)<span class="op">.</span><span class="fu">addBands</span>(bsi)<span class="op">;</span></span>
<span id="cb37-57"><a href="#cb37-57" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb37-58"><a href="#cb37-58" tabindex="-1"></a></span>
<span id="cb37-59"><a href="#cb37-59" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> <span class="fu">addIndices</span>(composite)<span class="op">;</span></span>
<span id="cb37-60"><a href="#cb37-60" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" tabindex="-1"></a><span class="co">// Calculate Slope and Elevation</span></span>
<span id="cb37-62"><a href="#cb37-62" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" tabindex="-1"></a><span class="co">// Use ALOS World 3D v3</span></span>
<span id="cb37-64"><a href="#cb37-64" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" tabindex="-1"></a><span class="co">// This comes as a collection of images</span></span>
<span id="cb37-66"><a href="#cb37-66" tabindex="-1"></a><span class="co">// We mosaic it to create a single image</span></span>
<span id="cb37-67"><a href="#cb37-67" tabindex="-1"></a></span>
<span id="cb37-68"><a href="#cb37-68" tabindex="-1"></a><span class="co">// Need to set the projection correctly on the mosaic</span></span>
<span id="cb37-69"><a href="#cb37-69" tabindex="-1"></a><span class="co">// for the slope computation</span></span>
<span id="cb37-70"><a href="#cb37-70" tabindex="-1"></a><span class="kw">var</span> proj <span class="op">=</span> alos<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">projection</span>()<span class="op">;</span></span>
<span id="cb37-71"><a href="#cb37-71" tabindex="-1"></a></span>
<span id="cb37-72"><a href="#cb37-72" tabindex="-1"></a><span class="kw">var</span> elevation <span class="op">=</span> alos<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;DSM&#39;</span>)<span class="op">.</span><span class="fu">mosaic</span>()</span>
<span id="cb37-73"><a href="#cb37-73" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setDefaultProjection</span>(proj)</span>
<span id="cb37-74"><a href="#cb37-74" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;elev&#39;</span>)<span class="op">;</span></span>
<span id="cb37-75"><a href="#cb37-75" tabindex="-1"></a></span>
<span id="cb37-76"><a href="#cb37-76" tabindex="-1"></a><span class="kw">var</span> slope <span class="op">=</span> ee<span class="op">.</span><span class="at">Terrain</span><span class="op">.</span><span class="fu">slope</span>(elevation)</span>
<span id="cb37-77"><a href="#cb37-77" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;slope&#39;</span>)<span class="op">;</span></span>
<span id="cb37-78"><a href="#cb37-78" tabindex="-1"></a></span>
<span id="cb37-79"><a href="#cb37-79" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> composite<span class="op">.</span><span class="fu">addBands</span>(elevation)<span class="op">.</span><span class="fu">addBands</span>(slope)<span class="op">;</span></span>
<span id="cb37-80"><a href="#cb37-80" tabindex="-1"></a><span class="kw">var</span> visParams <span class="op">=</span> {<span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">gamma</span><span class="op">:</span> <span class="fl">1.2</span>}<span class="op">;</span></span>
<span id="cb37-81"><a href="#cb37-81" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> visParams<span class="op">,</span> <span class="st">&#39;RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb37-82"><a href="#cb37-82" tabindex="-1"></a></span>
<span id="cb37-83"><a href="#cb37-83" tabindex="-1"></a><span class="co">// Normalize the image </span></span>
<span id="cb37-84"><a href="#cb37-84" tabindex="-1"></a></span>
<span id="cb37-85"><a href="#cb37-85" tabindex="-1"></a><span class="co">// Machine learning algorithms work best on images when all features have</span></span>
<span id="cb37-86"><a href="#cb37-86" tabindex="-1"></a><span class="co">// the same range</span></span>
<span id="cb37-87"><a href="#cb37-87" tabindex="-1"></a></span>
<span id="cb37-88"><a href="#cb37-88" tabindex="-1"></a><span class="co">// Function to Normalize Image</span></span>
<span id="cb37-89"><a href="#cb37-89" tabindex="-1"></a><span class="co">// Pixel Values should be between 0 and 1</span></span>
<span id="cb37-90"><a href="#cb37-90" tabindex="-1"></a><span class="co">// Formula is (x - xmin) / (xmax - xmin)</span></span>
<span id="cb37-91"><a href="#cb37-91" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb37-92"><a href="#cb37-92" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(image){</span>
<span id="cb37-93"><a href="#cb37-93" tabindex="-1"></a>  <span class="kw">var</span> bandNames <span class="op">=</span> image<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb37-94"><a href="#cb37-94" tabindex="-1"></a>  <span class="co">// Compute min and max of the image</span></span>
<span id="cb37-95"><a href="#cb37-95" tabindex="-1"></a>  <span class="kw">var</span> minDict <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb37-96"><a href="#cb37-96" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">min</span>()<span class="op">,</span></span>
<span id="cb37-97"><a href="#cb37-97" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb37-98"><a href="#cb37-98" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb37-99"><a href="#cb37-99" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span><span class="op">,</span></span>
<span id="cb37-100"><a href="#cb37-100" tabindex="-1"></a>    <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb37-101"><a href="#cb37-101" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb37-102"><a href="#cb37-102" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb37-103"><a href="#cb37-103" tabindex="-1"></a>  <span class="kw">var</span> maxDict <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb37-104"><a href="#cb37-104" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>()<span class="op">,</span></span>
<span id="cb37-105"><a href="#cb37-105" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb37-106"><a href="#cb37-106" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb37-107"><a href="#cb37-107" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span><span class="op">,</span></span>
<span id="cb37-108"><a href="#cb37-108" tabindex="-1"></a>    <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb37-109"><a href="#cb37-109" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb37-110"><a href="#cb37-110" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb37-111"><a href="#cb37-111" tabindex="-1"></a>  <span class="kw">var</span> mins <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(minDict<span class="op">.</span><span class="fu">values</span>(bandNames))<span class="op">;</span></span>
<span id="cb37-112"><a href="#cb37-112" tabindex="-1"></a>  <span class="kw">var</span> maxs <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(maxDict<span class="op">.</span><span class="fu">values</span>(bandNames))<span class="op">;</span></span>
<span id="cb37-113"><a href="#cb37-113" tabindex="-1"></a></span>
<span id="cb37-114"><a href="#cb37-114" tabindex="-1"></a>  <span class="kw">var</span> normalized <span class="op">=</span> image<span class="op">.</span><span class="fu">subtract</span>(mins)<span class="op">.</span><span class="fu">divide</span>(maxs<span class="op">.</span><span class="fu">subtract</span>(mins))<span class="op">;</span></span>
<span id="cb37-115"><a href="#cb37-115" tabindex="-1"></a>  <span class="cf">return</span> normalized<span class="op">;</span></span>
<span id="cb37-116"><a href="#cb37-116" tabindex="-1"></a>}</span>
<span id="cb37-117"><a href="#cb37-117" tabindex="-1"></a></span>
<span id="cb37-118"><a href="#cb37-118" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> <span class="fu">normalize</span>(composite)<span class="op">;</span></span>
<span id="cb37-119"><a href="#cb37-119" tabindex="-1"></a><span class="co">// Add a random column and split the GCPs into training and validation set</span></span>
<span id="cb37-120"><a href="#cb37-120" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">randomColumn</span>()<span class="op">;</span></span>
<span id="cb37-121"><a href="#cb37-121" tabindex="-1"></a></span>
<span id="cb37-122"><a href="#cb37-122" tabindex="-1"></a><span class="co">// This being a simpler classification, we take 60% points</span></span>
<span id="cb37-123"><a href="#cb37-123" tabindex="-1"></a><span class="co">// for validation. Normal recommended ratio is</span></span>
<span id="cb37-124"><a href="#cb37-124" tabindex="-1"></a><span class="co">// 70% training, 30% validation</span></span>
<span id="cb37-125"><a href="#cb37-125" tabindex="-1"></a><span class="kw">var</span> trainingGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb37-126"><a href="#cb37-126" tabindex="-1"></a><span class="kw">var</span> validationGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gte</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb37-127"><a href="#cb37-127" tabindex="-1"></a></span>
<span id="cb37-128"><a href="#cb37-128" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb37-129"><a href="#cb37-129" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb37-130"><a href="#cb37-130" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> trainingGcp<span class="op">,</span></span>
<span id="cb37-131"><a href="#cb37-131" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb37-132"><a href="#cb37-132" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb37-133"><a href="#cb37-133" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb37-134"><a href="#cb37-134" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb37-135"><a href="#cb37-135" tabindex="-1"></a><span class="fu">print</span>(training)<span class="op">;</span></span>
<span id="cb37-136"><a href="#cb37-136" tabindex="-1"></a></span>
<span id="cb37-137"><a href="#cb37-137" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb37-138"><a href="#cb37-138" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)</span>
<span id="cb37-139"><a href="#cb37-139" tabindex="-1"></a><span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb37-140"><a href="#cb37-140" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb37-141"><a href="#cb37-141" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span></span>
<span id="cb37-142"><a href="#cb37-142" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> composite<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb37-143"><a href="#cb37-143" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb37-144"><a href="#cb37-144" tabindex="-1"></a></span>
<span id="cb37-145"><a href="#cb37-145" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb37-146"><a href="#cb37-146" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> composite<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb37-147"><a href="#cb37-147" tabindex="-1"></a></span>
<span id="cb37-148"><a href="#cb37-148" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb37-149"><a href="#cb37-149" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb37-150"><a href="#cb37-150" tabindex="-1"></a></span>
<span id="cb37-151"><a href="#cb37-151" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb37-152"><a href="#cb37-152" tabindex="-1"></a><span class="co">// Accuracy Assessment</span></span>
<span id="cb37-153"><a href="#cb37-153" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb37-154"><a href="#cb37-154" tabindex="-1"></a></span>
<span id="cb37-155"><a href="#cb37-155" tabindex="-1"></a><span class="co">// Use classification map to assess accuracy using the validation fraction</span></span>
<span id="cb37-156"><a href="#cb37-156" tabindex="-1"></a><span class="co">// of the overall training set created above.</span></span>
<span id="cb37-157"><a href="#cb37-157" tabindex="-1"></a><span class="kw">var</span> test <span class="op">=</span> classified<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb37-158"><a href="#cb37-158" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> validationGcp<span class="op">,</span></span>
<span id="cb37-159"><a href="#cb37-159" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb37-160"><a href="#cb37-160" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb37-161"><a href="#cb37-161" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb37-162"><a href="#cb37-162" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb37-163"><a href="#cb37-163" tabindex="-1"></a></span>
<span id="cb37-164"><a href="#cb37-164" tabindex="-1"></a><span class="kw">var</span> testConfusionMatrix <span class="op">=</span> test<span class="op">.</span><span class="fu">errorMatrix</span>(<span class="st">&#39;landcover&#39;</span><span class="op">,</span> <span class="st">&#39;classification&#39;</span>)<span class="op">;</span></span>
<span id="cb37-165"><a href="#cb37-165" tabindex="-1"></a></span>
<span id="cb37-166"><a href="#cb37-166" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb37-167"><a href="#cb37-167" tabindex="-1"></a><span class="co">// Exporting Results</span></span>
<span id="cb37-168"><a href="#cb37-168" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb37-169"><a href="#cb37-169" tabindex="-1"></a></span>
<span id="cb37-170"><a href="#cb37-170" tabindex="-1"></a><span class="co">// Export the classified image to Drive</span></span>
<span id="cb37-171"><a href="#cb37-171" tabindex="-1"></a></span>
<span id="cb37-172"><a href="#cb37-172" tabindex="-1"></a><span class="co">// For images having integers (such as class numbers)</span></span>
<span id="cb37-173"><a href="#cb37-173" tabindex="-1"></a><span class="co">// we cast the image to floating point data type which</span></span>
<span id="cb37-174"><a href="#cb37-174" tabindex="-1"></a><span class="co">// allows the masked values to be saved as NaN values</span></span>
<span id="cb37-175"><a href="#cb37-175" tabindex="-1"></a><span class="co">// in the GeoTIFF format.</span></span>
<span id="cb37-176"><a href="#cb37-176" tabindex="-1"></a><span class="co">// You can set these to actual NoData values using</span></span>
<span id="cb37-177"><a href="#cb37-177" tabindex="-1"></a><span class="co">// GDAL tools after the export</span></span>
<span id="cb37-178"><a href="#cb37-178" tabindex="-1"></a><span class="co">// gdal_translate -a_nodata &#39;nan&#39; input.tif output.tif</span></span>
<span id="cb37-179"><a href="#cb37-179" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb37-180"><a href="#cb37-180" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span> classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">.</span><span class="fu">toFloat</span>()<span class="op">,</span></span>
<span id="cb37-181"><a href="#cb37-181" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Classified_Image_Export&#39;</span><span class="op">,</span></span>
<span id="cb37-182"><a href="#cb37-182" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb37-183"><a href="#cb37-183" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;classified&#39;</span><span class="op">,</span></span>
<span id="cb37-184"><a href="#cb37-184" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb37-185"><a href="#cb37-185" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb37-186"><a href="#cb37-186" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e10</span></span>
<span id="cb37-187"><a href="#cb37-187" tabindex="-1"></a>})</span>
<span id="cb37-188"><a href="#cb37-188" tabindex="-1"></a></span>
<span id="cb37-189"><a href="#cb37-189" tabindex="-1"></a><span class="co">// Export the results of accuracy asssessment</span></span>
<span id="cb37-190"><a href="#cb37-190" tabindex="-1"></a></span>
<span id="cb37-191"><a href="#cb37-191" tabindex="-1"></a><span class="co">// Create a Feature with null geometry and the value we want to export.</span></span>
<span id="cb37-192"><a href="#cb37-192" tabindex="-1"></a><span class="co">// Use .array() to convert Confusion Matrix to an Array so it can be</span></span>
<span id="cb37-193"><a href="#cb37-193" tabindex="-1"></a><span class="co">// exported in a CSV file</span></span>
<span id="cb37-194"><a href="#cb37-194" tabindex="-1"></a><span class="kw">var</span> fc <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>([</span>
<span id="cb37-195"><a href="#cb37-195" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> {</span>
<span id="cb37-196"><a href="#cb37-196" tabindex="-1"></a>    <span class="st">&#39;accuracy&#39;</span><span class="op">:</span> testConfusionMatrix<span class="op">.</span><span class="fu">accuracy</span>()<span class="op">,</span></span>
<span id="cb37-197"><a href="#cb37-197" tabindex="-1"></a>    <span class="st">&#39;matrix&#39;</span><span class="op">:</span> testConfusionMatrix<span class="op">.</span><span class="fu">array</span>()</span>
<span id="cb37-198"><a href="#cb37-198" tabindex="-1"></a>  })</span>
<span id="cb37-199"><a href="#cb37-199" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb37-200"><a href="#cb37-200" tabindex="-1"></a></span>
<span id="cb37-201"><a href="#cb37-201" tabindex="-1"></a><span class="fu">print</span>(fc)<span class="op">;</span></span>
<span id="cb37-202"><a href="#cb37-202" tabindex="-1"></a></span>
<span id="cb37-203"><a href="#cb37-203" tabindex="-1"></a>Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb37-204"><a href="#cb37-204" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> fc<span class="op">,</span></span>
<span id="cb37-205"><a href="#cb37-205" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Accuracy_Assessment_Export&#39;</span><span class="op">,</span></span>
<span id="cb37-206"><a href="#cb37-206" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb37-207"><a href="#cb37-207" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;accuracy&#39;</span><span class="op">,</span></span>
<span id="cb37-208"><a href="#cb37-208" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">&#39;CSV&#39;</span></span>
<span id="cb37-209"><a href="#cb37-209" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<div id="exercise-17" class="section level3">
<h3>Exercise</h3>
<p>It is also a good idea to export the classified image as an Asset.
This will allows you to import the classified image in another script
without running the whole classification workflow. Use the
Export.image.toAsset() function to export the classified image as an
asset.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F04c_Exporting_Classification_Results_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="kw">var</span> basin <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;WWF/HydroSHEDS/v1/Basins/hybas_7&#39;</span>)<span class="op">;</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="kw">var</span> alos <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;JAXA/ALOS/AW3D30/V3_2&#39;</span>)<span class="op">;</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a><span class="kw">var</span> arkavathy <span class="op">=</span> basin<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;HYBAS_ID&#39;</span><span class="op">,</span> <span class="dv">4071139640</span>))<span class="op">;</span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> arkavathy<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb38-21"><a href="#cb38-21" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb38-23"><a href="#cb38-23" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb38-24"><a href="#cb38-24" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb38-25"><a href="#cb38-25" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb38-27"><a href="#cb38-27" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb38-28"><a href="#cb38-28" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb38-29"><a href="#cb38-29" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb38-30"><a href="#cb38-30" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb38-32"><a href="#cb38-32" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb38-33"><a href="#cb38-33" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb38-34"><a href="#cb38-34" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb38-35"><a href="#cb38-35" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb38-36"><a href="#cb38-36" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb38-37"><a href="#cb38-37" tabindex="-1"></a>}</span>
<span id="cb38-38"><a href="#cb38-38" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb38-40"><a href="#cb38-40" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)</span>
<span id="cb38-41"><a href="#cb38-41" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb38-42"><a href="#cb38-42" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> filteredMasked<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb38-44"><a href="#cb38-44" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" tabindex="-1"></a><span class="kw">var</span> addIndices <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb38-46"><a href="#cb38-46" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndvi&#39;</span>])<span class="op">;</span></span>
<span id="cb38-47"><a href="#cb38-47" tabindex="-1"></a>  <span class="kw">var</span> ndbi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B11&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndbi&#39;</span>])<span class="op">;</span></span>
<span id="cb38-48"><a href="#cb38-48" tabindex="-1"></a>  <span class="kw">var</span> mndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;mndwi&#39;</span>])<span class="op">;</span> </span>
<span id="cb38-49"><a href="#cb38-49" tabindex="-1"></a>  <span class="kw">var</span> bsi <span class="op">=</span> image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb38-50"><a href="#cb38-50" tabindex="-1"></a>      <span class="st">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span><span class="op">,</span> {</span>
<span id="cb38-51"><a href="#cb38-51" tabindex="-1"></a>        <span class="st">&#39;X&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B11&#39;</span>)<span class="op">,</span> <span class="co">//swir1</span></span>
<span id="cb38-52"><a href="#cb38-52" tabindex="-1"></a>        <span class="st">&#39;Y&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">,</span>  <span class="co">//red</span></span>
<span id="cb38-53"><a href="#cb38-53" tabindex="-1"></a>        <span class="st">&#39;A&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)<span class="op">,</span> <span class="co">// nir</span></span>
<span id="cb38-54"><a href="#cb38-54" tabindex="-1"></a>        <span class="st">&#39;B&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B2&#39;</span>)<span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb38-55"><a href="#cb38-55" tabindex="-1"></a>  })<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;bsi&#39;</span>)<span class="op">;</span></span>
<span id="cb38-56"><a href="#cb38-56" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">.</span><span class="fu">addBands</span>(ndbi)<span class="op">.</span><span class="fu">addBands</span>(mndwi)<span class="op">.</span><span class="fu">addBands</span>(bsi)<span class="op">;</span></span>
<span id="cb38-57"><a href="#cb38-57" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb38-58"><a href="#cb38-58" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> <span class="fu">addIndices</span>(composite)<span class="op">;</span></span>
<span id="cb38-60"><a href="#cb38-60" tabindex="-1"></a></span>
<span id="cb38-61"><a href="#cb38-61" tabindex="-1"></a><span class="co">// Calculate Slope and Elevation</span></span>
<span id="cb38-62"><a href="#cb38-62" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" tabindex="-1"></a><span class="co">// Use ALOS World 3D v3</span></span>
<span id="cb38-64"><a href="#cb38-64" tabindex="-1"></a></span>
<span id="cb38-65"><a href="#cb38-65" tabindex="-1"></a><span class="co">// This comes as a collection of images</span></span>
<span id="cb38-66"><a href="#cb38-66" tabindex="-1"></a><span class="co">// We mosaic it to create a single image</span></span>
<span id="cb38-67"><a href="#cb38-67" tabindex="-1"></a></span>
<span id="cb38-68"><a href="#cb38-68" tabindex="-1"></a><span class="co">// Need to set the projection correctly on the mosaic</span></span>
<span id="cb38-69"><a href="#cb38-69" tabindex="-1"></a><span class="co">// for the slope computation</span></span>
<span id="cb38-70"><a href="#cb38-70" tabindex="-1"></a><span class="kw">var</span> proj <span class="op">=</span> alos<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">projection</span>()<span class="op">;</span></span>
<span id="cb38-71"><a href="#cb38-71" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" tabindex="-1"></a><span class="kw">var</span> elevation <span class="op">=</span> alos<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;DSM&#39;</span>)<span class="op">.</span><span class="fu">mosaic</span>()</span>
<span id="cb38-73"><a href="#cb38-73" tabindex="-1"></a>  <span class="op">.</span><span class="fu">setDefaultProjection</span>(proj)</span>
<span id="cb38-74"><a href="#cb38-74" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;elev&#39;</span>)<span class="op">;</span></span>
<span id="cb38-75"><a href="#cb38-75" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" tabindex="-1"></a><span class="kw">var</span> slope <span class="op">=</span> ee<span class="op">.</span><span class="at">Terrain</span><span class="op">.</span><span class="fu">slope</span>(elevation)</span>
<span id="cb38-77"><a href="#cb38-77" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;slope&#39;</span>)<span class="op">;</span></span>
<span id="cb38-78"><a href="#cb38-78" tabindex="-1"></a></span>
<span id="cb38-79"><a href="#cb38-79" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> composite<span class="op">.</span><span class="fu">addBands</span>(elevation)<span class="op">.</span><span class="fu">addBands</span>(slope)<span class="op">;</span></span>
<span id="cb38-80"><a href="#cb38-80" tabindex="-1"></a><span class="kw">var</span> visParams <span class="op">=</span> {<span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span> <span class="dt">gamma</span><span class="op">:</span> <span class="fl">1.2</span>}<span class="op">;</span></span>
<span id="cb38-81"><a href="#cb38-81" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> visParams<span class="op">,</span> <span class="st">&#39;RGB&#39;</span>)<span class="op">;</span></span>
<span id="cb38-82"><a href="#cb38-82" tabindex="-1"></a></span>
<span id="cb38-83"><a href="#cb38-83" tabindex="-1"></a><span class="co">// Normalize the image </span></span>
<span id="cb38-84"><a href="#cb38-84" tabindex="-1"></a></span>
<span id="cb38-85"><a href="#cb38-85" tabindex="-1"></a><span class="co">// Machine learning algorithms work best on images when all features have</span></span>
<span id="cb38-86"><a href="#cb38-86" tabindex="-1"></a><span class="co">// the same range</span></span>
<span id="cb38-87"><a href="#cb38-87" tabindex="-1"></a></span>
<span id="cb38-88"><a href="#cb38-88" tabindex="-1"></a><span class="co">// Function to Normalize Image</span></span>
<span id="cb38-89"><a href="#cb38-89" tabindex="-1"></a><span class="co">// Pixel Values should be between 0 and 1</span></span>
<span id="cb38-90"><a href="#cb38-90" tabindex="-1"></a><span class="co">// Formula is (x - xmin) / (xmax - xmin)</span></span>
<span id="cb38-91"><a href="#cb38-91" tabindex="-1"></a><span class="co">//************************************************************************** </span></span>
<span id="cb38-92"><a href="#cb38-92" tabindex="-1"></a><span class="kw">function</span> <span class="fu">normalize</span>(image){</span>
<span id="cb38-93"><a href="#cb38-93" tabindex="-1"></a>  <span class="kw">var</span> bandNames <span class="op">=</span> image<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb38-94"><a href="#cb38-94" tabindex="-1"></a>  <span class="co">// Compute min and max of the image</span></span>
<span id="cb38-95"><a href="#cb38-95" tabindex="-1"></a>  <span class="kw">var</span> minDict <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb38-96"><a href="#cb38-96" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">min</span>()<span class="op">,</span></span>
<span id="cb38-97"><a href="#cb38-97" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb38-98"><a href="#cb38-98" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb38-99"><a href="#cb38-99" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span><span class="op">,</span></span>
<span id="cb38-100"><a href="#cb38-100" tabindex="-1"></a>    <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-101"><a href="#cb38-101" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb38-102"><a href="#cb38-102" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb38-103"><a href="#cb38-103" tabindex="-1"></a>  <span class="kw">var</span> maxDict <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb38-104"><a href="#cb38-104" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>()<span class="op">,</span></span>
<span id="cb38-105"><a href="#cb38-105" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb38-106"><a href="#cb38-106" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb38-107"><a href="#cb38-107" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span><span class="op">,</span></span>
<span id="cb38-108"><a href="#cb38-108" tabindex="-1"></a>    <span class="dt">bestEffort</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-109"><a href="#cb38-109" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb38-110"><a href="#cb38-110" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb38-111"><a href="#cb38-111" tabindex="-1"></a>  <span class="kw">var</span> mins <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(minDict<span class="op">.</span><span class="fu">values</span>(bandNames))<span class="op">;</span></span>
<span id="cb38-112"><a href="#cb38-112" tabindex="-1"></a>  <span class="kw">var</span> maxs <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(maxDict<span class="op">.</span><span class="fu">values</span>(bandNames))<span class="op">;</span></span>
<span id="cb38-113"><a href="#cb38-113" tabindex="-1"></a></span>
<span id="cb38-114"><a href="#cb38-114" tabindex="-1"></a>  <span class="kw">var</span> normalized <span class="op">=</span> image<span class="op">.</span><span class="fu">subtract</span>(mins)<span class="op">.</span><span class="fu">divide</span>(maxs<span class="op">.</span><span class="fu">subtract</span>(mins))<span class="op">;</span></span>
<span id="cb38-115"><a href="#cb38-115" tabindex="-1"></a>  <span class="cf">return</span> normalized<span class="op">;</span></span>
<span id="cb38-116"><a href="#cb38-116" tabindex="-1"></a>}</span>
<span id="cb38-117"><a href="#cb38-117" tabindex="-1"></a></span>
<span id="cb38-118"><a href="#cb38-118" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span> <span class="fu">normalize</span>(composite)<span class="op">;</span></span>
<span id="cb38-119"><a href="#cb38-119" tabindex="-1"></a><span class="co">// Add a random column and split the GCPs into training and validation set</span></span>
<span id="cb38-120"><a href="#cb38-120" tabindex="-1"></a><span class="kw">var</span> gcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">randomColumn</span>()<span class="op">;</span></span>
<span id="cb38-121"><a href="#cb38-121" tabindex="-1"></a></span>
<span id="cb38-122"><a href="#cb38-122" tabindex="-1"></a><span class="co">// This being a simpler classification, we take 60% points</span></span>
<span id="cb38-123"><a href="#cb38-123" tabindex="-1"></a><span class="co">// for validation. Normal recommended ratio is</span></span>
<span id="cb38-124"><a href="#cb38-124" tabindex="-1"></a><span class="co">// 70% training, 30% validation</span></span>
<span id="cb38-125"><a href="#cb38-125" tabindex="-1"></a><span class="kw">var</span> trainingGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb38-126"><a href="#cb38-126" tabindex="-1"></a><span class="kw">var</span> validationGcp <span class="op">=</span> gcp<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gte</span>(<span class="st">&#39;random&#39;</span><span class="op">,</span> <span class="fl">0.6</span>))<span class="op">;</span></span>
<span id="cb38-127"><a href="#cb38-127" tabindex="-1"></a></span>
<span id="cb38-128"><a href="#cb38-128" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb38-129"><a href="#cb38-129" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> composite<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb38-130"><a href="#cb38-130" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> trainingGcp<span class="op">,</span></span>
<span id="cb38-131"><a href="#cb38-131" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span></span>
<span id="cb38-132"><a href="#cb38-132" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb38-133"><a href="#cb38-133" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb38-134"><a href="#cb38-134" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb38-135"><a href="#cb38-135" tabindex="-1"></a></span>
<span id="cb38-136"><a href="#cb38-136" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb38-137"><a href="#cb38-137" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)</span>
<span id="cb38-138"><a href="#cb38-138" tabindex="-1"></a><span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb38-139"><a href="#cb38-139" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb38-140"><a href="#cb38-140" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span></span>
<span id="cb38-141"><a href="#cb38-141" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> composite<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb38-142"><a href="#cb38-142" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb38-143"><a href="#cb38-143" tabindex="-1"></a></span>
<span id="cb38-144"><a href="#cb38-144" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb38-145"><a href="#cb38-145" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> composite<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb38-146"><a href="#cb38-146" tabindex="-1"></a></span>
<span id="cb38-147"><a href="#cb38-147" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb38-148"><a href="#cb38-148" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb38-149"><a href="#cb38-149" tabindex="-1"></a></span>
<span id="cb38-150"><a href="#cb38-150" tabindex="-1"></a><span class="co">// Exercise </span></span>
<span id="cb38-151"><a href="#cb38-151" tabindex="-1"></a></span>
<span id="cb38-152"><a href="#cb38-152" tabindex="-1"></a><span class="co">// Use the Export.image.toAsset() function to export the </span></span>
<span id="cb38-153"><a href="#cb38-153" tabindex="-1"></a><span class="co">// classified image as a Earth Engine Asset.</span></span>
<span id="cb38-154"><a href="#cb38-154" tabindex="-1"></a></span>
<span id="cb38-155"><a href="#cb38-155" tabindex="-1"></a><span class="co">// This will allows you to import the classified image in another</span></span>
<span id="cb38-156"><a href="#cb38-156" tabindex="-1"></a><span class="co">// script without running the whole classification workflow.</span></span>
<span id="cb38-157"><a href="#cb38-157" tabindex="-1"></a></span>
<span id="cb38-158"><a href="#cb38-158" tabindex="-1"></a><span class="co">// Hint: For images with discrete pixel values, we must set the</span></span>
<span id="cb38-159"><a href="#cb38-159" tabindex="-1"></a><span class="co">// pyramidingPolicy to &#39;mode&#39;.</span></span>
<span id="cb38-160"><a href="#cb38-160" tabindex="-1"></a><span class="co">// The pyramidingPolicy parameter should a dictionary specifying</span></span>
<span id="cb38-161"><a href="#cb38-161" tabindex="-1"></a><span class="co">// the policy for each band. A simpler way to specify it for all</span></span>
<span id="cb38-162"><a href="#cb38-162" tabindex="-1"></a><span class="co">// bands is to use {&#39;.default&#39;: &#39;mode&#39;}</span></span>
<span id="cb38-163"><a href="#cb38-163" tabindex="-1"></a></span>
<span id="cb38-164"><a href="#cb38-164" tabindex="-1"></a><span class="co">// assetId should be specified as a string</span></span>
<span id="cb38-165"><a href="#cb38-165" tabindex="-1"></a><span class="co">// It can be just the asset name &#39;classified_image&#39;</span></span>
<span id="cb38-166"><a href="#cb38-166" tabindex="-1"></a><span class="co">// or a full path such as &#39;projects/ee-&lt;yourusername&gt;/classified_image&#39;</span></span></code></pre></div>
</div>
</div>
<div id="calculating-area" class="section level2">
<h2>05. Calculating Area</h2>
<p>Now that we have the results of our classification, we will learn how
to calculate the area for pixels in each class. The functions used for
area computations are different for vectors and raster data.</p>
<ul>
<li><strong>Area of Polygons</strong>: Calculating area for polygons is
done using the <code>area()</code> function. It computes area on a
sphere (ignoring the ellipsoid flattening) and gives you the area in
square meters. You can optionally supply <code>proj</code> and a
non-zero <code>maxError</code> parameters to calculate area in a
specific projected CRS. For example,
<code>area({proj:'EPSG:32643', maxError: 1})</code> will calculate the
area of the polygon after reprojecting it to the <em>WGS 84/UTM Zone
43</em> CRS with a tolerance of 1 meter.</li>
<li><strong>Area of Image Pixels</strong>: Area of image pixels is
computed using the <code>ee.Image.pixelArea()</code> function. This
function computes the area inside the 4 corners of each pixel using the
WGS84 ellipsoid. The <code>ee.Image.pixelArea()</code> function uses a
custom equal-area projection for area calculation. The result is area in
square meters regardless of the projection of the input image. <a
href="https://groups.google.com/g/google-earth-engine-developers/c/Ccaorx-obVw/m/_ZQdP2wVAgAJ">Learn
more</a>.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/area_calculation.png" alt="Calculating Green Cover from Classified Image" width="75%" />
<p class="caption">
Calculating Green Cover from Classified Image
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F05b_Calculating_Area_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;users/ujavalgandhi/e2e/bangalore_classified&#39;</span>)<span class="op">;</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="kw">var</span> bangalore <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>)<span class="op">;</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(bangalore<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span>}<span class="op">,</span> <span class="st">&#39;Bangalore City&#39;</span>)<span class="op">;</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="co">// Calling .geometry() on a feature collection gives the</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a><span class="co">// dissolved geometry of all features in the collection</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a><span class="co">// .area() function calculates the area in square meters</span></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a><span class="kw">var</span> cityArea <span class="op">=</span> bangalore<span class="op">.</span><span class="fu">geometry</span>()<span class="op">.</span><span class="fu">area</span>()<span class="op">;</span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a><span class="co">// We can cast the result to a ee.Number() and calculate the</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a><span class="co">// area in square kilometers</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a><span class="kw">var</span> cityAreaSqKm <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(cityArea)<span class="op">.</span><span class="fu">divide</span>(<span class="fl">1e6</span>)<span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a><span class="fu">print</span>(cityAreaSqKm)<span class="op">;</span></span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a><span class="co">// Area Calculation for Images</span></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a><span class="kw">var</span> vegetation <span class="op">=</span> classified<span class="op">.</span><span class="fu">eq</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a><span class="co">// If the image contains values 0 or 1, we can calculate the</span></span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a><span class="co">// total area using reduceRegion() function</span></span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a><span class="co">// The result of .eq() operation is a binary image with pixels</span></span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a><span class="co">// values of 1 where the condition matched and 0 where it didn&#39;t</span></span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(vegetation<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;green&#39;</span>]}<span class="op">,</span> <span class="st">&#39;Green Cover&#39;</span>)<span class="op">;</span></span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a><span class="co">// Since our image has only 0 and 1 pixel values, the vegetation</span></span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a><span class="co">// pixels will have values equal to their area</span></span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a><span class="kw">var</span> areaImage <span class="op">=</span> vegetation<span class="op">.</span><span class="fu">multiply</span>(ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>())<span class="op">;</span></span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a><span class="co">// Now that each pixel for vegetation class in the image has the value</span></span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a><span class="co">// equal to its area, we can sum up all the values in the region</span></span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a><span class="co">// to get the total green cover.</span></span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a><span class="kw">var</span> area <span class="op">=</span> areaImage<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb39-40"><a href="#cb39-40" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span></span>
<span id="cb39-41"><a href="#cb39-41" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> bangalore<span class="op">.</span><span class="fu">geometry</span>()<span class="op">,</span></span>
<span id="cb39-42"><a href="#cb39-42" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb39-43"><a href="#cb39-43" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e10</span></span>
<span id="cb39-44"><a href="#cb39-44" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb39-45"><a href="#cb39-45" tabindex="-1"></a><span class="co">// The result of the reduceRegion() function is a dictionary with the key</span></span>
<span id="cb39-46"><a href="#cb39-46" tabindex="-1"></a><span class="co">// being the band name. We can extract the area number and convert it to</span></span>
<span id="cb39-47"><a href="#cb39-47" tabindex="-1"></a><span class="co">// square kilometers</span></span>
<span id="cb39-48"><a href="#cb39-48" tabindex="-1"></a><span class="kw">var</span> vegetationAreaSqKm <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(area<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;classification&#39;</span>))<span class="op">.</span><span class="fu">divide</span>(<span class="fl">1e6</span>)<span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb39-49"><a href="#cb39-49" tabindex="-1"></a><span class="fu">print</span>(vegetationAreaSqKm)<span class="op">;</span></span></code></pre></div>
<blockquote>
<p>If you want to compute area covered by each class, you can use a <a
href="https://developers.google.com/earth-engine/reducers_grouping">Grouped
Reducer</a>. See the <a
href="end-to-end-gee-supplement.html#calculating-area-by-class">Supplement</a>
to see a code snippet.</p>
</blockquote>
<div id="exercise-18" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F05c_Calculating_Area_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="co">// Compute and print the percentage green cover of the city</span></span></code></pre></div>
</div>
</div>
<div id="assignment-3" class="section level2">
<h2>Assignment 3</h2>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3AAssignments%2FAssignment3"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co">// Choose a city of your choice and create land use land classification</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="co">// using supervised classification technique. </span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="co">// You can use your script 01c from 03-Supervised-Classification</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="co">// module as a starting point.</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="co">// The classification should incorporate the following techniques</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="co">// 1. Add relevant indicies</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a><span class="co">// 2. Add cloud masking</span></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a><span class="co">// 3. Add elevation and slope</span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a><span class="co">// 4. Normalize the data</span></span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a><span class="co">// [Optional]</span></span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a><span class="co">// Accuracy Assessment</span></span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a><span class="co">// Post-processing Classification</span></span></code></pre></div>
</div>
</div>
<div id="module-4-change-detection" class="section level1">
<h1>Module 4: Change Detection</h1>
<div id="introduction-to-change-detection" class="section level2">
<h2>Introduction to Change Detection</h2>
<p>Many earth observation datasets are available at regular intervals
over long periods of time. This enables us to detect changes on the
Earth’s surface. Change detection technique in remote sensing fall in
the following categories</p>
<ul>
<li><strong>Single Band Change</strong>: Measuring change in a single
band image or a spectral index using a threshold</li>
<li><strong>Multi Band Change</strong>: Measuring spectral distance and
spectral angle between two multiband images</li>
<li><strong>Classification of Change</strong>: One-pass classification
using stacked image containing bands from before and after an event</li>
<li><strong>Post Classification Comparison</strong>: Comparing two
classified images and computing class transitions</li>
</ul>
<p><a
href="https://www.youtube.com/watch?v=ybHxiygVVz0&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=5"
target="_blank"><img
src="https://img.youtube.com/vi/ybHxiygVVz0/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=ybHxiygVVz0&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=5"
target="_blank">Watch the Video ↗</a></p>
</div>
<div id="spectral-index-change" class="section level2">
<h2>01. Spectral Index Change</h2>
<p>Many types of change can be detected by measuring the change in a
spectral index and applying a threshold. This technique is suitable when
there is a suitable spectral index is available for the type of change
you are interested in detecting.</p>
<p>Here we apply this technique to map the extent and severity of a
forest fire. The <strong>Normalized Burn Ratio (NBR)</strong> is an
index that is designed to highlight burnt vegetation areas. We compute
the NBR for before and after images. Then we apply a suitable threshold
to find burnt areas.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/spectral_index_change.png" alt="Spectral Index Change Detection" width="75%" />
<p class="caption">
Spectral Index Change Detection
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01b_Spectral_Index_Change_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co">// On 21st February 2019, massive forest fires broke out in</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="co">// numerous places across the Bandipur National Park of</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="co">// the Karnataka state in India.</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a><span class="co">// By 25 February 2019 most fire was brought under control</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="co">// This script shows how to do damage assessment using</span></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="co">// spectral index change detection technique.</span></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="co">// Define the area of interest</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>  [<span class="fl">76.37639666685044</span><span class="op">,</span> <span class="fl">11.766523239445169</span>]<span class="op">,</span></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>  [<span class="fl">76.37639666685044</span><span class="op">,</span> <span class="fl">11.519036946599561</span>]<span class="op">,</span></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a>  [<span class="fl">76.78426409849106</span><span class="op">,</span> <span class="fl">11.519036946599561</span>]<span class="op">,</span></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>  [<span class="fl">76.78426409849106</span><span class="op">,</span> <span class="fl">11.766523239445169</span>]</span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a><span class="kw">var</span> fireStart <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2019-02-20&#39;</span>)<span class="op">;</span></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a><span class="kw">var</span> fireEnd <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2019-02-25&#39;</span>)<span class="op">;</span></span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry<span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;COPERNICUS/S2&quot;</span>)</span>
<span id="cb42-21"><a href="#cb42-21" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" tabindex="-1"></a><span class="co">// Apply filters </span></span>
<span id="cb42-24"><a href="#cb42-24" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb42-25"><a href="#cb42-25" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb42-26"><a href="#cb42-26" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb42-27"><a href="#cb42-27" tabindex="-1"></a></span>
<span id="cb42-28"><a href="#cb42-28" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb42-29"><a href="#cb42-29" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb42-30"><a href="#cb42-30" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb42-31"><a href="#cb42-31" tabindex="-1"></a></span>
<span id="cb42-32"><a href="#cb42-32" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb42-33"><a href="#cb42-33" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb42-34"><a href="#cb42-34" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb42-35"><a href="#cb42-35" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb42-36"><a href="#cb42-36" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb42-38"><a href="#cb42-38" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb42-39"><a href="#cb42-39" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb42-40"><a href="#cb42-40" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb42-41"><a href="#cb42-41" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb42-42"><a href="#cb42-42" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb42-43"><a href="#cb42-43" tabindex="-1"></a>}</span>
<span id="cb42-44"><a href="#cb42-44" tabindex="-1"></a></span>
<span id="cb42-45"><a href="#cb42-45" tabindex="-1"></a></span>
<span id="cb42-46"><a href="#cb42-46" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb42-47"><a href="#cb42-47" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)<span class="op">;</span></span>
<span id="cb42-48"><a href="#cb42-48" tabindex="-1"></a></span>
<span id="cb42-49"><a href="#cb42-49" tabindex="-1"></a><span class="co">// Create Before and After composites</span></span>
<span id="cb42-50"><a href="#cb42-50" tabindex="-1"></a><span class="kw">var</span> before <span class="op">=</span> filteredMasked</span>
<span id="cb42-51"><a href="#cb42-51" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb42-52"><a href="#cb42-52" tabindex="-1"></a>    fireStart<span class="op">.</span><span class="fu">advance</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)<span class="op">,</span> fireStart))</span>
<span id="cb42-53"><a href="#cb42-53" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb42-54"><a href="#cb42-54" tabindex="-1"></a></span>
<span id="cb42-55"><a href="#cb42-55" tabindex="-1"></a><span class="kw">var</span> after <span class="op">=</span> filteredMasked</span>
<span id="cb42-56"><a href="#cb42-56" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb42-57"><a href="#cb42-57" tabindex="-1"></a>    fireEnd<span class="op">,</span> fireEnd<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)))</span>
<span id="cb42-58"><a href="#cb42-58" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb42-59"><a href="#cb42-59" tabindex="-1"></a></span>
<span id="cb42-60"><a href="#cb42-60" tabindex="-1"></a><span class="co">// Freshly burnt regions appeat bright in SWIR-bands</span></span>
<span id="cb42-61"><a href="#cb42-61" tabindex="-1"></a><span class="co">// Use a False Color Visualization</span></span>
<span id="cb42-62"><a href="#cb42-62" tabindex="-1"></a><span class="kw">var</span> swirVis <span class="op">=</span> {</span>
<span id="cb42-63"><a href="#cb42-63" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb42-64"><a href="#cb42-64" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb42-65"><a href="#cb42-65" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B12&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>]<span class="op">,</span></span>
<span id="cb42-66"><a href="#cb42-66" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb42-67"><a href="#cb42-67" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(before<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> swirVis<span class="op">,</span> <span class="st">&#39;Before&#39;</span>)</span>
<span id="cb42-68"><a href="#cb42-68" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(after<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> swirVis<span class="op">,</span> <span class="st">&#39;After&#39;</span>)</span>
<span id="cb42-69"><a href="#cb42-69" tabindex="-1"></a></span>
<span id="cb42-70"><a href="#cb42-70" tabindex="-1"></a><span class="co">// Write a function to calculate  Normalized Burn Ratio (NBR)</span></span>
<span id="cb42-71"><a href="#cb42-71" tabindex="-1"></a><span class="co">// &#39;NIR&#39; (B8) and &#39;SWIR-2&#39; (B12)</span></span>
<span id="cb42-72"><a href="#cb42-72" tabindex="-1"></a><span class="kw">var</span> addNBR <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb42-73"><a href="#cb42-73" tabindex="-1"></a>  <span class="kw">var</span> nbr <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B12&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;nbr&#39;</span>])<span class="op">;</span></span>
<span id="cb42-74"><a href="#cb42-74" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(nbr)</span>
<span id="cb42-75"><a href="#cb42-75" tabindex="-1"></a>}</span>
<span id="cb42-76"><a href="#cb42-76" tabindex="-1"></a></span>
<span id="cb42-77"><a href="#cb42-77" tabindex="-1"></a><span class="kw">var</span> beforeNbr <span class="op">=</span> <span class="fu">addNBR</span>(before)<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;nbr&#39;</span>)<span class="op">;</span></span>
<span id="cb42-78"><a href="#cb42-78" tabindex="-1"></a><span class="kw">var</span> afterNbr <span class="op">=</span> <span class="fu">addNBR</span>(after)<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;nbr&#39;</span>)<span class="op">;</span></span>
<span id="cb42-79"><a href="#cb42-79" tabindex="-1"></a></span>
<span id="cb42-80"><a href="#cb42-80" tabindex="-1"></a><span class="kw">var</span> nbrVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;black&#39;</span>]}</span>
<span id="cb42-81"><a href="#cb42-81" tabindex="-1"></a></span>
<span id="cb42-82"><a href="#cb42-82" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(beforeNbr<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> nbrVis<span class="op">,</span> <span class="st">&#39;Prefire NBR&#39;</span>)<span class="op">;</span></span>
<span id="cb42-83"><a href="#cb42-83" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(afterNbr<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> nbrVis<span class="op">,</span> <span class="st">&#39;Postfire NBR&#39;</span>)<span class="op">;</span></span>
<span id="cb42-84"><a href="#cb42-84" tabindex="-1"></a></span>
<span id="cb42-85"><a href="#cb42-85" tabindex="-1"></a><span class="co">// Calculate Change in NBR (dNBR)</span></span>
<span id="cb42-86"><a href="#cb42-86" tabindex="-1"></a><span class="kw">var</span> change <span class="op">=</span> beforeNbr<span class="op">.</span><span class="fu">subtract</span>(afterNbr)</span>
<span id="cb42-87"><a href="#cb42-87" tabindex="-1"></a></span>
<span id="cb42-88"><a href="#cb42-88" tabindex="-1"></a><span class="co">// Apply a threshold</span></span>
<span id="cb42-89"><a href="#cb42-89" tabindex="-1"></a><span class="kw">var</span> threshold <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb42-90"><a href="#cb42-90" tabindex="-1"></a></span>
<span id="cb42-91"><a href="#cb42-91" tabindex="-1"></a><span class="co">// Display Burned Areas</span></span>
<span id="cb42-92"><a href="#cb42-92" tabindex="-1"></a><span class="kw">var</span> burned <span class="op">=</span> change<span class="op">.</span><span class="fu">gt</span>(threshold)</span>
<span id="cb42-93"><a href="#cb42-93" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(burned<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;red&#39;</span>]}<span class="op">,</span> <span class="st">&#39;Burned&#39;</span><span class="op">,</span> <span class="kw">false</span>) </span></code></pre></div>
<div id="exercise-19" class="section level3">
<h3>Exercise</h3>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/spectral_index_change_exercise.png" alt="Classifying the Change Image" width="75%" />
<p class="caption">
Classifying the Change Image
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01c_Spectral_Index_Change_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="co">// Define the area of interest</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  [<span class="fl">76.37639666685044</span><span class="op">,</span> <span class="fl">11.766523239445169</span>]<span class="op">,</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>  [<span class="fl">76.37639666685044</span><span class="op">,</span> <span class="fl">11.519036946599561</span>]<span class="op">,</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  [<span class="fl">76.78426409849106</span><span class="op">,</span> <span class="fl">11.519036946599561</span>]<span class="op">,</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>  [<span class="fl">76.78426409849106</span><span class="op">,</span> <span class="fl">11.766523239445169</span>]</span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a><span class="kw">var</span> fireStart <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2019-02-20&#39;</span>)<span class="op">;</span></span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a><span class="kw">var</span> fireEnd <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2019-02-25&#39;</span>)<span class="op">;</span></span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry<span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;COPERNICUS/S2&quot;</span>)</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a><span class="co">// Apply filters </span></span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb43-22"><a href="#cb43-22" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb43-23"><a href="#cb43-23" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb43-24"><a href="#cb43-24" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb43-26"><a href="#cb43-26" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb43-27"><a href="#cb43-27" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb43-28"><a href="#cb43-28" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb43-29"><a href="#cb43-29" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb43-31"><a href="#cb43-31" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb43-32"><a href="#cb43-32" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb43-33"><a href="#cb43-33" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb43-34"><a href="#cb43-34" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb43-35"><a href="#cb43-35" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb43-36"><a href="#cb43-36" tabindex="-1"></a>}</span>
<span id="cb43-37"><a href="#cb43-37" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" tabindex="-1"></a></span>
<span id="cb43-39"><a href="#cb43-39" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb43-40"><a href="#cb43-40" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)<span class="op">;</span></span>
<span id="cb43-41"><a href="#cb43-41" tabindex="-1"></a></span>
<span id="cb43-42"><a href="#cb43-42" tabindex="-1"></a><span class="co">// Create Before and After composites</span></span>
<span id="cb43-43"><a href="#cb43-43" tabindex="-1"></a><span class="kw">var</span> before <span class="op">=</span> filteredMasked</span>
<span id="cb43-44"><a href="#cb43-44" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb43-45"><a href="#cb43-45" tabindex="-1"></a>    fireStart<span class="op">.</span><span class="fu">advance</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)<span class="op">,</span> fireStart))</span>
<span id="cb43-46"><a href="#cb43-46" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb43-47"><a href="#cb43-47" tabindex="-1"></a></span>
<span id="cb43-48"><a href="#cb43-48" tabindex="-1"></a><span class="kw">var</span> after <span class="op">=</span> filteredMasked</span>
<span id="cb43-49"><a href="#cb43-49" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb43-50"><a href="#cb43-50" tabindex="-1"></a>    fireEnd<span class="op">,</span> fireEnd<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)))</span>
<span id="cb43-51"><a href="#cb43-51" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb43-52"><a href="#cb43-52" tabindex="-1"></a></span>
<span id="cb43-53"><a href="#cb43-53" tabindex="-1"></a></span>
<span id="cb43-54"><a href="#cb43-54" tabindex="-1"></a><span class="co">// Write a function to calculate  Normalized Burn Ratio (NBR)</span></span>
<span id="cb43-55"><a href="#cb43-55" tabindex="-1"></a><span class="co">// &#39;NIR&#39; (B8) and &#39;SWIR-2&#39; (B12)</span></span>
<span id="cb43-56"><a href="#cb43-56" tabindex="-1"></a><span class="kw">var</span> addNBR <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb43-57"><a href="#cb43-57" tabindex="-1"></a>  <span class="kw">var</span> nbr <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B12&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;nbr&#39;</span>])<span class="op">;</span></span>
<span id="cb43-58"><a href="#cb43-58" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(nbr)</span>
<span id="cb43-59"><a href="#cb43-59" tabindex="-1"></a>}</span>
<span id="cb43-60"><a href="#cb43-60" tabindex="-1"></a></span>
<span id="cb43-61"><a href="#cb43-61" tabindex="-1"></a><span class="kw">var</span> beforeNbr <span class="op">=</span> <span class="fu">addNBR</span>(before)<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;nbr&#39;</span>)<span class="op">;</span></span>
<span id="cb43-62"><a href="#cb43-62" tabindex="-1"></a><span class="kw">var</span> afterNbr <span class="op">=</span> <span class="fu">addNBR</span>(after)<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;nbr&#39;</span>)<span class="op">;</span></span>
<span id="cb43-63"><a href="#cb43-63" tabindex="-1"></a></span>
<span id="cb43-64"><a href="#cb43-64" tabindex="-1"></a><span class="co">// Calculate Change in NBR (dNBR)</span></span>
<span id="cb43-65"><a href="#cb43-65" tabindex="-1"></a><span class="kw">var</span> change <span class="op">=</span> beforeNbr<span class="op">.</span><span class="fu">subtract</span>(afterNbr)</span>
<span id="cb43-66"><a href="#cb43-66" tabindex="-1"></a></span>
<span id="cb43-67"><a href="#cb43-67" tabindex="-1"></a><span class="kw">var</span> dnbrPalette <span class="op">=</span> [<span class="st">&#39;#ffffb2&#39;</span><span class="op">,</span><span class="st">&#39;#fecc5c&#39;</span><span class="op">,</span><span class="st">&#39;#fd8d3c&#39;</span><span class="op">,</span><span class="st">&#39;#f03b20&#39;</span><span class="op">,</span><span class="st">&#39;#bd0026&#39;</span>]<span class="op">;</span></span>
<span id="cb43-68"><a href="#cb43-68" tabindex="-1"></a><span class="co">// Display the change image</span></span>
<span id="cb43-69"><a href="#cb43-69" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(change<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="fl">0.1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> dnbrPalette}<span class="op">,</span></span>
<span id="cb43-70"><a href="#cb43-70" tabindex="-1"></a>  <span class="st">&#39;Change in NBR&#39;</span>)</span>
<span id="cb43-71"><a href="#cb43-71" tabindex="-1"></a></span>
<span id="cb43-72"><a href="#cb43-72" tabindex="-1"></a><span class="co">// We can also classify the change image according to</span></span>
<span id="cb43-73"><a href="#cb43-73" tabindex="-1"></a><span class="co">// burn severity</span></span>
<span id="cb43-74"><a href="#cb43-74" tabindex="-1"></a></span>
<span id="cb43-75"><a href="#cb43-75" tabindex="-1"></a><span class="co">// United States Geological Survey (USGS) proposed</span></span>
<span id="cb43-76"><a href="#cb43-76" tabindex="-1"></a><span class="co">// a classification table to interpret the burn severity</span></span>
<span id="cb43-77"><a href="#cb43-77" tabindex="-1"></a><span class="co">// We will assign a discrete class value and visualize it</span></span>
<span id="cb43-78"><a href="#cb43-78" tabindex="-1"></a><span class="co">// | Severity     | dNBR Range         | Class |</span></span>
<span id="cb43-79"><a href="#cb43-79" tabindex="-1"></a><span class="co">// |--------------|--------------------|-------|</span></span>
<span id="cb43-80"><a href="#cb43-80" tabindex="-1"></a><span class="co">// | Unburned     | &lt; 0.1              | 0     |</span></span>
<span id="cb43-81"><a href="#cb43-81" tabindex="-1"></a><span class="co">// | Low Severity | &gt;= 0.10 and &lt;0.27  | 1     |</span></span>
<span id="cb43-82"><a href="#cb43-82" tabindex="-1"></a><span class="co">// | Moderate-Low | &gt;= 0.27 and &lt;0.44  | 2     |</span></span>
<span id="cb43-83"><a href="#cb43-83" tabindex="-1"></a><span class="co">// | Moderate-High| &gt;= 0.44 and&lt; 0.66  | 3     |</span></span>
<span id="cb43-84"><a href="#cb43-84" tabindex="-1"></a><span class="co">// | High         | &gt;= 0.66            | 4     |</span></span>
<span id="cb43-85"><a href="#cb43-85" tabindex="-1"></a></span>
<span id="cb43-86"><a href="#cb43-86" tabindex="-1"></a><span class="co">// Classification of continuous values can be done</span></span>
<span id="cb43-87"><a href="#cb43-87" tabindex="-1"></a><span class="co">// using the .where() function</span></span>
<span id="cb43-88"><a href="#cb43-88" tabindex="-1"></a><span class="kw">var</span> severity <span class="op">=</span> change</span>
<span id="cb43-89"><a href="#cb43-89" tabindex="-1"></a>  <span class="op">.</span><span class="fu">where</span>(change<span class="op">.</span><span class="fu">lt</span>(<span class="fl">0.10</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb43-90"><a href="#cb43-90" tabindex="-1"></a>  <span class="op">.</span><span class="fu">where</span>(change<span class="op">.</span><span class="fu">gte</span>(<span class="fl">0.10</span>)<span class="op">.</span><span class="fu">and</span>(change<span class="op">.</span><span class="fu">lt</span>(<span class="fl">0.27</span>))<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb43-91"><a href="#cb43-91" tabindex="-1"></a>  <span class="op">.</span><span class="fu">where</span>(change<span class="op">.</span><span class="fu">gte</span>(<span class="fl">0.27</span>)<span class="op">.</span><span class="fu">and</span>(change<span class="op">.</span><span class="fu">lt</span>(<span class="fl">0.44</span>))<span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb43-92"><a href="#cb43-92" tabindex="-1"></a>  <span class="op">.</span><span class="fu">where</span>(change<span class="op">.</span><span class="fu">gte</span>(<span class="fl">0.44</span>)<span class="op">.</span><span class="fu">and</span>(change<span class="op">.</span><span class="fu">lt</span>(<span class="fl">0.66</span>))<span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb43-93"><a href="#cb43-93" tabindex="-1"></a>  <span class="op">.</span><span class="fu">where</span>(change<span class="op">.</span><span class="fu">gt</span>(<span class="fl">0.66</span>)<span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb43-94"><a href="#cb43-94" tabindex="-1"></a></span>
<span id="cb43-95"><a href="#cb43-95" tabindex="-1"></a></span>
<span id="cb43-96"><a href="#cb43-96" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb43-97"><a href="#cb43-97" tabindex="-1"></a></span>
<span id="cb43-98"><a href="#cb43-98" tabindex="-1"></a><span class="co">// The resulting image &#39;severity&#39; is a discrete image with </span></span>
<span id="cb43-99"><a href="#cb43-99" tabindex="-1"></a><span class="co">// pixel values from 0-4 representing the severity class</span></span>
<span id="cb43-100"><a href="#cb43-100" tabindex="-1"></a></span>
<span id="cb43-101"><a href="#cb43-101" tabindex="-1"></a><span class="co">// Display the image according to the following color table</span></span>
<span id="cb43-102"><a href="#cb43-102" tabindex="-1"></a></span>
<span id="cb43-103"><a href="#cb43-103" tabindex="-1"></a><span class="co">// | Severity     | Class | Color   |</span></span>
<span id="cb43-104"><a href="#cb43-104" tabindex="-1"></a><span class="co">// |--------------|-------|---------|</span></span>
<span id="cb43-105"><a href="#cb43-105" tabindex="-1"></a><span class="co">// | Unburned     | 0     | green   |</span></span>
<span id="cb43-106"><a href="#cb43-106" tabindex="-1"></a><span class="co">// | Low Severity | 1     | yellow  |</span></span>
<span id="cb43-107"><a href="#cb43-107" tabindex="-1"></a><span class="co">// | Moderate-Low | 2     | organge |</span></span>
<span id="cb43-108"><a href="#cb43-108" tabindex="-1"></a><span class="co">// | Moderate-High| 3     | red     |</span></span>
<span id="cb43-109"><a href="#cb43-109" tabindex="-1"></a><span class="co">// | High         | 4     | magenta |</span></span></code></pre></div>
</div>
</div>
<div id="spectral-distance-change" class="section level2">
<h2>02. Spectral Distance Change</h2>
<p>When you want to detect changes from multi-band images, a useful
technique is to compute the Spectral Distance and Spectral Angle between
the two images. Pixels that exhibit a large change will have a larger
distance compared to those that did not change. This technique is
particularly useful when there are no suitable index to detect the
change. It can be applied to detect change after natural disasters or
human conflicts.</p>
<p>Here we use this technique to detect landslides using before/after
composites. You may learn more about this technique at <a
href="https://goo.gl/xotYhk">Craig D’Souza’s Change Detection</a>
presentation.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/spectral_distance.png" alt="Spectral Distance Change Detection" width="75%" />
<p class="caption">
Spectral Distance Change Detection
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01b_Spectral_Distance_Change_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>  [<span class="fl">75.70357667713435</span><span class="op">,</span> <span class="fl">12.49723970868507</span>]<span class="op">,</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>  [<span class="fl">75.70357667713435</span><span class="op">,</span> <span class="fl">12.470171844429931</span>]<span class="op">,</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>  [<span class="fl">75.7528434923199</span><span class="op">,</span> <span class="fl">12.470171844429931</span>]<span class="op">,</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>  [<span class="fl">75.7528434923199</span><span class="op">,</span> <span class="fl">12.49723970868507</span>]</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)<span class="op">;</span></span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb44-17"><a href="#cb44-17" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb44-18"><a href="#cb44-18" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb44-20"><a href="#cb44-20" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb44-21"><a href="#cb44-21" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb44-22"><a href="#cb44-22" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb44-24"><a href="#cb44-24" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb44-25"><a href="#cb44-25" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb44-26"><a href="#cb44-26" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb44-27"><a href="#cb44-27" tabindex="-1"></a></span>
<span id="cb44-28"><a href="#cb44-28" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb44-29"><a href="#cb44-29" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb44-30"><a href="#cb44-30" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb44-31"><a href="#cb44-31" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.65</span><span class="op">;</span></span>
<span id="cb44-32"><a href="#cb44-32" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb44-33"><a href="#cb44-33" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb44-34"><a href="#cb44-34" tabindex="-1"></a>}</span>
<span id="cb44-35"><a href="#cb44-35" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb44-37"><a href="#cb44-37" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)<span class="op">;</span></span>
<span id="cb44-38"><a href="#cb44-38" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" tabindex="-1"></a><span class="kw">var</span> dateOfIncident <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2018-08-15&#39;</span>)<span class="op">;</span></span>
<span id="cb44-40"><a href="#cb44-40" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" tabindex="-1"></a><span class="kw">var</span> before <span class="op">=</span> filteredMasked</span>
<span id="cb44-42"><a href="#cb44-42" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(dateOfIncident<span class="op">.</span><span class="fu">advance</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">,</span> dateOfIncident))</span>
<span id="cb44-43"><a href="#cb44-43" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">6</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>))</span>
<span id="cb44-44"><a href="#cb44-44" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb44-45"><a href="#cb44-45" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb44-46"><a href="#cb44-46" tabindex="-1"></a>  </span>
<span id="cb44-47"><a href="#cb44-47" tabindex="-1"></a><span class="kw">var</span> after <span class="op">=</span> filteredMasked</span>
<span id="cb44-48"><a href="#cb44-48" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb44-49"><a href="#cb44-49" tabindex="-1"></a>    dateOfIncident<span class="op">,</span> dateOfIncident<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)))</span>
<span id="cb44-50"><a href="#cb44-50" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb44-51"><a href="#cb44-51" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb44-52"><a href="#cb44-52" tabindex="-1"></a></span>
<span id="cb44-53"><a href="#cb44-53" tabindex="-1"></a></span>
<span id="cb44-54"><a href="#cb44-54" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(before<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Before&#39;</span>)<span class="op">;</span></span>
<span id="cb44-55"><a href="#cb44-55" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(after<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;After&#39;</span>)<span class="op">;</span></span>
<span id="cb44-56"><a href="#cb44-56" tabindex="-1"></a></span>
<span id="cb44-57"><a href="#cb44-57" tabindex="-1"></a><span class="co">// Use the spectralDistance() function to get spectral distance measures</span></span>
<span id="cb44-58"><a href="#cb44-58" tabindex="-1"></a></span>
<span id="cb44-59"><a href="#cb44-59" tabindex="-1"></a><span class="co">// Use the metric &#39;Spectral Angle Mapper (SAM)</span></span>
<span id="cb44-60"><a href="#cb44-60" tabindex="-1"></a><span class="co">// The result is the spectral angle in radians</span></span>
<span id="cb44-61"><a href="#cb44-61" tabindex="-1"></a><span class="kw">var</span> angle <span class="op">=</span> after<span class="op">.</span><span class="fu">spectralDistance</span>(before<span class="op">,</span> <span class="st">&#39;sam&#39;</span>)<span class="op">;</span></span>
<span id="cb44-62"><a href="#cb44-62" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(angle<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;purple&#39;</span>]}<span class="op">,</span> <span class="st">&#39;Spectral Angle&#39;</span>)<span class="op">;</span></span>
<span id="cb44-63"><a href="#cb44-63" tabindex="-1"></a></span>
<span id="cb44-64"><a href="#cb44-64" tabindex="-1"></a><span class="co">// Use the metric &#39;Squared Euclidian Distance (SED)&#39;</span></span>
<span id="cb44-65"><a href="#cb44-65" tabindex="-1"></a><span class="kw">var</span> sed <span class="op">=</span> after<span class="op">.</span><span class="fu">spectralDistance</span>(before<span class="op">,</span> <span class="st">&#39;sed&#39;</span>)<span class="op">;</span></span>
<span id="cb44-66"><a href="#cb44-66" tabindex="-1"></a><span class="co">// Take square root to get euclidian distance</span></span>
<span id="cb44-67"><a href="#cb44-67" tabindex="-1"></a><span class="kw">var</span> distance <span class="op">=</span> sed<span class="op">.</span><span class="fu">sqrt</span>()<span class="op">;</span></span>
<span id="cb44-68"><a href="#cb44-68" tabindex="-1"></a></span>
<span id="cb44-69"><a href="#cb44-69" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(distance<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1500</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;red&#39;</span>]}<span class="op">,</span> <span class="st">&#39;spectral distance&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div id="exercise-20" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01c_Spectral_Distance_Change_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>([[</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  [<span class="fl">75.70357667713435</span><span class="op">,</span> <span class="fl">12.49723970868507</span>]<span class="op">,</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  [<span class="fl">75.70357667713435</span><span class="op">,</span> <span class="fl">12.470171844429931</span>]<span class="op">,</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  [<span class="fl">75.7528434923199</span><span class="op">,</span> <span class="fl">12.470171844429931</span>]<span class="op">,</span></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  [<span class="fl">75.7528434923199</span><span class="op">,</span> <span class="fl">12.49723970868507</span>]</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>]])<span class="op">;</span></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)<span class="op">;</span></span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb45-16"><a href="#cb45-16" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb45-17"><a href="#cb45-17" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb45-18"><a href="#cb45-18" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb45-20"><a href="#cb45-20" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb45-21"><a href="#cb45-21" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb45-22"><a href="#cb45-22" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb45-24"><a href="#cb45-24" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb45-25"><a href="#cb45-25" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb45-26"><a href="#cb45-26" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb45-27"><a href="#cb45-27" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb45-29"><a href="#cb45-29" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb45-30"><a href="#cb45-30" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb45-31"><a href="#cb45-31" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.65</span><span class="op">;</span></span>
<span id="cb45-32"><a href="#cb45-32" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb45-33"><a href="#cb45-33" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb45-34"><a href="#cb45-34" tabindex="-1"></a>}</span>
<span id="cb45-35"><a href="#cb45-35" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb45-37"><a href="#cb45-37" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)<span class="op">;</span></span>
<span id="cb45-38"><a href="#cb45-38" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" tabindex="-1"></a><span class="kw">var</span> dateOfIncident <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2018-08-15&#39;</span>)<span class="op">;</span></span>
<span id="cb45-40"><a href="#cb45-40" tabindex="-1"></a></span>
<span id="cb45-41"><a href="#cb45-41" tabindex="-1"></a><span class="kw">var</span> before <span class="op">=</span> filteredMasked</span>
<span id="cb45-42"><a href="#cb45-42" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(dateOfIncident<span class="op">.</span><span class="fu">advance</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">,</span> dateOfIncident))</span>
<span id="cb45-43"><a href="#cb45-43" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">6</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>))</span>
<span id="cb45-44"><a href="#cb45-44" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb45-45"><a href="#cb45-45" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb45-46"><a href="#cb45-46" tabindex="-1"></a>  </span>
<span id="cb45-47"><a href="#cb45-47" tabindex="-1"></a><span class="kw">var</span> after <span class="op">=</span> filteredMasked</span>
<span id="cb45-48"><a href="#cb45-48" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(</span>
<span id="cb45-49"><a href="#cb45-49" tabindex="-1"></a>    dateOfIncident<span class="op">,</span> dateOfIncident<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)))</span>
<span id="cb45-50"><a href="#cb45-50" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb45-51"><a href="#cb45-51" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb45-52"><a href="#cb45-52" tabindex="-1"></a></span>
<span id="cb45-53"><a href="#cb45-53" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(before<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Before&#39;</span>)<span class="op">;</span></span>
<span id="cb45-54"><a href="#cb45-54" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(after<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;After&#39;</span>)<span class="op">;</span></span>
<span id="cb45-55"><a href="#cb45-55" tabindex="-1"></a></span>
<span id="cb45-56"><a href="#cb45-56" tabindex="-1"></a><span class="co">// Use the spectralDistance() function to get spectral distance measures</span></span>
<span id="cb45-57"><a href="#cb45-57" tabindex="-1"></a></span>
<span id="cb45-58"><a href="#cb45-58" tabindex="-1"></a><span class="co">// Use the metric &#39;Spectral Angle Mapper (SAM)</span></span>
<span id="cb45-59"><a href="#cb45-59" tabindex="-1"></a><span class="co">// The result is the spectral angle in radians</span></span>
<span id="cb45-60"><a href="#cb45-60" tabindex="-1"></a><span class="kw">var</span> angle <span class="op">=</span> after<span class="op">.</span><span class="fu">spectralDistance</span>(before<span class="op">,</span> <span class="st">&#39;sam&#39;</span>)<span class="op">;</span></span>
<span id="cb45-61"><a href="#cb45-61" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(angle<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;purple&#39;</span>]}<span class="op">,</span> <span class="st">&#39;Spectral Angle&#39;</span>)<span class="op">;</span></span>
<span id="cb45-62"><a href="#cb45-62" tabindex="-1"></a></span>
<span id="cb45-63"><a href="#cb45-63" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb45-64"><a href="#cb45-64" tabindex="-1"></a><span class="co">// Inspect the angle image and find a suitable threshold</span></span>
<span id="cb45-65"><a href="#cb45-65" tabindex="-1"></a><span class="co">// that signifies damage after the landslides</span></span>
<span id="cb45-66"><a href="#cb45-66" tabindex="-1"></a><span class="co">// Apply the threshold and create a new image showing landslides</span></span>
<span id="cb45-67"><a href="#cb45-67" tabindex="-1"></a><span class="co">// Display the results</span></span>
<span id="cb45-68"><a href="#cb45-68" tabindex="-1"></a></span>
<span id="cb45-69"><a href="#cb45-69" tabindex="-1"></a><span class="co">// Hint: Use the .gt() method to apply the threshold</span></span></code></pre></div>
</div>
</div>
<div id="direct-classification-of-change" class="section level2">
<h2>03. Direct Classification of Change</h2>
<p>This technique of change detection is also known as <em>One-pass
Classification</em> or <em>Direct Multi-date Classification</em>. Here
we create a single stacked image containing bands from before and after
images. We train a classifier with training data sampled from the
stacked image and apply the classifier on the stacked image to find all
change pixels.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/change_classification.png" alt="All pixels that changed from bare ground to built-up" width="100%" />
<p class="caption">
All pixels that changed from bare ground to built-up
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F03b_Classifying_Change_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="kw">var</span> bangalore <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>)<span class="op">;</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="kw">var</span> change <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/bangalore_change_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="kw">var</span> nochange <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/bangalore_nochange_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)<span class="op">;</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> bangalore<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span></span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a><span class="co">// Write a function for Cloud masking</span></span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb46-18"><a href="#cb46-18" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb46-19"><a href="#cb46-19" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb46-21"><a href="#cb46-21" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb46-22"><a href="#cb46-22" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb46-23"><a href="#cb46-23" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb46-25"><a href="#cb46-25" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb46-26"><a href="#cb46-26" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb46-27"><a href="#cb46-27" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb46-28"><a href="#cb46-28" tabindex="-1"></a></span>
<span id="cb46-29"><a href="#cb46-29" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb46-30"><a href="#cb46-30" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb46-31"><a href="#cb46-31" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb46-32"><a href="#cb46-32" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb46-33"><a href="#cb46-33" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb46-34"><a href="#cb46-34" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb46-35"><a href="#cb46-35" tabindex="-1"></a>}</span>
<span id="cb46-36"><a href="#cb46-36" tabindex="-1"></a></span>
<span id="cb46-37"><a href="#cb46-37" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb46-39"><a href="#cb46-39" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)</span>
<span id="cb46-40"><a href="#cb46-40" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb46-41"><a href="#cb46-41" tabindex="-1"></a></span>
<span id="cb46-42"><a href="#cb46-42" tabindex="-1"></a><span class="co">// January 2019</span></span>
<span id="cb46-43"><a href="#cb46-43" tabindex="-1"></a><span class="kw">var</span> filtered2019 <span class="op">=</span> filteredMasked</span>
<span id="cb46-44"><a href="#cb46-44" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2019-02-01&#39;</span>))<span class="op">;</span></span>
<span id="cb46-45"><a href="#cb46-45" tabindex="-1"></a><span class="kw">var</span> image2019 <span class="op">=</span> filtered2019<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb46-46"><a href="#cb46-46" tabindex="-1"></a><span class="co">// Display the input composite.</span></span>
<span id="cb46-47"><a href="#cb46-47" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image2019<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;2019&#39;</span>)<span class="op">;</span></span>
<span id="cb46-48"><a href="#cb46-48" tabindex="-1"></a></span>
<span id="cb46-49"><a href="#cb46-49" tabindex="-1"></a><span class="co">// January 2020</span></span>
<span id="cb46-50"><a href="#cb46-50" tabindex="-1"></a><span class="kw">var</span> filtered2020 <span class="op">=</span> filteredMasked</span>
<span id="cb46-51"><a href="#cb46-51" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2020-02-01&#39;</span>))<span class="op">;</span></span>
<span id="cb46-52"><a href="#cb46-52" tabindex="-1"></a><span class="kw">var</span> image2020 <span class="op">=</span> filtered2020<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb46-53"><a href="#cb46-53" tabindex="-1"></a><span class="co">// Display the input composite.</span></span>
<span id="cb46-54"><a href="#cb46-54" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image2020<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;2020&#39;</span>)<span class="op">;</span></span>
<span id="cb46-55"><a href="#cb46-55" tabindex="-1"></a></span>
<span id="cb46-56"><a href="#cb46-56" tabindex="-1"></a><span class="kw">var</span> stackedImage <span class="op">=</span> image2019<span class="op">.</span><span class="fu">addBands</span>(image2020)<span class="op">;</span></span>
<span id="cb46-57"><a href="#cb46-57" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb46-59"><a href="#cb46-59" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> stackedImage<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb46-60"><a href="#cb46-60" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> change<span class="op">.</span><span class="fu">merge</span>(nochange)<span class="op">,</span> </span>
<span id="cb46-61"><a href="#cb46-61" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;class&#39;</span>]<span class="op">,</span> </span>
<span id="cb46-62"><a href="#cb46-62" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb46-63"><a href="#cb46-63" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb46-64"><a href="#cb46-64" tabindex="-1"></a></span>
<span id="cb46-65"><a href="#cb46-65" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb46-66"><a href="#cb46-66" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)<span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb46-67"><a href="#cb46-67" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb46-68"><a href="#cb46-68" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span> </span>
<span id="cb46-69"><a href="#cb46-69" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> stackedImage<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb46-70"><a href="#cb46-70" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb46-71"><a href="#cb46-71" tabindex="-1"></a></span>
<span id="cb46-72"><a href="#cb46-72" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb46-73"><a href="#cb46-73" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> stackedImage<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb46-74"><a href="#cb46-74" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span></span>
<span id="cb46-75"><a href="#cb46-75" tabindex="-1"></a>  {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;red&#39;</span>]}<span class="op">,</span> <span class="st">&#39;change&#39;</span>)<span class="op">;</span> </span></code></pre></div>
<div id="exercise-21" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?accept_repo=users%2Fujavalgandhi%2FEnd-to-End-GEE&amp;scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F03c_Classifying_Change_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co">// Add an NDBI band to improve the detection of changes.</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="kw">var</span> addNDBI <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>  <span class="kw">var</span> ndbi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B11&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndbi&#39;</span>])<span class="op">;</span></span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndbi)</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>}</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a><span class="co">// use addNDBI() function to add the NDBI band to both 2019 and 2020 composite images</span></span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a><span class="co">// Hint1: You can save the resulting image in the same variable to avoid changing </span></span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a><span class="co">// a lot of code.</span></span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a><span class="co">// var image = addNDBI(image)</span></span></code></pre></div>
</div>
</div>
<div id="post-classification-comparison" class="section level2">
<h2>04. Post-classification Comparison</h2>
<p>We dealing with multi-class images, a useful metric for change
detection is to know how many pixels from class X changed to class Y.
This can be accomplished using the
<code>ee.Reducer.frequencyHistogram()</code> reducer as shown below.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F04b_Post_Classification_Comparison_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="kw">var</span> bangalore <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>)<span class="op">;</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="kw">var</span> urban <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/urban_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="kw">var</span> bare <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/bare_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="kw">var</span> water <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/water_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a><span class="kw">var</span> vegetation <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/e2e/vegetation_gcps&#39;</span>)<span class="op">;</span></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR&#39;</span>)<span class="op">;</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> bangalore<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {</span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]<span class="op">,</span> </span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a><span class="co">// 2019 Jan</span></span>
<span id="cb48-18"><a href="#cb48-18" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb48-19"><a href="#cb48-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2019-02-01&#39;</span>))</span>
<span id="cb48-20"><a href="#cb48-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb48-21"><a href="#cb48-21" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)<span class="op">;</span></span>
<span id="cb48-22"><a href="#cb48-22" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" tabindex="-1"></a>  </span>
<span id="cb48-24"><a href="#cb48-24" tabindex="-1"></a><span class="kw">var</span> before <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb48-25"><a href="#cb48-25" tabindex="-1"></a><span class="co">// Display the input composite.</span></span>
<span id="cb48-26"><a href="#cb48-26" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(before<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;before&#39;</span>)<span class="op">;</span></span>
<span id="cb48-27"><a href="#cb48-27" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> urban<span class="op">.</span><span class="fu">merge</span>(bare)<span class="op">.</span><span class="fu">merge</span>(water)<span class="op">.</span><span class="fu">merge</span>(vegetation)<span class="op">;</span></span>
<span id="cb48-29"><a href="#cb48-29" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" tabindex="-1"></a><span class="co">// Overlay the point on the image to get training data.</span></span>
<span id="cb48-31"><a href="#cb48-31" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> before<span class="op">.</span><span class="fu">sampleRegions</span>({</span>
<span id="cb48-32"><a href="#cb48-32" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> training<span class="op">,</span> </span>
<span id="cb48-33"><a href="#cb48-33" tabindex="-1"></a>  <span class="dt">properties</span><span class="op">:</span> [<span class="st">&#39;landcover&#39;</span>]<span class="op">,</span> </span>
<span id="cb48-34"><a href="#cb48-34" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb48-35"><a href="#cb48-35" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb48-36"><a href="#cb48-36" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" tabindex="-1"></a><span class="co">// Train a classifier.</span></span>
<span id="cb48-38"><a href="#cb48-38" tabindex="-1"></a><span class="kw">var</span> classifier <span class="op">=</span> ee<span class="op">.</span><span class="at">Classifier</span><span class="op">.</span><span class="fu">smileRandomForest</span>(<span class="dv">50</span>)<span class="op">.</span><span class="fu">train</span>({</span>
<span id="cb48-39"><a href="#cb48-39" tabindex="-1"></a>  <span class="dt">features</span><span class="op">:</span> training<span class="op">,</span>  </span>
<span id="cb48-40"><a href="#cb48-40" tabindex="-1"></a>  <span class="dt">classProperty</span><span class="op">:</span> <span class="st">&#39;landcover&#39;</span><span class="op">,</span> </span>
<span id="cb48-41"><a href="#cb48-41" tabindex="-1"></a>  <span class="dt">inputProperties</span><span class="op">:</span> before<span class="op">.</span><span class="fu">bandNames</span>()</span>
<span id="cb48-42"><a href="#cb48-42" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb48-43"><a href="#cb48-43" tabindex="-1"></a></span>
<span id="cb48-44"><a href="#cb48-44" tabindex="-1"></a><span class="co">// // Classify the image.</span></span>
<span id="cb48-45"><a href="#cb48-45" tabindex="-1"></a><span class="kw">var</span> beforeClassified <span class="op">=</span> before<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb48-46"><a href="#cb48-46" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#cc6d8f&#39;</span><span class="op">,</span> <span class="st">&#39;#ffc107&#39;</span><span class="op">,</span> <span class="st">&#39;#1e88e5&#39;</span><span class="op">,</span> <span class="st">&#39;#004d40&#39;</span> ]<span class="op">;</span></span>
<span id="cb48-47"><a href="#cb48-47" tabindex="-1"></a><span class="kw">var</span> classifiedVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">;</span></span>
<span id="cb48-48"><a href="#cb48-48" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(beforeClassified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> classifiedVis<span class="op">,</span> <span class="st">&#39;before_classified&#39;</span>)<span class="op">;</span></span>
<span id="cb48-49"><a href="#cb48-49" tabindex="-1"></a></span>
<span id="cb48-50"><a href="#cb48-50" tabindex="-1"></a><span class="co">// 2020 Jan</span></span>
<span id="cb48-51"><a href="#cb48-51" tabindex="-1"></a><span class="kw">var</span> after <span class="op">=</span> s2</span>
<span id="cb48-52"><a href="#cb48-52" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-02-01&#39;</span>))</span>
<span id="cb48-53"><a href="#cb48-53" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb48-54"><a href="#cb48-54" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb48-55"><a href="#cb48-55" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb48-56"><a href="#cb48-56" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(after<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;after&#39;</span>)<span class="op">;</span></span>
<span id="cb48-58"><a href="#cb48-58" tabindex="-1"></a></span>
<span id="cb48-59"><a href="#cb48-59" tabindex="-1"></a><span class="co">// Classify the image.</span></span>
<span id="cb48-60"><a href="#cb48-60" tabindex="-1"></a><span class="kw">var</span> afterClassified<span class="op">=</span> after<span class="op">.</span><span class="fu">classify</span>(classifier)<span class="op">;</span></span>
<span id="cb48-61"><a href="#cb48-61" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(afterClassified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> classifiedVis<span class="op">,</span> <span class="st">&#39;after_classified&#39;</span>)<span class="op">;</span></span>
<span id="cb48-62"><a href="#cb48-62" tabindex="-1"></a></span>
<span id="cb48-63"><a href="#cb48-63" tabindex="-1"></a></span>
<span id="cb48-64"><a href="#cb48-64" tabindex="-1"></a><span class="co">// Reclassify from 0-3 to 1-4</span></span>
<span id="cb48-65"><a href="#cb48-65" tabindex="-1"></a><span class="kw">var</span> beforeClasses <span class="op">=</span> beforeClassified<span class="op">.</span><span class="fu">remap</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>])<span class="op">;</span></span>
<span id="cb48-66"><a href="#cb48-66" tabindex="-1"></a><span class="kw">var</span> afterClasses <span class="op">=</span> afterClassified<span class="op">.</span><span class="fu">remap</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span>])<span class="op">;</span></span>
<span id="cb48-67"><a href="#cb48-67" tabindex="-1"></a></span>
<span id="cb48-68"><a href="#cb48-68" tabindex="-1"></a><span class="co">// Show all changed areas</span></span>
<span id="cb48-69"><a href="#cb48-69" tabindex="-1"></a><span class="kw">var</span> changed <span class="op">=</span> afterClasses<span class="op">.</span><span class="fu">subtract</span>(beforeClasses)<span class="op">.</span><span class="fu">neq</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb48-70"><a href="#cb48-70" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(changed<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;red&#39;</span>]}<span class="op">,</span> <span class="st">&#39;Change&#39;</span>)<span class="op">;</span></span>
<span id="cb48-71"><a href="#cb48-71" tabindex="-1"></a></span>
<span id="cb48-72"><a href="#cb48-72" tabindex="-1"></a><span class="co">// We multiply the before image with 100 and add the after image</span></span>
<span id="cb48-73"><a href="#cb48-73" tabindex="-1"></a><span class="co">// The resulting pixel values will be unique and will represent each unique transition</span></span>
<span id="cb48-74"><a href="#cb48-74" tabindex="-1"></a><span class="co">// i.e. 102 is urban to bare, 103 urban to water etc.</span></span>
<span id="cb48-75"><a href="#cb48-75" tabindex="-1"></a><span class="kw">var</span> merged <span class="op">=</span> beforeClasses<span class="op">.</span><span class="fu">multiply</span>(<span class="dv">100</span>)<span class="op">.</span><span class="fu">add</span>(afterClasses)<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;transitions&#39;</span>)<span class="op">;</span></span>
<span id="cb48-76"><a href="#cb48-76" tabindex="-1"></a></span>
<span id="cb48-77"><a href="#cb48-77" tabindex="-1"></a><span class="co">// Use a frequencyHistogram to get a pixel count per class</span></span>
<span id="cb48-78"><a href="#cb48-78" tabindex="-1"></a><span class="kw">var</span> transitionMatrix <span class="op">=</span> merged<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb48-79"><a href="#cb48-79" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">frequencyHistogram</span>()<span class="op">,</span> </span>
<span id="cb48-80"><a href="#cb48-80" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb48-81"><a href="#cb48-81" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e10</span><span class="op">,</span></span>
<span id="cb48-82"><a href="#cb48-82" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb48-83"><a href="#cb48-83" tabindex="-1"></a>  <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb48-84"><a href="#cb48-84" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb48-85"><a href="#cb48-85" tabindex="-1"></a><span class="co">// This prints number of pixels for each class transition</span></span>
<span id="cb48-86"><a href="#cb48-86" tabindex="-1"></a><span class="fu">print</span>(transitionMatrix<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;transitions&#39;</span>))<span class="op">;</span></span>
<span id="cb48-87"><a href="#cb48-87" tabindex="-1"></a></span>
<span id="cb48-88"><a href="#cb48-88" tabindex="-1"></a><span class="co">// If we want to calculate the area of each class transition</span></span>
<span id="cb48-89"><a href="#cb48-89" tabindex="-1"></a><span class="co">// we can use a grouped reducer</span></span>
<span id="cb48-90"><a href="#cb48-90" tabindex="-1"></a></span>
<span id="cb48-91"><a href="#cb48-91" tabindex="-1"></a><span class="co">// Divide by 1e6 to get the area in sq.km.</span></span>
<span id="cb48-92"><a href="#cb48-92" tabindex="-1"></a><span class="kw">var</span> areaImage <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelArea</span>()<span class="op">.</span><span class="fu">divide</span>(<span class="fl">1e6</span>)<span class="op">.</span><span class="fu">addBands</span>(merged)<span class="op">;</span></span>
<span id="cb48-93"><a href="#cb48-93" tabindex="-1"></a><span class="co">// Calculate Area by each Transition Class</span></span>
<span id="cb48-94"><a href="#cb48-94" tabindex="-1"></a><span class="co">// using a Grouped Reducer</span></span>
<span id="cb48-95"><a href="#cb48-95" tabindex="-1"></a><span class="kw">var</span> areas <span class="op">=</span> areaImage<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb48-96"><a href="#cb48-96" tabindex="-1"></a>      <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb48-97"><a href="#cb48-97" tabindex="-1"></a>      <span class="dt">groupField</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb48-98"><a href="#cb48-98" tabindex="-1"></a>      <span class="dt">groupName</span><span class="op">:</span> <span class="st">&#39;transitions&#39;</span><span class="op">,</span></span>
<span id="cb48-99"><a href="#cb48-99" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb48-100"><a href="#cb48-100" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb48-101"><a href="#cb48-101" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb48-102"><a href="#cb48-102" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb48-103"><a href="#cb48-103" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e10</span></span>
<span id="cb48-104"><a href="#cb48-104" tabindex="-1"></a>    })<span class="op">;</span> </span>
<span id="cb48-105"><a href="#cb48-105" tabindex="-1"></a></span>
<span id="cb48-106"><a href="#cb48-106" tabindex="-1"></a><span class="co">// Post-process the result to generate a clean output</span></span>
<span id="cb48-107"><a href="#cb48-107" tabindex="-1"></a><span class="kw">var</span> classAreas <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(areas<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;groups&#39;</span>))<span class="op">;</span></span>
<span id="cb48-108"><a href="#cb48-108" tabindex="-1"></a><span class="kw">var</span> classAreaLists <span class="op">=</span> classAreas<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(item) {</span>
<span id="cb48-109"><a href="#cb48-109" tabindex="-1"></a>      <span class="kw">var</span> areaDict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(item)<span class="op">;</span></span>
<span id="cb48-110"><a href="#cb48-110" tabindex="-1"></a>      <span class="kw">var</span> classNumber <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(areaDict<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;transitions&#39;</span>))<span class="op">.</span><span class="fu">format</span>()<span class="op">;</span></span>
<span id="cb48-111"><a href="#cb48-111" tabindex="-1"></a>      <span class="kw">var</span> area <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(areaDict<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;sum&#39;</span>))<span class="op">.</span><span class="fu">round</span>()<span class="op">;</span></span>
<span id="cb48-112"><a href="#cb48-112" tabindex="-1"></a>      <span class="cf">return</span> ee<span class="op">.</span><span class="fu">List</span>([classNumber<span class="op">,</span> area])<span class="op">;</span></span>
<span id="cb48-113"><a href="#cb48-113" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb48-114"><a href="#cb48-114" tabindex="-1"></a><span class="kw">var</span> classTransitionsAreaDict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(classAreaLists<span class="op">.</span><span class="fu">flatten</span>())<span class="op">;</span></span>
<span id="cb48-115"><a href="#cb48-115" tabindex="-1"></a><span class="fu">print</span>(classTransitionsAreaDict)<span class="op">;</span></span></code></pre></div>
<div id="exercise-22" class="section level3">
<h3>Exercise</h3>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/post_classification.png" alt="Lost water pixels between 2019 and 2020" width="100%" />
<p class="caption">
Lost water pixels between 2019 and 2020
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F04c_Post_Classification_Comparison_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="co">// Show all areas where water became other classes and display the result</span></span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="co">// Hint1: Select class 3 pixels from before image and NOT class 3 pixels from after image</span></span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a><span class="co">// Hint2: use the .and() operation to select pixels matching both conditions</span></span></code></pre></div>
</div>
</div>
</div>
<div id="module-5-earth-engine-apps" class="section level1">
<h1>Module 5: Earth Engine Apps</h1>
<p>This module is focused the concepts related to client vs. server that
will help you in creating web apps. We will be building an app using the
Earth Engine User Interface API and publishing it to Google Cloud.</p>
<p><a
href="https://www.youtube.com/watch?v=Y4lM7Wtckhs&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=6"
target="_blank"><img
src="https://img.youtube.com/vi/Y4lM7Wtckhs/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=Y4lM7Wtckhs&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=6"
target="_blank">Watch the Video ↗</a></p>
<div id="client-vs.-server" class="section level2">
<h2>01. Client vs. Server</h2>
<p>The User Interface elements in your Code Editor - Map View, Drawing
Tools etc. are ‘client-side’ elements. They run in YOUR browser. Image
Collections, feature collections, calculations on Earth Engine objects
etc. are ‘server-side’ elements. They run in Google’s data center. You
cannot mix both these objects. To learn more, visit the <a
href="https://developers.google.com/earth-engine/guides/client_server">Client
vs. Server</a> section of the Earth Engine User Guide.</p>
<ul>
<li>To convert client-side objects to server-side objects, you can use
the appropriate API function. Server-side functions start with
<code>ee.</code>, such <code>ee.Date()</code>, <code>ee.Image()</code>
etc.</li>
<li>To convert server-side objects to client-side objects, you can call
<code>.getInfo()</code> on am Earth Engine object. For the Python API,
this is the only way to extract information from a server-side object,
but the Javascript API provides a better (and preferred) - method for
bring server-side objects to client-side using the
<code>evaluate()</code> method. This method asynchronously retrieves the
value of the object, without blocking the user interface - meaning it
will let your code continue to execute while it fetches the value.</li>
</ul>
<blockquote>
<p>Tip: You can use <code>ee.Algorithms.ObjectType()</code> to get the
type of a server-side object</p>
</blockquote>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F01b_Client_vs_Server_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="kw">var</span> date <span class="op">=</span> <span class="st">&#39;2020-01-01&#39;</span> <span class="co">// This is client-side</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="fu">print</span>(<span class="kw">typeof</span>(date))</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="kw">var</span> eedate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">&#39;2020-01-01&#39;</span>)<span class="op">.</span><span class="fu">format</span>() <span class="co">// This is server-side</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a><span class="fu">print</span>(<span class="kw">typeof</span>(eedate)) </span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a><span class="co">// To bring server-side objects to client-side, you can call .getInfo()</span></span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a><span class="co">// var clientdate = eedate.getInfo()</span></span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a><span class="co">// print(clientdate)</span></span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a><span class="co">// print(typeof(clientdate)) </span></span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a><span class="co">// getInfo() blocks the execution of your code till the value is fetched</span></span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a><span class="co">// If the value takes time to compute, your code editor will freeze</span></span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a><span class="co">// This is not a good user experience</span></span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;COPERNICUS/S2_SR&quot;</span>)</span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-02-01&#39;</span>))</span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" tabindex="-1"></a><span class="co">//var numImages = filtered.size().getInfo()</span></span>
<span id="cb50-20"><a href="#cb50-20" tabindex="-1"></a><span class="co">//print(numImages)</span></span>
<span id="cb50-21"><a href="#cb50-21" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" tabindex="-1"></a><span class="co">// A better approach is to use evaluate() function</span></span>
<span id="cb50-23"><a href="#cb50-23" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" tabindex="-1"></a><span class="co">// You need to define a &#39;callback&#39; function which will be called once the </span></span>
<span id="cb50-25"><a href="#cb50-25" tabindex="-1"></a><span class="co">// value has been computed and ready to be used.</span></span>
<span id="cb50-26"><a href="#cb50-26" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" tabindex="-1"></a><span class="kw">var</span> myCallback <span class="op">=</span> <span class="kw">function</span>(object) {</span>
<span id="cb50-28"><a href="#cb50-28" tabindex="-1"></a>  <span class="fu">print</span>(object)</span>
<span id="cb50-29"><a href="#cb50-29" tabindex="-1"></a>}</span>
<span id="cb50-30"><a href="#cb50-30" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Computing the size of the collection&#39;</span>)</span>
<span id="cb50-31"><a href="#cb50-31" tabindex="-1"></a><span class="kw">var</span> numImages <span class="op">=</span> filtered<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">evaluate</span>(myCallback)</span></code></pre></div>
<div id="exercise-23" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F01c_Client_vs_Server_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="kw">var</span> date <span class="op">=</span> ee<span class="op">.</span><span class="at">Date</span><span class="op">.</span><span class="fu">fromYMD</span>(<span class="dv">2019</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="fu">print</span>(date)</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a><span class="co">// We can use the format() function to create</span></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a><span class="co">// a string from a date object</span></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a><span class="kw">var</span> dateString <span class="op">=</span> date<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;dd MMM, YYYY&#39;</span>)</span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="fu">print</span>(dateString)</span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a><span class="co">// The print statement below combines a client-side string</span></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a><span class="co">// with a server-side string - resulting in an error.</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a><span class="co">// Fix the code so that the following message is printed</span></span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a><span class="co">// &#39;The date is 01 Jan, 2019&#39;</span></span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a><span class="kw">var</span> message <span class="op">=</span> <span class="st">&#39;The date is &#39;</span> <span class="op">+</span> dateString</span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a><span class="fu">print</span>(message)</span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a><span class="co">// Hint: </span></span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a><span class="co">// Convert the client-side string to a server-side string</span></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a><span class="co">// Use ee.String() to create a server-side string</span></span>
<span id="cb51-21"><a href="#cb51-21" tabindex="-1"></a><span class="co">// Use the .cat() function instead of + to combine 2 strings</span></span></code></pre></div>
</div>
</div>
<div id="using-ui-elements" class="section level2">
<h2>02. Using UI Elements</h2>
<p>Earth Engine comes with a User Interface API that allows you to build
an interactive web application powered by Earth Engine.</p>
<p>The Earth Engine API provides a library of User Interface (UI)
widgets - such as Buttons, Drop-down Menus, Sliders etc. - that can be
used to create interactive apps. All the user interface functions are
contained in the <code>ui.</code> package - such as
<code>ui.Select()</code>, <code>ui.Button()</code>. You can create those
elements by calling these functions with appropriate parameters. Learn
more in the <a
href="https://developers.google.com/earth-engine/guides/ui">Earth Engine
User Interface API</a> section of the Earth Engine User Guide.</p>
<p>This section shows how to build a drop-down selector using the
<code>ui.Select()</code> widget.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F02b_Using_UI_Elements_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co">// You can add any widgets from the ui.* module to the map</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="kw">var</span> years <span class="op">=</span> [<span class="st">&#39;2014&#39;</span><span class="op">,</span> <span class="st">&#39;2015&#39;</span><span class="op">,</span> <span class="st">&#39;2016&#39;</span><span class="op">,</span> <span class="st">&#39;2017&#39;</span>]<span class="op">;</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a><span class="co">// Let&#39;s create a ui.Select() dropdown with the above values</span></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a><span class="kw">var</span> yearSelector <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>  <span class="dt">items</span><span class="op">:</span> years<span class="op">,</span></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">&#39;2014&#39;</span><span class="op">,</span></span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>  <span class="dt">placeholder</span><span class="op">:</span> <span class="st">&#39;Select a year&#39;</span><span class="op">,</span></span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>  })</span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">add</span>(yearSelector)<span class="op">;</span></span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a><span class="kw">var</span> loadImage <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a>  <span class="kw">var</span> year <span class="op">=</span> yearSelector<span class="op">.</span><span class="fu">getValue</span>()<span class="op">;</span></span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a>  <span class="kw">var</span> col <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG&quot;</span>)<span class="op">;</span></span>
<span id="cb52-15"><a href="#cb52-15" tabindex="-1"></a>  <span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="at">Date</span><span class="op">.</span><span class="fu">fromYMD</span>(</span>
<span id="cb52-16"><a href="#cb52-16" tabindex="-1"></a>    ee<span class="op">.</span><span class="at">Number</span><span class="op">.</span><span class="fu">parse</span>(year)<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb52-17"><a href="#cb52-17" tabindex="-1"></a>  <span class="kw">var</span> endDate <span class="op">=</span> startDate<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;year&#39;</span>)<span class="op">;</span></span>
<span id="cb52-18"><a href="#cb52-18" tabindex="-1"></a>  <span class="kw">var</span> filtered <span class="op">=</span> col<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(startDate<span class="op">,</span> endDate))<span class="op">;</span></span>
<span id="cb52-19"><a href="#cb52-19" tabindex="-1"></a>  <span class="kw">var</span> composite <span class="op">=</span> filtered<span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;avg_rad&#39;</span>)<span class="op">;</span></span>
<span id="cb52-20"><a href="#cb52-20" tabindex="-1"></a>  <span class="kw">var</span> layerName <span class="op">=</span> <span class="st">&#39;Night Lights &#39;</span> <span class="op">+</span> year<span class="op">;</span></span>
<span id="cb52-21"><a href="#cb52-21" tabindex="-1"></a>  <span class="kw">var</span> nighttimeVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">60.0</span>}<span class="op">;</span></span>
<span id="cb52-22"><a href="#cb52-22" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">,</span> nighttimeVis<span class="op">,</span> layerName)<span class="op">;</span></span>
<span id="cb52-23"><a href="#cb52-23" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb52-24"><a href="#cb52-24" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" tabindex="-1"></a><span class="kw">var</span> button <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>({</span>
<span id="cb52-26"><a href="#cb52-26" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">&#39;Click to Load Image&#39;</span><span class="op">,</span></span>
<span id="cb52-27"><a href="#cb52-27" tabindex="-1"></a>  <span class="dt">onClick</span><span class="op">:</span> loadImage<span class="op">,</span></span>
<span id="cb52-28"><a href="#cb52-28" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb52-29"><a href="#cb52-29" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">add</span>(button)<span class="op">;</span></span></code></pre></div>
<div id="exercise-24" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F02c_Using_UI_Elements_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co">// Instead of manually creating a list of years like before</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="co">// we can create a list of years using ee.List.sequence()</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="kw">var</span> years <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">2014</span><span class="op">,</span> <span class="dv">2020</span>)</span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a><span class="co">// Convert them to strings using format() function</span></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a><span class="kw">var</span> yearStrings <span class="op">=</span> years<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(year){</span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Number</span>(year)<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;%04d&#39;</span>)</span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>})</span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a><span class="fu">print</span>(yearStrings)<span class="op">;</span></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a><span class="co">// Convert the server-side object to client-side using</span></span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a><span class="co">// evaluate() and use it with ui.Select()</span></span>
<span id="cb53-13"><a href="#cb53-13" tabindex="-1"></a>yearStrings<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(yearList) {</span>
<span id="cb53-14"><a href="#cb53-14" tabindex="-1"></a>  <span class="kw">var</span> yearSelector <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb53-15"><a href="#cb53-15" tabindex="-1"></a>    <span class="dt">items</span><span class="op">:</span> yearList<span class="op">,</span></span>
<span id="cb53-16"><a href="#cb53-16" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">&#39;2014&#39;</span><span class="op">,</span></span>
<span id="cb53-17"><a href="#cb53-17" tabindex="-1"></a>    <span class="dt">placeholder</span><span class="op">:</span> <span class="st">&#39;Select a year&#39;</span><span class="op">,</span></span>
<span id="cb53-18"><a href="#cb53-18" tabindex="-1"></a>    })</span>
<span id="cb53-19"><a href="#cb53-19" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">add</span>(yearSelector)</span>
<span id="cb53-20"><a href="#cb53-20" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb53-21"><a href="#cb53-21" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb53-23"><a href="#cb53-23" tabindex="-1"></a></span>
<span id="cb53-24"><a href="#cb53-24" tabindex="-1"></a><span class="co">// Create another dropdown with months from 1 to 12</span></span>
<span id="cb53-25"><a href="#cb53-25" tabindex="-1"></a><span class="co">// and add it to the map.</span></span></code></pre></div>
</div>
</div>
<div id="building-and-publishing-an-app" class="section level2">
<h2>03. Building and Publishing an App</h2>
<p>Building a web mapping application typically requires the skills of a
full stack developer and are out of reach for most analysts and
scientists. But the Earth Engine User Interface API makes this process
much more accessible by providing ready-to-use widgets and free cloud
hosting to allow anyone to publish an app with just a few lines of code.
The main container object is the <code>ui.Panel()</code> which can
contain different types of widgets.</p>
<p>The code below shows how to build an app called <a
href="https://santhosh-m.users.earthengine.app/view/night-lights-explorer">Night
Lights Explorer</a> that allows anyone to pick a year/month and load the
<em>VIIRS Nighttime Day/Night Band Composite</em> for the selected
month. Copy/paste the code below to your Code Editor and click
<em>Run</em>.</p>
<p><img src="images/end_to_end_gee/app1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>You will see a panel on the right-hand side with 2 drop-down boxes
and a button. These are User Interface (UI) widgets provided by the
Earth Engine API that allows the user to interactively select the
values. You can select the values for <em>year</em> and <em>month</em>
and click <em>Load</em> button to see the image for the selected
month.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F03b_Building_an_App_with_UI_Widgets_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co">// Panels are the main container widgets</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="kw">var</span> mainPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">width</span><span class="op">:</span> <span class="st">&#39;300px&#39;</span>}</span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a><span class="kw">var</span> title <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">&#39;Night Lights Explorer&#39;</span><span class="op">,</span></span>
<span id="cb54-9"><a href="#cb54-9" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="st">&#39;fontSize&#39;</span><span class="op">:</span> <span class="st">&#39;24px&#39;</span>}</span>
<span id="cb54-10"><a href="#cb54-10" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-11"><a href="#cb54-11" tabindex="-1"></a><span class="co">// You can add widgets to the panel</span></span>
<span id="cb54-12"><a href="#cb54-12" tabindex="-1"></a>mainPanel<span class="op">.</span><span class="fu">add</span>(title)<span class="op">;</span></span>
<span id="cb54-13"><a href="#cb54-13" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" tabindex="-1"></a><span class="co">// You can even add panels to other panels</span></span>
<span id="cb54-15"><a href="#cb54-15" tabindex="-1"></a><span class="kw">var</span> dropdownPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb54-16"><a href="#cb54-16" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">&#39;horizontal&#39;</span>)<span class="op">,</span></span>
<span id="cb54-17"><a href="#cb54-17" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-18"><a href="#cb54-18" tabindex="-1"></a>mainPanel<span class="op">.</span><span class="fu">add</span>(dropdownPanel)<span class="op">;</span></span>
<span id="cb54-19"><a href="#cb54-19" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" tabindex="-1"></a><span class="kw">var</span> yearSelector <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb54-21"><a href="#cb54-21" tabindex="-1"></a>  <span class="dt">placeholder</span><span class="op">:</span> <span class="st">&#39;please wait..&#39;</span><span class="op">,</span></span>
<span id="cb54-22"><a href="#cb54-22" tabindex="-1"></a>  })</span>
<span id="cb54-23"><a href="#cb54-23" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" tabindex="-1"></a><span class="kw">var</span> monthSelector <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb54-25"><a href="#cb54-25" tabindex="-1"></a>  <span class="dt">placeholder</span><span class="op">:</span> <span class="st">&#39;please wait..&#39;</span><span class="op">,</span></span>
<span id="cb54-26"><a href="#cb54-26" tabindex="-1"></a>  })</span>
<span id="cb54-27"><a href="#cb54-27" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" tabindex="-1"></a><span class="kw">var</span> button <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>(<span class="st">&#39;Load&#39;</span>)</span>
<span id="cb54-29"><a href="#cb54-29" tabindex="-1"></a>dropdownPanel<span class="op">.</span><span class="fu">add</span>(yearSelector)</span>
<span id="cb54-30"><a href="#cb54-30" tabindex="-1"></a>dropdownPanel<span class="op">.</span><span class="fu">add</span>(monthSelector)</span>
<span id="cb54-31"><a href="#cb54-31" tabindex="-1"></a>dropdownPanel<span class="op">.</span><span class="fu">add</span>(button)</span>
<span id="cb54-32"><a href="#cb54-32" tabindex="-1"></a></span>
<span id="cb54-33"><a href="#cb54-33" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" tabindex="-1"></a><span class="co">// Let&#39;s add a dropdown with the years</span></span>
<span id="cb54-35"><a href="#cb54-35" tabindex="-1"></a><span class="kw">var</span> years <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">2014</span><span class="op">,</span> <span class="dv">2020</span>)</span>
<span id="cb54-36"><a href="#cb54-36" tabindex="-1"></a><span class="kw">var</span> months <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb54-37"><a href="#cb54-37" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" tabindex="-1"></a><span class="co">// Dropdown items need to be strings</span></span>
<span id="cb54-39"><a href="#cb54-39" tabindex="-1"></a><span class="kw">var</span> yearStrings <span class="op">=</span> years<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(year){</span>
<span id="cb54-40"><a href="#cb54-40" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Number</span>(year)<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;%04d&#39;</span>)<span class="op">;</span></span>
<span id="cb54-41"><a href="#cb54-41" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-42"><a href="#cb54-42" tabindex="-1"></a><span class="kw">var</span> monthStrings <span class="op">=</span> months<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(month){</span>
<span id="cb54-43"><a href="#cb54-43" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Number</span>(month)<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;%02d&#39;</span>)<span class="op">;</span></span>
<span id="cb54-44"><a href="#cb54-44" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-45"><a href="#cb54-45" tabindex="-1"></a></span>
<span id="cb54-46"><a href="#cb54-46" tabindex="-1"></a><span class="co">// Evaluate the results and populate the dropdown</span></span>
<span id="cb54-47"><a href="#cb54-47" tabindex="-1"></a>yearStrings<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(yearList) {</span>
<span id="cb54-48"><a href="#cb54-48" tabindex="-1"></a>  yearSelector<span class="op">.</span><span class="fu">items</span>()<span class="op">.</span><span class="fu">reset</span>(yearList)<span class="op">;</span></span>
<span id="cb54-49"><a href="#cb54-49" tabindex="-1"></a>  yearSelector<span class="op">.</span><span class="fu">setPlaceholder</span>(<span class="st">&#39;select a year&#39;</span>)<span class="op">;</span></span>
<span id="cb54-50"><a href="#cb54-50" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-51"><a href="#cb54-51" tabindex="-1"></a></span>
<span id="cb54-52"><a href="#cb54-52" tabindex="-1"></a>monthStrings<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(monthList) {</span>
<span id="cb54-53"><a href="#cb54-53" tabindex="-1"></a>  monthSelector<span class="op">.</span><span class="fu">items</span>()<span class="op">.</span><span class="fu">reset</span>(monthList)<span class="op">;</span></span>
<span id="cb54-54"><a href="#cb54-54" tabindex="-1"></a>  monthSelector<span class="op">.</span><span class="fu">setPlaceholder</span>(<span class="st">&#39;select a month&#39;</span>)<span class="op">;</span></span>
<span id="cb54-55"><a href="#cb54-55" tabindex="-1"></a></span>
<span id="cb54-56"><a href="#cb54-56" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb54-57"><a href="#cb54-57" tabindex="-1"></a></span>
<span id="cb54-58"><a href="#cb54-58" tabindex="-1"></a><span class="co">// Define a function that triggers when any value is changed</span></span>
<span id="cb54-59"><a href="#cb54-59" tabindex="-1"></a><span class="kw">var</span> loadComposite <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb54-60"><a href="#cb54-60" tabindex="-1"></a>  <span class="kw">var</span> col <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG&quot;</span>)<span class="op">;</span></span>
<span id="cb54-61"><a href="#cb54-61" tabindex="-1"></a>  <span class="kw">var</span> year <span class="op">=</span> yearSelector<span class="op">.</span><span class="fu">getValue</span>()<span class="op">;</span></span>
<span id="cb54-62"><a href="#cb54-62" tabindex="-1"></a>  <span class="kw">var</span> month <span class="op">=</span> monthSelector<span class="op">.</span><span class="fu">getValue</span>()<span class="op">;</span></span>
<span id="cb54-63"><a href="#cb54-63" tabindex="-1"></a>  <span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="at">Date</span><span class="op">.</span><span class="fu">fromYMD</span>(</span>
<span id="cb54-64"><a href="#cb54-64" tabindex="-1"></a>    ee<span class="op">.</span><span class="at">Number</span><span class="op">.</span><span class="fu">parse</span>(year)<span class="op">,</span> ee<span class="op">.</span><span class="at">Number</span><span class="op">.</span><span class="fu">parse</span>(month)<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb54-65"><a href="#cb54-65" tabindex="-1"></a>  <span class="kw">var</span> endDate <span class="op">=</span> startDate<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)<span class="op">;</span></span>
<span id="cb54-66"><a href="#cb54-66" tabindex="-1"></a>  <span class="kw">var</span> filtered <span class="op">=</span> col<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(startDate<span class="op">,</span> endDate))<span class="op">;</span></span>
<span id="cb54-67"><a href="#cb54-67" tabindex="-1"></a></span>
<span id="cb54-68"><a href="#cb54-68" tabindex="-1"></a>  <span class="kw">var</span> image <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(filtered<span class="op">.</span><span class="fu">first</span>())<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;avg_rad&#39;</span>)<span class="op">;</span></span>
<span id="cb54-69"><a href="#cb54-69" tabindex="-1"></a>  <span class="kw">var</span> nighttimeVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">60.0</span>}<span class="op">;</span></span>
<span id="cb54-70"><a href="#cb54-70" tabindex="-1"></a>  <span class="kw">var</span> layerName <span class="op">=</span> <span class="st">&#39;Night Lights &#39;</span> <span class="op">+</span> year <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> month<span class="op">;</span></span>
<span id="cb54-71"><a href="#cb54-71" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> nighttimeVis<span class="op">,</span> layerName)<span class="op">;</span></span>
<span id="cb54-72"><a href="#cb54-72" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb54-73"><a href="#cb54-73" tabindex="-1"></a>button<span class="op">.</span><span class="fu">onClick</span>(loadComposite)<span class="op">;</span></span>
<span id="cb54-74"><a href="#cb54-74" tabindex="-1"></a></span>
<span id="cb54-75"><a href="#cb54-75" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="fl">76.43</span><span class="op">,</span> <span class="fl">12.41</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb54-76"><a href="#cb54-76" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">add</span>(mainPanel)<span class="op">;</span></span></code></pre></div>
<div id="exercise-25" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F03c_Building_an_App_with_UI_Widgets_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a><span class="co">// Add a button called &#39;Reset&#39;</span></span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a><span class="co">// Clicking the button should remove all loaded layers</span></span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a><span class="co">// Hint: Use Map.clear() for removing the layers</span></span></code></pre></div>
</div>
</div>
<div id="publishing-the-app" class="section level2">
<h2>04. Publishing the App</h2>
<p>We will now publish this app. Click on the <em>Apps</em> button.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/app2.png" alt="App with UI Elements" width="100%" />
<p class="caption">
App with UI Elements
</p>
</div>
<p>In the <em>Manage Apps</em> window, click <em>New App</em>.</p>
<p><img src="images/end_to_end_gee/app3.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Select the existing project or create a new project. The app will be
hosted on Google Cloud, so you will need to create and link a Google
Cloud project with the app. If you don’t have a Google Cloud account,
you can select the <em>Register a New Project</em> option to create a
new project. You can provide an edit access based on the project
selection.</p>
<p><img src="images/end_to_end_gee/app4.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Give the name of your app and see the URL created for your app.</p>
<p><img src="images/end_to_end_gee/app5.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Select code to use for the app. It can be from the current content or
choose any repository path where the code is saved. We will go ahead
with <em>Current contents of editor</em></p>
<p><img src="images/end_to_end_gee/app6.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Click next and in the <em>Publish New App</em> dialog, leave all
other settings to default and click <em>Publish</em>.</p>
<p><img src="images/end_to_end_gee/app7.png" width="50%" style="display: block; margin: auto;" /></p>
<p>The app will be hosted on Google Cloud and you can access it by
clicking on the <em>App Name</em> of your app in the <em>Manage
Apps</em> dialog.</p>
<p><img src="images/end_to_end_gee/app8.png" width="60%" style="display: block; margin: auto;" /></p>
<p>You will see your Earth Engine powered app running in the browser.
Anyone can access and interact with the app by just visiting the App
URL.</p>
<blockquote>
<p>The app publishing process takes a few minutes. So if you get an
error that your app is not yet ready, check back in a few minutes.</p>
</blockquote>
<p><a
href="https://ujavalgandhi.users.earthengine.app/view/night-lights-explorer"
target="_blank">Explore The App ↗</a></p>
<p><img src="images/end_to_end_gee/app9.png" width="100%" style="display: block; margin: auto;" /></p>
<div id="exercise-26" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F04c_Publishing_the_App_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="co">// Panels are the main container widgets</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a><span class="kw">var</span> mainPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">width</span><span class="op">:</span> <span class="st">&#39;300px&#39;</span>}</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a><span class="kw">var</span> title <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">&#39;Night Lights Explorer&#39;</span><span class="op">,</span></span>
<span id="cb56-9"><a href="#cb56-9" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="st">&#39;fontSize&#39;</span><span class="op">:</span> <span class="st">&#39;24px&#39;</span>}</span>
<span id="cb56-10"><a href="#cb56-10" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb56-11"><a href="#cb56-11" tabindex="-1"></a><span class="co">// You can add widgets to the panel</span></span>
<span id="cb56-12"><a href="#cb56-12" tabindex="-1"></a>mainPanel<span class="op">.</span><span class="fu">add</span>(title)</span>
<span id="cb56-13"><a href="#cb56-13" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" tabindex="-1"></a><span class="co">// You can even add panels to other panels</span></span>
<span id="cb56-15"><a href="#cb56-15" tabindex="-1"></a><span class="kw">var</span> dropdownPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb56-16"><a href="#cb56-16" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">&#39;horizontal&#39;</span>)<span class="op">,</span></span>
<span id="cb56-17"><a href="#cb56-17" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb56-18"><a href="#cb56-18" tabindex="-1"></a>mainPanel<span class="op">.</span><span class="fu">add</span>(dropdownPanel)<span class="op">;</span></span>
<span id="cb56-19"><a href="#cb56-19" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" tabindex="-1"></a><span class="kw">var</span> yearSelector <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb56-21"><a href="#cb56-21" tabindex="-1"></a>  <span class="dt">placeholder</span><span class="op">:</span> <span class="st">&#39;please wait..&#39;</span><span class="op">,</span></span>
<span id="cb56-22"><a href="#cb56-22" tabindex="-1"></a>  })</span>
<span id="cb56-23"><a href="#cb56-23" tabindex="-1"></a></span>
<span id="cb56-24"><a href="#cb56-24" tabindex="-1"></a><span class="kw">var</span> monthSelector <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb56-25"><a href="#cb56-25" tabindex="-1"></a>  <span class="dt">placeholder</span><span class="op">:</span> <span class="st">&#39;please wait..&#39;</span><span class="op">,</span></span>
<span id="cb56-26"><a href="#cb56-26" tabindex="-1"></a>  })</span>
<span id="cb56-27"><a href="#cb56-27" tabindex="-1"></a></span>
<span id="cb56-28"><a href="#cb56-28" tabindex="-1"></a><span class="kw">var</span> button <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>(<span class="st">&#39;Load&#39;</span>)</span>
<span id="cb56-29"><a href="#cb56-29" tabindex="-1"></a>dropdownPanel<span class="op">.</span><span class="fu">add</span>(yearSelector)</span>
<span id="cb56-30"><a href="#cb56-30" tabindex="-1"></a>dropdownPanel<span class="op">.</span><span class="fu">add</span>(monthSelector)</span>
<span id="cb56-31"><a href="#cb56-31" tabindex="-1"></a>dropdownPanel<span class="op">.</span><span class="fu">add</span>(button)</span>
<span id="cb56-32"><a href="#cb56-32" tabindex="-1"></a></span>
<span id="cb56-33"><a href="#cb56-33" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" tabindex="-1"></a><span class="co">// Let&#39;s add a dropdown with the years</span></span>
<span id="cb56-35"><a href="#cb56-35" tabindex="-1"></a><span class="kw">var</span> years <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">2014</span><span class="op">,</span> <span class="dv">2020</span>)</span>
<span id="cb56-36"><a href="#cb56-36" tabindex="-1"></a><span class="kw">var</span> months <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb56-37"><a href="#cb56-37" tabindex="-1"></a></span>
<span id="cb56-38"><a href="#cb56-38" tabindex="-1"></a><span class="co">// Dropdown items need to be strings</span></span>
<span id="cb56-39"><a href="#cb56-39" tabindex="-1"></a><span class="kw">var</span> yearStrings <span class="op">=</span> years<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(year){</span>
<span id="cb56-40"><a href="#cb56-40" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Number</span>(year)<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;%04d&#39;</span>)</span>
<span id="cb56-41"><a href="#cb56-41" tabindex="-1"></a>})</span>
<span id="cb56-42"><a href="#cb56-42" tabindex="-1"></a><span class="kw">var</span> monthStrings <span class="op">=</span> months<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(month){</span>
<span id="cb56-43"><a href="#cb56-43" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Number</span>(month)<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;%02d&#39;</span>)</span>
<span id="cb56-44"><a href="#cb56-44" tabindex="-1"></a>})</span>
<span id="cb56-45"><a href="#cb56-45" tabindex="-1"></a></span>
<span id="cb56-46"><a href="#cb56-46" tabindex="-1"></a><span class="co">// Evaluate the results and populate the dropdown</span></span>
<span id="cb56-47"><a href="#cb56-47" tabindex="-1"></a>yearStrings<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(yearList) {</span>
<span id="cb56-48"><a href="#cb56-48" tabindex="-1"></a>  yearSelector<span class="op">.</span><span class="fu">items</span>()<span class="op">.</span><span class="fu">reset</span>(yearList)</span>
<span id="cb56-49"><a href="#cb56-49" tabindex="-1"></a>  yearSelector<span class="op">.</span><span class="fu">setPlaceholder</span>(<span class="st">&#39;select a year&#39;</span>)</span>
<span id="cb56-50"><a href="#cb56-50" tabindex="-1"></a>})</span>
<span id="cb56-51"><a href="#cb56-51" tabindex="-1"></a></span>
<span id="cb56-52"><a href="#cb56-52" tabindex="-1"></a>monthStrings<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(monthList) {</span>
<span id="cb56-53"><a href="#cb56-53" tabindex="-1"></a>  monthSelector<span class="op">.</span><span class="fu">items</span>()<span class="op">.</span><span class="fu">reset</span>(monthList)</span>
<span id="cb56-54"><a href="#cb56-54" tabindex="-1"></a>  monthSelector<span class="op">.</span><span class="fu">setPlaceholder</span>(<span class="st">&#39;select a month&#39;</span>)</span>
<span id="cb56-55"><a href="#cb56-55" tabindex="-1"></a></span>
<span id="cb56-56"><a href="#cb56-56" tabindex="-1"></a>})</span>
<span id="cb56-57"><a href="#cb56-57" tabindex="-1"></a></span>
<span id="cb56-58"><a href="#cb56-58" tabindex="-1"></a><span class="co">// Define a function that triggers when any value is changed</span></span>
<span id="cb56-59"><a href="#cb56-59" tabindex="-1"></a><span class="kw">var</span> loadComposite <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb56-60"><a href="#cb56-60" tabindex="-1"></a>  <span class="kw">var</span> col <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG&quot;</span>)<span class="op">;</span></span>
<span id="cb56-61"><a href="#cb56-61" tabindex="-1"></a>  <span class="kw">var</span> year <span class="op">=</span> yearSelector<span class="op">.</span><span class="fu">getValue</span>()</span>
<span id="cb56-62"><a href="#cb56-62" tabindex="-1"></a>  <span class="kw">var</span> month <span class="op">=</span> monthSelector<span class="op">.</span><span class="fu">getValue</span>()</span>
<span id="cb56-63"><a href="#cb56-63" tabindex="-1"></a>  <span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="at">Date</span><span class="op">.</span><span class="fu">fromYMD</span>(</span>
<span id="cb56-64"><a href="#cb56-64" tabindex="-1"></a>    ee<span class="op">.</span><span class="at">Number</span><span class="op">.</span><span class="fu">parse</span>(year)<span class="op">,</span> ee<span class="op">.</span><span class="at">Number</span><span class="op">.</span><span class="fu">parse</span>(month)<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb56-65"><a href="#cb56-65" tabindex="-1"></a>  <span class="kw">var</span> endDate <span class="op">=</span> startDate<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;month&#39;</span>)</span>
<span id="cb56-66"><a href="#cb56-66" tabindex="-1"></a>  <span class="kw">var</span> filtered <span class="op">=</span> col<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(startDate<span class="op">,</span> endDate))</span>
<span id="cb56-67"><a href="#cb56-67" tabindex="-1"></a></span>
<span id="cb56-68"><a href="#cb56-68" tabindex="-1"></a>  <span class="kw">var</span> image <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(filtered<span class="op">.</span><span class="fu">first</span>())<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;avg_rad&#39;</span>)</span>
<span id="cb56-69"><a href="#cb56-69" tabindex="-1"></a>  <span class="kw">var</span> nighttimeVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">60.0</span>}</span>
<span id="cb56-70"><a href="#cb56-70" tabindex="-1"></a>  <span class="kw">var</span> layerName <span class="op">=</span> <span class="st">&#39;Night Lights &#39;</span> <span class="op">+</span> year <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> month</span>
<span id="cb56-71"><a href="#cb56-71" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> nighttimeVis<span class="op">,</span> layerName)</span>
<span id="cb56-72"><a href="#cb56-72" tabindex="-1"></a>}</span>
<span id="cb56-73"><a href="#cb56-73" tabindex="-1"></a>button<span class="op">.</span><span class="fu">onClick</span>(loadComposite)</span>
<span id="cb56-74"><a href="#cb56-74" tabindex="-1"></a></span>
<span id="cb56-75"><a href="#cb56-75" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb56-76"><a href="#cb56-76" tabindex="-1"></a><span class="co">// Set the map center to your area of interest</span></span>
<span id="cb56-77"><a href="#cb56-77" tabindex="-1"></a><span class="co">// Replace the author label with your name</span></span>
<span id="cb56-78"><a href="#cb56-78" tabindex="-1"></a><span class="co">// Publish the app.</span></span>
<span id="cb56-79"><a href="#cb56-79" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="fl">76.43</span><span class="op">,</span> <span class="fl">12.41</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb56-80"><a href="#cb56-80" tabindex="-1"></a><span class="kw">var</span> authorLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">&#39;App by: Ujaval Gandhi&#39;</span>)<span class="op">;</span></span>
<span id="cb56-81"><a href="#cb56-81" tabindex="-1"></a>mainPanel<span class="op">.</span><span class="fu">add</span>(authorLabel)<span class="op">;</span></span>
<span id="cb56-82"><a href="#cb56-82" tabindex="-1"></a></span>
<span id="cb56-83"><a href="#cb56-83" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">add</span>(mainPanel)<span class="op">;</span></span></code></pre></div>
</div>
</div>
<div id="create-a-split-panel-app" class="section level2">
<h2>05. Create a Split Panel App</h2>
<p>Another useful widget that can be used in Apps is
<code>ui.SplitPanel()</code>. This allows you to create an app that can
display 2 different images of the same region that can be explored
interactively by swiping. Here we create an app to explore the <a
href="https://developers.google.com/earth-engine/datasets/catalog/ESA_WorldCover_v100">ESA
WorldCover 10m</a> global classification dataset.</p>
<p>On the left-hand panel, we will load a Sentinel-2 composite for the
year 2020. On the right-hand panel, we will load the 11-class landcover
classification of the same region.</p>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F05b_Split_Panel_App_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&quot;FAO/GAUL_SIMPLIFIED_500m/2015/level2&quot;</span>)<span class="op">;</span></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a><span class="kw">var</span> selected <span class="op">=</span> admin2</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))</span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))</span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> selected<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)</span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;COPERNICUS/S2_HARMONIZED&quot;</span>)<span class="op">;</span></span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" tabindex="-1"></a><span class="co">// Write a function to scale the bands</span></span>
<span id="cb57-12"><a href="#cb57-12" tabindex="-1"></a><span class="kw">var</span> scaleImage <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb57-13"><a href="#cb57-13" tabindex="-1"></a>  <span class="cf">return</span> image</span>
<span id="cb57-14"><a href="#cb57-14" tabindex="-1"></a>    <span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)</span>
<span id="cb57-15"><a href="#cb57-15" tabindex="-1"></a>    <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb57-16"><a href="#cb57-16" tabindex="-1"></a>}</span>
<span id="cb57-17"><a href="#cb57-17" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb57-19"><a href="#cb57-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb57-20"><a href="#cb57-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb57-21"><a href="#cb57-21" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2021-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb57-22"><a href="#cb57-22" tabindex="-1"></a>  </span>
<span id="cb57-23"><a href="#cb57-23" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb57-24"><a href="#cb57-24" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb57-25"><a href="#cb57-25" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb57-26"><a href="#cb57-26" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb57-28"><a href="#cb57-28" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb57-29"><a href="#cb57-29" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb57-30"><a href="#cb57-30" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb57-31"><a href="#cb57-31" tabindex="-1"></a></span>
<span id="cb57-32"><a href="#cb57-32" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb57-33"><a href="#cb57-33" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb57-34"><a href="#cb57-34" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb57-35"><a href="#cb57-35" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb57-36"><a href="#cb57-36" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb57-37"><a href="#cb57-37" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb57-38"><a href="#cb57-38" tabindex="-1"></a>}</span>
<span id="cb57-39"><a href="#cb57-39" tabindex="-1"></a></span>
<span id="cb57-40"><a href="#cb57-40" tabindex="-1"></a></span>
<span id="cb57-41"><a href="#cb57-41" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb57-42"><a href="#cb57-42" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)<span class="op">;</span></span>
<span id="cb57-43"><a href="#cb57-43" tabindex="-1"></a>  </span>
<span id="cb57-44"><a href="#cb57-44" tabindex="-1"></a><span class="kw">var</span> filteredMaskedScaled <span class="op">=</span> filteredMasked<span class="op">.</span><span class="fu">map</span>(scaleImage)<span class="op">;</span></span>
<span id="cb57-45"><a href="#cb57-45" tabindex="-1"></a></span>
<span id="cb57-46"><a href="#cb57-46" tabindex="-1"></a><span class="co">// Create a median composite for 2020</span></span>
<span id="cb57-47"><a href="#cb57-47" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span>  filteredMaskedScaled<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb57-48"><a href="#cb57-48" tabindex="-1"></a></span>
<span id="cb57-49"><a href="#cb57-49" tabindex="-1"></a><span class="co">// Load ESA WorldCover 2020 Classification</span></span>
<span id="cb57-50"><a href="#cb57-50" tabindex="-1"></a><span class="kw">var</span> worldcover <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;ESA/WorldCover/v100&quot;</span>)</span>
<span id="cb57-51"><a href="#cb57-51" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> worldcover</span>
<span id="cb57-52"><a href="#cb57-52" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2021-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb57-53"><a href="#cb57-53" tabindex="-1"></a><span class="kw">var</span> classification <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(filtered<span class="op">.</span><span class="fu">first</span>())<span class="op">;</span></span>
<span id="cb57-54"><a href="#cb57-54" tabindex="-1"></a></span>
<span id="cb57-55"><a href="#cb57-55" tabindex="-1"></a><span class="co">// Create a Split Panel App</span></span>
<span id="cb57-56"><a href="#cb57-56" tabindex="-1"></a></span>
<span id="cb57-57"><a href="#cb57-57" tabindex="-1"></a><span class="co">// Set a center and zoom level.</span></span>
<span id="cb57-58"><a href="#cb57-58" tabindex="-1"></a><span class="co">// Create two maps.</span></span>
<span id="cb57-59"><a href="#cb57-59" tabindex="-1"></a><span class="kw">var</span> leftMap <span class="op">=</span> ui<span class="op">.</span><span class="fu">Map</span>()<span class="op">;</span></span>
<span id="cb57-60"><a href="#cb57-60" tabindex="-1"></a><span class="kw">var</span> rightMap <span class="op">=</span> ui<span class="op">.</span><span class="fu">Map</span>()<span class="op">;</span></span>
<span id="cb57-61"><a href="#cb57-61" tabindex="-1"></a></span>
<span id="cb57-62"><a href="#cb57-62" tabindex="-1"></a><span class="co">// Link them together.</span></span>
<span id="cb57-63"><a href="#cb57-63" tabindex="-1"></a><span class="kw">var</span> linker <span class="op">=</span> ui<span class="op">.</span><span class="at">Map</span><span class="op">.</span><span class="fu">Linker</span>([leftMap<span class="op">,</span> rightMap])<span class="op">;</span></span>
<span id="cb57-64"><a href="#cb57-64" tabindex="-1"></a></span>
<span id="cb57-65"><a href="#cb57-65" tabindex="-1"></a><span class="co">// Create a split panel with the two maps.</span></span>
<span id="cb57-66"><a href="#cb57-66" tabindex="-1"></a><span class="kw">var</span> splitPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">SplitPanel</span>({</span>
<span id="cb57-67"><a href="#cb57-67" tabindex="-1"></a>  <span class="dt">firstPanel</span><span class="op">:</span> leftMap<span class="op">,</span></span>
<span id="cb57-68"><a href="#cb57-68" tabindex="-1"></a>  <span class="dt">secondPanel</span><span class="op">:</span> rightMap<span class="op">,</span></span>
<span id="cb57-69"><a href="#cb57-69" tabindex="-1"></a>  <span class="dt">orientation</span><span class="op">:</span> <span class="st">&#39;horizontal&#39;</span><span class="op">,</span></span>
<span id="cb57-70"><a href="#cb57-70" tabindex="-1"></a>  <span class="dt">wipe</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb57-71"><a href="#cb57-71" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb57-72"><a href="#cb57-72" tabindex="-1"></a></span>
<span id="cb57-73"><a href="#cb57-73" tabindex="-1"></a><span class="co">// Remove the default map from the root panel.</span></span>
<span id="cb57-74"><a href="#cb57-74" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb57-75"><a href="#cb57-75" tabindex="-1"></a></span>
<span id="cb57-76"><a href="#cb57-76" tabindex="-1"></a><span class="co">// Add our split panel to the root panel.</span></span>
<span id="cb57-77"><a href="#cb57-77" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">add</span>(splitPanel)<span class="op">;</span></span>
<span id="cb57-78"><a href="#cb57-78" tabindex="-1"></a></span>
<span id="cb57-79"><a href="#cb57-79" tabindex="-1"></a><span class="co">// Add the layers to the maps</span></span>
<span id="cb57-80"><a href="#cb57-80" tabindex="-1"></a><span class="co">// Composite goes to the leftMap</span></span>
<span id="cb57-81"><a href="#cb57-81" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb57-82"><a href="#cb57-82" tabindex="-1"></a>leftMap<span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;2020 Composite&#39;</span>)<span class="op">;</span></span>
<span id="cb57-83"><a href="#cb57-83" tabindex="-1"></a>leftMap<span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb57-84"><a href="#cb57-84" tabindex="-1"></a><span class="co">// Classification foes to the rightMap</span></span>
<span id="cb57-85"><a href="#cb57-85" tabindex="-1"></a>rightMap<span class="op">.</span><span class="fu">addLayer</span>(classification<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;WorldCover Classification&#39;</span>)<span class="op">;</span></span>
<span id="cb57-86"><a href="#cb57-86" tabindex="-1"></a>rightMap<span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span></code></pre></div>
<div id="exercise-27" class="section level3">
<h3>Exercise</h3>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F05c_Split_Panel_App_(exercise)"
target="_blank">Try in Code Editor ↗</a></p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode js"><code class="sourceCode javascript"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&quot;FAO/GAUL_SIMPLIFIED_500m/2015/level2&quot;</span>)<span class="op">;</span></span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a><span class="kw">var</span> selected <span class="op">=</span> admin2</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM1_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Karnataka&#39;</span>))</span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))</span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> selected<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)</span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;COPERNICUS/S2_HARMONIZED&quot;</span>)<span class="op">;</span></span>
<span id="cb58-9"><a href="#cb58-9" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" tabindex="-1"></a><span class="co">// Write a function to scale the bands</span></span>
<span id="cb58-12"><a href="#cb58-12" tabindex="-1"></a><span class="kw">var</span> scaleImage <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb58-13"><a href="#cb58-13" tabindex="-1"></a>  <span class="cf">return</span> image</span>
<span id="cb58-14"><a href="#cb58-14" tabindex="-1"></a>    <span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)</span>
<span id="cb58-15"><a href="#cb58-15" tabindex="-1"></a>    <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb58-16"><a href="#cb58-16" tabindex="-1"></a>}</span>
<span id="cb58-17"><a href="#cb58-17" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb58-19"><a href="#cb58-19" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb58-20"><a href="#cb58-20" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb58-21"><a href="#cb58-21" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2021-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb58-22"><a href="#cb58-22" tabindex="-1"></a>  </span>
<span id="cb58-23"><a href="#cb58-23" tabindex="-1"></a>  </span>
<span id="cb58-24"><a href="#cb58-24" tabindex="-1"></a><span class="co">// Load the Cloud Score+ collection</span></span>
<span id="cb58-25"><a href="#cb58-25" tabindex="-1"></a><span class="kw">var</span> csPlus <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)<span class="op">;</span></span>
<span id="cb58-26"><a href="#cb58-26" tabindex="-1"></a><span class="kw">var</span> csPlusBands <span class="op">=</span> csPlus<span class="op">.</span><span class="fu">first</span>()<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb58-27"><a href="#cb58-27" tabindex="-1"></a></span>
<span id="cb58-28"><a href="#cb58-28" tabindex="-1"></a><span class="co">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb58-29"><a href="#cb58-29" tabindex="-1"></a><span class="co">// image in the collection</span></span>
<span id="cb58-30"><a href="#cb58-30" tabindex="-1"></a><span class="co">// This is done using the linkCollection() function</span></span>
<span id="cb58-31"><a href="#cb58-31" tabindex="-1"></a><span class="kw">var</span> filteredS2WithCs <span class="op">=</span> filtered<span class="op">.</span><span class="fu">linkCollection</span>(csPlus<span class="op">,</span> csPlusBands)<span class="op">;</span></span>
<span id="cb58-32"><a href="#cb58-32" tabindex="-1"></a></span>
<span id="cb58-33"><a href="#cb58-33" tabindex="-1"></a><span class="co">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb58-34"><a href="#cb58-34" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskLowQA</span>(image) {</span>
<span id="cb58-35"><a href="#cb58-35" tabindex="-1"></a>  <span class="kw">var</span> qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span><span class="op">;</span></span>
<span id="cb58-36"><a href="#cb58-36" tabindex="-1"></a>  <span class="kw">var</span> clearThreshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span>
<span id="cb58-37"><a href="#cb58-37" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(qaBand)<span class="op">.</span><span class="fu">gte</span>(clearThreshold)<span class="op">;</span></span>
<span id="cb58-38"><a href="#cb58-38" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb58-39"><a href="#cb58-39" tabindex="-1"></a>}</span>
<span id="cb58-40"><a href="#cb58-40" tabindex="-1"></a></span>
<span id="cb58-41"><a href="#cb58-41" tabindex="-1"></a></span>
<span id="cb58-42"><a href="#cb58-42" tabindex="-1"></a><span class="kw">var</span> filteredMasked <span class="op">=</span> filteredS2WithCs</span>
<span id="cb58-43"><a href="#cb58-43" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskLowQA)<span class="op">;</span></span>
<span id="cb58-44"><a href="#cb58-44" tabindex="-1"></a></span>
<span id="cb58-45"><a href="#cb58-45" tabindex="-1"></a><span class="kw">var</span> filteredMaskedScaled <span class="op">=</span> filteredMasked<span class="op">.</span><span class="fu">map</span>(scaleImage)<span class="op">;</span></span>
<span id="cb58-46"><a href="#cb58-46" tabindex="-1"></a>  </span>
<span id="cb58-47"><a href="#cb58-47" tabindex="-1"></a><span class="co">// Create a median composite for 2020</span></span>
<span id="cb58-48"><a href="#cb58-48" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span>  filteredMaskedScaled<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb58-49"><a href="#cb58-49" tabindex="-1"></a></span>
<span id="cb58-50"><a href="#cb58-50" tabindex="-1"></a></span>
<span id="cb58-51"><a href="#cb58-51" tabindex="-1"></a><span class="co">// Load ESA WorldCover 2020 Classification</span></span>
<span id="cb58-52"><a href="#cb58-52" tabindex="-1"></a><span class="kw">var</span> worldcover <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;ESA/WorldCover/v100&quot;</span>)</span>
<span id="cb58-53"><a href="#cb58-53" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> worldcover</span>
<span id="cb58-54"><a href="#cb58-54" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2021-01-01&#39;</span>))<span class="op">;</span></span>
<span id="cb58-55"><a href="#cb58-55" tabindex="-1"></a><span class="kw">var</span> classification <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(filtered<span class="op">.</span><span class="fu">first</span>())<span class="op">;</span></span>
<span id="cb58-56"><a href="#cb58-56" tabindex="-1"></a></span>
<span id="cb58-57"><a href="#cb58-57" tabindex="-1"></a><span class="co">// Create a Split Panel App</span></span>
<span id="cb58-58"><a href="#cb58-58" tabindex="-1"></a></span>
<span id="cb58-59"><a href="#cb58-59" tabindex="-1"></a><span class="co">// Create two maps.</span></span>
<span id="cb58-60"><a href="#cb58-60" tabindex="-1"></a><span class="kw">var</span> leftMap <span class="op">=</span> ui<span class="op">.</span><span class="fu">Map</span>()<span class="op">;</span></span>
<span id="cb58-61"><a href="#cb58-61" tabindex="-1"></a><span class="kw">var</span> rightMap <span class="op">=</span> ui<span class="op">.</span><span class="fu">Map</span>()<span class="op">;</span></span>
<span id="cb58-62"><a href="#cb58-62" tabindex="-1"></a></span>
<span id="cb58-63"><a href="#cb58-63" tabindex="-1"></a><span class="co">// Link them together.</span></span>
<span id="cb58-64"><a href="#cb58-64" tabindex="-1"></a><span class="kw">var</span> linker <span class="op">=</span> ui<span class="op">.</span><span class="at">Map</span><span class="op">.</span><span class="fu">Linker</span>([leftMap<span class="op">,</span> rightMap])<span class="op">;</span></span>
<span id="cb58-65"><a href="#cb58-65" tabindex="-1"></a></span>
<span id="cb58-66"><a href="#cb58-66" tabindex="-1"></a><span class="co">// Create a split panel with the two maps.</span></span>
<span id="cb58-67"><a href="#cb58-67" tabindex="-1"></a><span class="kw">var</span> splitPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">SplitPanel</span>({</span>
<span id="cb58-68"><a href="#cb58-68" tabindex="-1"></a>  <span class="dt">firstPanel</span><span class="op">:</span> leftMap<span class="op">,</span></span>
<span id="cb58-69"><a href="#cb58-69" tabindex="-1"></a>  <span class="dt">secondPanel</span><span class="op">:</span> rightMap<span class="op">,</span></span>
<span id="cb58-70"><a href="#cb58-70" tabindex="-1"></a>  <span class="dt">orientation</span><span class="op">:</span> <span class="st">&#39;horizontal&#39;</span><span class="op">,</span></span>
<span id="cb58-71"><a href="#cb58-71" tabindex="-1"></a>  <span class="dt">wipe</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb58-72"><a href="#cb58-72" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb58-73"><a href="#cb58-73" tabindex="-1"></a></span>
<span id="cb58-74"><a href="#cb58-74" tabindex="-1"></a><span class="co">// Remove the default map from the root panel.</span></span>
<span id="cb58-75"><a href="#cb58-75" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb58-76"><a href="#cb58-76" tabindex="-1"></a></span>
<span id="cb58-77"><a href="#cb58-77" tabindex="-1"></a><span class="co">// Add our split panel to the root panel.</span></span>
<span id="cb58-78"><a href="#cb58-78" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">add</span>(splitPanel)<span class="op">;</span></span>
<span id="cb58-79"><a href="#cb58-79" tabindex="-1"></a></span>
<span id="cb58-80"><a href="#cb58-80" tabindex="-1"></a><span class="co">// Add the layers to the maps</span></span>
<span id="cb58-81"><a href="#cb58-81" tabindex="-1"></a><span class="co">// Composite goes to the leftMap</span></span>
<span id="cb58-82"><a href="#cb58-82" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb58-83"><a href="#cb58-83" tabindex="-1"></a>leftMap<span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;2020 Composite&#39;</span>)<span class="op">;</span></span>
<span id="cb58-84"><a href="#cb58-84" tabindex="-1"></a>leftMap<span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb58-85"><a href="#cb58-85" tabindex="-1"></a><span class="co">// Classification foes to the rightMap</span></span>
<span id="cb58-86"><a href="#cb58-86" tabindex="-1"></a>rightMap<span class="op">.</span><span class="fu">addLayer</span>(classification<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;WorldCover Classification&#39;</span>)<span class="op">;</span></span>
<span id="cb58-87"><a href="#cb58-87" tabindex="-1"></a>rightMap<span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb58-88"><a href="#cb58-88" tabindex="-1"></a><span class="co">// Adding a Legend</span></span>
<span id="cb58-89"><a href="#cb58-89" tabindex="-1"></a><span class="co">// The following code creates a legend with class names and colors</span></span>
<span id="cb58-90"><a href="#cb58-90" tabindex="-1"></a></span>
<span id="cb58-91"><a href="#cb58-91" tabindex="-1"></a><span class="co">// Create the panel for the legend items.</span></span>
<span id="cb58-92"><a href="#cb58-92" tabindex="-1"></a><span class="kw">var</span> legend <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb58-93"><a href="#cb58-93" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb58-94"><a href="#cb58-94" tabindex="-1"></a>    <span class="dt">position</span><span class="op">:</span> <span class="st">&#39;middle-right&#39;</span><span class="op">,</span></span>
<span id="cb58-95"><a href="#cb58-95" tabindex="-1"></a>    <span class="dt">padding</span><span class="op">:</span> <span class="st">&#39;8px 15px&#39;</span></span>
<span id="cb58-96"><a href="#cb58-96" tabindex="-1"></a>  }</span>
<span id="cb58-97"><a href="#cb58-97" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb58-98"><a href="#cb58-98" tabindex="-1"></a></span>
<span id="cb58-99"><a href="#cb58-99" tabindex="-1"></a><span class="co">// Create and add the legend title.</span></span>
<span id="cb58-100"><a href="#cb58-100" tabindex="-1"></a><span class="kw">var</span> legendTitle <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb58-101"><a href="#cb58-101" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">&#39;ESA WorldCover Classes&#39;</span><span class="op">,</span></span>
<span id="cb58-102"><a href="#cb58-102" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb58-103"><a href="#cb58-103" tabindex="-1"></a>    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">&#39;bold&#39;</span><span class="op">,</span></span>
<span id="cb58-104"><a href="#cb58-104" tabindex="-1"></a>    <span class="dt">fontSize</span><span class="op">:</span> <span class="st">&#39;18px&#39;</span><span class="op">,</span></span>
<span id="cb58-105"><a href="#cb58-105" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> <span class="st">&#39;0 0 4px 0&#39;</span><span class="op">,</span></span>
<span id="cb58-106"><a href="#cb58-106" tabindex="-1"></a>    <span class="dt">padding</span><span class="op">:</span> <span class="st">&#39;0&#39;</span></span>
<span id="cb58-107"><a href="#cb58-107" tabindex="-1"></a>  }</span>
<span id="cb58-108"><a href="#cb58-108" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb58-109"><a href="#cb58-109" tabindex="-1"></a>legend<span class="op">.</span><span class="fu">add</span>(legendTitle)<span class="op">;</span></span>
<span id="cb58-110"><a href="#cb58-110" tabindex="-1"></a></span>
<span id="cb58-111"><a href="#cb58-111" tabindex="-1"></a><span class="kw">var</span> loading <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">&#39;Loading legend...&#39;</span><span class="op">,</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">&#39;2px 0 4px 0&#39;</span>})<span class="op">;</span></span>
<span id="cb58-112"><a href="#cb58-112" tabindex="-1"></a>legend<span class="op">.</span><span class="fu">add</span>(loading)<span class="op">;</span></span>
<span id="cb58-113"><a href="#cb58-113" tabindex="-1"></a></span>
<span id="cb58-114"><a href="#cb58-114" tabindex="-1"></a><span class="co">// Creates and styles 1 row of the legend.</span></span>
<span id="cb58-115"><a href="#cb58-115" tabindex="-1"></a><span class="kw">var</span> makeRow <span class="op">=</span> <span class="kw">function</span>(color<span class="op">,</span> name) {</span>
<span id="cb58-116"><a href="#cb58-116" tabindex="-1"></a>  <span class="co">// Create the label that is actually the colored box.</span></span>
<span id="cb58-117"><a href="#cb58-117" tabindex="-1"></a>  <span class="kw">var</span> colorBox <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb58-118"><a href="#cb58-118" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb58-119"><a href="#cb58-119" tabindex="-1"></a>      <span class="dt">backgroundColor</span><span class="op">:</span> <span class="st">&#39;#&#39;</span> <span class="op">+</span> color<span class="op">,</span></span>
<span id="cb58-120"><a href="#cb58-120" tabindex="-1"></a>      <span class="co">// Use padding to give the box height and width.</span></span>
<span id="cb58-121"><a href="#cb58-121" tabindex="-1"></a>      <span class="dt">padding</span><span class="op">:</span> <span class="st">&#39;8px&#39;</span><span class="op">,</span></span>
<span id="cb58-122"><a href="#cb58-122" tabindex="-1"></a>      <span class="dt">margin</span><span class="op">:</span> <span class="st">&#39;0 0 4px 0&#39;</span></span>
<span id="cb58-123"><a href="#cb58-123" tabindex="-1"></a>    }</span>
<span id="cb58-124"><a href="#cb58-124" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb58-125"><a href="#cb58-125" tabindex="-1"></a></span>
<span id="cb58-126"><a href="#cb58-126" tabindex="-1"></a>  <span class="co">// Create the label filled with the description text.</span></span>
<span id="cb58-127"><a href="#cb58-127" tabindex="-1"></a>  <span class="kw">var</span> description <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb58-128"><a href="#cb58-128" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> name<span class="op">,</span></span>
<span id="cb58-129"><a href="#cb58-129" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">&#39;0 0 4px 6px&#39;</span>}</span>
<span id="cb58-130"><a href="#cb58-130" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb58-131"><a href="#cb58-131" tabindex="-1"></a></span>
<span id="cb58-132"><a href="#cb58-132" tabindex="-1"></a>  <span class="cf">return</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb58-133"><a href="#cb58-133" tabindex="-1"></a>    <span class="dt">widgets</span><span class="op">:</span> [colorBox<span class="op">,</span> description]<span class="op">,</span></span>
<span id="cb58-134"><a href="#cb58-134" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">Flow</span>(<span class="st">&#39;horizontal&#39;</span>)</span>
<span id="cb58-135"><a href="#cb58-135" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb58-136"><a href="#cb58-136" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb58-137"><a href="#cb58-137" tabindex="-1"></a></span>
<span id="cb58-138"><a href="#cb58-138" tabindex="-1"></a><span class="kw">var</span> BAND_NAME <span class="op">=</span> <span class="st">&#39;Map&#39;</span><span class="op">;</span></span>
<span id="cb58-139"><a href="#cb58-139" tabindex="-1"></a><span class="co">// Get the list of palette colors and class names from the image.</span></span>
<span id="cb58-140"><a href="#cb58-140" tabindex="-1"></a>classification<span class="op">.</span><span class="fu">toDictionary</span>()<span class="op">.</span><span class="fu">select</span>([BAND_NAME <span class="op">+</span> <span class="st">&quot;.*&quot;</span>])<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(result) {</span>
<span id="cb58-141"><a href="#cb58-141" tabindex="-1"></a>  <span class="kw">var</span> palette <span class="op">=</span> result[BAND_NAME <span class="op">+</span> <span class="st">&quot;_class_palette&quot;</span>]<span class="op">;</span></span>
<span id="cb58-142"><a href="#cb58-142" tabindex="-1"></a>  <span class="kw">var</span> names <span class="op">=</span> result[BAND_NAME <span class="op">+</span> <span class="st">&quot;_class_names&quot;</span>]<span class="op">;</span></span>
<span id="cb58-143"><a href="#cb58-143" tabindex="-1"></a>  loading<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;shown&#39;</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb58-144"><a href="#cb58-144" tabindex="-1"></a></span>
<span id="cb58-145"><a href="#cb58-145" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> names<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb58-146"><a href="#cb58-146" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">add</span>(<span class="fu">makeRow</span>(palette[i]<span class="op">,</span> names[i]))<span class="op">;</span></span>
<span id="cb58-147"><a href="#cb58-147" tabindex="-1"></a>  }</span>
<span id="cb58-148"><a href="#cb58-148" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb58-149"><a href="#cb58-149" tabindex="-1"></a></span>
<span id="cb58-150"><a href="#cb58-150" tabindex="-1"></a><span class="co">// Print the panel containing the legend</span></span>
<span id="cb58-151"><a href="#cb58-151" tabindex="-1"></a><span class="fu">print</span>(legend)<span class="op">;</span></span>
<span id="cb58-152"><a href="#cb58-152" tabindex="-1"></a></span>
<span id="cb58-153"><a href="#cb58-153" tabindex="-1"></a><span class="co">// Exercise</span></span>
<span id="cb58-154"><a href="#cb58-154" tabindex="-1"></a></span>
<span id="cb58-155"><a href="#cb58-155" tabindex="-1"></a><span class="co">// Change the filter to select your chosen Admin2 region</span></span>
<span id="cb58-156"><a href="#cb58-156" tabindex="-1"></a></span>
<span id="cb58-157"><a href="#cb58-157" tabindex="-1"></a><span class="co">// The &#39;legend&#39; varaible above is a panel containing the legend</span></span>
<span id="cb58-158"><a href="#cb58-158" tabindex="-1"></a><span class="co">// for the classification. Add it to the map below</span></span>
<span id="cb58-159"><a href="#cb58-159" tabindex="-1"></a></span>
<span id="cb58-160"><a href="#cb58-160" tabindex="-1"></a><span class="co">// Hint: UI Widgets can only be shown once in the app. Remove the</span></span>
<span id="cb58-161"><a href="#cb58-161" tabindex="-1"></a><span class="co">//       print statement before adding the legend to the map.</span></span>
<span id="cb58-162"><a href="#cb58-162" tabindex="-1"></a><span class="co">// Hint: Load the legend in the right-hand side map.</span></span></code></pre></div>
</div>
</div>
</div>
<div id="module-6-google-earth-engine-python-api"
class="section level1">
<h1>Module 6: Google Earth Engine Python API</h1>
<div id="introduction-to-the-python-api" class="section level2">
<h2>Introduction to the Python API</h2>
<p>Till this point in the course, we have used the Earth Engine
Javascript API for all our analysis. Earth Engine also provides a Python
API. If you are a Python programmer, you may prefer to use the Python
API to integrate Earth Engine in your spatial analysis workflow. There
are many options for running Python code that uses the Google Earth
Engine API. We will use the following two methods in this course.</p>
<p><a
href="https://www.youtube.com/watch?v=34yNkLmEHAI&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=7"
target="_blank"><img
src="https://img.youtube.com/vi/34yNkLmEHAI/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=34yNkLmEHAI&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=7"
target="_blank">Watch the Video ↗</a></p>
<div id="google-colab" class="section level3">
<h3>Google Colab</h3>
<p>An easy way to start using the Google Earth Engine Python API is via
<a href="https://colab.research.google.com/">Google Colab</a>. Google
Colaboratory provides a hosted environment to run Python notebooks
without having to install Python locally. It also comes pre-installed
with many useful packages - including the Google Earth Engine Python
API. You can simply visit <a href="https://colab.research.google.com/"
class="uri">https://colab.research.google.com/</a> and start a new
notebook.</p>
</div>
<div id="local-development-environment" class="section level3">
<h3>Local Development Environment</h3>
<p>An advantage of Python API is that you can use it in your own
development environment - so you get a lot more flexibility to automate
as well as combine other analysis and visualization libraries with Earth
Engine. This requires installing Python and the Earth Engine Python API
on your machine or server. You also need to do a one-time authentication
and save the token on the machine. The preferred method for installing
the Earth Engine Python API is via Anaconda. Please follow our <a
href="install-gee-python-api.html">Google Earth Engine Python API
Installation Guide</a> for step-by-step instructions.</p>
</div>
</div>
<div id="python-api-syntax" class="section level2">
<h2>01. Python API Syntax</h2>
<p><a
href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/01_python_api_syntax.ipynb"
target="_blank">Open in Google Colab ↗</a></p>
<p>Coming from the programming in Earth Engine through the Code Editor,
you will need to slightly adapt your scripts to be able to run in
Python. For the bulk of your code, you will be using Earth Engine API’s
server-side objects and functions - which will be exactly the same in
Python. You only need to make a few syntactical changes.</p>
<p><a
href="https://developers.google.com/earth-engine/python_install#syntax">Here’s
the full list</a> of differences.</p>
<div id="initialization" class="section level4">
<h4>Initialization</h4>
<p>First of all, you need to run the following cells to initialize the
API and authorize your account. You must have a Google Cloud Project
associated with your GEE account. Replace the <code>cloud_project</code>
with your own project from <a
href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<p>You will be prompted to allow the notebook to access your Google
credentials to sign-in to the account and allow access to <em>Google
Drive and Google Cloud data</em>. Once you approve, it will proceed to
initialize the Earth Engine API. This step needs to be done just once
per session.</p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="im">import</span> ee</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>cloud_project <span class="op">=</span> <span class="st">&#39;spatialthoughts&#39;</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a>    ee.Authenticate()</span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span></code></pre></div>
</div>
<div id="variables" class="section level4">
<h4>Variables</h4>
<p>Python code doesn’t use the ‘var’ keyword</p>
<p>javascript code:</p>
<pre><code>var city = &#39;San Fransico&#39;
var state = &#39;California&#39;
print(city, state)

var population = 881549
print(population)</code></pre>
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>city <span class="op">=</span> <span class="st">&#39;San Fransico&#39;</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>state <span class="op">=</span> <span class="st">&#39;California&#39;</span></span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a><span class="bu">print</span>(city, state)</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>population <span class="op">=</span> <span class="dv">881549</span></span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a><span class="bu">print</span>(population)</span></code></pre></div>
</div>
<div id="earth-engine-objects-1" class="section level4">
<h4>Earth Engine Objects</h4>
<p>You can create Earth Engine objects using the <code>ee</code>
functions the same way.</p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)</span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>geometry <span class="op">=</span> ee.Geometry.Polygon([[</span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>  [<span class="fl">82.60642647743225</span>, <span class="fl">27.16350437805251</span>],</span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>  [<span class="fl">82.60984897613525</span>, <span class="fl">27.1618529901377</span>],</span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a>  [<span class="fl">82.61088967323303</span>, <span class="fl">27.163695288375266</span>],</span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a>  [<span class="fl">82.60757446289062</span>, <span class="fl">27.16517483230927</span>]</span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a>]])</span></code></pre></div>
</div>
<div id="line-continuation" class="section level4">
<h4>Line Continuation</h4>
<p>Python doesn’t use a semi-colon for line ending. To indicate
line-continuation you need to use the \ character</p>
<p>javascript code:</p>
<pre><code>var s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;);
var filtered = s2.filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30))
  .filter(ee.Filter.date(&#39;2019-02-01&#39;, &#39;2019-03-01&#39;))
  .filter(ee.Filter.bounds(geometry));</code></pre>
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>filtered <span class="op">=</span> s2 <span class="op">\</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2019-02-01&#39;</span>, <span class="st">&#39;2019-03-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.bounds(geometry))</span></code></pre></div>
</div>
<div id="functions" class="section level4">
<h4>Functions</h4>
<p>Instead of the <code>function</code> keyword, Python uses the
<code>def</code> keyword. Also the in-line functions are defined using
<code>lambda</code> anonymous functions.</p>
<p>In the example below, also now the <code>and</code> operator - which
is capitalized as <code>And</code> in Python version to avoid conflict
with the built-in <code>and</code> operator. The same applies to
<code>Or</code> and <code>Not</code> operators. <code>true</code>,
<code>false</code>, <code>null</code> in Python are also spelled as
<code>True</code>, <code>False</code> and <code>None</code>.</p>
<p>javascript code:</p>
<pre><code>function maskS2clouds(image) {
  var qa = image.select(&#39;QA60&#39;)
  var cloudBitMask = 1 &lt;&lt; 10;
  var cirrusBitMask = 1 &lt;&lt; 11;
  var mask = qa.bitwiseAnd(cloudBitMask).eq(0).and(
             qa.bitwiseAnd(cirrusBitMask).eq(0))
  return image.updateMask(mask)//.divide(10000)
      .select(&quot;B.*&quot;)
      .copyProperties(image, [&quot;system:time_start&quot;])
}

function addNDVI(image) {
  var ndvi = image.normalizedDifference([&#39;B8&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;);
  return image.addBands(ndvi);
}</code></pre>
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="kw">def</span> maskS2clouds(image):</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>  qa <span class="op">=</span> image.select(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>  cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span></span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>  cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span></span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>  mask <span class="op">=</span> qa.bitwiseAnd(cloudBitMask).eq(<span class="dv">0</span>).And(</span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a>             qa.bitwiseAnd(cirrusBitMask).eq(<span class="dv">0</span>))</span>
<span id="cb67-7"><a href="#cb67-7" tabindex="-1"></a>  <span class="cf">return</span> image.updateMask(mask) <span class="op">\</span></span>
<span id="cb67-8"><a href="#cb67-8" tabindex="-1"></a>      .select(<span class="st">&quot;B.*&quot;</span>) <span class="op">\</span></span>
<span id="cb67-9"><a href="#cb67-9" tabindex="-1"></a>      .copyProperties(image, [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb67-10"><a href="#cb67-10" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" tabindex="-1"></a><span class="kw">def</span> addNDVI(image):</span>
<span id="cb67-12"><a href="#cb67-12" tabindex="-1"></a>  ndvi <span class="op">=</span> image.normalizedDifference([<span class="st">&#39;B8&#39;</span>, <span class="st">&#39;B4&#39;</span>]).rename(<span class="st">&#39;ndvi&#39;</span>)</span>
<span id="cb67-13"><a href="#cb67-13" tabindex="-1"></a>  <span class="cf">return</span> image.addBands(ndvi)</span>
<span id="cb67-14"><a href="#cb67-14" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" tabindex="-1"></a>withNdvi <span class="op">=</span> filtered <span class="op">\</span></span>
<span id="cb67-16"><a href="#cb67-16" tabindex="-1"></a>    .<span class="bu">map</span>(maskS2clouds) <span class="op">\</span></span>
<span id="cb67-17"><a href="#cb67-17" tabindex="-1"></a>    .<span class="bu">map</span>(addNDVI)</span></code></pre></div>
</div>
<div id="function-arguments" class="section level4">
<h4>Function Arguments</h4>
<p>Named arguments to Earth Engine functions need to be in quotes. Also
when passing the named arguments as a dictionary, it needs to be passed
using the <code>**</code> keyword.</p>
<p>javascript code:</p>
<pre><code>var composite = withNdvi.median();
var ndvi = composite.select(&#39;ndvi&#39;);

var stats = ndvi.reduceRegion({
    reducer: ee.Reducer.mean(),
    geometry: geometry,
    scale: 10,
    maxPixels: 1e10
})    </code></pre>
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>composite <span class="op">=</span> withNdvi.median()</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>ndvi <span class="op">=</span> composite.select(<span class="st">&#39;ndvi&#39;</span>)</span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>stats <span class="op">=</span> ndvi.reduceRegion(<span class="op">**</span>{</span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>  <span class="st">&#39;reducer&#39;</span>: ee.Reducer.mean(),</span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>  <span class="st">&#39;geometry&#39;</span>: geometry,</span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>  <span class="st">&#39;scale&#39;</span>: <span class="dv">10</span>,</span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>  <span class="st">&#39;maxPixels&#39;</span>: <span class="fl">1e10</span></span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a>  })</span></code></pre></div>
</div>
<div id="printing-values" class="section level4">
<h4>Printing Values</h4>
<p>The <code>print()</code> function syntax is the same. But you must
remember that in the Code Editor when you cann <code>print</code>, the
value of the server object is fetched and then printed. You must do that
explicitely by calling <code>getInfo()</code> on any server-side
object.</p>
<p>javascript code:</p>
<pre><code>print(stats.get(&#39;ndvi&#39;)</code></pre>
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="bu">print</span>(stats.get(<span class="st">&#39;ndvi&#39;</span>).getInfo())</span></code></pre></div>
</div>
<div id="in-line-functions" class="section level4">
<h4>In-line functions</h4>
<p>The syntax for defining in-line functions is also slightly different.
You need to use the <code>lambda</code> keyword.</p>
<p>javascript code:</p>
<pre><code>var myList = ee.List.sequence(1, 10);
var newList = myList.map(function(number) {
    return ee.Number(number).pow(2);
print(newList);</code></pre>
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>myList <span class="op">=</span> ee.List.sequence(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>newList <span class="op">=</span> myList.<span class="bu">map</span>(<span class="kw">lambda</span> number: ee.Number(number).<span class="bu">pow</span>(<span class="dv">2</span>))</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a><span class="bu">print</span>(newList.getInfo())</span></code></pre></div>
</div>
<div id="exercise-28" class="section level3">
<h3>Exercise</h3>
<p>Take the Javascript code snippet below and write the equiavalent
Python code in the cell below.</p>
<ul>
<li><strong>Hint1</strong>: Chaining of filters require the use of line
continuation character <code>\</code></li>
<li><strong>Hint2</strong>: Printing of server-side objects requires
calling <code>.getInfo()</code> on the object</li>
</ul>
<p>The correct code should print the value <strong>30</strong>.</p>
<hr />
<pre><code>var geometry = ee.Geometry.Point([77.60412933051538, 12.952912912328241]);

var s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;);

var filtered = s2.filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30))
  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;))
  .filter(ee.Filter.bounds(geometry));
  
print(filtered.size());</code></pre>
<hr />
</div>
</div>
<div id="automatic-conversion-of-javascript-code-to-python"
class="section level2">
<h2>02. Automatic Conversion of Javascript Code to Python</h2>
<p><a
href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/02_automatic_conversion_of_scripts.ipynb"
target="_blank">Open in Google Colab ↗</a></p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/automatic_conversion.png" alt="Interactive leaflet map created by geemap" width="100%" />
<p class="caption">
Interactive leaflet map created by geemap
</p>
</div>
<p><a href="https://github.com/giswqs/geemap">geemap</a> is an
open-source Python package that comes with many helpful features that
help you use Earth Engine effectively in Python.</p>
<p>It comes with a function that can help you translate your javascript
earth engine code to Python automatically.</p>
<blockquote>
<p>The reverse is also possible. The <a
href="https://www.open-geocomputing.org/OpenEarthEngineLibrary/#.Python.run">Open
Earth Engine Library (OEEL)</a> allows you to run Python code in the
Earth Engine Code Editor.</p>
</blockquote>
<p>The <code>geemap</code> package is pre-installed in Colab.</p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="im">import</span> geemap</span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a><span class="im">import</span> ee</span></code></pre></div>
<div id="initialization-1" class="section level4">
<h4>Initialization</h4>
<p>First of all, you need to run the following cells to initialize the
API and authorize your account. You must have a Google Cloud Project
associated with your GEE account. Replace the <code>cloud_project</code>
with your own project from <a
href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a>cloud_project <span class="op">=</span> <span class="st">&#39;spatialthoughts&#39;</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a>    ee.Authenticate()</span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span></code></pre></div>
</div>
<div id="automatic-conversion-using-gui" class="section level4">
<h4>Automatic Conversion using GUI</h4>
<p><code>geemap</code> comes with a user interface that can be used to
interactively do code conversion. Let’s try to convert the following
Javascript code to Python.</p>
<pre><code>var geometry = ee.Geometry.Point([77.60412933051538, 12.952912912328241]);
var s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;);

var rgbVis = {min: 0.0, max: 3000, bands: [&#39;B4&#39;, &#39;B3&#39;, &#39;B2&#39;]};

var filtered = s2.filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30))
  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;))
  .filter(ee.Filter.bounds(geometry));
  
var medianComposite = filtered.median();

Map.centerObject(geometry, 10);
Map.addLayer(medianComposite, rgbVis, &#39;Median Composite&#39;);</code></pre>
<p>Run the cell below to load the map widget. Once the map widget loads,
click the <em>Toolbar</em> icon in the top-right corner and select the
<em>Convert Earth Engine Javascript to Python</em> tool. Paste your
Javascript code and click <em>Convert</em>.</p>
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a>m <span class="op">=</span> geemap.Map(width<span class="op">=</span><span class="dv">800</span>)</span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>m</span></code></pre></div>
<p>You will see the auto-converted code displayed. Copy and paste it
into a new cell and run it. Your code will be run using the GEE Python
API.</p>
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>geometry <span class="op">=</span> ee.Geometry.Point([<span class="fl">77.60412933051538</span>, <span class="fl">12.952912912328241</span>])</span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)</span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a>rgbVis <span class="op">=</span> {<span class="st">&#39;min&#39;</span>: <span class="fl">0.0</span>, <span class="st">&#39;max&#39;</span>: <span class="dv">3000</span>, <span class="st">&#39;bands&#39;</span>: [<span class="st">&#39;B4&#39;</span>, <span class="st">&#39;B3&#39;</span>, <span class="st">&#39;B2&#39;</span>]}</span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a>filtered <span class="op">=</span> s2.<span class="bu">filter</span>(ee.Filter.lt(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2019-01-01&#39;</span>, <span class="st">&#39;2020-01-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.bounds(geometry))</span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a>medianComposite <span class="op">=</span> filtered.median()</span>
<span id="cb79-11"><a href="#cb79-11" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" tabindex="-1"></a>m.centerObject(geometry, <span class="dv">10</span>)</span>
<span id="cb79-13"><a href="#cb79-13" tabindex="-1"></a>m.addLayer(medianComposite, rgbVis, <span class="st">&#39;Median Composite&#39;</span>)</span></code></pre></div>
<p>If your code loads any layers, they will be loaded on the map widget.
To display it, open a new code cell and just type <code>m</code> to
display the widget.</p>
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a>m</span></code></pre></div>
</div>
<div id="automatic-conversion-using-code" class="section level4">
<h4>Automatic Conversion using Code</h4>
<p><code>geemap</code> offers a function <code>js_snippet_to_py()</code>
that can be used to perform the conversion using code. This is useful
for batch conversions. To use this, we first create a string with the
javascript code.</p>
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>javascript_code <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a><span class="st">var geometry = ee.Geometry.Point([107.61303468448624, 12.130969369851766]);</span></span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a><span class="st">Map.centerObject(geometry, 12)</span></span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a><span class="st">var s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)</span></span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a><span class="st">var rgbVis = {</span></span>
<span id="cb81-6"><a href="#cb81-6" tabindex="-1"></a><span class="st">  min: 0.0,</span></span>
<span id="cb81-7"><a href="#cb81-7" tabindex="-1"></a><span class="st">  max: 3000,</span></span>
<span id="cb81-8"><a href="#cb81-8" tabindex="-1"></a><span class="st">  bands: [&#39;B4&#39;, &#39;B3&#39;, &#39;B2&#39;],</span></span>
<span id="cb81-9"><a href="#cb81-9" tabindex="-1"></a><span class="st">};</span></span>
<span id="cb81-10"><a href="#cb81-10" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" tabindex="-1"></a><span class="st">var filtered = s2</span></span>
<span id="cb81-12"><a href="#cb81-12" tabindex="-1"></a><span class="st">  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;))</span></span>
<span id="cb81-13"><a href="#cb81-13" tabindex="-1"></a><span class="st">  .filter(ee.Filter.bounds(geometry))</span></span>
<span id="cb81-14"><a href="#cb81-14" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" tabindex="-1"></a><span class="st">// Load the Cloud Score+ collection</span></span>
<span id="cb81-16"><a href="#cb81-16" tabindex="-1"></a><span class="st">var csPlus = ee.ImageCollection(&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;);</span></span>
<span id="cb81-17"><a href="#cb81-17" tabindex="-1"></a><span class="st">var csPlusBands = csPlus.first().bandNames();</span></span>
<span id="cb81-18"><a href="#cb81-18" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" tabindex="-1"></a><span class="st">// We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb81-20"><a href="#cb81-20" tabindex="-1"></a><span class="st">// image in the collection</span></span>
<span id="cb81-21"><a href="#cb81-21" tabindex="-1"></a><span class="st">// This is done using the linkCollection() function</span></span>
<span id="cb81-22"><a href="#cb81-22" tabindex="-1"></a><span class="st">var filteredS2WithCs = filtered.linkCollection(csPlus, csPlusBands);</span></span>
<span id="cb81-23"><a href="#cb81-23" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" tabindex="-1"></a><span class="st">// Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb81-25"><a href="#cb81-25" tabindex="-1"></a><span class="st">function maskLowQA(image) {</span></span>
<span id="cb81-26"><a href="#cb81-26" tabindex="-1"></a><span class="st">  var qaBand = &#39;cs&#39;;</span></span>
<span id="cb81-27"><a href="#cb81-27" tabindex="-1"></a><span class="st">  var clearThreshold = 0.5;</span></span>
<span id="cb81-28"><a href="#cb81-28" tabindex="-1"></a><span class="st">  var mask = image.select(qaBand).gte(clearThreshold);</span></span>
<span id="cb81-29"><a href="#cb81-29" tabindex="-1"></a><span class="st">  return image.updateMask(mask);</span></span>
<span id="cb81-30"><a href="#cb81-30" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb81-31"><a href="#cb81-31" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" tabindex="-1"></a></span>
<span id="cb81-33"><a href="#cb81-33" tabindex="-1"></a><span class="st">var filteredMasked = filteredS2WithCs</span></span>
<span id="cb81-34"><a href="#cb81-34" tabindex="-1"></a><span class="st">  .map(maskLowQA);</span></span>
<span id="cb81-35"><a href="#cb81-35" tabindex="-1"></a></span>
<span id="cb81-36"><a href="#cb81-36" tabindex="-1"></a><span class="st">// Write a function that computes NDVI for an image and adds it as a band</span></span>
<span id="cb81-37"><a href="#cb81-37" tabindex="-1"></a><span class="st">function addNDVI(image) {</span></span>
<span id="cb81-38"><a href="#cb81-38" tabindex="-1"></a><span class="st">  var ndvi = image.normalizedDifference([&#39;B5&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;);</span></span>
<span id="cb81-39"><a href="#cb81-39" tabindex="-1"></a><span class="st">  return image.addBands(ndvi);</span></span>
<span id="cb81-40"><a href="#cb81-40" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb81-41"><a href="#cb81-41" tabindex="-1"></a></span>
<span id="cb81-42"><a href="#cb81-42" tabindex="-1"></a><span class="st">var withNdvi = filteredMasked.map(addNDVI);</span></span>
<span id="cb81-43"><a href="#cb81-43" tabindex="-1"></a></span>
<span id="cb81-44"><a href="#cb81-44" tabindex="-1"></a><span class="st">var composite = withNdvi.median()</span></span>
<span id="cb81-45"><a href="#cb81-45" tabindex="-1"></a><span class="st">palette = [</span></span>
<span id="cb81-46"><a href="#cb81-46" tabindex="-1"></a><span class="st">  &#39;CE7E45&#39;, &#39;DF923D&#39;, &#39;F1B555&#39;, &#39;FCD163&#39;, &#39;99B718&#39;,</span></span>
<span id="cb81-47"><a href="#cb81-47" tabindex="-1"></a><span class="st">  &#39;74A901&#39;, &#39;66A000&#39;, &#39;529400&#39;, &#39;3E8601&#39;, &#39;207401&#39;, &#39;056201&#39;,</span></span>
<span id="cb81-48"><a href="#cb81-48" tabindex="-1"></a><span class="st">  &#39;004C00&#39;, &#39;023B01&#39;, &#39;012E01&#39;, &#39;011D01&#39;, &#39;011301&#39;];</span></span>
<span id="cb81-49"><a href="#cb81-49" tabindex="-1"></a></span>
<span id="cb81-50"><a href="#cb81-50" tabindex="-1"></a><span class="st">ndviVis = {min:0, max:0.7, palette: palette }</span></span>
<span id="cb81-51"><a href="#cb81-51" tabindex="-1"></a><span class="st">Map.addLayer(withNdvi.select(&#39;ndvi&#39;), ndviVis, &#39;NDVI Composite&#39;)</span></span>
<span id="cb81-52"><a href="#cb81-52" tabindex="-1"></a></span>
<span id="cb81-53"><a href="#cb81-53" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a>lines <span class="op">=</span> geemap.js_snippet_to_py(</span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>    javascript_code, add_new_cell<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>    import_ee<span class="op">=</span><span class="va">True</span>, import_geemap<span class="op">=</span><span class="va">True</span>, show_map<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a>    <span class="bu">print</span>(line.rstrip())</span></code></pre></div>
<p>The automatic conversion works great. Review it and paste it to the
cell below.</p>
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a><span class="im">import</span> geemap</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a>m <span class="op">=</span> geemap.Map()</span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a>geometry <span class="op">=</span> ee.Geometry.Point([<span class="fl">107.61303468448624</span>, <span class="fl">12.130969369851766</span>])</span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a>m.centerObject(geometry, <span class="dv">12</span>)</span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)</span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a>rgbVis <span class="op">=</span> {</span>
<span id="cb83-10"><a href="#cb83-10" tabindex="-1"></a>  <span class="st">&#39;min&#39;</span>: <span class="fl">0.0</span>,</span>
<span id="cb83-11"><a href="#cb83-11" tabindex="-1"></a>  <span class="st">&#39;max&#39;</span>: <span class="dv">3000</span>,</span>
<span id="cb83-12"><a href="#cb83-12" tabindex="-1"></a>  <span class="st">&#39;bands&#39;</span>: [<span class="st">&#39;B4&#39;</span>, <span class="st">&#39;B3&#39;</span>, <span class="st">&#39;B2&#39;</span>],</span>
<span id="cb83-13"><a href="#cb83-13" tabindex="-1"></a>}</span>
<span id="cb83-14"><a href="#cb83-14" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" tabindex="-1"></a>filtered <span class="op">=</span> s2 <span class="op">\</span></span>
<span id="cb83-16"><a href="#cb83-16" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2019-01-01&#39;</span>, <span class="st">&#39;2020-01-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb83-17"><a href="#cb83-17" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.bounds(geometry))</span>
<span id="cb83-18"><a href="#cb83-18" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" tabindex="-1"></a><span class="co"># Load the Cloud Score+ collection</span></span>
<span id="cb83-20"><a href="#cb83-20" tabindex="-1"></a>csPlus <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)</span>
<span id="cb83-21"><a href="#cb83-21" tabindex="-1"></a>csPlusBands <span class="op">=</span> csPlus.first().bandNames()</span>
<span id="cb83-22"><a href="#cb83-22" tabindex="-1"></a></span>
<span id="cb83-23"><a href="#cb83-23" tabindex="-1"></a><span class="co"># We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb83-24"><a href="#cb83-24" tabindex="-1"></a><span class="co"># image in the collection</span></span>
<span id="cb83-25"><a href="#cb83-25" tabindex="-1"></a><span class="co"># This is done using the linkCollection() function</span></span>
<span id="cb83-26"><a href="#cb83-26" tabindex="-1"></a>filteredS2WithCs <span class="op">=</span> filtered.linkCollection(csPlus, csPlusBands)</span>
<span id="cb83-27"><a href="#cb83-27" tabindex="-1"></a></span>
<span id="cb83-28"><a href="#cb83-28" tabindex="-1"></a><span class="co"># Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb83-29"><a href="#cb83-29" tabindex="-1"></a><span class="kw">def</span> maskLowQA(image):</span>
<span id="cb83-30"><a href="#cb83-30" tabindex="-1"></a>  qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span></span>
<span id="cb83-31"><a href="#cb83-31" tabindex="-1"></a>  clearThreshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb83-32"><a href="#cb83-32" tabindex="-1"></a>  mask <span class="op">=</span> image.select(qaBand).gte(clearThreshold)</span>
<span id="cb83-33"><a href="#cb83-33" tabindex="-1"></a>  <span class="cf">return</span> image.updateMask(mask)</span>
<span id="cb83-34"><a href="#cb83-34" tabindex="-1"></a></span>
<span id="cb83-35"><a href="#cb83-35" tabindex="-1"></a>filteredMasked <span class="op">=</span> filteredS2WithCs <span class="op">\</span></span>
<span id="cb83-36"><a href="#cb83-36" tabindex="-1"></a>  .<span class="bu">map</span>(maskLowQA)</span>
<span id="cb83-37"><a href="#cb83-37" tabindex="-1"></a></span>
<span id="cb83-38"><a href="#cb83-38" tabindex="-1"></a><span class="co"># Write a function that computes NDVI for an image and adds it as a band</span></span>
<span id="cb83-39"><a href="#cb83-39" tabindex="-1"></a><span class="kw">def</span> addNDVI(image):</span>
<span id="cb83-40"><a href="#cb83-40" tabindex="-1"></a>  ndvi <span class="op">=</span> image.normalizedDifference([<span class="st">&#39;B5&#39;</span>, <span class="st">&#39;B4&#39;</span>]).rename(<span class="st">&#39;ndvi&#39;</span>)</span>
<span id="cb83-41"><a href="#cb83-41" tabindex="-1"></a>  <span class="cf">return</span> image.addBands(ndvi)</span>
<span id="cb83-42"><a href="#cb83-42" tabindex="-1"></a></span>
<span id="cb83-43"><a href="#cb83-43" tabindex="-1"></a>withNdvi <span class="op">=</span> filteredMasked.<span class="bu">map</span>(addNDVI)</span>
<span id="cb83-44"><a href="#cb83-44" tabindex="-1"></a></span>
<span id="cb83-45"><a href="#cb83-45" tabindex="-1"></a>composite <span class="op">=</span> withNdvi.median()</span>
<span id="cb83-46"><a href="#cb83-46" tabindex="-1"></a>palette <span class="op">=</span> [</span>
<span id="cb83-47"><a href="#cb83-47" tabindex="-1"></a>  <span class="st">&#39;CE7E45&#39;</span>, <span class="st">&#39;DF923D&#39;</span>, <span class="st">&#39;F1B555&#39;</span>, <span class="st">&#39;FCD163&#39;</span>, <span class="st">&#39;99B718&#39;</span>,</span>
<span id="cb83-48"><a href="#cb83-48" tabindex="-1"></a>  <span class="st">&#39;74A901&#39;</span>, <span class="st">&#39;66A000&#39;</span>, <span class="st">&#39;529400&#39;</span>, <span class="st">&#39;3E8601&#39;</span>, <span class="st">&#39;207401&#39;</span>, <span class="st">&#39;056201&#39;</span>,</span>
<span id="cb83-49"><a href="#cb83-49" tabindex="-1"></a>  <span class="st">&#39;004C00&#39;</span>, <span class="st">&#39;023B01&#39;</span>, <span class="st">&#39;012E01&#39;</span>, <span class="st">&#39;011D01&#39;</span>, <span class="st">&#39;011301&#39;</span>]</span>
<span id="cb83-50"><a href="#cb83-50" tabindex="-1"></a></span>
<span id="cb83-51"><a href="#cb83-51" tabindex="-1"></a>ndviVis <span class="op">=</span> {<span class="st">&#39;min&#39;</span>:<span class="dv">0</span>, <span class="st">&#39;max&#39;</span>:<span class="fl">0.7</span>, <span class="st">&#39;palette&#39;</span>: palette }</span>
<span id="cb83-52"><a href="#cb83-52" tabindex="-1"></a>m.addLayer(withNdvi.select(<span class="st">&#39;ndvi&#39;</span>), ndviVis, <span class="st">&#39;NDVI Composite&#39;</span>)</span>
<span id="cb83-53"><a href="#cb83-53" tabindex="-1"></a></span>
<span id="cb83-54"><a href="#cb83-54" tabindex="-1"></a>m</span></code></pre></div>
</div>
<div id="exercise-29" class="section level3">
<h3>Exercise</h3>
<p>Take the Javascript code snippet below and use <code>geemap</code> to
automatically convert it to Python.</p>
<hr />
<pre><code>var admin2 = ee.FeatureCollection(&quot;FAO/GAUL_SIMPLIFIED_500m/2015/level2&quot;);

var karnataka = admin2.filter(ee.Filter.eq(&#39;ADM1_NAME&#39;, &#39;Karnataka&#39;))

var visParams = {color: &#39;red&#39;}
Map.centerObject(karnataka)
Map.addLayer(karnataka, visParams, &#39;Karnataka Districts&#39;)</code></pre>
<hr />
</div>
</div>
<div id="batch-exports" class="section level2">
<h2>03. Batch Exports</h2>
<p><a
href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/03_export_a_collection.ipynb"
target="_blank">Open in Google Colab ↗</a></p>
<p>One of the most commonly asked questions by Earth Engine users is -
<em>How do I download all images in a collection</em>? The Earth Engine
Python API comes with a <code>ee.batch</code> module that allows you to
launch batch exports and manage tasks. The recommended way to do batch
exports like this is to use the Python API’s
<code>ee.batch.Export</code> functions and use a Python for-loop to
iterate and export each image. The <code>ee.batch</code> module also
gives you ability to control <em>Tasks</em> - allowing you to automate
exports.</p>
<blockquote>
<p>You can also export images in a collection using Javascript API in
the Code Editor but this requires you to manually start the tasks for
each image. This approach is fine for small number of images. You can
check out the <a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3ASupplement%2FImage_Collections%2FExporting_ImageCollections">recommended
script</a>.</p>
</blockquote>
<div id="initialization-2" class="section level4">
<h4>Initialization</h4>
<p>First of all, you need to run the following cells to initialize the
API and authorize your account. You must have a Google Cloud Project
associated with your GEE account. Replace the <code>cloud_project</code>
with your own project from <a
href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<div class="sourceCode" id="cb85"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="im">import</span> ee</span></code></pre></div>
<div class="sourceCode" id="cb86"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a>cloud_project <span class="op">=</span> <span class="st">&#39;spatialthoughts&#39;</span></span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb86-4"><a href="#cb86-4" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span>
<span id="cb86-5"><a href="#cb86-5" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb86-6"><a href="#cb86-6" tabindex="-1"></a>    ee.Authenticate()</span>
<span id="cb86-7"><a href="#cb86-7" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span></code></pre></div>
</div>
<div id="create-a-collection" class="section level4">
<h4>Create a Collection</h4>
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a>geometry <span class="op">=</span> ee.Geometry.Point([<span class="fl">107.61303468448624</span>, <span class="fl">12.130969369851766</span>])</span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)</span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a>rgbVis <span class="op">=</span> {</span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a>  <span class="st">&#39;min&#39;</span>: <span class="fl">0.0</span>,</span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a>  <span class="st">&#39;max&#39;</span>: <span class="dv">3000</span>,</span>
<span id="cb87-6"><a href="#cb87-6" tabindex="-1"></a>  <span class="st">&#39;bands&#39;</span>: [<span class="st">&#39;B4&#39;</span>, <span class="st">&#39;B3&#39;</span>, <span class="st">&#39;B2&#39;</span>],</span>
<span id="cb87-7"><a href="#cb87-7" tabindex="-1"></a>}</span>
<span id="cb87-8"><a href="#cb87-8" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" tabindex="-1"></a>filtered <span class="op">=</span> s2 <span class="op">\</span></span>
<span id="cb87-10"><a href="#cb87-10" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2019-01-01&#39;</span>, <span class="st">&#39;2020-01-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb87-11"><a href="#cb87-11" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb87-12"><a href="#cb87-12" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.bounds(geometry)) <span class="op">\</span></span>
<span id="cb87-13"><a href="#cb87-13" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" tabindex="-1"></a><span class="co"># Load the Cloud Score+ collection</span></span>
<span id="cb87-15"><a href="#cb87-15" tabindex="-1"></a>csPlus <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)</span>
<span id="cb87-16"><a href="#cb87-16" tabindex="-1"></a>csPlusBands <span class="op">=</span> csPlus.first().bandNames()</span>
<span id="cb87-17"><a href="#cb87-17" tabindex="-1"></a></span>
<span id="cb87-18"><a href="#cb87-18" tabindex="-1"></a><span class="co"># We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb87-19"><a href="#cb87-19" tabindex="-1"></a><span class="co"># image in the collection</span></span>
<span id="cb87-20"><a href="#cb87-20" tabindex="-1"></a><span class="co"># This is done using the linkCollection() function</span></span>
<span id="cb87-21"><a href="#cb87-21" tabindex="-1"></a>filteredS2WithCs <span class="op">=</span> filtered.linkCollection(csPlus, csPlusBands)</span>
<span id="cb87-22"><a href="#cb87-22" tabindex="-1"></a></span>
<span id="cb87-23"><a href="#cb87-23" tabindex="-1"></a><span class="co"># Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb87-24"><a href="#cb87-24" tabindex="-1"></a><span class="kw">def</span> maskLowQA(image):</span>
<span id="cb87-25"><a href="#cb87-25" tabindex="-1"></a>  qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span></span>
<span id="cb87-26"><a href="#cb87-26" tabindex="-1"></a>  clearThreshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb87-27"><a href="#cb87-27" tabindex="-1"></a>  mask <span class="op">=</span> image.select(qaBand).gte(clearThreshold)</span>
<span id="cb87-28"><a href="#cb87-28" tabindex="-1"></a>  <span class="cf">return</span> image.updateMask(mask)</span>
<span id="cb87-29"><a href="#cb87-29" tabindex="-1"></a></span>
<span id="cb87-30"><a href="#cb87-30" tabindex="-1"></a>filteredMasked <span class="op">=</span> filteredS2WithCs <span class="op">\</span></span>
<span id="cb87-31"><a href="#cb87-31" tabindex="-1"></a>  .<span class="bu">map</span>(maskLowQA)</span>
<span id="cb87-32"><a href="#cb87-32" tabindex="-1"></a></span>
<span id="cb87-33"><a href="#cb87-33" tabindex="-1"></a><span class="co"># Write a function that computes NDVI for an image and adds it as a band</span></span>
<span id="cb87-34"><a href="#cb87-34" tabindex="-1"></a><span class="kw">def</span> addNDVI(image):</span>
<span id="cb87-35"><a href="#cb87-35" tabindex="-1"></a>  ndvi <span class="op">=</span> image.normalizedDifference([<span class="st">&#39;B5&#39;</span>, <span class="st">&#39;B4&#39;</span>]).rename(<span class="st">&#39;ndvi&#39;</span>)</span>
<span id="cb87-36"><a href="#cb87-36" tabindex="-1"></a>  <span class="cf">return</span> image.addBands(ndvi)</span>
<span id="cb87-37"><a href="#cb87-37" tabindex="-1"></a></span>
<span id="cb87-38"><a href="#cb87-38" tabindex="-1"></a>withNdvi <span class="op">=</span> filteredMasked.<span class="bu">map</span>(addNDVI)</span></code></pre></div>
</div>
<div id="export-all-images" class="section level4">
<h4>Export All Images</h4>
<p>Exports are done via the <code>ee.batch</code> module. This module
allows you to automatically start an export - making it suitable for
batch exports.</p>
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a>image_ids <span class="op">=</span> withNdvi.aggregate_array(<span class="st">&#39;system:index&#39;</span>).getInfo()</span>
<span id="cb88-2"><a href="#cb88-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Total images: &#39;</span>, <span class="bu">len</span>(image_ids))</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a><span class="co"># Export with 100m resolution for this demo</span></span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a><span class="cf">for</span> i, image_id <span class="kw">in</span> <span class="bu">enumerate</span>(image_ids):</span>
<span id="cb89-3"><a href="#cb89-3" tabindex="-1"></a>  image <span class="op">=</span> ee.Image(withNdvi.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;system:index&#39;</span>, image_id)).first())</span>
<span id="cb89-4"><a href="#cb89-4" tabindex="-1"></a>  geometry <span class="op">=</span> image.geometry()</span>
<span id="cb89-5"><a href="#cb89-5" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" tabindex="-1"></a>  <span class="co"># Create an export task using ee.batch.Export.image.toDrive()</span></span>
<span id="cb89-7"><a href="#cb89-7" tabindex="-1"></a>  task <span class="op">=</span> ee.batch.Export.image.toDrive(<span class="op">**</span>{</span>
<span id="cb89-8"><a href="#cb89-8" tabindex="-1"></a>    <span class="st">&#39;image&#39;</span>: image.select(<span class="st">&#39;ndvi&#39;</span>),</span>
<span id="cb89-9"><a href="#cb89-9" tabindex="-1"></a>    <span class="st">&#39;description&#39;</span>: <span class="st">&#39;Image Export </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(i<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb89-10"><a href="#cb89-10" tabindex="-1"></a>    <span class="st">&#39;fileNamePrefix&#39;</span>: image_id,</span>
<span id="cb89-11"><a href="#cb89-11" tabindex="-1"></a>    <span class="st">&#39;folder&#39;</span>:<span class="st">&#39;earthengine&#39;</span>,</span>
<span id="cb89-12"><a href="#cb89-12" tabindex="-1"></a>    <span class="st">&#39;scale&#39;</span>: <span class="dv">100</span>,</span>
<span id="cb89-13"><a href="#cb89-13" tabindex="-1"></a>    <span class="st">&#39;region&#39;</span>: geometry,</span>
<span id="cb89-14"><a href="#cb89-14" tabindex="-1"></a>    <span class="st">&#39;maxPixels&#39;</span>: <span class="fl">1e10</span></span>
<span id="cb89-15"><a href="#cb89-15" tabindex="-1"></a>  })</span>
<span id="cb89-16"><a href="#cb89-16" tabindex="-1"></a>  <span class="co"># Start the task</span></span>
<span id="cb89-17"><a href="#cb89-17" tabindex="-1"></a>  task.start()</span>
<span id="cb89-18"><a href="#cb89-18" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&#39;Started Task: &#39;</span>, i<span class="op">+</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="manage-runningwaiting-tasks" class="section level4">
<h4>Manage Running/Waiting Tasks</h4>
<p>You can manage tasks as well. Get a list of tasks and get state
information on them</p>
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a>tasks <span class="op">=</span> ee.batch.Task.<span class="bu">list</span>()</span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a><span class="cf">for</span> task <span class="kw">in</span> tasks:</span>
<span id="cb90-3"><a href="#cb90-3" tabindex="-1"></a>  task_id <span class="op">=</span> task.status()[<span class="st">&#39;id&#39;</span>]</span>
<span id="cb90-4"><a href="#cb90-4" tabindex="-1"></a>  task_state <span class="op">=</span> task.status()[<span class="st">&#39;state&#39;</span>]</span>
<span id="cb90-5"><a href="#cb90-5" tabindex="-1"></a>  <span class="bu">print</span>(task_id, task_state)</span></code></pre></div>
<p>You can cancel tasks as well</p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>tasks <span class="op">=</span> ee.batch.Task.<span class="bu">list</span>()</span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a><span class="cf">for</span> task <span class="kw">in</span> tasks:</span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a>    task_id <span class="op">=</span> task.status()[<span class="st">&#39;id&#39;</span>]</span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a>    task_state <span class="op">=</span> task.status()[<span class="st">&#39;state&#39;</span>]</span>
<span id="cb91-5"><a href="#cb91-5" tabindex="-1"></a>    <span class="cf">if</span> task_state <span class="op">==</span> <span class="st">&#39;RUNNING&#39;</span> <span class="kw">or</span> task_state <span class="op">==</span> <span class="st">&#39;READY&#39;</span>:</span>
<span id="cb91-6"><a href="#cb91-6" tabindex="-1"></a>        task.cancel()</span>
<span id="cb91-7"><a href="#cb91-7" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Task </span><span class="sc">{}</span><span class="st"> canceled&#39;</span>.<span class="bu">format</span>(task_id))</span>
<span id="cb91-8"><a href="#cb91-8" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb91-9"><a href="#cb91-9" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Task </span><span class="sc">{}</span><span class="st"> state is </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(task_id, task_state))</span></code></pre></div>
</div>
<div id="exercise-30" class="section level3">
<h3>Exercise</h3>
<p>The code below uses the TerraClimate data and creates an
ImageCollection with 12 monthly images of maximum temperature. It also
extract the geometry for Australia from the LSIB collection. Add the
code to start an export task for each image in the collection for
australia.</p>
<ul>
<li><strong>Hint1</strong>: TerraClimate images have a scale of
4638.3m</li>
<li><strong>Hint2</strong>: You need to export the image contained in
the clippedImage variable</li>
</ul>
<div class="sourceCode" id="cb92"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a>lsib <span class="op">=</span> ee.FeatureCollection(<span class="st">&#39;USDOS/LSIB_SIMPLE/2017&#39;</span>)</span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a>australia <span class="op">=</span> lsib.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;country_na&#39;</span>, <span class="st">&#39;Australia&#39;</span>))</span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a>geometry <span class="op">=</span> australia.geometry()</span>
<span id="cb92-4"><a href="#cb92-4" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" tabindex="-1"></a>terraclimate <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;IDAHO_EPSCOR/TERRACLIMATE&#39;</span>)</span>
<span id="cb92-6"><a href="#cb92-6" tabindex="-1"></a>tmax <span class="op">=</span> terraclimate.select(<span class="st">&#39;soil&#39;</span>)</span>
<span id="cb92-7"><a href="#cb92-7" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" tabindex="-1"></a><span class="kw">def</span> scale(image):</span>
<span id="cb92-9"><a href="#cb92-9" tabindex="-1"></a>  <span class="cf">return</span> image.multiply(<span class="fl">0.1</span>) <span class="op">\</span></span>
<span id="cb92-10"><a href="#cb92-10" tabindex="-1"></a>    .copyProperties(image,[<span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb92-11"><a href="#cb92-11" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" tabindex="-1"></a>tmaxScaled <span class="op">=</span> tmax.<span class="bu">map</span>(scale)</span>
<span id="cb92-13"><a href="#cb92-13" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" tabindex="-1"></a>filtered <span class="op">=</span> tmaxScaled <span class="op">\</span></span>
<span id="cb92-15"><a href="#cb92-15" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2023-01-01&#39;</span>, <span class="st">&#39;2024-01-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb92-16"><a href="#cb92-16" tabindex="-1"></a>  <span class="co">#.filter(ee.Filter.bounds(geometry))</span></span>
<span id="cb92-17"><a href="#cb92-17" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" tabindex="-1"></a>image_ids <span class="op">=</span> filtered.aggregate_array(<span class="st">&#39;system:index&#39;</span>).getInfo()</span>
<span id="cb92-19"><a href="#cb92-19" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Total images: &#39;</span>, <span class="bu">len</span>(image_ids))</span></code></pre></div>
<p>Replace the comments with your code.</p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="cf">for</span> i, image_id <span class="kw">in</span> <span class="bu">enumerate</span>(image_ids):</span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a>    exportImage <span class="op">=</span> ee.Image(filtered.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;system:index&#39;</span>, image_id)).first())</span>
<span id="cb93-3"><a href="#cb93-3" tabindex="-1"></a>    <span class="co"># clip the image</span></span>
<span id="cb93-4"><a href="#cb93-4" tabindex="-1"></a>    clippedImage <span class="op">=</span> exportImage.clip(geometry)</span>
<span id="cb93-5"><a href="#cb93-5" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" tabindex="-1"></a>    <span class="co">## Create the export task using ee.batch.Export.image.toDrive()</span></span>
<span id="cb93-7"><a href="#cb93-7" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" tabindex="-1"></a>    <span class="co">## Start the task</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/exporting_a_collection.png" alt="Launching multiple tasks using the  Python API" width="100%" />
<p class="caption">
Launching multiple tasks using the Python API
</p>
</div>
</div>
</div>
<div id="using-earth-engine-with-xarray" class="section level2">
<h2>04. Using Earth Engine with XArray</h2>
<p><a
href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/04_time_series_processing_xee.ipynb"
target="_blank">Open in Google Colab ↗</a></p>
<p><a href="https://github.com/google/Xee">XEE</a> is an python package
for working with Google Earth Engine data with <a
href="https://docs.xarray.dev/en/stable/">XArray</a>. XEE makes it
possible to leverage the strengths of both GEE and the Python ecosystem
around XArray.</p>
<p>We will learn how to use XEE to extract and process a NDVI
time-series for a single point location.</p>
<p>If you want to download processed time-series images as GeoTIFF
files, pleasee see <a
href="https://courses.spatialthoughts.com/python-remote-sensing.html#processing-time-series">this
notebook</a>.</p>
<div id="installation" class="section level4">
<h4>Installation</h4>
<p>Let’s install the required packages in the Colab environment.</p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;google.colab&#39;</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a>    <span class="op">!</span>pip install <span class="op">--</span>upgrade xee</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a><span class="im">import</span> xarray</span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
</div>
<div id="initialization-3" class="section level4">
<h4>Initialization</h4>
<p>First of all, you need to run the following cells to initialize the
API and authorize your account. You must have a Google Cloud Project
associated with your GEE account. Replace the <code>cloud_project</code>
with your own project from <a
href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<p>We are using the <a
href="https://developers.google.com/earth-engine/cloud/highvolume">High-volume
Endpoint</a> which supports large number of concurrent requests and is
recommended when working with XEE.</p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a>cloud_project <span class="op">=</span> <span class="st">&#39;spatialthoughts&#39;</span></span>
<span id="cb96-2"><a href="#cb96-2" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb96-4"><a href="#cb96-4" tabindex="-1"></a>    ee.Initialize(</span>
<span id="cb96-5"><a href="#cb96-5" tabindex="-1"></a>        project<span class="op">=</span>cloud_project,</span>
<span id="cb96-6"><a href="#cb96-6" tabindex="-1"></a>        opt_url<span class="op">=</span><span class="st">&#39;https://earthengine-highvolume.googleapis.com&#39;</span></span>
<span id="cb96-7"><a href="#cb96-7" tabindex="-1"></a>    )</span>
<span id="cb96-8"><a href="#cb96-8" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb96-9"><a href="#cb96-9" tabindex="-1"></a>    ee.Authenticate()</span>
<span id="cb96-10"><a href="#cb96-10" tabindex="-1"></a>    ee.Initialize(</span>
<span id="cb96-11"><a href="#cb96-11" tabindex="-1"></a>        project<span class="op">=</span>cloud_project,</span>
<span id="cb96-12"><a href="#cb96-12" tabindex="-1"></a>        opt_url<span class="op">=</span><span class="st">&#39;https://earthengine-highvolume.googleapis.com&#39;</span></span>
<span id="cb96-13"><a href="#cb96-13" tabindex="-1"></a>    )</span></code></pre></div>
</div>
<div id="select-a-location." class="section level4">
<h4>Select a location.</h4>
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a>geometry <span class="op">=</span> ee.Geometry.Point([<span class="fl">82.60759592318209</span>, <span class="fl">27.163481733946846</span>])</span></code></pre></div>
</div>
<div id="preprocess-the-data-in-gee" class="section level4">
<h4>Preprocess the data in GEE</h4>
<p>We start with the Sentinel-2 L1C collection. We pre-process the data
by applying cloud masking and pixel scaling.</p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>)</span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>filtered <span class="op">=</span> s2 <span class="op">\</span></span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2017-01-01&#39;</span>, <span class="st">&#39;2018-01-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span class="dv">30</span>)) <span class="op">\</span></span>
<span id="cb98-6"><a href="#cb98-6" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.bounds(geometry))</span>
<span id="cb98-7"><a href="#cb98-7" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" tabindex="-1"></a><span class="co"># Load the Cloud Score+ collection</span></span>
<span id="cb98-9"><a href="#cb98-9" tabindex="-1"></a>csPlus <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>)</span>
<span id="cb98-10"><a href="#cb98-10" tabindex="-1"></a>csPlusBands <span class="op">=</span> csPlus.first().bandNames()</span>
<span id="cb98-11"><a href="#cb98-11" tabindex="-1"></a></span>
<span id="cb98-12"><a href="#cb98-12" tabindex="-1"></a><span class="co"># We need to add Cloud Score + bands to each Sentinel-2</span></span>
<span id="cb98-13"><a href="#cb98-13" tabindex="-1"></a><span class="co"># image in the collection</span></span>
<span id="cb98-14"><a href="#cb98-14" tabindex="-1"></a><span class="co"># This is done using the linkCollection() function</span></span>
<span id="cb98-15"><a href="#cb98-15" tabindex="-1"></a>filteredS2WithCs <span class="op">=</span> filtered.linkCollection(csPlus, csPlusBands)</span>
<span id="cb98-16"><a href="#cb98-16" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" tabindex="-1"></a><span class="co"># Function to mask pixels with low CS+ QA scores.</span></span>
<span id="cb98-18"><a href="#cb98-18" tabindex="-1"></a><span class="kw">def</span> maskLowQA(image):</span>
<span id="cb98-19"><a href="#cb98-19" tabindex="-1"></a>  qaBand <span class="op">=</span> <span class="st">&#39;cs&#39;</span></span>
<span id="cb98-20"><a href="#cb98-20" tabindex="-1"></a>  clearThreshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb98-21"><a href="#cb98-21" tabindex="-1"></a>  mask <span class="op">=</span> image.select(qaBand).gte(clearThreshold)</span>
<span id="cb98-22"><a href="#cb98-22" tabindex="-1"></a>  <span class="cf">return</span> image.updateMask(mask)</span>
<span id="cb98-23"><a href="#cb98-23" tabindex="-1"></a></span>
<span id="cb98-24"><a href="#cb98-24" tabindex="-1"></a>filteredMasked <span class="op">=</span> filteredS2WithCs <span class="op">\</span></span>
<span id="cb98-25"><a href="#cb98-25" tabindex="-1"></a>  .<span class="bu">map</span>(maskLowQA)</span>
<span id="cb98-26"><a href="#cb98-26" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" tabindex="-1"></a><span class="co"># Write a function that computes NDVI for an image and adds it as a band</span></span>
<span id="cb98-28"><a href="#cb98-28" tabindex="-1"></a><span class="co"># Create a new image to overcome https://github.com/google/Xee/issues/88</span></span>
<span id="cb98-29"><a href="#cb98-29" tabindex="-1"></a><span class="kw">def</span> addNDVI(image):</span>
<span id="cb98-30"><a href="#cb98-30" tabindex="-1"></a>  ndvi <span class="op">=</span> image.normalizedDifference([<span class="st">&#39;B8&#39;</span>, <span class="st">&#39;B4&#39;</span>]).rename(<span class="st">&#39;ndvi&#39;</span>)</span>
<span id="cb98-31"><a href="#cb98-31" tabindex="-1"></a>  <span class="cf">return</span> image.multiply(<span class="fl">0.0001</span>).addBands(ndvi)<span class="op">\</span></span>
<span id="cb98-32"><a href="#cb98-32" tabindex="-1"></a>    .copyProperties(image, [<span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb98-33"><a href="#cb98-33" tabindex="-1"></a></span>
<span id="cb98-34"><a href="#cb98-34" tabindex="-1"></a><span class="co"># Map the function over the collection</span></span>
<span id="cb98-35"><a href="#cb98-35" tabindex="-1"></a>withNdvi <span class="op">=</span> filteredMasked.<span class="bu">map</span>(addNDVI)</span></code></pre></div>
</div>
<div id="load-imagecollection-as-xarray-dataset" class="section level4">
<h4>Load ImageCollection as XArray Dataset</h4>
<p>Now we have an ImageCollection that we want to get it as a XArray
Dataset. We define the region of interest and extract the
ImageCollection using the <code>ee</code> engine.</p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a>ds <span class="op">=</span> xarray.open_dataset(</span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a>    withNdvi,</span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>    engine<span class="op">=</span><span class="st">&#39;ee&#39;</span>,</span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">&#39;EPSG:3857&#39;</span>,</span>
<span id="cb99-5"><a href="#cb99-5" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb99-6"><a href="#cb99-6" tabindex="-1"></a>    geometry<span class="op">=</span>geometry,</span>
<span id="cb99-7"><a href="#cb99-7" tabindex="-1"></a>    ee_mask_value<span class="op">=-</span><span class="dv">9999</span>,</span>
<span id="cb99-8"><a href="#cb99-8" tabindex="-1"></a>)</span>
<span id="cb99-9"><a href="#cb99-9" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" tabindex="-1"></a>ds</span></code></pre></div>
<p>Select the <code>ndvi</code> band.</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a>ndvi_time_series <span class="op">=</span> ds.ndvi</span></code></pre></div>
<p>Run <code>compute()</code> to fetch the pixels from Earth Engine.
This may take some time depending on the size of the request. This is a
time-series at a single pixel, so we also <code>squeeze()</code> to
remove the X and Y dimensions and get an array of NDVI values.</p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a>original_time_series <span class="op">=</span> ndvi_time_series.compute()</span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>original_time_series <span class="op">=</span> original_time_series.squeeze()</span>
<span id="cb101-3"><a href="#cb101-3" tabindex="-1"></a>original_time_series</span></code></pre></div>
<p>Plot the time-series.</p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a>original_time_series.plot.line(</span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a>    ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;time&#39;</span>,</span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, color<span class="op">=</span><span class="st">&#39;#66c2a4&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb102-6"><a href="#cb102-6" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<div id="process-time-series-using-xarray" class="section level4">
<h4>Process Time-Series using XArray</h4>
<p>We use XArray’s excellent time-series processing functionality to
process the time-series. First, we create a regularly spaced
time-series.</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>time_series_resampled <span class="op">=</span> original_time_series<span class="op">\</span></span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a>  .resample(time<span class="op">=</span><span class="st">&#39;5d&#39;</span>).mean(dim<span class="op">=</span><span class="st">&#39;time&#39;</span>)</span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a>time_series_resampled</span></code></pre></div>
<p>Next we fill the cloud-masked pixels with linearly interpolated
values from temporal neighbors.</p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a>time_series_interpolated <span class="op">=</span> time_series_resampled<span class="op">\</span></span>
<span id="cb104-2"><a href="#cb104-2" tabindex="-1"></a>  .interpolate_na(<span class="st">&#39;time&#39;</span>, use_coordinate<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb104-3"><a href="#cb104-3" tabindex="-1"></a>time_series_interpolated</span></code></pre></div>
<p>We also apply a moving-window smoothing to remove noise.</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a>time_series_smooth <span class="op">=</span> time_series_interpolated<span class="op">\</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a>  .rolling(time<span class="op">=</span><span class="dv">3</span>, center<span class="op">=</span><span class="va">True</span>).mean()</span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a>time_series_smooth</span></code></pre></div>
<p>A moving-window smoothing removed the first and last values of the
time-series. We anchor the smoothed time-series with the values from the
original time-series.</p>
<div class="sourceCode" id="cb106"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a>time_series_smooth[<span class="dv">0</span>] <span class="op">=</span> original_time_series[<span class="dv">0</span>]</span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a>time_series_smooth[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> original_time_series[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb106-3"><a href="#cb106-3" tabindex="-1"></a>time_series_smooth</span></code></pre></div>
<p>Plot the original and smoothed time-series.</p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb107-2"><a href="#cb107-2" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb107-3"><a href="#cb107-3" tabindex="-1"></a>original_time_series.plot.line(</span>
<span id="cb107-4"><a href="#cb107-4" tabindex="-1"></a>    ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;time&#39;</span>,</span>
<span id="cb107-5"><a href="#cb107-5" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">&#39;^&#39;</span>, color<span class="op">=</span><span class="st">&#39;#66c2a4&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb107-6"><a href="#cb107-6" tabindex="-1"></a>time_series_smooth.plot.line(</span>
<span id="cb107-7"><a href="#cb107-7" tabindex="-1"></a>    ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;time&#39;</span>,</span>
<span id="cb107-8"><a href="#cb107-8" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, color<span class="op">=</span><span class="st">&#39;#238b45&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;-&#39;</span>, linewidth<span class="op">=</span><span class="dv">1</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb107-9"><a href="#cb107-9" tabindex="-1"></a>plt.show()</span></code></pre></div>
</div>
<div id="download-the-time-series" class="section level4">
<h4>Download the Time-Series</h4>
<p>Convert the DataArray to a Pandas DataFrame and save it as a CSV
file.</p>
<div class="sourceCode" id="cb108"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a>df <span class="op">=</span> time_series_smooth.to_dataframe(<span class="st">&#39;ndvi&#39;</span>).reset_index()</span>
<span id="cb108-2"><a href="#cb108-2" tabindex="-1"></a>df</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;smoothed_time_series.csv&#39;</span></span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>df[[<span class="st">&#39;time&#39;</span>, <span class="st">&#39;ndvi&#39;</span>]].to_csv(output_filename, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div id="exercise-31" class="section level3">
<h3>Exercise</h3>
<p>Replace the <code>geometry</code> with the location of your choice.
Extract and download the smoothed time-series as a CSV file.</p>
</div>
</div>
<div id="automating-downloads" class="section level2">
<h2>05. Automating Downloads</h2>
<p>Another common use of the GEE Python API is to automate data
processing and export. You can create a Python script that can be called
from a server or launched on a schedule using tools such as <a
href="https://medium.com/@roddyjaques/how-to-run-anaconda-programs-with-a-bat-file-5f6dd7675508">Windows
Scheduler</a> or <a
href="https://donny-son.github.io/posts/cronjob-with-conda/">crontab</a>.</p>
<p>This script below provides a complete example of automating a
download using Google Earth Engine API. It uses the Google Earth Engine
API to compute the average soil moisture for the given time period over
all districts in a state. The result is then downloaded as a CSV file
and saved locally.</p>
<blockquote>
<p>Before running the script, please install the Earth Engine Python
Client Library and commplete the authentication workflow on your machine
using our <a href="#install-gee-python-api.html">step-by-step
instructions</a>.</p>
</blockquote>
<p>Once you have finished the authentication, follow the steps below to
create a script to download data from GEE.</p>
<ol style="list-style-type: decimal">
<li>Create a new file named <code>download_data.py</code> with the
content shown below.</li>
</ol>
<div class="sourceCode" id="cb110"><pre
class="sourceCode py"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb110-5"><a href="#cb110-5" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" tabindex="-1"></a>cloud_project <span class="op">=</span> <span class="st">&#39;spatialthoughts&#39;</span></span>
<span id="cb110-7"><a href="#cb110-7" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-9"><a href="#cb110-9" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span>
<span id="cb110-10"><a href="#cb110-10" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb110-11"><a href="#cb110-11" tabindex="-1"></a>    ee.Authenticate()</span>
<span id="cb110-12"><a href="#cb110-12" tabindex="-1"></a>    ee.Initialize(project<span class="op">=</span>cloud_project)</span>
<span id="cb110-13"><a href="#cb110-13" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" tabindex="-1"></a><span class="co"># Get current date</span></span>
<span id="cb110-15"><a href="#cb110-15" tabindex="-1"></a>now <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb110-16"><a href="#cb110-16" tabindex="-1"></a></span>
<span id="cb110-17"><a href="#cb110-17" tabindex="-1"></a><span class="co"># Define the period of past 1-week</span></span>
<span id="cb110-18"><a href="#cb110-18" tabindex="-1"></a>end_date <span class="op">=</span> ee.Date(now)</span>
<span id="cb110-19"><a href="#cb110-19" tabindex="-1"></a>start_date <span class="op">=</span> end_date.advance(<span class="op">-</span><span class="dv">1</span>, <span class="st">&#39;week&#39;</span>)</span>
<span id="cb110-20"><a href="#cb110-20" tabindex="-1"></a></span>
<span id="cb110-21"><a href="#cb110-21" tabindex="-1"></a>date_string <span class="op">=</span> end_date.<span class="bu">format</span>(<span class="st">&#39;YYYY_MM_dd&#39;</span>)</span>
<span id="cb110-22"><a href="#cb110-22" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;ssm_</span><span class="sc">{}</span><span class="st">.csv&#39;</span>.<span class="bu">format</span>(date_string.getInfo())</span>
<span id="cb110-23"><a href="#cb110-23" tabindex="-1"></a></span>
<span id="cb110-24"><a href="#cb110-24" tabindex="-1"></a><span class="co"># Saving to current directory. You can change the path to appropriate location</span></span>
<span id="cb110-25"><a href="#cb110-25" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(filename)</span>
<span id="cb110-26"><a href="#cb110-26" tabindex="-1"></a></span>
<span id="cb110-27"><a href="#cb110-27" tabindex="-1"></a>soilmoisture <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;NASA/SMAP/SPL4SMGP/007&#39;</span>)</span>
<span id="cb110-28"><a href="#cb110-28" tabindex="-1"></a>admin2 <span class="op">=</span> ee.FeatureCollection(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)</span>
<span id="cb110-29"><a href="#cb110-29" tabindex="-1"></a></span>
<span id="cb110-30"><a href="#cb110-30" tabindex="-1"></a><span class="co"># Filter to a state</span></span>
<span id="cb110-31"><a href="#cb110-31" tabindex="-1"></a>karnataka <span class="op">=</span> admin2.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;ADM1_NAME&#39;</span>, <span class="st">&#39;Karnataka&#39;</span>))</span>
<span id="cb110-32"><a href="#cb110-32" tabindex="-1"></a></span>
<span id="cb110-33"><a href="#cb110-33" tabindex="-1"></a><span class="co"># Select the ssm band</span></span>
<span id="cb110-34"><a href="#cb110-34" tabindex="-1"></a>ssm  <span class="op">=</span> soilmoisture.select(<span class="st">&#39;sm_surface&#39;</span>)</span>
<span id="cb110-35"><a href="#cb110-35" tabindex="-1"></a></span>
<span id="cb110-36"><a href="#cb110-36" tabindex="-1"></a>filtered <span class="op">=</span> ssm .<span class="bu">filter</span>(ee.Filter.date(start_date, end_date))</span>
<span id="cb110-37"><a href="#cb110-37" tabindex="-1"></a></span>
<span id="cb110-38"><a href="#cb110-38" tabindex="-1"></a>mean <span class="op">=</span> filtered.mean()</span>
<span id="cb110-39"><a href="#cb110-39" tabindex="-1"></a></span>
<span id="cb110-40"><a href="#cb110-40" tabindex="-1"></a>stats <span class="op">=</span> mean.reduceRegions(<span class="op">**</span>{</span>
<span id="cb110-41"><a href="#cb110-41" tabindex="-1"></a>  <span class="st">&#39;collection&#39;</span>: karnataka,</span>
<span id="cb110-42"><a href="#cb110-42" tabindex="-1"></a>  <span class="st">&#39;reducer&#39;</span>: ee.Reducer.mean().setOutputs([<span class="st">&#39;meanssm&#39;</span>]),</span>
<span id="cb110-43"><a href="#cb110-43" tabindex="-1"></a>  <span class="st">&#39;scale&#39;</span>: <span class="dv">11000</span>,</span>
<span id="cb110-44"><a href="#cb110-44" tabindex="-1"></a>  <span class="st">&#39;crs&#39;</span>: <span class="st">&#39;EPSG:32643&#39;</span></span>
<span id="cb110-45"><a href="#cb110-45" tabindex="-1"></a>  })</span>
<span id="cb110-46"><a href="#cb110-46" tabindex="-1"></a></span>
<span id="cb110-47"><a href="#cb110-47" tabindex="-1"></a><span class="co"># Select columns to keep and remove geometry to make the result lightweight</span></span>
<span id="cb110-48"><a href="#cb110-48" tabindex="-1"></a><span class="co"># Change column names to match your uploaded shapefile</span></span>
<span id="cb110-49"><a href="#cb110-49" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">&#39;ADM2_NAME&#39;</span>, <span class="st">&#39;meanssm&#39;</span>]</span>
<span id="cb110-50"><a href="#cb110-50" tabindex="-1"></a>exportCollection <span class="op">=</span> stats.select(<span class="op">**</span>{</span>
<span id="cb110-51"><a href="#cb110-51" tabindex="-1"></a>    <span class="st">&#39;propertySelectors&#39;</span>: columns,</span>
<span id="cb110-52"><a href="#cb110-52" tabindex="-1"></a>    <span class="st">&#39;retainGeometry&#39;</span>: <span class="va">False</span>})</span>
<span id="cb110-53"><a href="#cb110-53" tabindex="-1"></a></span>
<span id="cb110-54"><a href="#cb110-54" tabindex="-1"></a>features <span class="op">=</span> exportCollection.getInfo()[<span class="st">&#39;features&#39;</span>]</span>
<span id="cb110-55"><a href="#cb110-55" tabindex="-1"></a></span>
<span id="cb110-56"><a href="#cb110-56" tabindex="-1"></a>data <span class="op">=</span> []</span>
<span id="cb110-57"><a href="#cb110-57" tabindex="-1"></a></span>
<span id="cb110-58"><a href="#cb110-58" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> features:</span>
<span id="cb110-59"><a href="#cb110-59" tabindex="-1"></a>    data.append(f[<span class="st">&#39;properties&#39;</span>])</span>
<span id="cb110-60"><a href="#cb110-60" tabindex="-1"></a></span>
<span id="cb110-61"><a href="#cb110-61" tabindex="-1"></a>field_names <span class="op">=</span> [<span class="st">&#39;ADM2_NAME&#39;</span>, <span class="st">&#39;meanssm&#39;</span>]</span>
<span id="cb110-62"><a href="#cb110-62" tabindex="-1"></a></span>
<span id="cb110-63"><a href="#cb110-63" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(output_path, <span class="st">&#39;w&#39;</span>) <span class="im">as</span> csvfile:</span>
<span id="cb110-64"><a href="#cb110-64" tabindex="-1"></a>    writer <span class="op">=</span> csv.DictWriter(csvfile, fieldnames <span class="op">=</span> field_names)</span>
<span id="cb110-65"><a href="#cb110-65" tabindex="-1"></a>    writer.writeheader()</span>
<span id="cb110-66"><a href="#cb110-66" tabindex="-1"></a>    writer.writerows(data)</span>
<span id="cb110-67"><a href="#cb110-67" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Success: File written at&#39;</span>, output_path)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>From the terminal, navigate to the directory where you have created
the file and type the command below to run the script.</li>
</ol>
<pre><code>python download_data.py</code></pre>
<p><img src="images/end_to_end_gee/download2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>The script will download the data from GEE and save a file to your
current directory.</li>
</ol>
<p><img src="images/end_to_end_gee/download3.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="automating-exports" class="section level2">
<h2>06. Automating Exports</h2>
<p>If you want to automate Earth Engine jobs on a server, it is
preferable to use a <a
href="https://developers.google.com/earth-engine/guides/service_account">Service
Account</a> for authentication. A service account is a virtual account
linked to a Google Cloud project. Once you create a service account and
give necessary permissions, it can be used to authenticate your Earth
Engine account instead of your own account. Each service account is
identified by an email address in the form of
<code>&lt;account_name&gt;@&lt;project&gt;.iam.gserviceaccount.com</code>.
Along with them, the credentials are stored in a separate
<code>.json</code> file. You need to keep this <code>.json</code> file
safe on the system with appropriate permissions so external users do not
have access to it.</p>
<blockquote>
<p>Before running the script, please install the Earth Engine Python
Client Library on the server using our <a
href="#install-gee-python-api.html">step-by-step instructions</a>.</p>
</blockquote>
<p>The below code example shows how to authenticate an Earth Engine
Export job using a service account. The code snippet assumes that the
private key file is in the same directory as the scirpt and saved as a
file named <code>.private_key.json</code>.</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode py"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a><span class="co"># Replace the service account with your service account email</span></span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a>service_account <span class="op">=</span> <span class="st">&#39;export-data-gee@spatialthoughts.iam.gserviceaccount.com&#39;</span></span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a><span class="co"># Replace the value with the path to your private key json file</span></span>
<span id="cb112-5"><a href="#cb112-5" tabindex="-1"></a>private_key_path <span class="op">=</span> <span class="st">&#39;.private_key.json&#39;</span></span>
<span id="cb112-6"><a href="#cb112-6" tabindex="-1"></a>credentials <span class="op">=</span> ee.ServiceAccountCredentials(service_account, private_key_path)</span>
<span id="cb112-7"><a href="#cb112-7" tabindex="-1"></a>ee.Initialize(credentials)</span>
<span id="cb112-8"><a href="#cb112-8" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" tabindex="-1"></a>lsib <span class="op">=</span> ee.FeatureCollection(<span class="st">&#39;USDOS/LSIB_SIMPLE/2017&#39;</span>)</span>
<span id="cb112-10"><a href="#cb112-10" tabindex="-1"></a>australia <span class="op">=</span> lsib.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;country_na&#39;</span>, <span class="st">&#39;Australia&#39;</span>))</span>
<span id="cb112-11"><a href="#cb112-11" tabindex="-1"></a>geometry <span class="op">=</span> australia.geometry()</span>
<span id="cb112-12"><a href="#cb112-12" tabindex="-1"></a></span>
<span id="cb112-13"><a href="#cb112-13" tabindex="-1"></a>terraclimate <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;IDAHO_EPSCOR/TERRACLIMATE&#39;</span>)</span>
<span id="cb112-14"><a href="#cb112-14" tabindex="-1"></a>tmax <span class="op">=</span> terraclimate.select(<span class="st">&#39;tmmx&#39;</span>)</span>
<span id="cb112-15"><a href="#cb112-15" tabindex="-1"></a></span>
<span id="cb112-16"><a href="#cb112-16" tabindex="-1"></a><span class="kw">def</span> scale(image):</span>
<span id="cb112-17"><a href="#cb112-17" tabindex="-1"></a>  <span class="cf">return</span> image.multiply(<span class="fl">0.1</span>) <span class="op">\</span></span>
<span id="cb112-18"><a href="#cb112-18" tabindex="-1"></a>    .copyProperties(image,[<span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb112-19"><a href="#cb112-19" tabindex="-1"></a></span>
<span id="cb112-20"><a href="#cb112-20" tabindex="-1"></a>tmaxScaled <span class="op">=</span> tmax.<span class="bu">map</span>(scale)</span>
<span id="cb112-21"><a href="#cb112-21" tabindex="-1"></a></span>
<span id="cb112-22"><a href="#cb112-22" tabindex="-1"></a>filtered <span class="op">=</span> tmaxScaled <span class="op">\</span></span>
<span id="cb112-23"><a href="#cb112-23" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(<span class="st">&#39;2020-01-01&#39;</span>, <span class="st">&#39;2021-01-01&#39;</span>)) <span class="op">\</span></span>
<span id="cb112-24"><a href="#cb112-24" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.bounds(geometry))</span>
<span id="cb112-25"><a href="#cb112-25" tabindex="-1"></a></span>
<span id="cb112-26"><a href="#cb112-26" tabindex="-1"></a>image_ids <span class="op">=</span> filtered.aggregate_array(<span class="st">&#39;system:index&#39;</span>).getInfo()</span>
<span id="cb112-27"><a href="#cb112-27" tabindex="-1"></a></span>
<span id="cb112-28"><a href="#cb112-28" tabindex="-1"></a><span class="cf">for</span> i, image_id <span class="kw">in</span> <span class="bu">enumerate</span>(image_ids):</span>
<span id="cb112-29"><a href="#cb112-29" tabindex="-1"></a>    exportImage <span class="op">=</span> ee.Image(filtered.<span class="bu">filter</span>(</span>
<span id="cb112-30"><a href="#cb112-30" tabindex="-1"></a>        ee.Filter.eq(<span class="st">&#39;system:index&#39;</span>, image_id)).first())</span>
<span id="cb112-31"><a href="#cb112-31" tabindex="-1"></a></span>
<span id="cb112-32"><a href="#cb112-32" tabindex="-1"></a>    clippedImage <span class="op">=</span> exportImage.clip(geometry)</span>
<span id="cb112-33"><a href="#cb112-33" tabindex="-1"></a>    </span>
<span id="cb112-34"><a href="#cb112-34" tabindex="-1"></a>    task <span class="op">=</span> ee.batch.Export.image.toDrive(<span class="op">**</span>{</span>
<span id="cb112-35"><a href="#cb112-35" tabindex="-1"></a>        <span class="st">&#39;image&#39;</span>: clippedImage,</span>
<span id="cb112-36"><a href="#cb112-36" tabindex="-1"></a>        <span class="st">&#39;description&#39;</span>: <span class="st">&#39;Terraclimate Image Export </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(i<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb112-37"><a href="#cb112-37" tabindex="-1"></a>        <span class="st">&#39;fileNamePrefix&#39;</span>: image_id,</span>
<span id="cb112-38"><a href="#cb112-38" tabindex="-1"></a>        <span class="st">&#39;folder&#39;</span>:<span class="st">&#39;earthengine&#39;</span>,</span>
<span id="cb112-39"><a href="#cb112-39" tabindex="-1"></a>        <span class="st">&#39;scale&#39;</span>: <span class="fl">4638.3</span>,</span>
<span id="cb112-40"><a href="#cb112-40" tabindex="-1"></a>        <span class="st">&#39;region&#39;</span>: geometry,</span>
<span id="cb112-41"><a href="#cb112-41" tabindex="-1"></a>        <span class="st">&#39;maxPixels&#39;</span>: <span class="fl">1e10</span></span>
<span id="cb112-42"><a href="#cb112-42" tabindex="-1"></a>    })</span>
<span id="cb112-43"><a href="#cb112-43" tabindex="-1"></a>    task.start()</span>
<span id="cb112-44"><a href="#cb112-44" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Started Task: &#39;</span>, i<span class="op">+</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="using-the-google-earth-engine-qgis-plugin"
class="section level2">
<h2>07. Using the Google Earth Engine QGIS Plugin</h2>
<p>The <a
href="https://gee-community.github.io/qgis-earthengine-plugin/">QGIS
Google Earth Engine plugin</a> allows GEE Python API code to be run from
QGIS and visualize the results directly in QGIS. This allows users to
integrate QGIS’s rich cartographic features with the cloud data
processing capabilities. After installing the plugin, you will be
prompted to authenticate to GEE using your credentials. Once
authenticated, you are able to run EE Python API code along with other
PyQGIS code within QGIS.</p>
<blockquote>
<p>If you get an authentication error, <a
href="https://courses.spatialthoughts.com/install-gee-python-api.html#authentication">follow
these instructions</a> to install the Python API client and run
<code>earthengine authenticate</code></p>
</blockquote>
<p>We will run a script that processes and visualizes a future climate
scenario using the <a
href="https://www.carbonbrief.org/cmip6-the-next-generation-of-climate-models-explained/">CMIP6
Climate Models</a>.</p>
<p>Open the QGIS Python Console from <strong>Plugins → Python
Console</strong> and click the <strong>Show Editor</strong> button.
Paste the following code and click the <strong>Run</strong> button. Once
the code runs, the resulting image computed by Earth Engine and will be
streamed to QGIS as a new layer.</p>
<p><img src="images/end_to_end_gee/ee_qgis1.png" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode py"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb113-2"><a href="#cb113-2" tabindex="-1"></a><span class="im">from</span> ee_plugin <span class="im">import</span> Map</span>
<span id="cb113-3"><a href="#cb113-3" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" tabindex="-1"></a><span class="co"># Use the CMIP6 Climate Projections Dataset</span></span>
<span id="cb113-5"><a href="#cb113-5" tabindex="-1"></a>cmip6 <span class="op">=</span> ee.ImageCollection(<span class="st">&#39;NASA/GDDP-CMIP6&#39;</span>)</span>
<span id="cb113-6"><a href="#cb113-6" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" tabindex="-1"></a><span class="co"># Select a model and a scenario</span></span>
<span id="cb113-8"><a href="#cb113-8" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" tabindex="-1"></a>model <span class="op">=</span> <span class="st">&#39;ACCESS-CM2&#39;</span></span>
<span id="cb113-10"><a href="#cb113-10" tabindex="-1"></a>scenario <span class="op">=</span> <span class="st">&#39;ssp245&#39;</span></span>
<span id="cb113-11"><a href="#cb113-11" tabindex="-1"></a></span>
<span id="cb113-12"><a href="#cb113-12" tabindex="-1"></a><span class="co"># Select the band</span></span>
<span id="cb113-13"><a href="#cb113-13" tabindex="-1"></a><span class="co"># Here we are using maximum air temperature</span></span>
<span id="cb113-14"><a href="#cb113-14" tabindex="-1"></a>band <span class="op">=</span> <span class="st">&#39;tasmax&#39;</span></span>
<span id="cb113-15"><a href="#cb113-15" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" tabindex="-1"></a><span class="co"># Select the date range</span></span>
<span id="cb113-17"><a href="#cb113-17" tabindex="-1"></a>startDate <span class="op">=</span> ee.Date.fromYMD(<span class="dv">2030</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb113-18"><a href="#cb113-18" tabindex="-1"></a>endDate <span class="op">=</span> startDate.advance(<span class="dv">1</span>, <span class="st">&#39;month&#39;</span>)</span>
<span id="cb113-19"><a href="#cb113-19" tabindex="-1"></a></span>
<span id="cb113-20"><a href="#cb113-20" tabindex="-1"></a>filtered <span class="op">=</span> cmip6 <span class="op">\</span></span>
<span id="cb113-21"><a href="#cb113-21" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.date(startDate, endDate)) <span class="op">\</span></span>
<span id="cb113-22"><a href="#cb113-22" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;model&#39;</span>, model)) <span class="op">\</span></span>
<span id="cb113-23"><a href="#cb113-23" tabindex="-1"></a>  .<span class="bu">filter</span>(ee.Filter.eq(<span class="st">&#39;scenario&#39;</span>, scenario)) <span class="op">\</span></span>
<span id="cb113-24"><a href="#cb113-24" tabindex="-1"></a>  .select(band)</span>
<span id="cb113-25"><a href="#cb113-25" tabindex="-1"></a></span>
<span id="cb113-26"><a href="#cb113-26" tabindex="-1"></a><span class="co"># Temperature values are in Kelvin</span></span>
<span id="cb113-27"><a href="#cb113-27" tabindex="-1"></a><span class="co"># convert to Celcius</span></span>
<span id="cb113-28"><a href="#cb113-28" tabindex="-1"></a></span>
<span id="cb113-29"><a href="#cb113-29" tabindex="-1"></a><span class="kw">def</span> scaleValues(image):</span>
<span id="cb113-30"><a href="#cb113-30" tabindex="-1"></a>  <span class="cf">return</span> image <span class="op">\</span></span>
<span id="cb113-31"><a href="#cb113-31" tabindex="-1"></a>    .subtract(<span class="fl">273.15</span>) <span class="op">\</span></span>
<span id="cb113-32"><a href="#cb113-32" tabindex="-1"></a>    .copyProperties(image,</span>
<span id="cb113-33"><a href="#cb113-33" tabindex="-1"></a>      [<span class="st">&#39;system:time_start&#39;</span>, <span class="st">&#39;model&#39;</span>, <span class="st">&#39;scenario&#39;</span>])</span>
<span id="cb113-34"><a href="#cb113-34" tabindex="-1"></a></span>
<span id="cb113-35"><a href="#cb113-35" tabindex="-1"></a>scaled <span class="op">=</span> filtered.<span class="bu">map</span>(scaleValues)</span>
<span id="cb113-36"><a href="#cb113-36" tabindex="-1"></a></span>
<span id="cb113-37"><a href="#cb113-37" tabindex="-1"></a><span class="co"># Calculate average daily maximum temperature</span></span>
<span id="cb113-38"><a href="#cb113-38" tabindex="-1"></a>mean <span class="op">=</span> scaled.mean()</span>
<span id="cb113-39"><a href="#cb113-39" tabindex="-1"></a></span>
<span id="cb113-40"><a href="#cb113-40" tabindex="-1"></a>tempVis <span class="op">=</span> {</span>
<span id="cb113-41"><a href="#cb113-41" tabindex="-1"></a>  <span class="st">&#39;min&#39;</span>: <span class="dv">10</span>,</span>
<span id="cb113-42"><a href="#cb113-42" tabindex="-1"></a>  <span class="st">&#39;max&#39;</span>: <span class="dv">40</span>,</span>
<span id="cb113-43"><a href="#cb113-43" tabindex="-1"></a>  <span class="st">&#39;palette&#39;</span>: [<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;purple&#39;</span>, <span class="st">&#39;cyan&#39;</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&#39;yellow&#39;</span>, <span class="st">&#39;red&#39;</span>],</span>
<span id="cb113-44"><a href="#cb113-44" tabindex="-1"></a>}</span>
<span id="cb113-45"><a href="#cb113-45" tabindex="-1"></a></span>
<span id="cb113-46"><a href="#cb113-46" tabindex="-1"></a>Map.addLayer(mean, tempVis, <span class="st">&#39;Average Daily Maximum Air Temperature&#39;</span>)</span></code></pre></div>
<p>You can now use this layer in your QGIS project or Print Layout.
Here’s an example of visualizing the layer on a custom globe using the
<a href="https://plugins.qgis.org/plugins/GlobeBuilder/">Globe Builder
Plugin</a>.</p>
<p><img src="images/end_to_end_gee/ee_qgis2.png" width="75%" style="display: block; margin: auto;" /></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="supplement" class="section level1">
<h1>Supplement</h1>
<p>We have a large collection of scripts that accompany this course.
Visit the <a
href="https://courses.spatialthoughts.com/end-to-end-gee-supplement.html">Supplement</a>.</p>
</div>
<div id="guided-projects" class="section level1">
<h1>Guided Projects</h1>
<p>Below are step-by-step video-based walkthrough of implementing
real-world projects using Earth Engine. You can continue their learning
journey by implementing these projects for their region of interest
after the class.</p>
<p><a
href="https://www.youtube.com/watch?v=uoOvOPK0iro&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=8"
target="_blank"><img
src="https://img.youtube.com/vi/uoOvOPK0iro/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=uoOvOPK0iro&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=8"
target="_blank">Watch the Video ↗</a></p>
<div id="get-the-code" class="section level2">
<h2>Get the Code</h2>
<ol style="list-style-type: decimal">
<li><a
href="https://code.earthengine.google.co.in/?accept_repo=users/ujavalgandhi/End-to-End-Projects">Click
this link</a> to open Google Earth Engine code editor and add the
repository to your account.</li>
<li>If successful, you will have a new repository named
<code>users/ujavalgandhi/End-to-End-Projects</code> in the
<em>Scripts</em> tab in the <em>Reader</em> section.</li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/projects.png" alt="Code Editor After Adding the Projects Repository" width="75%" />
<p class="caption">
Code Editor After Adding the Projects Repository
</p>
</div>
<p>If you do not see the repository in the <em>Reader</em> section,
click <em>Refresh repository cache</em> button in your <em>Scripts</em>
tab and it will show up.</p>
<div class="figure" style="text-align: center">
<img src="images/end_to_end_gee/repository_cache.png" alt="Refresh repository cache" width="50%" />
<p class="caption">
Refresh repository cache
</p>
</div>
</div>
<div id="project-1-calculating-rainfall-deviation"
class="section level2">
<h2>Project 1: Calculating Rainfall Deviation</h2>
<p>Calculating Rainfall Deviation from the 30-year mean using CHIRPS
Gridded Rainfall Data</p>
<p><a
href="https://www.youtube.com/watch?v=zHUCM3XLc6k&amp;list=PLppGmFLhQ1HJ5VhW6BZfhPX6spUcTY7SR"
target="_blank"><img
src="https://img.youtube.com/vi/zHUCM3XLc6k/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=zHUCM3XLc6k&amp;list=PLppGmFLhQ1HJ5VhW6BZfhPX6spUcTY7SR"
target="_blank">Watch the Video ↗</a></p>
</div>
<div id="project-2-flood-mapping" class="section level2">
<h2>Project 2: Flood Mapping</h2>
<p>Rapid mapping of a flood using Sentinel-1 SAR Data.</p>
<p><a
href="https://www.youtube.com/watch?v=jYsK9Y4ICrY&amp;list=PLppGmFLhQ1HJzzKVS_4v8nBiXLYxAu100"
target="_blank"><img
src="https://img.youtube.com/vi/jYsK9Y4ICrY/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=jYsK9Y4ICrY&amp;list=PLppGmFLhQ1HJzzKVS_4v8nBiXLYxAu100"
target="_blank">Watch the Video ↗</a></p>
</div>
<div id="project-3-extracting-time-series" class="section level2">
<h2>Project 3: Extracting Time-Series</h2>
<p>Extracting a 10-year NDVI time-series over multiple polygons using
MODIS data.</p>
<p><a
href="https://www.youtube.com/watch?v=LqSClCXrMl4&amp;list=PLppGmFLhQ1HJV1CctqanQvXQI1JmqGDDD"
target="_blank"><img
src="https://img.youtube.com/vi/LqSClCXrMl4/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=LqSClCXrMl4&amp;list=PLppGmFLhQ1HJV1CctqanQvXQI1JmqGDDD"
target="_blank">Watch the Video ↗</a></p>
</div>
<div id="project-4-landcover-analysis" class="section level2">
<h2>Project 4: LandCover Analysis</h2>
<p>Use existing land cover products to extract specific classes and
compute statistics across many regions.</p>
<p><a
href="https://www.youtube.com/watch?v=B0E_dzO1J4g&amp;list=PLppGmFLhQ1HLl0St2wiOPePr58sKu0Vh1"
target="_blank"><img
src="https://img.youtube.com/vi/B0E_dzO1J4g/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=B0E_dzO1J4g&amp;list=PLppGmFLhQ1HLl0St2wiOPePr58sKu0Vh1"
target="_blank">Watch the Video ↗</a></p>
</div>
<div id="project-5-extracting-nighttime-lights-statistics"
class="section level2">
<h2>Project 5: Extracting Nighttime Lights Statistics</h2>
<p>Calculate the sum of Nighttime Lights (NTL) for urban and agriculture
land use in each Admin1 region in a country for each year from
2013-2021.</p>
<p><a
href="https://www.youtube.com/watch?v=_c-_UU9J6s0&amp;list=PLppGmFLhQ1HLN6ivbJJHLZbEYLdq5zgns"
target="_blank"><img
src="https://img.youtube.com/vi/_c-_UU9J6s0/mqdefault.jpg"
alt="Watch the Video" /></a></p>
<p><a
href="https://www.youtube.com/watch?v=_c-_UU9J6s0&amp;list=PLppGmFLhQ1HLN6ivbJJHLZbEYLdq5zgns"
target="_blank">Watch the Video ↗</a></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="learning-resources" class="section level1">
<h1>Learning Resources</h1>
<ul>
<li><a href="https://www.eefabook.org/">Cloud-Based Remote Sensing with
Google Earth Engine: Fundamentals and Applications</a>: A free and
open-access book with 55-chapters covering fundamentals and applications
of GEE. Also includes YouTube videos summarizing each chapter.</li>
<li><a href="https://github.com/giswqs/Awesome-GEE">Awesome Earth
Engine</a>: A curated list of Google Earth Engine resources.</li>
<li><a
href="https://courses.spatialthoughts.com/gee-water-resources-management.html">Google
Earth Engine for Water Resources Management</a>: Application-focused
Introduction to Google Earth Engine.</li>
<li><a
href="https://courses.spatialthoughts.com/gee-charts.html">Creating
Publication Quality Charts with GEE</a>: A comprehesive guide on
creating high-quality data visualizations with Google Earth Engine and
Google Charts.</li>
</ul>
</div>
<div id="useful-public-repositories" class="section level1">
<h1>Useful Public Repositories</h1>
<p>Please visit <a href="https://github.com/giswqs/Awesome-GEE">Awesome
Earth Engine</a> to see a curated list of Google Earth Engine
resources.</p>
<p>We also have a few recommendations of a few selected packages, which
have very useful functions to make you productive in Earth Engine.</p>
<p><strong>General Purpose Packages</strong></p>
<ul>
<li><a
href="https://github.com/gee-community/ee-packages-py">eepackages</a>: A
set of Google Earth Engine utilities by maintained by Gennadii Donchyts
for both Javascript and Python API.</li>
<li><a
href="https://github.com/fitoprincipe/geetools-code-editor/wiki">geetools</a>:
Tools for cloud masking, batch processing, and more</li>
<li><a
href="https://github.com/gee-community/ee-palettes">ee-palettes</a>:
Module for generating color palettes</li>
<li><a
href="https://github.com/awesome-spectral-indices/spectral">spectral</a>:
A javascript module that provides ready-to-use curated list of spectral
indices for GEE.</li>
<li><a href="https://github.com/davemlz/eemont">eemont</a>: Python
package that provides utility methods to create a more fluid code by
being friendly with the Python method chaining.</li>
</ul>
<p><strong>Application Specific Packages</strong></p>
<ul>
<li><a
href="https://github.com/rfernand387/LEAF-Toolbox/wiki">LEAF-Toolbox</a>:
Google Earth Engine application that produces various Vegetation
Biophysical Products, including Leaf Area Index (LAI).</li>
<li><a
href="https://github.com/seanyx/RivWidthCloudPaper">RivWidthCloud</a>:
Package to automate extracting river centerline and width for both
Javascript and Python API.</li>
</ul>
</div>
<div id="debugging-errors-and-scaling-your-analysis"
class="section level1">
<h1>Debugging Errors and Scaling Your Analysis</h1>
<p>As you start implementing more complex workflows and analyze large
regions - you are bound to run into scaling issues and errors such as
below:</p>
<ul>
<li><em>User memory-limit exceeded</em></li>
<li><em>Computation timed-out</em></li>
<li><em>Computed value is too large</em></li>
</ul>
<p>These are usually the result of inefficient code and structure of
your script. Below are my recommendations for improving your coding
style and utilizing the full power of the Earth Engine
infrastructure.</p>
<ul>
<li>If/else statements and for-loops should be avoided completely and
replaced with filter/map/reduce. The former are sequential and will be
slow. Refer to the <a
href="https://developers.google.com/earth-engine/tutorials/tutorial_js_03">Function
Programming Concepts</a> guide on how to restructure your code to
utilize the parallel computing infratructure provided by GEE.</li>
<li>Remove any reprojection or resampling calls fro your script. Barring
a few exceptions, you should not be reprojecting or resampling data.
Earth Engine is designed to take care of it internally.</li>
<li>For complex analysis involving large volumes of data, you should
break down your workflow into logical steps and export intermediate
results. For example, if you are implementing a complex supervised
classification workflow - do it in multiple stages. A) Create your
composite, add required bands, normalize them and export it as an Asset.
B) Import the exported composite into another script and train a
classifier. Export the classified image as an Asset. C) Import the
exported classified image and do accuracy assessment and visualize the
results. You will be able to run your analysis much faster, experiment
easily and avoid scaling errors. Refer to the <a
href="https://developers.google.com/earth-engine/guides/best_practices?hl=en#export_intermediate_results">Export
Intermediate Result</a> guide to learn more.</li>
<li>You may also break your export region into smaller regions
(typically by admin units) and Export each region separately. For
example, if you want to export results for an entire country at 30m
resolution - rather than a running a large Export - you can export each
Admin1 unit in your country separately. This helps with computation
timed-out errors and improves overall processing time. You can start as
many exports from your account as you want and they will be executed in
a queue. But do not split your exports over multiple Earth Engine
accounts. This is a <a
href="https://developers.google.com/earth-engine/batch-task-restrictions">violation
of GEE Terms of Service</a> and may result in your account getting
blocked.</li>
</ul>
<p>The Earth Engine User Guide also has tips and examples of best
practices. You can review the following articles to learn them.</p>
<ul>
<li><a
href="https://developers.google.com/earth-engine/guides/best_practices?hl=en">Coding
Best Practices</a></li>
<li><a
href="https://developers.google.com/earth-engine/guides/debugging?hl=en">Debugging
Guide</a></li>
</ul>
<p>The following videos are highly recommended and contain good advice
on debugging and scaling workflows.</p>
<p><a href="https://www.youtube.com/watch?v=3AtnpkZTvnk"
target="_blank"><img
src="https://img.youtube.com/vi/3AtnpkZTvnk/mqdefault.jpg"
alt="Earth Engine Scaling and Debugging" /></a></p>
<p><a href="https://www.youtube.com/watch?v=3AtnpkZTvnk"
target="_blank">Watch the Video ↗</a></p>
<p><a href="https://www.youtube.com/watch?v=fsez4HiOc8k"
target="_blank"><img
src="https://img.youtube.com/vi/fsez4HiOc8k/mqdefault.jpg"
alt="Using Earth Engine for Very Large Computations" /></a></p>
<p><a href="https://www.youtube.com/watch?v=fsez4HiOc8k"
target="_blank">Watch the Video ↗</a></p>
<div style="page-break-after: always;"></div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li><strong>Sentinel-2 Level-1C, Level-2A</strong> and
<strong>Sentinel-1 SAR GRD</strong>: Contains Copernicus Sentinel
data.</li>
<li><strong>TerraClimate: Monthly Climate and Climatic Water Balance for
Global Terrestrial Surfaces, University of Idaho</strong>: Abatzoglou,
J.T., S.Z. Dobrowski, S.A. Parks, K.C. Hegewisch, 2018, Terraclimate, a
high-resolution global dataset of monthly climate and climatic water
balance from 1958-2015, Scientific Data 5:170191, <a
href="doi:10.1038/sdata.2017.191"
class="uri">doi:10.1038/sdata.2017.191</a></li>
<li><strong>VIIRS Stray Light Corrected Nighttime Day/Night Band
Composites Version 1</strong>: C. D. Elvidge, K. E. Baugh, M. Zhizhin,
and F.-C. Hsu, “Why VIIRS data are superior to DMSP for mapping
nighttime lights,” Asia-Pacific Advanced Network 35, vol. 35, p. 62,
2013.</li>
<li><strong>FAO GAUL 500m: Global Administrative Unit Layers 2015,
Second-Level Administrative Units</strong>: Source of Administrative
boundaries: The Global Administrative Unit Layers (GAUL) dataset,
implemented by FAO within the CountrySTAT and Agricultural Market
Information System (AMIS) projects.</li>
<li><strong>CHIRPS Pentad: Climate Hazards Group InfraRed Precipitation
with Station Data (version 2.0 final)</strong>: Funk, Chris, Pete
Peterson, Martin Landsfeld, Diego Pedreros, James Verdin, Shraddhanand
Shukla, Gregory Husak, James Rowland, Laura Harrison, Andrew Hoell &amp;
Joel Michaelsen. “The climate hazards infrared precipitation with
stations—a new environmental record for monitoring extremes”. Scientific
Data 2, 150066. <a href="doi:10.1038/sdata.2015.66"
class="uri">doi:10.1038/sdata.2015.66</a> 2015.</li>
<li><strong>MOD13Q1.006 Terra Vegetation Indices 16-Day Global
250m</strong>: Didan, K. (2015). <i>MOD13Q1 MODIS/Terra Vegetation
Indices 16-Day L3 Global 250m SIN Grid V006</i> [Data set]. NASA EOSDIS
Land Processes DAAC. Accessed 2021-05-06 from <a
href="https://doi.org/10.5067/MODIS/MOD13Q1.006"
class="uri">https://doi.org/10.5067/MODIS/MOD13Q1.006</a></li>
<li><strong>GHS Urban Centre Database 2015 multitemporal and
multidimensional attributes R2019A</strong>: Florczyk A., Corbane C,.
Schiavina M., Pesaresi M., Maffenini L., Melchiorri, M., Politis P.,
Sabo F., Freire S., Ehrlich D., Kemper T., Tommasi P., Airaghi D.,
Zanchetta L. (2019) European Commission, Joint Research Centre (JRC) <a
href="https://data.jrc.ec.europa.eu/dataset/53473144-b88c-44bc-b4a3-4583ed1f547e">PID</a></li>
<li><strong>ESA WorldCover v100</strong>: Zanaga, D., Van De Kerchove,
R., De Keersmaecker, W., Souverijns, N., Brockmann, C., Quast, R.,
Wevers, J., Grosu, A., Paccini, A., Vergnaud, S., Cartus, O., Santoro,
M., Fritz, S., Georgieva, I., Lesiv, M., Carter, S., Herold, M., Li,
Linlin, Tsendbazar, N.E., Ramoino, F., Arino, O., 2021. ESA WorldCover
10 m 2020 v100. <a
href="https://doi.org/10.5281/zenodo.5571936">doi:10.5281/zenodo.5571936</a></li>
</ul>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<div id="composites" class="section level2">
<h2>Composites</h2>
<ul>
<li>Phan, T.N.; Kuch, V.; Lehnert, L.W. Land Cover Classification using
Google Earth Engine and Random Forest Classifier—The Role of Image
Composition. Remote Sens. 2020, 12, 2411. <a
href="https://doi.org/10.3390/rs12152411"
class="uri">https://doi.org/10.3390/rs12152411</a></li>
<li>D. Simonetti, U. Pimple, A. Langner, A. Marelli, Pan-tropical
Sentinel-2 cloud-free annual composite datasets, Data in Brief, Volume
39, 2021, 107488, ISSN 2352-3409,<a
href="https://doi.org/10.1016/j.dib.2021.107488"
class="uri">https://doi.org/10.1016/j.dib.2021.107488</a>.</li>
</ul>
</div>
<div id="supervised-classification" class="section level2">
<h2>Supervised Classification</h2>
<ul>
<li>Shetty, S.; Gupta, P.K.; Belgiu, M.; Srivastav, S.K. Assessing the
Effect of Training Sampling Design on the Performance of Machine
Learning Classifiers for Land Cover Mapping Using Multi-Temporal Remote
Sensing Data and Google Earth Engine. Remote Sens. 2021, 13, 1433. <a
href="https://doi.org/10.3390/rs13081433"
class="uri">https://doi.org/10.3390/rs13081433</a></li>
<li>Kelley, L.C.; Pitcher, L.; Bacon, C. Using Google Earth Engine to
Map Complex Shade-Grown Coffee Landscapes in Northern Nicaragua. Remote
Sens. 2018, 10, 952. <a href="https://doi.org/10.3390/rs10060952"
class="uri">https://doi.org/10.3390/rs10060952</a></li>
<li>Arsalan Ghorbanian, Mohammad Kakooei, Meisam Amani, Sahel Mahdavi,
Ali Mohammadzadeh, Mahdi Hasanlou, Improved land cover map of Iran using
Sentinel imagery within Google Earth Engine and a novel automatic
workflow for land cover classification using migrated training samples,
ISPRS Journal of Photogrammetry and Remote Sensing, Volume 167, 2020, <a
href="https://doi.org/10.1016/j.isprsjprs.2020.07.013"
class="uri">https://doi.org/10.1016/j.isprsjprs.2020.07.013</a></li>
<li>Tassi, A.; Vizzari, M. Object-Oriented LULC Classification in Google
Earth Engine Combining SNIC, GLCM, and Machine Learning Algorithms.
Remote Sens. 2020, 12, 3776. <a
href="https://doi.org/10.3390/rs12223776"
class="uri">https://doi.org/10.3390/rs12223776</a></li>
<li>Cristina Gómez, Joanne C. White, Michael A. Wulder, Optical remotely
sensed time series data for land cover classification: A review, ISPRS
Journal of Photogrammetry and Remote Sensing, Volume 116, 2016, Pages
55-72, ISSN 0924-2716, <a
href="https://doi.org/10.1016/j.isprsjprs.2016.03.008"
class="uri">https://doi.org/10.1016/j.isprsjprs.2016.03.008</a></li>
<li>Sherrie Wang, George Azzari, David B. Lobell, Crop type mapping
without field-level labels: Random forest transfer and unsupervised
clustering techniques, Remote Sensing of Environment, Volume 222, 2019,
Pages 303-317, ISSN 0034-4257, <a
href="https://doi.org/10.1016/j.rse.2018.12.026"
class="uri">https://doi.org/10.1016/j.rse.2018.12.026</a></li>
</ul>
</div>
<div id="time-series-classification" class="section level2">
<h2>Time-Series Classification</h2>
<ul>
<li>Cristina Gómez, Joanne C. White, Michael A. Wulder, Optical remotely
sensed time series data for land cover classification: A review, ISPRS
Journal of Photogrammetry and Remote Sensing, Volume 116, 2016, Pages
55-72, <a href="https://doi.org/10.1016/j.isprsjprs.2016.03.008"
class="uri">https://doi.org/10.1016/j.isprsjprs.2016.03.008</a></li>
<li>Arsalan Ghorbanian, Mohammad Kakooei, Meisam Amani, Sahel Mahdavi,
Ali Mohammadzadeh, Mahdi Hasanlou, Improved land cover map of Iran using
Sentinel imagery within Google Earth Engine and a novel automatic
workflow for land cover classification using migrated training samples,
ISPRS Journal of Photogrammetry and Remote Sensing, Volume 167, 2020, <a
href="https://doi.org/10.1016/j.isprsjprs.2020.07.013"
class="uri">https://doi.org/10.1016/j.isprsjprs.2020.07.013</a></li>
<li>Souza, C.M., Jr.; Z. Shimbo, J.; Rosa, M.R.; Parente, L.L.; A.
Alencar, A.; Rudorff, B.F.T.; Hasenack, H.; Matsumoto, M.; G. Ferreira,
L.; Souza-Filho, P.W.M.; et al. Reconstructing Three Decades of Land Use
and Land Cover Changes in Brazilian Biomes with Landsat Archive and
Earth Engine. Remote Sens. 2020, 12, 2735. <a
href="https://doi.org/10.3390/rs12172735"
class="uri">https://doi.org/10.3390/rs12172735</a></li>
</ul>
</div>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>The course material (text, images, presentation, videos) is licensed
under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution 4.0 International License</a>.</p>
<p>The code (scripts, Jupyter notebooks) is licensed under the MIT
License. For a copy, see <a href="https://opensource.org/licenses/MIT"
class="uri">https://opensource.org/licenses/MIT</a></p>
<p>Kindly give appropriate credit to the original author as below:</p>
<p>Copyright © 2022 Ujaval Gandhi <a
href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
</div>
<div id="citing-and-referencing" class="section level1">
<h1>Citing and Referencing</h1>
<p>You can cite the course materials as follows</p>
<ul>
<li>Gandhi, Ujaval, 2021. <em>End-to-End Google Earth Engine</em>
Course. Spatial Thoughts. <a
href="https://courses.spatialthoughts.com/end-to-end-gee.html"
class="uri">https://courses.spatialthoughts.com/end-to-end-gee.html</a></li>
</ul>
<hr />
<p><strong>This course is offered as an instructor-led online class.
Visit <a href="https://spatialthoughts.com/events/">Spatial Thoughts</a>
to know details of upcoming sessions.</strong></p>
</div>

<!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to report any issues with this page, please comment below.</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/courses"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
