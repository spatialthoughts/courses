<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Building Your First QGIS Plugin (Full workshop)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDGF11RK4Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PDGF11RK4Z');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Building Your First QGIS Plugin (Full
workshop)</h1>
<h3 class="subtitle">Learn the basics of the QGIS plugin architecture
and create your first functional plugin.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#installation-and-setting-up-the-environment"
id="toc-installation-and-setting-up-the-environment">Installation and
Setting up the Environment</a>
<ul>
<li><a href="#install-qgis" id="toc-install-qgis">Install QGIS</a></li>
<li><a href="#get-a-text-editor" id="toc-get-a-text-editor">Get a Text
Editor</a></li>
</ul></li>
<li><a href="#building-a-plugin" id="toc-building-a-plugin">Building a
Plugin</a>
<ul>
<li><a href="#create-a-minimal-plugin"
id="toc-create-a-minimal-plugin">1. Create a Minimal Plugin</a></li>
<li><a href="#add-core-functionality" id="toc-add-core-functionality">2.
Add Core Functionality</a></li>
<li><a href="#add-user-interface" id="toc-add-user-interface">3. Add
User Interface</a></li>
<li><a href="#package-and-share-your-plugin"
id="toc-package-and-share-your-plugin">4. Package and Share Your
Plugin</a></li>
</ul></li>
<li><a href="#what-next" id="toc-what-next">What next?</a></li>
<li><a href="#license" id="toc-license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This workshop is designed to help you take your first steps in
building QGIS plugins. We will understand the QGIS plugin architecture
and see how you can package your code and distribute it as a plugin.</p>
<p><a
href="https://docs.google.com/presentation/d/1NKTXASOgu8GFTWKkQpPbGDVRwDcyzRSdVwCg0772dTI/edit?usp=sharing"
target="_blank"><img src="images/qgis_plugin_workshop/introduction.png"
width="400" alt="View Presentation" /></a></p>
<p><a
href="https://docs.google.com/presentation/d/1NKTXASOgu8GFTWKkQpPbGDVRwDcyzRSdVwCg0772dTI/edit?usp=sharing"
target="_blank">View the Presentation ↗</a></p>
</div>
<div id="installation-and-setting-up-the-environment"
class="section level1">
<h1>Installation and Setting up the Environment</h1>
<div id="install-qgis" class="section level2">
<h2>Install QGIS</h2>
<p>This workshop requires QGIS LTR version 3.34. Please review <a
href="install-qgis-ltr.html">QGIS-LTR Installation Guide</a> for
step-by-step instructions.</p>
</div>
<div id="get-a-text-editor" class="section level2">
<h2>Get a Text Editor</h2>
<p>Any kind of software development requires a good text editor. If you
already have a favorite text editor or an IDE (Integrated Development
Environment), you may use it for this workshop. Otherwise, each platform
offers a wide variety of free or paid options for text editors. Choose
the one that fits your needs.</p>
<p>Below are my recommendations editors that are simple to use for
beginners.</p>
<ul>
<li>Windows: <a
href="https://notepad-plus-plus.org/downloads/">Notepad++</a> is a good
free editor for windows. Download and install the Notepad++ editor. Tip:
Before writing Python code in Notepad+++, make sure to go to Settings →
Preferences → Language and enable <code>Replace by space</code>. Python
is very sensitive about whitespace and this setting will ensure tabs and
spaces are treated properly.</li>
<li>Mac: <a href="https://macromates.com/">TextMate</a> is an
open-source editor for Mac that is currently available for free.</li>
</ul>
</div>
</div>
<div id="building-a-plugin" class="section level1">
<h1>Building a Plugin</h1>
<p>The workshop will teach you how to build a plugin named
<strong>Basemap Loader</strong> that adds a toolbar to QGIS allowing you
to pick and easily load your favorite basemaps.</p>
<div class="figure" style="text-align: center">
<img src="images/qgis_plugin_workshop/basemap_loader.gif" alt="The Basemap Loader Plugin" width="75%" />
<p class="caption">
The Basemap Loader Plugin
</p>
</div>
<div id="create-a-minimal-plugin" class="section level2">
<h2>1. Create a Minimal Plugin</h2>
<p>We will now build a simple plugin named <strong>Basemap
Loader</strong> that adds a button in the <em>Plugin Toolbar</em> that
loads a basemap from OpenStreetMap to the current project. To understand
the required structure, let’s see what a minimal plugin looks like. You
can learn more about this structure at <a
href="https://github.com/wonder-sk/qgis-minimal-plugin">QGIS Minimalist
Plugin Skeleton</a>.</p>
<ol style="list-style-type: decimal">
<li>The first requirement for plugins is a file called
<code>metadata.txt</code>. This file contains general info, version,
name and some other metadata used by plugins website and plugin
manager.</li>
</ol>
<p><code>metadata.txt</code></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>[general]</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>name<span class="op">=</span>Basemap Loader</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>description<span class="op">=</span>This plugin adds a basemap layer to QGIS.</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>version<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>qgisMinimumVersion<span class="op">=</span><span class="fl">3.0</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>author<span class="op">=</span>Ujaval Gandhi</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>email<span class="op">=</span>ujaval<span class="op">@</span>spatialthoughts.com</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>icon<span class="op">=</span>logo.png</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Second is the file that contains the main logic of the plugin. It
must have <code>__init__()</code> method that gives the plugin access to
the QGIS Interface (iface). The <code>initGui()</code> method is called
when the plugin is loaded and <code>unload()</code> method which is
called when the plugin is unloaded. For now, we are creating a minimal
plugin that just add a button and a menu entry that displays message
when clicked.</li>
</ol>
<p><code>main.py</code></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">from</span> PyQt5.QtWidgets <span class="im">import</span> QAction</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="im">from</span> PyQt5.QtGui <span class="im">import</span> QIcon</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>cmd_folder <span class="op">=</span> os.path.split(inspect.getfile(inspect.currentframe()))[<span class="dv">0</span>]</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="kw">class</span> BasemapLoaderPlugin:</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, iface):</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>        <span class="va">self</span>.iface <span class="op">=</span> iface</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="kw">def</span> initGui(<span class="va">self</span>):</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>        icon <span class="op">=</span> os.path.join(os.path.join(cmd_folder, <span class="st">&#39;logo.png&#39;</span>))</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>        <span class="va">self</span>.action <span class="op">=</span> QAction(QIcon(icon), <span class="st">&#39;Load Basemap&#39;</span>, <span class="va">self</span>.iface.mainWindow())</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>        <span class="va">self</span>.iface.addToolBarIcon(<span class="va">self</span>.action)</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>        <span class="va">self</span>.action.triggered.<span class="ex">connect</span>(<span class="va">self</span>.run)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>      </span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="kw">def</span> unload(<span class="va">self</span>):</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>        <span class="va">self</span>.iface.removeToolBarIcon(<span class="va">self</span>.action)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>        <span class="kw">del</span> <span class="va">self</span>.action</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>        </span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>        <span class="va">self</span>.iface.messageBar().pushMessage(<span class="st">&#39;Hello from Plugin&#39;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Third file is called <code>__init__.py</code> which is the starting
point of the plugin. It imports the plugin class created in the second
file and creates an instance of it.</li>
</ol>
<p><code>__init__.py</code></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> .main <span class="im">import</span> BasemapLoaderPlugin</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">def</span> classFactory(iface):</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="cf">return</span> BasemapLoaderPlugin(iface)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Create these 3 files and put them in a folder named
<code>basemap_loader</code>. Download the <a
href="https://courses.spatialthoughts.com/images/qgis_plugin_workshop/logo.png">logo.png</a>
file and copy to this folder.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/pluginbasemapfiles.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Next we need to copy the folder to the appropriate directory so QGIS
loads it at startup. Open your profile folder by going to
<strong>Settings → User Profiles → Open Active Profile
Folder</strong></li>
</ol>
<p><img src="images/qgis_plugin_workshop/active_profile_folder1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Locate the python plugins directory at
<code>{profile folder}/python/plugins</code>. Copy the entire folder to
this directory.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/active_profile_folder2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Restart QGIS. Go to <strong>Plugins → Manage and Install plugins… →
Installed</strong> and enable the <strong>Basemap Loader</strong>
plugin.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/enable_plugin.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>You will the toolbar icon from the plugin. Click on the button and
the <em>Hello from Plugin</em> message is displayed.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/pluginbasemaphello.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="add-core-functionality" class="section level2">
<h2>2. Add Core Functionality</h2>
<p>Now let’s build on the basic plugin structure and add the
functionality to load a XYZ Tile Layer when the button is clicked. We
will be using the <a
href="https://wiki.openstreetmap.org/wiki/Raster_tile_providers#Base_maps">OpenStreetMap
Standard</a> XYZ layer. The PyQGIS code to load a XYZ tile layer is
adapted from the <a
href="https://docs.qgis.org/3.34/en/docs/pyqgis_developer_cookbook/cheat_sheet.html">PyQGIS
Cookbook</a>.</p>
<ol style="list-style-type: decimal">
<li>Modify the <code>main.py</code> file with the content from
below.</li>
</ol>
<p><code>main.py</code></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="im">from</span> PyQt5.QtWidgets <span class="im">import</span> QAction</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="im">from</span> PyQt5.QtGui <span class="im">import</span> QIcon</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="im">from</span> qgis.core <span class="im">import</span> QgsRasterLayer, QgsProject, QgsCoordinateReferenceSystem</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>cmd_folder <span class="op">=</span> os.path.split(inspect.getfile(inspect.currentframe()))[<span class="dv">0</span>]</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="kw">class</span> BasemapLoaderPlugin:</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, iface):</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>        <span class="va">self</span>.iface <span class="op">=</span> iface</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="kw">def</span> initGui(<span class="va">self</span>):</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>        icon <span class="op">=</span> os.path.join(os.path.join(cmd_folder, <span class="st">&#39;logo.png&#39;</span>))</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>        <span class="va">self</span>.action <span class="op">=</span> QAction(QIcon(icon), <span class="st">&#39;Load Basemap&#39;</span>, <span class="va">self</span>.iface.mainWindow())</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>        <span class="va">self</span>.iface.addToolBarIcon(<span class="va">self</span>.action)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>        <span class="va">self</span>.action.triggered.<span class="ex">connect</span>(<span class="va">self</span>.run)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>      </span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>    <span class="kw">def</span> unload(<span class="va">self</span>):</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>        <span class="va">self</span>.iface.removeToolBarIcon(<span class="va">self</span>.action)</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>        <span class="kw">del</span> <span class="va">self</span>.action</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>        basemap_url <span class="op">=</span> <span class="st">&#39;https://tile.openstreetmap.org/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png&#39;</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>        zmin <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>        zmax <span class="op">=</span> <span class="dv">19</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>        crs <span class="op">=</span> <span class="st">&#39;EPSG:3857&#39;</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>        </span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>        uri <span class="op">=</span> <span class="ss">f&#39;type=xyz&amp;url=</span><span class="sc">{</span>basemap_url<span class="sc">}</span><span class="ss">&amp;zmax=</span><span class="sc">{</span>zmax<span class="sc">}</span><span class="ss">&amp;zmin=</span><span class="sc">{</span>zmin<span class="sc">}</span><span class="ss">$crs=</span><span class="sc">{</span>crs<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>        rlayer <span class="op">=</span> QgsRasterLayer(uri, <span class="st">&#39;OpenStreetMap&#39;</span>, <span class="st">&#39;wms&#39;</span>)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>        <span class="cf">if</span> rlayer.isValid():</span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>            QgsProject.instance().addMapLayer(rlayer)</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>            <span class="va">self</span>.iface.messageBar().pushSuccess(<span class="st">&#39;Success&#39;</span>, <span class="st">&#39;Basemap Layer Loaded&#39;</span>)</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>            <span class="va">self</span>.iface.messageBar().pushCritical(<span class="st">&#39;Error&#39;</span>, <span class="st">&#39;Invalid Basemap Layer&#39;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>To see the result of our changes, we must restart QGIS. This can be
quite tedious while developing plugins, so there is a handy plugin named
<strong>Plugin Reloader</strong> that can reload a selected plugin
without having to restart QGIS. Go to <strong>Plugins → Manage and
Install plugins… → All</strong> and search for the plugin named
<strong>Plugin Reloader</strong>. Click <em>Install Plugin</em>. Once
the plugin is installed, locate the <em>Configure</em> button from the
<em>Plugin Toolbar</em> and select the <strong>Basemap Loader</strong>
plugin. Click <em>Reload</em> to reload the plugin.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/pluginbasemapreload.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Once reloaded, click the <em>Load Basemap</em> button from the
toolbar and you will see the basemap layer loaded in QGIS.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/pluginbasemapcomplete.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="add-user-interface" class="section level2">
<h2>3. Add User Interface</h2>
<p>We will now add some user-interface widget to the plugin. Instead of
a button that loads a single basemap, we can build a toolbar that has a
drop-down menu of many options that the user can pick from and load the
basemap.</p>
<p>For a comprehensive list of basemap tile-services and their URLs, you
can see the <a
href="https://contextily.readthedocs.io/en/latest/providers_deepdive.html">Contextily
Providers</a> page.</p>
<ol style="list-style-type: decimal">
<li>Modify the <code>main.py</code> file with the content from
below.</li>
</ol>
<p><code>main.py</code></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="im">from</span> PyQt5.QtWidgets <span class="im">import</span> QAction, QComboBox, QLabel, QPushButton</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="im">from</span> PyQt5.QtGui <span class="im">import</span> QIcon</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="im">from</span> qgis.core <span class="im">import</span> QgsRasterLayer, QgsProject, QgsCoordinateReferenceSystem</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>cmd_folder <span class="op">=</span> os.path.split(inspect.getfile(inspect.currentframe()))[<span class="dv">0</span>]</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># We create a dictionary of all the basemaps and their URLs to be used</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>osm <span class="op">=</span> <span class="st">&#39;https://tile.openstreetmap.org/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png&#39;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>cartodb_darkmatter <span class="op">=</span> <span class="st">&#39;https://a.basemaps.cartocdn.com/dark_all/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png&#39;</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>cartodb_positron <span class="op">=</span> <span class="st">&#39;https://a.basemaps.cartocdn.com/light_all/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">.png&#39;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>esri_shaded_relief <span class="op">=</span> <span class="st">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/&#39;</span> \</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    <span class="st">&#39;World_Street_Map/MapServer/tile/</span><span class="sc">{z}</span><span class="st">/</span><span class="sc">{y}</span><span class="st">/</span><span class="sc">{x}</span><span class="st">&#39;</span> </span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>BASEMAPS <span class="op">=</span> {</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    <span class="st">&#39;OpenStreetMap&#39;</span>: osm,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    <span class="st">&#39;CartoDB DarkMatter&#39;</span>: cartodb_darkmatter,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    <span class="st">&#39;CartoDB Positron&#39;</span>: cartodb_positron,</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>    <span class="st">&#39;Esri World Shaded Relief&#39;</span>: esri_shaded_relief</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>}</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="kw">class</span> BasemapLoaderPlugin:</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, iface):</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>        <span class="va">self</span>.iface <span class="op">=</span> iface</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>    <span class="kw">def</span> initGui(<span class="va">self</span>):</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>        <span class="co"># Create a Toolbar</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>        <span class="va">self</span>.basemapToolbar <span class="op">=</span> <span class="va">self</span>.iface.addToolBar(<span class="st">&#39;Basemap Selector&#39;</span>)</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>        </span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>        <span class="co"># Create an Action with Logo</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>        icon <span class="op">=</span> os.path.join(os.path.join(cmd_folder, <span class="st">&#39;logo.png&#39;</span>))</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>        <span class="va">self</span>.action <span class="op">=</span> QAction(QIcon(icon), <span class="st">&#39;Load Basemap&#39;</span>, <span class="va">self</span>.basemapToolbar)</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>        </span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>        <span class="co"># Create a label</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>        <span class="va">self</span>.label <span class="op">=</span> QLabel(<span class="st">&#39;Select a basemap&#39;</span>, parent<span class="op">=</span><span class="va">self</span>.basemapToolbar)</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>        <span class="co"># Create a dropdown menu</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>        <span class="va">self</span>.basemapSelector <span class="op">=</span> QComboBox(parent<span class="op">=</span><span class="va">self</span>.basemapToolbar)</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>        <span class="va">self</span>.basemapSelector.setFixedWidth(<span class="dv">150</span>)</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>        <span class="co"># Populate it with names of all the basemaps</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>        <span class="cf">for</span> basemap_name <span class="kw">in</span> BASEMAPS.keys():</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>            <span class="va">self</span>.basemapSelector.addItem(basemap_name)</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>            </span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>        <span class="co"># Add all the widgets to the toolbar</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>        <span class="va">self</span>.basemapToolbar.addWidget(<span class="va">self</span>.label)</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a>        <span class="va">self</span>.basemapToolbar.addWidget(<span class="va">self</span>.basemapSelector)</span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>        <span class="va">self</span>.basemapToolbar.addAction(<span class="va">self</span>.action)</span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a>      </span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>        <span class="co"># Connect the run() method to the action</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>        <span class="va">self</span>.action.triggered.<span class="ex">connect</span>(<span class="va">self</span>.run)</span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a>      </span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a>    <span class="kw">def</span> unload(<span class="va">self</span>):</span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a>        <span class="kw">del</span> <span class="va">self</span>.basemapToolbar</span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a>        selected_basemap <span class="op">=</span> <span class="va">self</span>.basemapSelector.currentText()</span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a>        basemap_url <span class="op">=</span> BASEMAPS[selected_basemap]</span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a>        zmin <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a>        zmax <span class="op">=</span> <span class="dv">19</span></span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a>        crs <span class="op">=</span> <span class="st">&#39;EPSG:3857&#39;</span></span>
<span id="cb5-62"><a href="#cb5-62" tabindex="-1"></a>        </span>
<span id="cb5-63"><a href="#cb5-63" tabindex="-1"></a>        uri <span class="op">=</span> <span class="ss">f&#39;type=xyz&amp;url=</span><span class="sc">{</span>basemap_url<span class="sc">}</span><span class="ss">&amp;zmax=</span><span class="sc">{</span>zmax<span class="sc">}</span><span class="ss">&amp;zmin=</span><span class="sc">{</span>zmin<span class="sc">}</span><span class="ss">$crs=</span><span class="sc">{</span>crs<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb5-64"><a href="#cb5-64" tabindex="-1"></a>        rlayer <span class="op">=</span> QgsRasterLayer(uri, selected_basemap, <span class="st">&#39;wms&#39;</span>)</span>
<span id="cb5-65"><a href="#cb5-65" tabindex="-1"></a>        <span class="cf">if</span> rlayer.isValid():</span>
<span id="cb5-66"><a href="#cb5-66" tabindex="-1"></a>            QgsProject.instance().addMapLayer(rlayer)</span>
<span id="cb5-67"><a href="#cb5-67" tabindex="-1"></a>            <span class="va">self</span>.iface.messageBar().pushSuccess(<span class="st">&#39;Success&#39;</span>, <span class="st">&#39;Basemap Layer Loaded&#39;</span>)</span>
<span id="cb5-68"><a href="#cb5-68" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-69"><a href="#cb5-69" tabindex="-1"></a>            <span class="va">self</span>.iface.messageBar().pushCritical(<span class="st">&#39;Error&#39;</span>, <span class="st">&#39;Invalid Basemap Layer&#39;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Reload the plugin to see the toolbar.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/pluginbasemapui.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="package-and-share-your-plugin" class="section level2">
<h2>4. Package and Share Your Plugin</h2>
<ol style="list-style-type: decimal">
<li>The easiest way to share your plugin with other users is by creating
a ZIP file. Right-click the plugin directory and create a zip file.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/compress.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>You can send the resulting <code>basemap_loader.zip</code> file to
other users. You may also host this file and share the link with other
users. For example, the final plugin can be downloaded from this link →
<a
href="https://drive.google.com/uc?export=download&amp;id=1_0liBiBP18x4y2CVNswtkt_lK0e-qiCu">basemap_loader.zip</a>.
Once downloaded, the plugin can be installed from <strong>Plugins →
Manage and Install plugins… → Install from ZIP</strong>. Click
<em>Install Plugin</em> to install the plugin.</li>
</ol>
<blockquote>
<p>You will get a warning <em>Installing a plugin from an untrusted
source can harm the computer. Only continue if you received the plugin
from a source you trust. Continue?</em>. Click <em>Yes</em> to continue
the installation.</p>
</blockquote>
<p><img src="images/qgis_plugin_workshop/install.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Switch to to <em>Installed</em> table and enable the <strong>Basemap
Loader</strong> plugin.</li>
</ol>
<p><img src="images/qgis_plugin_workshop/enable_plugin.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="what-next" class="section level1">
<h1>What next?</h1>
<p>If you enjoyed this workshop, check out our full course <a
href="pyqgis-masterclass.html">PyQGIS Masterclass</a> which covers the
entire PyQGIS API in a structured manner.</p>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This workshop material is licensed under a <a
href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International (CC BY 4.0)</a>. You are free to re-use
and adapt the material but are required to give appropriate credit to
the original author as below:</p>
<p><em>Building Your First QGIS Plugin Workshop</em> by Ujaval Gandhi <a
href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<p>© 2024 Spatial Thoughts <a
href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
</div>

<!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to report any issues with this page, please comment below.</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/courses"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
