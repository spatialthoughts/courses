<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Advanced Concepts in Google Earth Engine (Full Course Material)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PDGF11RK4Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PDGF11RK4Z');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Advanced Concepts in Google Earth Engine
(Full Course Material)</h1>
<h3 class="subtitle">A Deep-dive into Reducers, Joins, Regressions and
Vector Data Processing in GEE.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#sign-up-for-google-earth-engine"
id="toc-sign-up-for-google-earth-engine">Sign-up for Google Earth
Engine</a></li>
<li><a href="#get-the-course-materials"
id="toc-get-the-course-materials">Get the Course Materials</a></li>
<li><a href="#reducers" id="toc-reducers">1. Reducers</a>
<ul>
<li><a href="#combined-reducers" id="toc-combined-reducers">01. Combined
Reducers</a></li>
<li><a href="#repeated-reducers" id="toc-repeated-reducers">02. Repeated
Reducers</a></li>
<li><a href="#grouped-reducers" id="toc-grouped-reducers">03. Grouped
Reducers</a></li>
<li><a href="#weighted-vs.-unweighted-reducers"
id="toc-weighted-vs.-unweighted-reducers">04. Weighted vs. Unweighted
Reducers</a></li>
<li><a href="#zonal-statistics---vector"
id="toc-zonal-statistics---vector">05. Zonal Statistics -
Vector</a></li>
<li><a href="#zonal-statistics---raster"
id="toc-zonal-statistics---raster">06. Zonal Statistics -
Raster</a></li>
</ul></li>
<li><a href="#joins" id="toc-joins">Joins</a></li>
<li><a href="#regressions" id="toc-regressions">Regressions</a></li>
<li><a href="#vector-data-processing-and-visualization"
id="toc-vector-data-processing-and-visualization">Vector Data Processing
and Visualization</a></li>
<li><a href="#license" id="toc-license">License</a></li>
<li><a href="#citing-and-referencing"
id="toc-citing-and-referencing">Citing and Referencing</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This is an advanced-level course that is suited for participants who
are familiar with the Google Earth Engine API and want to learn advanced
data processing techniques and understand the inner-workings in Earth
Engine. This class covers the following topics:</p>
<ul>
<li>Reducers</li>
<li>Joins</li>
<li>Regressions</li>
<li>Vector Data Processing and Visualization</li>
</ul>
<p><a
href="https://docs.google.com/presentation/d/1HCPuyubqUFmaPxEsvZChMmB8beocGBBI4yl9VbNNfn0/edit?usp=sharing"
target="_blank"><img src="images/gee_advanced/introduction.png"
width="400" alt="View Presentation" /></a></p>
<p><a
href="https://docs.google.com/presentation/d/1HCPuyubqUFmaPxEsvZChMmB8beocGBBI4yl9VbNNfn0/edit?usp=sharing"
target="_blank">View the Presentation ↗</a></p>
</div>
<div id="sign-up-for-google-earth-engine" class="section level1">
<h1>Sign-up for Google Earth Engine</h1>
<p>If you already have a Google Earth Engine account, you can skip this
step.</p>
<p>Visit our <a href="gee-sign-up.html">GEE Sign-Up Guide</a> for
step-by-step instructions.</p>
</div>
<div id="get-the-course-materials" class="section level1">
<h1>Get the Course Materials</h1>
<p>The course material and exercises are in the form of Earth Engine
scripts shared via a code repository.</p>
<ol style="list-style-type: decimal">
<li><a
href="https://code.earthengine.google.co.in/?accept_repo=users/ujavalgandhi/GEE-Advanced">Click
this link</a> to open Google Earth Engine code editor and add the
repository to your account.</li>
<li>If successful, you will have a new repository named
<code>users/ujavalgandhi/GEE-Advanced</code> in the <em>Scripts</em> tab
in the <em>Reader</em> section.</li>
<li>Verify that your code editor looks like below</li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/gee_advanced/repository.png" alt="Code Editor with Workshop Repository" width="50%" />
<p class="caption">
Code Editor with Workshop Repository
</p>
</div>
<p>If you do not see the repository in the <em>Reader</em> section,
click <em>Refresh repository cache</em> button in your <em>Scripts</em>
tab and it will show up.</p>
<div class="figure" style="text-align: center">
<img src="images/common/repository_cache.png" alt="Refresh repository cache" width="50%" />
<p class="caption">
Refresh repository cache
</p>
</div>
</div>
<div id="reducers" class="section level1">
<h1>1. Reducers</h1>
<p>Reducer is an object used to compute statistics or perform
aggregations. Reducers can aggregate data over time, space, bands, lists
and other data structures in Earth Engine. Each reducer can take one or
more input and generate one of more outputs.</p>
<p><a
href="https://docs.google.com/presentation/d/1l3C4p-mwYyDQaERn6QkixMavkKeSz8MzxK9et89ED2E/edit?usp=sharing"
target="_blank"><img src="images/gee_advanced/reducers.png" width="400"
alt="View Presentation" /></a></p>
<p><a
href="https://docs.google.com/presentation/d/1l3C4p-mwYyDQaERn6QkixMavkKeSz8MzxK9et89ED2E/edit?usp=sharing"
target="_blank">View the Presentation ↗</a></p>
<div id="combined-reducers" class="section level2">
<h2>01. Combined Reducers</h2>
<p>You can create a new reducer by combining multiple reducers. Combined
reducers are useful to compute multiple statistics together. The
resulting reducer is run in parallel and is highly efficient than
running each reducer independently.</p>
<div class="figure" style="text-align: center">
<img src="images/gee_advanced/combined_reducers.png" alt="Combined Reducers" width="75%" />
<p class="caption">
Combined Reducers
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Advanced%3A01-Reducers%2F01b_Combined_Reducers_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">// Example script showing how to extract data</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">// from images and imagecollections</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="kw">var</span> admin2Filtered <span class="op">=</span> admin2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> admin2Filtered<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">// We use the MODIS 16-day Vegetation Indicies dataset</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">var</span> modis <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;MODIS/061/MOD13Q1&#39;</span>)<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">// Pre-Processing: Cloud Masking and Scaling</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">// Function for Cloud Masking</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="kw">var</span> bitwiseExtract <span class="op">=</span> <span class="kw">function</span>(input<span class="op">,</span> fromBit<span class="op">,</span> toBit) {</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="kw">var</span> maskSize <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">add</span>(toBit)<span class="op">.</span><span class="fu">subtract</span>(fromBit)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">leftShift</span>(maskSize)<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="cf">return</span> input<span class="op">.</span><span class="fu">rightShift</span>(fromBit)<span class="op">.</span><span class="fu">bitwiseAnd</span>(mask)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>}</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="kw">var</span> maskSnowAndClouds <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="kw">var</span> summaryQa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;SummaryQA&#39;</span>)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  <span class="co">// Select pixels which are less than or equals to 1 (0 or 1)</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  <span class="kw">var</span> qaMask <span class="op">=</span> <span class="fu">bitwiseExtract</span>(summaryQa<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">.</span><span class="fu">lte</span>(<span class="dv">1</span>)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>  <span class="kw">var</span> maskedImage <span class="op">=</span> image<span class="op">.</span><span class="fu">updateMask</span>(qaMask)</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>  <span class="cf">return</span> maskedImage<span class="op">.</span><span class="fu">copyProperties</span>(</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    image<span class="op">,</span> [<span class="st">&#39;system:index&#39;</span><span class="op">,</span> <span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>}</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">// Function for Scaling Pixel Values</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">// MODIS NDVI values come as NDVI x 10000</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="co">// that need to be scaled by 0.0001</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="kw">var</span> ndviScaled <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>  <span class="kw">var</span> scaled <span class="op">=</span> image<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>  <span class="cf">return</span> scaled<span class="op">.</span><span class="fu">copyProperties</span>(</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>    image<span class="op">,</span> [<span class="st">&#39;system:index&#39;</span><span class="op">,</span> <span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="co">// Apply the functions and select the &#39;NDVI&#39; band</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="kw">var</span> processedCol <span class="op">=</span> modis</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskSnowAndClouds)</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(ndviScaled)</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co">// Extracting Image Statistics</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a><span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="at">Date</span><span class="op">.</span><span class="fu">fromYMD</span>(<span class="dv">2019</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="kw">var</span> endDate <span class="op">=</span> startDate<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&#39;year&#39;</span>)</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> processedCol</span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(startDate<span class="op">,</span> endDate))</span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filtered<span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(geometry<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;Region&#39;</span>)<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;#FFFFFF&#39;</span><span class="op">,</span> <span class="st">&#39;#006400&#39;</span>]}<span class="op">,</span> <span class="st">&#39;MODIS NDVI&#39;</span>)</span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a><span class="co">// Compute Mean NDVI</span></span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb1-62"><a href="#cb1-62" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Mean NDVI&#39;</span><span class="op">,</span> stats<span class="op">.</span><span class="fu">getNumber</span>(<span class="st">&#39;NDVI&#39;</span>))<span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" tabindex="-1"></a><span class="co">// Use a Combined Reducer</span></span>
<span id="cb1-66"><a href="#cb1-66" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb1-67"><a href="#cb1-67" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">combine</span>({</span>
<span id="cb1-68"><a href="#cb1-68" tabindex="-1"></a>      <span class="dt">reducer2</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">minMax</span>()<span class="op">,</span></span>
<span id="cb1-69"><a href="#cb1-69" tabindex="-1"></a>      <span class="dt">sharedInputs</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">,</span></span>
<span id="cb1-70"><a href="#cb1-70" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb1-71"><a href="#cb1-71" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb1-72"><a href="#cb1-72" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-73"><a href="#cb1-73" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;NDVI Statistics&#39;</span><span class="op">,</span> stats)<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" tabindex="-1"></a><span class="co">// You can combine as many reducers as you want</span></span>
<span id="cb1-76"><a href="#cb1-76" tabindex="-1"></a><span class="kw">var</span> allReducers <span class="op">=</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()</span>
<span id="cb1-77"><a href="#cb1-77" tabindex="-1"></a>  <span class="op">.</span><span class="fu">combine</span>({<span class="dt">reducer2</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">min</span>()<span class="op">,</span> <span class="dt">sharedInputs</span><span class="op">:</span> <span class="kw">true</span>} )</span>
<span id="cb1-78"><a href="#cb1-78" tabindex="-1"></a>  <span class="op">.</span><span class="fu">combine</span>({<span class="dt">reducer2</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>()<span class="op">,</span> <span class="dt">sharedInputs</span><span class="op">:</span> <span class="kw">true</span>} )</span>
<span id="cb1-79"><a href="#cb1-79" tabindex="-1"></a>  <span class="op">.</span><span class="fu">combine</span>({<span class="dt">reducer2</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">percentile</span>([<span class="dv">25</span>])<span class="op">,</span> <span class="dt">sharedInputs</span><span class="op">:</span> <span class="kw">true</span>} )</span>
<span id="cb1-80"><a href="#cb1-80" tabindex="-1"></a>  <span class="op">.</span><span class="fu">combine</span>({<span class="dt">reducer2</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">percentile</span>([<span class="dv">50</span>])<span class="op">,</span> <span class="dt">sharedInputs</span><span class="op">:</span> <span class="kw">true</span>} )</span>
<span id="cb1-81"><a href="#cb1-81" tabindex="-1"></a>  <span class="op">.</span><span class="fu">combine</span>({<span class="dt">reducer2</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">percentile</span>([<span class="dv">75</span>])<span class="op">,</span> <span class="dt">sharedInputs</span><span class="op">:</span> <span class="kw">true</span>} )</span>
<span id="cb1-82"><a href="#cb1-82" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb1-84"><a href="#cb1-84" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> allReducers<span class="op">,</span></span>
<span id="cb1-85"><a href="#cb1-85" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb1-86"><a href="#cb1-86" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">250</span></span>
<span id="cb1-87"><a href="#cb1-87" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;NDVI Statistics&#39;</span><span class="op">,</span> stats)<span class="op">;</span></span></code></pre></div>
</div>
<div id="repeated-reducers" class="section level2">
<h2>02. Repeated Reducers</h2>
<p>A reducer can be repeated multiple times to create a multi-input
reducer. These are useful for computing the same statistics on different
inputs.</p>
<div class="figure" style="text-align: center">
<img src="images/gee_advanced/repeated_reducers.png" alt="Repeated Reducers" width="75%" />
<p class="caption">
Repeated Reducers
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Advanced%3A01-Reducers%2F02b_Repeated_Reducer_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">// Load the Ookla Speedtest Dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">// https://gee-community-catalog.org/projects/speedtest/</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="kw">var</span> tiles <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="st">&#39;projects/sat-io/open-datasets/network/mobile_tiles/&#39;</span> <span class="op">+</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="st">&#39;2022-01-01_performance_mobile_tiles&#39;</span>)<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">// Select a region</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="st">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)<span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="kw">var</span> selected <span class="op">=</span> admin2</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM0_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;India&#39;</span>))</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))<span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> selected<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry)<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> tiles<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filtered<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span>}<span class="op">,</span> <span class="st">&#39;Broadband Speeds&#39;</span>)<span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="fu">print</span>(filtered<span class="op">.</span><span class="fu">first</span>())<span class="op">;</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">// Let&#39;s compute average download speed</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> filtered<span class="op">.</span><span class="fu">aggregate_mean</span>(<span class="st">&#39;avg_d_kbps&#39;</span>)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Average Download Speed (Mbps)&#39;</span><span class="op">,</span> stats<span class="op">.</span><span class="fu">divide</span>(<span class="dv">1000</span>))<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">// If we want to compute stats on multiple properties</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">// we can use reducecolumns()</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">// Let&#39;s compute average download and upload speeds</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="kw">var</span> properties <span class="op">=</span> [<span class="st">&#39;avg_d_kbps&#39;</span><span class="op">,</span> <span class="st">&#39;avg_u_kbps&#39;</span>]<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">// Since we have 2 properties, we need to repeat the reducer</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> filtered<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">repeat</span>(<span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>  <span class="dt">selectors</span><span class="op">:</span> properties})<span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="fu">print</span>(stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;mean&#39;</span>))<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">// Extract and convert</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="kw">var</span> speeds <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;mean&#39;</span>))<span class="op">;</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Average Download Speed (Mbps)&#39;</span><span class="op">,</span> speeds<span class="op">.</span><span class="fu">getNumber</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">1000</span>))<span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Average Upload Speed (Mbps)&#39;</span><span class="op">,</span> speeds<span class="op">.</span><span class="fu">getNumber</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">1000</span>))<span class="op">;</span></span></code></pre></div>
</div>
<div id="grouped-reducers" class="section level2">
<h2>03. Grouped Reducers</h2>
<p>You can group the output of a reducer by the value of a specified
input. These are useful in computing grouped statistics (i.e. statistics
by category).</p>
<div class="figure" style="text-align: center">
<img src="images/gee_advanced/grouped_reducers.png" alt="Grouped Reducers" width="75%" />
<p class="caption">
Grouped Reducers
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Advanced%3A01-Reducers%2F03b_Grouped_Reducers_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co">// Select a region</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">77.6045</span><span class="op">,</span> <span class="fl">12.8992</span>])<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">var</span> bufferDistance <span class="op">=</span> <span class="dv">5000</span><span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(bufferDistance)<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry<span class="op">,</span> <span class="dv">12</span>)<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(geometry<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;gray&#39;</span>}<span class="op">,</span> <span class="st">&#39;Buffer Zone&#39;</span>)<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR&#39;</span>)<span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">// Write a function for Cloud masking</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="kw">var</span> maskS2clouds <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>}</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">// Write a function to scale the bands</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="kw">var</span> scaleImage <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  <span class="cf">return</span> image</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    <span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>}</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2021-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2022-01-01&#39;</span>))</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskS2clouds)</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(scaleImage)<span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>  </span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">// Create a median composite for 2021</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="kw">var</span> composite <span class="op">=</span>  filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(composite<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;2020 Composite&#39;</span>)<span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">// We use the ESA WorldCover 2021 dataset</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="kw">var</span> worldcover <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;ESA/WorldCover/v200&#39;</span>)<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">// The image has 11 classes</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">// Remap the class values to have continuous values</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">// from 0 to 10</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="kw">var</span> classified <span class="op">=</span> worldcover<span class="op">.</span><span class="fu">remap</span>(</span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>  [<span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">60</span><span class="op">,</span> <span class="dv">70</span><span class="op">,</span> <span class="dv">80</span><span class="op">,</span> <span class="dv">90</span><span class="op">,</span> <span class="dv">95</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>  [<span class="dv">0</span><span class="op">,</span>  <span class="dv">1</span> <span class="op">,</span> <span class="dv">2</span><span class="op">,</span>  <span class="dv">3</span><span class="op">,</span>  <span class="dv">4</span><span class="op">,</span>  <span class="dv">5</span><span class="op">,</span>  <span class="dv">6</span><span class="op">,</span>  <span class="dv">7</span><span class="op">,</span>  <span class="dv">8</span><span class="op">,</span>  <span class="dv">9</span><span class="op">,</span>  <span class="dv">10</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;classification&#39;</span>)<span class="op">;</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a><span class="co">// Define a list of class names</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="kw">var</span> worldCoverClassNames<span class="op">=</span> [</span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>  <span class="st">&#39;Tree Cover&#39;</span><span class="op">,</span> <span class="st">&#39;Shrubland&#39;</span><span class="op">,</span> <span class="st">&#39;Grassland&#39;</span><span class="op">,</span> <span class="st">&#39;Cropland&#39;</span><span class="op">,</span> <span class="st">&#39;Built-up&#39;</span><span class="op">,</span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>  <span class="st">&#39;Bare / sparse Vegetation&#39;</span><span class="op">,</span> <span class="st">&#39;Snow and Ice&#39;</span><span class="op">,</span> </span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a>  <span class="st">&#39;Permanent Water Bodies&#39;</span><span class="op">,</span> <span class="st">&#39;Herbaceous Wetland&#39;</span><span class="op">,</span> </span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>  <span class="st">&#39;Mangroves&#39;</span><span class="op">,</span> <span class="st">&#39;Moss and Lichen&#39;</span>]<span class="op">;</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a><span class="co">// Define a list of class colors</span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a><span class="kw">var</span> worldCoverPalette <span class="op">=</span> [</span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>  <span class="st">&#39;006400&#39;</span><span class="op">,</span> <span class="st">&#39;ffbb22&#39;</span><span class="op">,</span> <span class="st">&#39;ffff4c&#39;</span><span class="op">,</span> <span class="st">&#39;f096ff&#39;</span><span class="op">,</span> <span class="st">&#39;fa0000&#39;</span><span class="op">,</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a>  <span class="st">&#39;b4b4b4&#39;</span><span class="op">,</span> <span class="st">&#39;f0f0f0&#39;</span><span class="op">,</span> <span class="st">&#39;0064c8&#39;</span><span class="op">,</span> <span class="st">&#39;0096a0&#39;</span><span class="op">,</span> <span class="st">&#39;00cf75&#39;</span><span class="op">,</span></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>  <span class="st">&#39;fae6a0&#39;</span>]<span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a><span class="co">// We define a dictionary with class names</span></span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a><span class="kw">var</span> classNames <span class="op">=</span> ee<span class="op">.</span><span class="at">Dictionary</span><span class="op">.</span><span class="fu">fromLists</span>(</span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>  [<span class="st">&#39;0&#39;</span><span class="op">,</span><span class="st">&#39;1&#39;</span><span class="op">,</span><span class="st">&#39;2&#39;</span><span class="op">,</span><span class="st">&#39;3&#39;</span><span class="op">,</span><span class="st">&#39;4&#39;</span><span class="op">,</span><span class="st">&#39;5&#39;</span><span class="op">,</span><span class="st">&#39;6&#39;</span><span class="op">,</span><span class="st">&#39;7&#39;</span><span class="op">,</span><span class="st">&#39;8&#39;</span><span class="op">,</span><span class="st">&#39;9&#39;</span><span class="op">,</span> <span class="st">&#39;10&#39;</span>]<span class="op">,</span></span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a>  worldCoverClassNames</span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a><span class="co">// We define a dictionary with class colors</span></span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a><span class="kw">var</span> classColors <span class="op">=</span> ee<span class="op">.</span><span class="at">Dictionary</span><span class="op">.</span><span class="fu">fromLists</span>(</span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a>  [<span class="st">&#39;0&#39;</span><span class="op">,</span><span class="st">&#39;1&#39;</span><span class="op">,</span><span class="st">&#39;2&#39;</span><span class="op">,</span><span class="st">&#39;3&#39;</span><span class="op">,</span><span class="st">&#39;4&#39;</span><span class="op">,</span><span class="st">&#39;5&#39;</span><span class="op">,</span><span class="st">&#39;6&#39;</span><span class="op">,</span><span class="st">&#39;7&#39;</span><span class="op">,</span><span class="st">&#39;8&#39;</span><span class="op">,</span><span class="st">&#39;9&#39;</span><span class="op">,</span> <span class="st">&#39;10&#39;</span>]<span class="op">,</span></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>  worldCoverPalette</span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a><span class="kw">var</span> worldCoverVisParams <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">10</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> worldCoverPalette}<span class="op">;</span></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(classified<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">,</span> worldCoverVisParams<span class="op">,</span> <span class="st">&#39;Landcover&#39;</span>)<span class="op">;</span></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a><span class="kw">var</span> samples <span class="op">=</span> composite<span class="op">.</span><span class="fu">addBands</span>(classified)</span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a>  <span class="op">.</span><span class="fu">stratifiedSample</span>({</span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a>    <span class="dt">numPoints</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a>    <span class="dt">classBand</span><span class="op">:</span> <span class="st">&#39;classification&#39;</span><span class="op">,</span></span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a>    <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span> </span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a>    <span class="dt">tileScale</span><span class="op">:</span> <span class="dv">16</span></span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a>  </span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Stratified Samples&#39;</span><span class="op">,</span> samples)</span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a><span class="co">// We want to get average spectral value for a band</span></span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a><span class="co">// grouped by class</span></span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a><span class="kw">var</span> properties <span class="op">=</span> [<span class="st">&#39;B5&#39;</span><span class="op">,</span> <span class="st">&#39;classification&#39;</span>]</span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> samples<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a>    <span class="dt">selectors</span><span class="op">:</span> properties<span class="op">,</span></span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a>      <span class="dt">groupField</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a><span class="kw">var</span> groupStats <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;groups&#39;</span>))<span class="op">;</span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a><span class="fu">print</span>(groupStats)<span class="op">;</span></span>
<span id="cb3-97"><a href="#cb3-97" tabindex="-1"></a></span>
<span id="cb3-98"><a href="#cb3-98" tabindex="-1"></a><span class="co">// Let&#39;s get average spectral value for every band</span></span>
<span id="cb3-99"><a href="#cb3-99" tabindex="-1"></a><span class="kw">var</span> bands <span class="op">=</span> composite<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb3-100"><a href="#cb3-100" tabindex="-1"></a><span class="kw">var</span> properties <span class="op">=</span> bands<span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;classification&#39;</span>)<span class="op">;</span></span>
<span id="cb3-101"><a href="#cb3-101" tabindex="-1"></a></span>
<span id="cb3-102"><a href="#cb3-102" tabindex="-1"></a><span class="co">// Now we have multiple columns, so we have to repeat the reducer</span></span>
<span id="cb3-103"><a href="#cb3-103" tabindex="-1"></a><span class="kw">var</span> numBands <span class="op">=</span> bands<span class="op">.</span><span class="fu">length</span>()<span class="op">;</span></span>
<span id="cb3-104"><a href="#cb3-104" tabindex="-1"></a></span>
<span id="cb3-105"><a href="#cb3-105" tabindex="-1"></a><span class="co">// We need the index of the group band</span></span>
<span id="cb3-106"><a href="#cb3-106" tabindex="-1"></a><span class="kw">var</span> groupIndex <span class="op">=</span> properties<span class="op">.</span><span class="fu">indexOf</span>(<span class="st">&#39;classification&#39;</span>)<span class="op">;</span></span>
<span id="cb3-107"><a href="#cb3-107" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> samples<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb3-109"><a href="#cb3-109" tabindex="-1"></a>    <span class="dt">selectors</span><span class="op">:</span> properties<span class="op">,</span></span>
<span id="cb3-110"><a href="#cb3-110" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">repeat</span>(numBands)<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb3-111"><a href="#cb3-111" tabindex="-1"></a>      <span class="dt">groupField</span><span class="op">:</span> groupIndex})<span class="op">,</span></span>
<span id="cb3-112"><a href="#cb3-112" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb3-113"><a href="#cb3-113" tabindex="-1"></a><span class="kw">var</span> groupStats <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;groups&#39;</span>))<span class="op">;</span></span>
<span id="cb3-114"><a href="#cb3-114" tabindex="-1"></a><span class="fu">print</span>(groupStats)<span class="op">;</span></span>
<span id="cb3-115"><a href="#cb3-115" tabindex="-1"></a></span>
<span id="cb3-116"><a href="#cb3-116" tabindex="-1"></a><span class="co">// We do some post-processing to format the results</span></span>
<span id="cb3-117"><a href="#cb3-117" tabindex="-1"></a></span>
<span id="cb3-118"><a href="#cb3-118" tabindex="-1"></a><span class="kw">var</span> fc <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(groupStats<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(item) {</span>
<span id="cb3-119"><a href="#cb3-119" tabindex="-1"></a>  <span class="co">// Extract the means</span></span>
<span id="cb3-120"><a href="#cb3-120" tabindex="-1"></a>  <span class="kw">var</span> values <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(item)<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;mean&#39;</span>)</span>
<span id="cb3-121"><a href="#cb3-121" tabindex="-1"></a>  <span class="kw">var</span> groupNumber <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(item)<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;group&#39;</span>)</span>
<span id="cb3-122"><a href="#cb3-122" tabindex="-1"></a>  <span class="kw">var</span> properties <span class="op">=</span> ee<span class="op">.</span><span class="at">Dictionary</span><span class="op">.</span><span class="fu">fromLists</span>(bands<span class="op">,</span> values)</span>
<span id="cb3-123"><a href="#cb3-123" tabindex="-1"></a>  <span class="kw">var</span> withClass <span class="op">=</span> properties<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;class&#39;</span><span class="op">,</span> classNames<span class="op">.</span><span class="fu">get</span>(groupNumber))</span>
<span id="cb3-124"><a href="#cb3-124" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> withClass)</span>
<span id="cb3-125"><a href="#cb3-125" tabindex="-1"></a>}))</span>
<span id="cb3-126"><a href="#cb3-126" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Average Spectral Value for Each Class&#39;</span><span class="op">,</span> fc)</span></code></pre></div>
</div>
<div id="weighted-vs.-unweighted-reducers" class="section level2">
<h2>04. Weighted vs. Unweighted Reducers</h2>
<p>Default calculations in Earth Engine uses weighted reducers. Weighted
reducers account for fractional area of each pixel covered by the
geometry. Unweighted reducers count pixels as whole if their centroid is
covered by the geometry. You can choose to run any reducer in
un-weighted mode using <code>.unweighted()</code>. Most software
packages for remote sensing do not have support for weighted reducers,
so Earth Engine users may choose to run their analysis un-weighted mode
to verify and compare their results generated from other packages.</p>
<div class="figure" style="text-align: center">
<img src="images/gee_advanced/weighted_vs_unweighted.png" alt="Weighted vs. Unweighted Reducers" width="75%" />
<p class="caption">
Weighted vs. Unweighted Reducers
</p>
</div>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Advanced%3A01-Reducers%2F04b_Weighted_vs_Unweighted_Reducers_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co">// Example script demonstrating the different between</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">// weighted and un-weighted reducers in Earth Engine</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">// We are using a 4x4 pixel test image having each pixel</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">// value set to 1.</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">// with 1km pixels in EPSG:32643</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">// Code for generating such images is at </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">// https://github.com/spatialthoughts/python-tutorials/blob/main/raster_from_array.ipynb</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;users/ujavalgandhi/public/test_image_ones&#39;</span>)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="kw">var</span> pixels <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/public/test_image_pixels&#39;</span>)<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="kw">var</span> test_geometry <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;users/ujavalgandhi/public/test_geometry&#39;</span>)<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    </span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="kw">var</span> visParams <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span>]}<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> visParams<span class="op">,</span> <span class="st">&#39;Test Image&#39;</span>)<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(image)<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(pixels<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;black&#39;</span>}<span class="op">,</span> <span class="st">&#39;Pixel Boundaries&#39;</span>)<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="kw">var</span> centroids <span class="op">=</span> image<span class="op">.</span><span class="fu">sample</span>({</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> image<span class="op">.</span><span class="fu">geometry</span>()<span class="op">,</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>  <span class="dt">geometries</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(centroids<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;cyan&#39;</span>}<span class="op">,</span> <span class="st">&#39;Pixel Centroids&#39;</span>)<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> test_geometry<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(geometry<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;red&#39;</span>}<span class="op">,</span> <span class="st">&#39;Region&#39;</span>)<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">// 3rd party package for labelling</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="kw">var</span> style <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;users/gena/packages:style&#39;</span>)<span class="op">;</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="kw">var</span> textProperties <span class="op">=</span> { <span class="dt">textColor</span><span class="op">:</span> <span class="st">&#39;ffffff&#39;</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">12</span><span class="op">,</span> <span class="dt">outlineColor</span><span class="op">:</span> <span class="st">&#39;000000&#39;</span>}<span class="op">;</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="kw">var</span> labels <span class="op">=</span> style<span class="op">.</span><span class="at">Feature</span><span class="op">.</span><span class="fu">label</span>(centroids<span class="op">,</span> <span class="st">&#39;b1&#39;</span><span class="op">,</span> textProperties)<span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(labels<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;labels&#39;</span>)<span class="op">;</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">// Weighted reducers account for fractional area of </span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">// each pixel covered by the geometry</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">,</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>})</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Sum of Pixels in Polygon (Weighted)&#39;</span><span class="op">,</span> stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;b1&#39;</span>))<span class="op">;</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a><span class="co">// Unweighted reducers count pixels as whole if their</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a><span class="co">// centroid is covered by the geometry</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">sum</span>()<span class="op">.</span><span class="fu">unweighted</span>()<span class="op">,</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>})</span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Sum of Pixels in Polygon (Un-weighted)&#39;</span><span class="op">,</span> stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;b1&#39;</span>))<span class="op">;</span> </span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a> </span></code></pre></div>
</div>
<div id="zonal-statistics---vector" class="section level2">
<h2>05. Zonal Statistics - Vector</h2>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Advanced%3A01-Reducers%2F05b_Zonal_Statistics_Vector_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">// Vector Zonal Statistics</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">// We want to comptue the mean annual temperature</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">// for each ecoregion and each biome within a realm</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">// We use the EcoRegions FeatureCollection</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="kw">var</span> ecoregions <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;RESOLVE/ECOREGIONS/2017&#39;</span>)<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">// The dataset contains multiple polygons for each ecoregion</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">// The layer contains polygons for -&gt; 846 Ecoregions</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">// Ecoregions are grouped into -&gt; 14 Biomes</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">// Biomes are groouped into -&gt; 8 Realms</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="fu">print</span>(ecoregions<span class="op">.</span><span class="fu">aggregate_array</span>(<span class="st">&#39;REALM&#39;</span>)<span class="op">.</span><span class="fu">distinct</span>())<span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">// Let&#39;s filter to ecoregions in a realm</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="kw">var</span> realm <span class="op">=</span> <span class="st">&#39;Australasia&#39;</span><span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> ecoregions<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;REALM&#39;</span><span class="op">,</span> realm))<span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">// We use the WorldClim V1 dataset that contains</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">// historical climate data from 1960-1990</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="kw">var</span> worldclim <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;WORLDCLIM/V1/BIO&#39;</span>)<span class="op">;</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">// Select &#39;annual mean temperature&#39; band</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">// and apply scaling factor</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="kw">var</span> temperature <span class="op">=</span> worldclim<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;bio01&#39;</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.1</span>)<span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">// Visualize Temperature and Ecoregions</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">&#39;#4575b4&#39;</span><span class="op">,</span> <span class="st">&#39;#91bfdb&#39;</span><span class="op">,</span> <span class="st">&#39;#e0f3f8&#39;</span><span class="op">,</span> </span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>  <span class="st">&#39;#ffffbf&#39;</span><span class="op">,</span> <span class="st">&#39;#fee090&#39;</span><span class="op">,</span> <span class="st">&#39;#fc8d59&#39;</span><span class="op">,</span> <span class="st">&#39;#d73027&#39;</span>]</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(temperature<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">10</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">25</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette}<span class="op">,</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>  <span class="st">&#39;Annual Mean Temparature&#39;</span>)</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(filtered<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;REALM&#39;</span><span class="op">,</span> realm))<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;blue&#39;</span>}<span class="op">,</span> <span class="st">&#39;Ecoregions&#39;</span>)<span class="op">;</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">// Calculate Average Annual Mean Temperature per Ecoregion</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="co">// Get the native resolution of the image</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="kw">var</span> scale <span class="op">=</span> worldclim<span class="op">.</span><span class="fu">projection</span>()<span class="op">.</span><span class="fu">nominalScale</span>()</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="kw">var</span> zonalStats <span class="op">=</span> temperature<span class="op">.</span><span class="fu">reduceRegions</span>({</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> filtered<span class="op">,</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">setOutputs</span>([<span class="st">&#39;meantemp&#39;</span>])<span class="op">,</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> scale})</span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="co">// Output of reduceRegions() is a FeatureCollection</span></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Ecoregions with Mean Temp&#39;</span><span class="op">,</span> zonalStats<span class="op">.</span><span class="fu">first</span>())<span class="op">;</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a><span class="co">// We have 1 polygon per ecoregion with its mean temperature</span></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a><span class="co">// Group them by biome and compute mean temperature per biome</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a><span class="kw">var</span> zonalGroupStats <span class="op">=</span> zonalStats<span class="op">.</span><span class="fu">reduceColumns</span>({</span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">setOutputs</span>([<span class="st">&#39;meantemp&#39;</span>])</span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>    <span class="op">.</span><span class="fu">group</span>({<span class="dt">groupField</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">groupName</span><span class="op">:</span> <span class="st">&#39;biome&#39;</span>})<span class="op">,</span></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">&#39;meantemp&#39;</span><span class="op">,</span> <span class="st">&#39;BIOME_NAME&#39;</span>]})</span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Biomes with Mean Temp&#39;</span><span class="op">,</span> zonalGroupStats)<span class="op">;</span></span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a><span class="co">// Process the results</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a><span class="kw">var</span> groups <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(zonalGroupStats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;groups&#39;</span>))<span class="op">;</span></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a><span class="kw">var</span> results <span class="op">=</span> groups<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(item) {</span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a>  <span class="co">// Extract the mean</span></span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a>  <span class="kw">var</span> meanTemp <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(item)<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;meantemp&#39;</span>)<span class="op">;</span></span>
<span id="cb5-62"><a href="#cb5-62" tabindex="-1"></a>  <span class="co">// The group name is what we specified in the grouped reducer</span></span>
<span id="cb5-63"><a href="#cb5-63" tabindex="-1"></a>  <span class="kw">var</span> biomeName <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(item)<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;biome&#39;</span>)<span class="op">;</span></span>
<span id="cb5-64"><a href="#cb5-64" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> {</span>
<span id="cb5-65"><a href="#cb5-65" tabindex="-1"></a>    <span class="st">&#39;BIOME_NAME&#39;</span><span class="op">:</span> biomeName<span class="op">,</span></span>
<span id="cb5-66"><a href="#cb5-66" tabindex="-1"></a>    <span class="st">&#39;meantemp&#39;</span><span class="op">:</span> meanTemp})<span class="op">;</span></span>
<span id="cb5-67"><a href="#cb5-67" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-68"><a href="#cb5-68" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" tabindex="-1"></a><span class="kw">var</span> zonalGroupStatsFc <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(results)<span class="op">;</span></span>
<span id="cb5-70"><a href="#cb5-70" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Biomes with Mean Temp (Processed)&#39;</span><span class="op">,</span> zonalGroupStatsFc)<span class="op">;</span></span>
<span id="cb5-71"><a href="#cb5-71" tabindex="-1"></a></span>
<span id="cb5-72"><a href="#cb5-72" tabindex="-1"></a><span class="co">// Export the results</span></span>
<span id="cb5-73"><a href="#cb5-73" tabindex="-1"></a>Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb5-74"><a href="#cb5-74" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> zonalStats<span class="op">,</span></span>
<span id="cb5-75"><a href="#cb5-75" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Mean_Temp_By_Ecoregion&#39;</span><span class="op">,</span></span>
<span id="cb5-76"><a href="#cb5-76" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb5-77"><a href="#cb5-77" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;mean_temp_by_ecoregion&#39;</span><span class="op">,</span></span>
<span id="cb5-78"><a href="#cb5-78" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">&#39;CSV&#39;</span><span class="op">,</span></span>
<span id="cb5-79"><a href="#cb5-79" tabindex="-1"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">&#39;BIOME_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;ECO_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;meantemp&#39;</span>]</span>
<span id="cb5-80"><a href="#cb5-80" tabindex="-1"></a>})</span>
<span id="cb5-81"><a href="#cb5-81" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" tabindex="-1"></a>Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb5-83"><a href="#cb5-83" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> zonalGroupStatsFc<span class="op">,</span></span>
<span id="cb5-84"><a href="#cb5-84" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Mean_Temp_By_Biome&#39;</span><span class="op">,</span></span>
<span id="cb5-85"><a href="#cb5-85" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb5-86"><a href="#cb5-86" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;mean_temp_by_biome&#39;</span><span class="op">,</span></span>
<span id="cb5-87"><a href="#cb5-87" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">&#39;CSV&#39;</span><span class="op">,</span></span>
<span id="cb5-88"><a href="#cb5-88" tabindex="-1"></a>  <span class="dt">selectors</span><span class="op">:</span> [<span class="st">&#39;BIOME_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;meantemp&#39;</span>]</span>
<span id="cb5-89"><a href="#cb5-89" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="zonal-statistics---raster" class="section level2">
<h2>06. Zonal Statistics - Raster</h2>
<p><a
href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Advanced%3A01-Reducers%2F06b_Zonal_Statistics_Raster_(complete)"
target="_blank">Open in Code Editor ↗</a></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">// Raster Zonal Statistics</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">// We want to use unsupervised classification on a source image</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">// and automatically detect water cluster by picking the cluster</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">// with highest MNDWI value.</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">// Create a composite for the selected region</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="kw">var</span> admin2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&quot;FAO/GAUL_SIMPLIFIED_500m/2015/level2&quot;</span>)<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&quot;COPERNICUS/S2_SR_HARMONIZED&quot;</span>)<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="kw">var</span> selected <span class="op">=</span> admin2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;ADM2_NAME&#39;</span><span class="op">,</span> <span class="st">&#39;Bangalore Urban&#39;</span>))</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> selected<span class="op">.</span><span class="fu">geometry</span>()</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">// Cloud masking function</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>  <span class="co">// Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>  <span class="co">// Return the masked and scaled data, without the QA bands.</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B.*&#39;</span>)</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&#39;system:time_start&#39;</span>])</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>}</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="kw">var</span> filtered <span class="op">=</span> s2<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">30</span>))</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">date</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span> <span class="st">&#39;2020-01-01&#39;</span>))</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">bounds</span>(geometry))</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskS2clouds)<span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>  </span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> filtered<span class="op">.</span><span class="fu">median</span>()<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span> </span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">// Calculate  Normalized Difference Vegetation Index (NDWI)</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co">// &#39;GREEN&#39; (B3) and &#39;NIR&#39; (B8)</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="kw">var</span> ndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B8&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;ndwi&#39;</span>])<span class="op">;</span></span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a> </span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a><span class="co">// Calculate Modified Normalized Difference Water Index (MNDWI)</span></span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a><span class="co">// &#39;GREEN&#39; (B3) and &#39;SWIR1&#39; (B11)</span></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a><span class="kw">var</span> mndwi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B11&#39;</span>])<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;mndwi&#39;</span>])<span class="op">;</span> </span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a><span class="co">// Select the MIR (SWIR2) band (B12)</span></span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a><span class="kw">var</span> mir2 <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B12&#39;</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0001</span>)<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;mir2&#39;</span>)</span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a><span class="kw">var</span> stackedImage <span class="op">=</span> ndwi<span class="op">.</span><span class="fu">addBands</span>(mndwi)<span class="op">.</span><span class="fu">addBands</span>(mir2)</span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a><span class="co">// Make the training dataset for unsupervised clustering</span></span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a><span class="kw">var</span> training <span class="op">=</span> stackedImage<span class="op">.</span><span class="fu">sample</span>({</span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a>  <span class="dt">numPixels</span><span class="op">:</span> <span class="dv">1000</span></span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a><span class="fu">print</span>(training<span class="op">.</span><span class="fu">first</span>())</span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a><span class="co">// Instantiate the clusterer and train it.</span></span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a><span class="kw">var</span> clusterer <span class="op">=</span> ee<span class="op">.</span><span class="at">Clusterer</span><span class="op">.</span><span class="fu">wekaCascadeKMeans</span>({</span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a>  <span class="dt">minClusters</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a>  <span class="dt">maxClusters</span><span class="op">:</span> <span class="dv">10</span>})<span class="op">.</span><span class="fu">train</span>(training)<span class="op">;</span></span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a><span class="co">// Cluster the stacked image</span></span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a><span class="kw">var</span> clustered <span class="op">=</span> stackedImage<span class="op">.</span><span class="fu">cluster</span>(clusterer)<span class="op">;</span></span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a><span class="co">// Visualize the results</span></span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setCenter</span>(<span class="fl">77.61</span><span class="op">,</span> <span class="fl">13.08</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(geometry<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-70"><a href="#cb6-70" tabindex="-1"></a><span class="kw">var</span> rgbVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span> <span class="st">&#39;B3&#39;</span><span class="op">,</span> <span class="st">&#39;B2&#39;</span>]}<span class="op">;</span></span>
<span id="cb6-71"><a href="#cb6-71" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> rgbVis<span class="op">,</span> <span class="st">&#39;Image&#39;</span>)<span class="op">;</span></span>
<span id="cb6-72"><a href="#cb6-72" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(clustered<span class="op">.</span><span class="fu">randomVisualizer</span>()<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;clusters&#39;</span>)</span>
<span id="cb6-73"><a href="#cb6-73" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" tabindex="-1"></a><span class="co">// We need to identify which of the clusters represent water</span></span>
<span id="cb6-75"><a href="#cb6-75" tabindex="-1"></a><span class="co">// We use the MNDWI band and select the cluster with the </span></span>
<span id="cb6-76"><a href="#cb6-76" tabindex="-1"></a><span class="co">// highest average MNDWI values of all pixels within the cluster</span></span>
<span id="cb6-77"><a href="#cb6-77" tabindex="-1"></a></span>
<span id="cb6-78"><a href="#cb6-78" tabindex="-1"></a><span class="co">// Calculate the stats on MNDWI band, grouped by clusters</span></span>
<span id="cb6-79"><a href="#cb6-79" tabindex="-1"></a><span class="kw">var</span> stats <span class="op">=</span> mndwi<span class="op">.</span><span class="fu">addBands</span>(clustered)<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb6-80"><a href="#cb6-80" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">.</span><span class="fu">group</span>({</span>
<span id="cb6-81"><a href="#cb6-81" tabindex="-1"></a>    <span class="dt">groupField</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-82"><a href="#cb6-82" tabindex="-1"></a>    <span class="dt">groupName</span><span class="op">:</span> <span class="st">&#39;cluster&#39;</span><span class="op">,</span></span>
<span id="cb6-83"><a href="#cb6-83" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb6-84"><a href="#cb6-84" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb6-85"><a href="#cb6-85" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="co">// Approximate stats</span></span>
<span id="cb6-86"><a href="#cb6-86" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e8</span></span>
<span id="cb6-87"><a href="#cb6-87" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-88"><a href="#cb6-88" tabindex="-1"></a><span class="fu">print</span>(stats)</span>
<span id="cb6-89"><a href="#cb6-89" tabindex="-1"></a></span>
<span id="cb6-90"><a href="#cb6-90" tabindex="-1"></a><span class="co">// Extract the cluster-wise stats as a list of lists</span></span>
<span id="cb6-91"><a href="#cb6-91" tabindex="-1"></a><span class="co">// We get a list in the following format</span></span>
<span id="cb6-92"><a href="#cb6-92" tabindex="-1"></a><span class="co">// [[avg_mndwi, cluster_number], [avg_mndwi, cluster_number] ...]]</span></span>
<span id="cb6-93"><a href="#cb6-93" tabindex="-1"></a><span class="kw">var</span> groupStats <span class="op">=</span> ee<span class="op">.</span><span class="fu">List</span>(stats<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;groups&#39;</span>))</span>
<span id="cb6-94"><a href="#cb6-94" tabindex="-1"></a></span>
<span id="cb6-95"><a href="#cb6-95" tabindex="-1"></a><span class="kw">var</span> groupStatsLists <span class="op">=</span> groupStats<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(item) {</span>
<span id="cb6-96"><a href="#cb6-96" tabindex="-1"></a>      <span class="kw">var</span> areaDict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(item)</span>
<span id="cb6-97"><a href="#cb6-97" tabindex="-1"></a>      <span class="kw">var</span> clusterNumber <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(</span>
<span id="cb6-98"><a href="#cb6-98" tabindex="-1"></a>        areaDict<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;cluster&#39;</span>))</span>
<span id="cb6-99"><a href="#cb6-99" tabindex="-1"></a>      <span class="kw">var</span> mndwi <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(</span>
<span id="cb6-100"><a href="#cb6-100" tabindex="-1"></a>        areaDict<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;mean&#39;</span>))</span>
<span id="cb6-101"><a href="#cb6-101" tabindex="-1"></a>      <span class="cf">return</span> ee<span class="op">.</span><span class="fu">List</span>([mndwi<span class="op">,</span> clusterNumber])</span>
<span id="cb6-102"><a href="#cb6-102" tabindex="-1"></a>    })</span>
<span id="cb6-103"><a href="#cb6-103" tabindex="-1"></a>    </span>
<span id="cb6-104"><a href="#cb6-104" tabindex="-1"></a><span class="co">// Use the ee.Reducer.max() on the list of lists</span></span>
<span id="cb6-105"><a href="#cb6-105" tabindex="-1"></a><span class="co">// It will pick the list with the highest MNDWI</span></span>
<span id="cb6-106"><a href="#cb6-106" tabindex="-1"></a><span class="kw">var</span> waterClusterList <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(ee<span class="op">.</span><span class="fu">List</span>(groupStatsLists)<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">2</span>)))</span>
<span id="cb6-107"><a href="#cb6-107" tabindex="-1"></a></span>
<span id="cb6-108"><a href="#cb6-108" tabindex="-1"></a><span class="co">// Extract the cluster number</span></span>
<span id="cb6-109"><a href="#cb6-109" tabindex="-1"></a><span class="kw">var</span> waterCluster <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(waterClusterList<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;max1&#39;</span>))</span>
<span id="cb6-110"><a href="#cb6-110" tabindex="-1"></a></span>
<span id="cb6-111"><a href="#cb6-111" tabindex="-1"></a><span class="co">// Select all pixels from the water cluster and mask everything else</span></span>
<span id="cb6-112"><a href="#cb6-112" tabindex="-1"></a><span class="kw">var</span> water <span class="op">=</span> clustered<span class="op">.</span><span class="fu">eq</span>(waterCluster)<span class="op">.</span><span class="fu">selfMask</span>()</span>
<span id="cb6-113"><a href="#cb6-113" tabindex="-1"></a></span>
<span id="cb6-114"><a href="#cb6-114" tabindex="-1"></a><span class="kw">var</span> waterVis <span class="op">=</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> [<span class="st">&#39;white&#39;</span><span class="op">,</span> <span class="st">&#39;blue&#39;</span>]}</span>
<span id="cb6-115"><a href="#cb6-115" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(water<span class="op">,</span> waterVis<span class="op">,</span> <span class="st">&#39;water&#39;</span>)</span>
<span id="cb6-116"><a href="#cb6-116" tabindex="-1"></a></span>
<span id="cb6-117"><a href="#cb6-117" tabindex="-1"></a><span class="co">// Interactive visualization may time-out for large images</span></span>
<span id="cb6-118"><a href="#cb6-118" tabindex="-1"></a><span class="co">// Export the image to use the batch processing mode</span></span>
<span id="cb6-119"><a href="#cb6-119" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb6-120"><a href="#cb6-120" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span> water<span class="op">,</span></span>
<span id="cb6-121"><a href="#cb6-121" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;Water_Cluster&#39;</span><span class="op">,</span></span>
<span id="cb6-122"><a href="#cb6-122" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;earthengine&#39;</span><span class="op">,</span></span>
<span id="cb6-123"><a href="#cb6-123" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">&#39;water_cluster&#39;</span><span class="op">,</span></span>
<span id="cb6-124"><a href="#cb6-124" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> geometry<span class="op">,</span></span>
<span id="cb6-125"><a href="#cb6-125" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb6-126"><a href="#cb6-126" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e10</span>}) </span>
<span id="cb6-127"><a href="#cb6-127" tabindex="-1"></a>  </span></code></pre></div>
</div>
</div>
<div id="joins" class="section level1">
<h1>Joins</h1>
<p><em>Coming Soon…</em></p>
</div>
<div id="regressions" class="section level1">
<h1>Regressions</h1>
<p><em>Coming Soon…</em></p>
</div>
<div id="vector-data-processing-and-visualization"
class="section level1">
<h1>Vector Data Processing and Visualization</h1>
<p><em>Coming Soon…</em></p>
<hr />
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>The course material (text, images, presentation, videos) is licensed
under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative
Commons Attribution 4.0 International License</a>.</p>
<p>The code (scripts, Jupyter notebooks) is licensed under the MIT
License. For a copy, see <a href="https://opensource.org/licenses/MIT"
class="uri">https://opensource.org/licenses/MIT</a></p>
<p>You are free to re-use and adapt the material but are required to
give appropriate credit to the original author as below:</p>
<p>Copyright © 2023 Ujaval Gandhi <a
href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
</div>
<div id="citing-and-referencing" class="section level1">
<h1>Citing and Referencing</h1>
<p>You can cite the course materials as follows</p>
<ul>
<li>Gandhi, Ujaval, 2023. <em>Advanced Concepts in Google Earth
Engine</em> course. Spatial Thoughts. <a
href="https://courses.spatialthoughts.com/gee-advanced.html"
class="uri">https://courses.spatialthoughts.com/gee-advanced.html</a></li>
</ul>
<hr />
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
