<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>QGIS Automation using Actions (Workshop Material)</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<style>
.copy-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  padding: 4px 8px;
  font-size: 18px;
  background: #969696;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.3s;
}

.copy-btn:hover {
  opacity: 1;
}

.copy-btn.copied {
  background: #636363;
}

pre {
  position: relative;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Find all code blocks
  const codeBlocks = document.querySelectorAll('pre code');
  
  codeBlocks.forEach(function(codeBlock) {
    const pre = codeBlock.parentElement;
    
    // Create copy button
    const button = document.createElement('button');
    button.className = 'copy-btn';
    button.textContent = '⎘';
    
    // Add button to pre element
    pre.appendChild(button);
    
    // Add click event
    button.addEventListener('click', function() {
      // Create temporary textarea to copy text
      const textarea = document.createElement('textarea');
      textarea.value = codeBlock.textContent;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      
      // Update button text
      button.textContent = 'Copied!';
      button.classList.add('copied');
      
      // Reset button after 2 seconds
      setTimeout(function() {
        button.textContent = '⎘';
        button.classList.remove('copied');
      }, 2000);
    });
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">QGIS Automation using Actions (Workshop
Material)</h1>
<h3 class="subtitle">Learn how to build and apply PyQGIS Actions to
automate tasks in QGIS.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#software" id="toc-software">Software</a></li>
<li><a href="#get-the-data-package" id="toc-get-the-data-package">Get
the Data Package</a></li>
<li><a href="#hello-world" id="toc-hello-world">1. Hello World</a>
<ul>
<li><a href="#extract-a-feature-from-a-layer"
id="toc-extract-a-feature-from-a-layer">1.1 Extract a Feature from a
Layer</a></li>
<li><a href="#exercise-1" id="toc-exercise-1">Exercise 1</a></li>
</ul></li>
<li><a href="#automate-data-editing-and-selection"
id="toc-automate-data-editing-and-selection">2. Automate Data Editing
and Selection</a>
<ul>
<li><a href="#select-multiple-features"
id="toc-select-multiple-features">2.1 Select Multiple Features</a></li>
<li><a href="#exercise-2" id="toc-exercise-2">Exercise 2</a></li>
<li><a href="#update-field-values" id="toc-update-field-values">2.2
Update Field Values</a></li>
<li><a href="#exercise-3" id="toc-exercise-3">Exercise 3</a></li>
</ul></li>
<li><a href="#manage-imagery-collections"
id="toc-manage-imagery-collections">3. Manage Imagery Collections</a>
<ul>
<li><a href="#load-and-remove-raster-layers"
id="toc-load-and-remove-raster-layers">3.1 Load and Remove Raster
Layers</a></li>
<li><a href="#exercise-4" id="toc-exercise-4">Exercise 4</a></li>
</ul></li>
<li><a href="#supplement" id="toc-supplement">Supplement</a>
<ul>
<li><a href="#select-features-in-a-buffer-zone"
id="toc-select-features-in-a-buffer-zone">Select Features in a Buffer
Zone</a></li>
<li><a href="#reversing-line-direction-using-processing-algorithm"
id="toc-reversing-line-direction-using-processing-algorithm">Reversing
Line Direction using Processing Algorithm</a></li>
<li><a href="#creating-isochrones-using-ors-tools-plugin"
id="toc-creating-isochrones-using-ors-tools-plugin">Creating Isochrones
using ORS Tools plugin</a></li>
<li><a href="#view-panorama-from-mapillary"
id="toc-view-panorama-from-mapillary">View Panorama from
Mapillary</a></li>
</ul></li>
<li><a href="#data-credits" id="toc-data-credits">Data Credits</a></li>
<li><a href="#license" id="toc-license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>QGIS allows you to define custom Actions on map layers. Actions can
launch commands or run python code when the user clicks on a feature
from the layer. This workshop will cover QGIS Actions in detail along
with use cases on how you can harness its power to automate GIS
workflows. We will focus on Python Actions and go through various
examples of implementing new functionality and automating tasks with
just a few lines of PyQGIS code.</p>
<p>This workshop requires prior knowledge of Python and familiarity with
PyQGIS API.</p>
<p><a
href="https://docs.google.com/presentation/d/16CiiFs3mLyQIrDXf4Uc50DFwRHsmCeMRpo1i25JNk-s/edit?usp=sharing"
target="_blank"><img src="images/qgis_actions/introduction.png"
width="400" alt="View Presentation" /></a></p>
<p><a
href="https://docs.google.com/presentation/d/16CiiFs3mLyQIrDXf4Uc50DFwRHsmCeMRpo1i25JNk-s/edit?usp=sharing"
target="_blank">View the Presentation ↗</a></p>
</div>
<div id="software" class="section level1">
<h1>Software</h1>
<p>This workshop requires QGIS LTR version 3.40.</p>
<p>Please review <a href="install-qgis-ltr.html">QGIS-LTR Installation
Guide</a> for step-by-step instructions.</p>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The code examples in this workshop use a variety of datasets. All the
required layers, project files etc. are supplied to you in the zip file
<code>qgis-actions.zip</code>. Unzip this file to the
<code>Downloads</code> directory.</p>
<p>The data package also comes with a <code>solutions</code> folder that
contain model solutions for each section.</p>
<p>Download <a
href="https://github.com/spatialthoughts/courses/releases/download/data/qgis_actions.zip">qgis-actions.zip</a>.</p>
</div>
<div id="hello-world" class="section level1">
<h1>1. Hello World</h1>
<p>Let’s get started by learning the basics of QGIS Actions.</p>
<div id="extract-a-feature-from-a-layer" class="section level2">
<h2>1.1 Extract a Feature from a Layer</h2>
<p>We will create an action that takes a layer of all countries in the
world and allows you to extract any country polygon by clicking on
it.</p>
<ol style="list-style-type: decimal">
<li>Open QGIS. QGIS comes with a few hidden <em>Easter Eggs</em> that
can be triggered by typing a keyword in the <em>Coordinate</em> box at
the bottom of the main window. While many of these are for fun, some
provide useful functionality. One such hidden feature is the ability to
load a world map by typing a keyword. Enter the keyword
<strong>world</strong> into the coordinate box at the bottom of the QGIS
window rm and click <em>Enter</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>A new layer named <code>World Map</code> will be added to the
<em>Layers</em> panel. This layer is the <a
href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">Admin0
- Countries</a> boundaries dataset from Natural Earth. Let’s define an
action on this layer. Right-click the layer and select
<em>Properties</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Switch to the <em>Actions</em> tab and click the <em>Add a new
action</em> (<em>+</em>) button.</li>
</ol>
<p><img src="images/qgis_actions/helloworld3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Select <strong>Python</strong> as the <em>Type</em>. Enter
<strong>Hello World</strong> as the <em>Description</em>. This will be
the name of the action as it appears in various menu items. Leave the
<em>Action Scopes</em> to the default selected values of
<strong>Feature</strong> and <strong>Canvas</strong>. Under the
<em>Action Text</em> enter the following Python code and click
<em>OK</em>.</li>
</ol>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Hello World&#39;</span>)</span></code></pre></div>
<p><img src="images/qgis_actions/helloworld4.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Click <em>OK</em> again to get back to the main QGIS Canvas. We now
have an action that will print <code>Hello World</code> when we click on
a feature. To see the output, open the <em>Python Console</em> from
<strong>Plugins → Python Console</strong>. Locate the <em>Actions</em>
button on the <em>Attributes Toolbar</em>. Click the dropdown menu next
to it and select <em>Hello World</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Once the action is selected, click on any feature from the layer.
You will see <em>Hello World</em> printed in the console.</li>
</ol>
<p><img src="images/qgis_actions/helloworld6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>You now know how to define and trigger a Python action. Let’s make
the action more useful. Instead of printing a static text, let’s modify
the action to print the name of the country where we clicked. Open the
<em>Attribute Table</em> of the <code>World Map</code> layer. You will
notice that the <strong>NAME</strong> attribute contains the country
names.</li>
</ol>
<p><img src="images/qgis_actions/helloworld7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Right click the <code>World Map</code> layer and select
<em>Properties</em>. From the <em>Actions</em> tab, double click the
already defined <em>Hello World</em> action.</li>
</ol>
<p><img src="images/qgis_actions/helloworld8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Our action is triggered by clicking on a feature and we can access
the attributes of that feature. Select the <strong>NAME</strong>
attribute and click <em>Insert</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld9.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>You will see the value <code>[%NAME%]</code> entered in the
<em>Action Text</em> text box. This is a special expression syntax which
indicates that the value surrounded by <code>[%</code> and
<code>%]</code> will be replaced with the value of the attribute from
the feature when the action is triggered.</li>
</ol>
<p><img src="images/qgis_actions/helloworld10.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Update the code to print the attribute value as below.</li>
</ol>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;[%NAME%]&#39;</span>)</span></code></pre></div>
<p><img src="images/qgis_actions/helloworld11.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>Click <em>OK</em> and get back to the main window. Select the action
and click on any feature. You will now see the name of the country
printed in the console.</li>
</ol>
<p><img src="images/qgis_actions/helloworld12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Along with all the attributes of the clicked feature, we also have
access to other project and layer variables. Update the code as below to
print the values of the feature id and layer id along with the value of
the <code>NAME</code> attribute. Note that we are using the Python <a
href="https://realpython.com/python-string-formatting/#3-string-interpolation-f-strings-python-36">f-strings</a>
for formatting the output.</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>feature_name <span class="op">=</span> <span class="st">&#39;[%NAME%]&#39;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>feature_id <span class="op">=</span> [<span class="op">%</span>$id<span class="op">%</span>]</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;feature name: </span><span class="sc">{</span>feature_name<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;feature id: </span><span class="sc">{</span>feature_id<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;layer id: </span><span class="sc">{</span>layer_id<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<p><img src="images/qgis_actions/helloworld13.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>Click <em>OK</em> and try the action again. This time you will see
the feature id and layer id printed along with the feature name.</li>
</ol>
<p><img src="images/qgis_actions/helloworld14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>Now you know how to access the <code>@layer_id</code> and
<code>$id</code> values of the current feature. We can now use it to
extract the current feature and create a new layer from it. Replace the
<em>Action Text</em> with the following code which uses <a
href="https://qgis.org/pyqgis/3.0/core/Feature/QgsFeatureSource.html#qgis.core.QgsFeatureSource.materialize"><code>QgsFeatureSource.materialize()</code></a>
method to create a new memory based vector layer with the query
containing the feature id.</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>feature_name <span class="op">=</span> <span class="st">&#39;[%NAME%]&#39;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>feature_id <span class="op">=</span> [<span class="op">%</span>$id<span class="op">%</span>]</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>new_layer <span class="op">=</span> layer.materialize(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    QgsFeatureRequest().setFilterFids([feature_id]))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>new_layer.setName(feature_name)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>QgsProject.instance().addMapLayer(new_layer)</span></code></pre></div>
<p><img src="images/qgis_actions/helloworld15.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="16" style="list-style-type: decimal">
<li>Go back to the main Canvas and close the <em>Python Console</em>.
Select the <em>Hello World</em> action and click on any feature. You
will see a new layer added to the <em>Layers</em> panel that contains
the feature. Really useful!</li>
</ol>
<p><img src="images/qgis_actions/helloworld16.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="17" style="list-style-type: decimal">
<li>We have a small problem. As the new layer is created and added to
the <em>Layers</em> panel, it becomes the active layer. To trigger the
action again, we have to select the <code>World Map</code> layer again.
To prevent this, we can use <a
href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.setActiveLayer"><code>QgisInterface.setActiveLayer()</code></a>
method to set the current layer as the active layer. We import
<code>iface</code> in the code to access the current instance of the
<code>QgisInterface</code> class.</li>
</ol>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>feature_name <span class="op">=</span> <span class="st">&#39;[%NAME%]&#39;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>feature_id <span class="op">=</span> [<span class="op">%</span>$id<span class="op">%</span>]</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>new_layer <span class="op">=</span> layer.materialize(</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    QgsFeatureRequest().setFilterFids([feature_id]))</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>new_layer.setName(feature_name)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>QgsProject.instance().addMapLayer(new_layer)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>iface.setActiveLayer(layer)</span></code></pre></div>
<p><img src="images/qgis_actions/helloworld17.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="18" style="list-style-type: decimal">
<li>Now you are able to click around and extract multiple countries
without having to manually switch layers.</li>
</ol>
<p><img src="images/qgis_actions/helloworld18.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We have now finished this section and you are ready to do the
exercise. Your can load the <code>HelloWorld_Checkpoint1.qgz</code> file
in the <code>solutions</code> folder to catch up to this point.</p>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise 1</h2>
<p>Update the action to display an <em>Info</em> message on the QGIS
message bar as shown below.</p>
<p>Hint: You can use <a
href="https://qgis.org/pyqgis/3.0/gui/Message/QgsMessageBar.html#qgis.gui.QgsMessageBar.pushInfo">iface.messageBar().pushInfo()</a>
method to display a message.</p>
<p><img src="images/qgis_actions/helloworld_exercise.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="automate-data-editing-and-selection" class="section level1">
<h1>2. Automate Data Editing and Selection</h1>
<p>In this section, we will work with a dataset of land parcels and
learn how QGIS Actions can be used to speed up data selection and
editing.</p>
<div id="select-multiple-features" class="section level2">
<h2>2.1 Select Multiple Features</h2>
<ol style="list-style-type: decimal">
<li>Open the <code>Parcels_Multi_Select.qgz</code> project from your
data package.</li>
</ol>
<p><img src="images/qgis_actions/multiselect1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Select the <code>parcels</code> layer and open the <em>Attribute
Table</em>. The <strong>mapblklot</strong> attribute contains a unique
identifier for each parcels and the <strong>block_num</strong> attribute
has a unique identifier for each city block.</li>
</ol>
<p><img src="images/qgis_actions/multiselect2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>A city block is a group of parcels that is surrounded by streets. If
we select a few parcels belonging to the same city block, you will see
that they all have the same value for the <strong>block_num</strong>
attribute.</li>
</ol>
<p><img src="images/qgis_actions/multiselect3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>A common task while managing such data is to select all parcels
belonging to the same block. Let’s build an action that allows us to
select all parcels from a block with a single click. Right-click the
<code>parcels</code> layer and select <em>Properties</em>.</li>
</ol>
<p><img src="images/qgis_actions/multiselect4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Switch to the <em>Actions</em> tab and click the <em>Add a new
action</em> (<em>+</em>) button.</li>
</ol>
<p><img src="images/qgis_actions/multiselect5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Select <strong>Python</strong> as the <em>Type</em>. Enter
<strong>Select all Parcels from the Block</strong> as the
<em>Description</em>. Leave the <em>Action Scopes</em> to the default
selected values of <strong>Feature</strong> and <strong>Canvas</strong>.
Under the <em>Action Text</em> enter the following Python code and click
<em>OK</em>. Click <em>OK</em> again to get back to the main QGIS
Canvas.</li>
</ol>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>field_name <span class="op">=</span> <span class="st">&#39;block_num&#39;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>field_value <span class="op">=</span> <span class="st">&#39;[%block_num%]&#39;</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>expression <span class="op">=</span> <span class="ss">f&#39;&quot;</span><span class="sc">{</span>field_name<span class="sc">}</span><span class="ss">&quot; = </span><span class="ch">\&#39;</span><span class="sc">{</span>field_value<span class="sc">}</span><span class="ch">\&#39;</span><span class="ss">&#39;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="bu">print</span>(expression)</span></code></pre></div>
<p><img src="images/qgis_actions/multiselect6.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>This action is going to print an expression that can be used to
select all parcels from the same block as the parcel where you clicked.
Let’s test this. Open the <em>Python Console</em> from <strong>Plugins →
Python Console</strong>. Locate the <em>Actions</em> button on the
<em>Attributes Toolbar</em>. Click the dropdown menu next to it and
select <em>Select all Parcels from the Block</em>. Click on any parcel.
You will see an expression printed in the console.</li>
</ol>
<p><img src="images/qgis_actions/multiselect7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>The expression should work to select all parcels having the same
block number. Let’s update the action with the code as follows.</li>
</ol>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>field_name <span class="op">=</span> <span class="st">&#39;block_num&#39;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>field_value <span class="op">=</span> <span class="st">&#39;[%block_num%]&#39;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>expression <span class="op">=</span> <span class="ss">f&#39;&quot;</span><span class="sc">{</span>field_name<span class="sc">}</span><span class="ss">&quot; = </span><span class="ch">\&#39;</span><span class="sc">{</span>field_value<span class="sc">}</span><span class="ch">\&#39;</span><span class="ss">&#39;</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>layer.selectByExpression(expression)</span></code></pre></div>
<p><img src="images/qgis_actions/multiselect8.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Trigger the action again and click on any parcels. This time you
will see that all the parcels from the block will be selected.</li>
</ol>
<p><img src="images/qgis_actions/multiselect9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>If you use the action again, the current selection will go away and
a new selection will be made. We can change this behavior by supplying
an addition <em>behavior</em> option to the <a
href="https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectByExpression"><code>QgsVectorLayer.selectByExpression()</code></a>
method. Update the code as below.</li>
</ol>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>field_name <span class="op">=</span> <span class="st">&#39;block_num&#39;</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>field_value <span class="op">=</span> <span class="st">&#39;[%block_num%]&#39;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>expression <span class="op">=</span> <span class="ss">f&#39;&quot;</span><span class="sc">{</span>field_name<span class="sc">}</span><span class="ss">&quot; = </span><span class="ch">\&#39;</span><span class="sc">{</span>field_value<span class="sc">}</span><span class="ch">\&#39;</span><span class="ss">&#39;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>layer.selectByExpression(expression, QgsVectorLayer.AddToSelection)</span></code></pre></div>
<p><img src="images/qgis_actions/multiselect10.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Now as you click on multiple parcels, the new block selection will
be added to the previous selections.</li>
</ol>
<p><img src="images/qgis_actions/multiselect11.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We have now finished this section and you are ready to do the
exercise. Your can load the
<code>Parcels_Multi_Select_Checkpoint1.qgz</code> file in the
<code>solutions</code> folder to catch up to this point.</p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise 2</h2>
<p>Add another action to the <code>parcels</code> layer called
<em>Extract Selected Features</em>. This action should create a new
memory layer from the selected parcels. The following code block shows
how to get a list of selected feature ids that can be used in your
solution.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>selected_ids <span class="op">=</span> [feature.<span class="bu">id</span>() <span class="cf">for</span> feature <span class="kw">in</span> layer.selectedFeatures()]</span></code></pre></div>
<p><strong>Hint</strong>: Use <a
href="https://qgis.org/pyqgis/3.0/core/Feature/QgsFeatureSource.html#qgis.core.QgsFeatureSource.materialize"><code>QgsFeatureSource.materialize()</code></a>
method we learnt in the previous section.</p>
<p><img src="images/qgis_actions/multiselect_exercise.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="update-field-values" class="section level2">
<h2>2.2 Update Field Values</h2>
<ol style="list-style-type: decimal">
<li>Open the <code>Parcels_QA.qgz</code> project from your data
package.</li>
</ol>
<p><img src="images/qgis_actions/qa2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>This project contains the same <code>parcels</code> layer that has
been styled and labeled using the values from the
<strong>checked</strong> column. This column contains the value of
either <strong>Y</strong> or <strong>N</strong>. Let’s say we are tasked
with checking each feature and then updating the value of this field to
<strong>Y</strong> once it has been checked. Let’s setup an action to
automate this QA process.</li>
</ol>
<p><img src="images/qgis_actions/qa2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Right-click the <code>parcels</code> layer and select
<em>Properties</em>.</li>
</ol>
<p><img src="images/qgis_actions/qa3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Switch to the <em>Actions</em> tab and click the <em>Add a new
action</em> (<em>+</em>) button. Select <strong>Python</strong> as the
<em>Type</em>. Enter <strong>Mark QA Done</strong> as the
<em>Description</em>. Leave the <em>Action Scopes</em> to the default
selected values of <strong>Feature</strong> and <strong>Canvas</strong>.
Under the <em>Action Text</em> enter the following Python code and click
<em>OK</em>. This code uses <a
href="https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.changeAttributeValue"><code>QgsVectorLayer.changeAttributeValue()</code></a>
method to update the field <strong>checked</strong>’s value to
<strong>Y</strong>. Note that we are using the
<code>with edit(layer)</code> statement to wrap our editing code in a
more semantic code block. This will ensure that the changes committed at
the end or rolled back appropriately if there are any errors.</li>
</ol>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>feature_id <span class="op">=</span> [<span class="op">%</span>$id<span class="op">%</span>]</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>field_name <span class="op">=</span> <span class="st">&#39;checked&#39;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>layer <span class="op">=</span> QgsProject().instance().mapLayer(layer_id)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>field <span class="op">=</span> layer.fields().lookupField(field_name)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="cf">with</span> edit(layer):</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    layer.changeAttributeValue(feature_id, field, <span class="st">&#39;Y&#39;</span>)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    iface.messageBar().pushInfo(<span class="st">&#39;Success&#39;</span>, <span class="st">&#39;Field Value Updated&#39;</span>)</span></code></pre></div>
<p><img src="images/qgis_actions/qa4.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Click <em>OK</em> again to get back to the main QGIS Canvas. Select
the action and click on any parcel with the <strong>N</strong> label.
You will see that the value is updated and the parcel turns green
instantly.</li>
</ol>
<p><img src="images/qgis_actions/qa5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Actions can also be triggered from other interfaces. Let’s add this
action to the attribute table. Right-click the <code>parcels</code>
layer and select <em>Properties</em>. Switch to the <em>Actions</em>
tab. At the bottom, check the <em>Show in Attribute Table</em> box.
Click <em>OK</em>.</li>
</ol>
<p><img src="images/qgis_actions/qa6.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Click <em>OK</em> again to get back to the main QGIS Canvas. Open
the <em>Attribute Table</em> for the <code>parcels</code> layer. You
will notice that there is a new <em>Actions</em> column with the
<em>Mark QA Done</em> action added to the table. You can click on the
button to trigger the action for each feature.</li>
</ol>
<p><img src="images/qgis_actions/qa7.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We have now finished this section and you are ready to do the
exercise. Your can load the <code>Parcels_QA_Checkpoint1.qgz</code> file
in the <code>solutions</code> folder to catch up to this point.</p>
</div>
<div id="exercise-3" class="section level2">
<h2>Exercise 3</h2>
<p>Add another action to the <code>parcels</code> layer called
<em>Delete Parcel</em>. This action should delete the feature when
selected. Use the following code block to start working on your
solution.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>feature_id <span class="op">=</span> [<span class="op">%</span>$id<span class="op">%</span>]</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span></code></pre></div>
<p><em>Hint:</em> You can use <a
href="https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.deleteFeature"><code>QgsVectorLayer.deleteFeature()</code></a>
method to delete a feature by its feature id.</p>
<p><img src="images/qgis_actions/qa_exercise.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="manage-imagery-collections" class="section level1">
<h1>3. Manage Imagery Collections</h1>
<p>Actions also provide a simple and intuitive way to manage large
imagery collections using QGIS. In this section, we will learn how to
create a <em>Tile Index</em> and setup actions to interactively load and
remove raster layers of interest.</p>
<div id="load-and-remove-raster-layers" class="section level2">
<h2>3.1 Load and Remove Raster Layers</h2>
<ol style="list-style-type: decimal">
<li>The first step in our process is to create a tile index layer from a
set of raster files in your data package. Open the QGIS Processing
Toolbox from <strong>Processing → Toolbox</strong>. Search for the
algorithm named <strong>Tile index</strong>. Double-click to open
it.</li>
</ol>
<p><img src="images/qgis_actions/tileindex1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>In the <em>Tile Index</em> dialog, click <em>…</em>.</li>
</ol>
<p><img src="images/qgis_actions/tileindex2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>In the <em>Input files</em> dialog, click <em>Add Directory…</em>
button and browse to the <strong>qgis_actions → imagery</strong> folder.
Click <em>open</em>. Once the files are listed, click <em>OK</em>.</li>
</ol>
<p><img src="images/qgis_actions/tileindex3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Back in the <em>Tile Index</em> dialog, check the <em>Store absolute
path to the indexed rasters</em> box. Leave all other parameters to
their default value and click <em>Run</em>.</li>
</ol>
<p><img src="images/qgis_actions/tileindex4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>A new layer named <em>Tile Index</em> will be loaded in the
<em>Layers</em> panel. This layer has bounding box polygons for each of
the image tiles in the folder along with its path. Open the
<em>Attribute Table</em>. You will see that the path to the raster tiles
is stored in the <em>location</em> attribute.</li>
</ol>
<p><img src="images/qgis_actions/tileindex5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Right-click the <code>Tile Index</code> layer and select
<em>Properties</em>.</li>
</ol>
<p><img src="images/qgis_actions/tileindex6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Switch to the <em>Actions</em> tab and click the <em>Add a new
action</em> (<em>+</em>) button. Select <strong>Python</strong> as the
<em>Type</em>. Enter <strong>Load Selected Tile</strong> as the
<em>Description</em>. Leave the <em>Action Scopes</em> to the default
selected values of <strong>Feature</strong> and <strong>Canvas</strong>.
Under the <em>Action Text</em> enter the following Python code and click
<em>OK</em>.</li>
</ol>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>path <span class="op">=</span> <span class="vs">r&#39;[</span><span class="sc">%lo</span><span class="vs">cation%]&#39;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>iface.addRasterLayer(path)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>file_name <span class="op">=</span> os.path.basename(path)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>iface.messageBar().pushSuccess(</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="st">&#39;Success&#39;</span>, <span class="ss">f&#39;Raster tile </span><span class="sc">{</span>file_name<span class="sc">}</span><span class="ss"> loaded&#39;</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>iface.setActiveLayer(layer)</span></code></pre></div>
<p><img src="images/qgis_actions/tileindex7.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Click <em>OK</em> again to get back to the main QGIS Canvas. Select
the action <em>Load Selected Tile</em> and click on any polygon to load
the raster layer in QGIS. This action allows you to selectively load
only the required tiles.</li>
</ol>
<p><img src="images/qgis_actions/tileindex8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Let’s setup another action to remove the unwanted tile layers.
Right-click the <code>Tile Index</code> layer and select
<em>Properties</em>. Switch to the <em>Actions</em> tab and click the
<em>Add a new action</em> (<em>+</em>) button. Select
<strong>Python</strong> as the <em>Type</em>. Enter <strong>Remove
Selected Tile</strong> as the <em>Description</em>. Leave the <em>Action
Scopes</em> to the default selected values of <strong>Feature</strong>
and <strong>Canvas</strong>. Under the <em>Action Text</em> enter the
following Python code. Here we use the <a
href="https://qgis.org/pyqgis/3.0/core/Project/QgsProject.html#qgis.core.QgsProject.removeMapLayer"><code>QgsProject.removeMapLayer()</code></a>
method to remove the layer. We must also call
<code>iface.mapCanvas().refresh()</code> to see the results. Click
<em>OK</em>.</li>
</ol>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>path <span class="op">=</span> <span class="vs">r&#39;[</span><span class="sc">%lo</span><span class="vs">cation%]&#39;</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>file_name <span class="op">=</span> os.path.basename(path)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>layer_name <span class="op">=</span> os.path.splitext(file_name)[<span class="dv">0</span>]</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>layer_list <span class="op">=</span> QgsProject.instance().mapLayersByName(layer_name)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="cf">if</span> layer_list:</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  QgsProject.instance().removeMapLayer(layer_list[<span class="dv">0</span>])</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  iface.mapCanvas().refresh()</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  iface.messageBar().pushSuccess(</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="st">&#39;Success&#39;</span>, <span class="ss">f&#39;Raster tile </span><span class="sc">{</span>file_name<span class="sc">}</span><span class="ss"> removed.&#39;</span>)</span></code></pre></div>
<p><img src="images/qgis_actions/tileindex9.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Click <em>OK</em> again to get back to the main QGIS Canvas. Select
the action <em>Remove Selected Tile</em> and click on the canvas over
any tile that has been loaded in QGIS. That tile will be removed.</li>
</ol>
<p><img src="images/qgis_actions/tileindex10.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We have now finished this section and you are ready to do the
exercise. Your can load the <code>Tile_Index_Checkpoint1.qgz</code> file
in the <code>solutions</code> folder to catch up to this point.</p>
</div>
<div id="exercise-4" class="section level2">
<h2>Exercise 4</h2>
<p>The action <em>Load Selected Tile</em> allows you to load any tile
multiple times. This is not desirable since it will create duplicate
layers. Update the action to load a tile only if it is not previously
loaded in QGIS. It should display an error message when you try to load
a tile that is already loaded.</p>
<p>Hint: Use <code>iface.messageBar().pushCritical()</code> to display
an error message.</p>
<p><img src="images/qgis_actions/tileindex_exercise.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="supplement" class="section level1">
<h1>Supplement</h1>
<div id="select-features-in-a-buffer-zone" class="section level2">
<h2>Select Features in a Buffer Zone</h2>
<p>Another useful application of action is to select features from a
layer within a buffer zone. Open the <code>Buffer_Select.qgz</code>
project from your data package. This project contains a
<code>roads</code> and a <code>buildings</code> layer. The
<code>roads</code> layer has an action defined called <strong>Select
Buildings within Buffer</strong> that selects all buildings that are
within 20 meters of the selected road segment.</p>
<blockquote>
<p>Note: This example uses <code>line_geometry.boundingBox()</code> in
the <code>getFeatures()</code> method which makes use of the spatial
index (if it exists) to speed up finding the candidate features.</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>fid <span class="op">=</span> [<span class="op">%</span> $id <span class="op">%</span>]</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>distance <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>line_layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>line_feature <span class="op">=</span> line_layer.getFeature(fid)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>line_geometry <span class="op">=</span> line_feature.geometry().<span class="bu">buffer</span>(distance, <span class="dv">5</span>)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>polygon_layer_name <span class="op">=</span> <span class="st">&#39;buildings&#39;</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>polygon_layer <span class="op">=</span> QgsProject.instance().mapLayersByName(polygon_layer_name)[<span class="dv">0</span>]</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>nearby_features <span class="op">=</span> [</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  p.<span class="bu">id</span>() </span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="cf">for</span> p <span class="kw">in</span> polygon_layer.getFeatures(line_geometry.boundingBox()) </span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  <span class="cf">if</span> p.geometry().intersects(line_geometry)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>]</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="cf">if</span> nearby_features:</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  polygon_layer.selectByIds(nearby_features)</span></code></pre></div>
<p>Select the action and click on any road feature. All the buildings
within the buffer zone will be selected.</p>
<p><img src="images/qgis_actions/buffer_select1.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="reversing-line-direction-using-processing-algorithm"
class="section level2">
<h2>Reversing Line Direction using Processing Algorithm</h2>
<p>The QGIS Processing Toolbox contains many useful algorithms. You can
call any algorithms using Python from Actions. This example shows how to
setup an action to run a processing algorithm a line feature to reverse
direction.</p>
<p>We will use the <strong>Vector Geometry → Reverse line
direction</strong> algorithm. By default, all Processing algorithms
create new layer. If we want to edit the layer, we must enable the <a
href="https://docs.qgis.org/testing/en/docs/user_manual/working_with_vector/editing_geometry_attributes.html#the-processing-in-place-layer-modifier">Edit
Features In-Place mode</a>. The same mode can be invoked from PyQGIS via
<code>execute_in_place()</code> method.</p>
<blockquote>
<p>Note: The <em>Advanced Digitizing Toolbar</em> already has a tool
that allows you reverse the line direction for the selected feature.
This example is an implementation of a similar functionality using an
Action.</p>
</blockquote>
<p>Open the <code>Network_Linedirection.qgz</code> project. It contains
a line layer named <code>street_centerlines</code> which has been styled
to show an arrow in the direction of the line. We have defined an action
<strong>Reverse Line Direction</strong> on this layer with the following
code.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">from</span> processing.gui.AlgorithmExecutor <span class="im">import</span> execute_in_place</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>fid <span class="op">=</span> [<span class="op">%</span> $id <span class="op">%</span>]</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>layer.selectByIds([fid])</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>registry <span class="op">=</span> QgsApplication.instance().processingRegistry()</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>algorithm <span class="op">=</span> registry.algorithmById(<span class="st">&#39;native:reverselinedirection&#39;</span>)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>    <span class="st">&#39;INPUT&#39;</span>: layer,</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    <span class="st">&#39;selectedFeaturesOnly&#39;</span>: <span class="va">True</span>,</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>    <span class="st">&#39;featureLimit&#39;</span>: <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>   <span class="st">&#39; geometryCheck&#39;</span>: QgsFeatureRequest.GeometryAbortOnInvalid</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>}</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="cf">with</span> edit(layer):</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>    execute_in_place(algorithm, parameters)</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>    </span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>layer.removeSelection()</span></code></pre></div>
<p>Select the action and click on any line segment. You will see the
line direction will get reversed. Our Python action saves many extra
clicks compared to executing this via the Toolbox.</p>
<p><img src="images/qgis_actions/reverse_line.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="creating-isochrones-using-ors-tools-plugin"
class="section level2">
<h2>Creating Isochrones using ORS Tools plugin</h2>
<p>Similar to native algorithms, we can also call any third-party
algorithms added from QGIS Plugins. This example shows how to use the
<strong>ORS Tools → Isochrones → Isochrones from point</strong>
algorithm to generate a walking-directions isochrone from a point
layer.</p>
<p>Before using this example, you must install the <em>ORS Tools</em>
plugin and configure it. Follow the steps below for configuration after
you have installed the plugin.</p>
<ul>
<li>Visit <a
href="https://openrouteservice.org/dev/#/signup">OpenRouteService
Sign-Up</a> page and create an account. Once your account is activated,
visit your <a
href="https://openrouteservice.org/dev/#/home">Dashboard</a> and request
a token. Select Standard as the Token type and enter
<strong>QGIS</strong> as the Token name. Click <em>CREATE
TOKEN</em>.</li>
<li>In QGIS, go to <strong>Web → ORS Tools → Provider Settings</strong>
and enter the API key created in the previous step.</li>
</ul>
<p>Now you are ready to try out the action. Open the
<code>Stations_Isochrones.qgz</code> project from your data package.
This project has a <code>san_francisco_stations</code> layer with a few
actions such as <strong>Calculate Isochrone (1km)</strong> defined with
code similar to below.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">import</span> processing</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>x_coord <span class="op">=</span> [<span class="op">%@</span>click_x<span class="op">%</span>]</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>y_coord <span class="op">=</span> [<span class="op">%@</span>click_y<span class="op">%</span>]</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>layer_id <span class="op">=</span> <span class="st">&#39;[%@layer_id%]&#39;</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co"># Distance in meters</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>distance <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co"># Check if ORS Tools in available</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>providers <span class="op">=</span> [x.name() <span class="cf">for</span> x <span class="kw">in</span> QgsApplication.processingRegistry().providers()]</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;ORS Tools&#39;</span> <span class="kw">not</span> <span class="kw">in</span> providers:</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    iface.messageBar().pushCritical(<span class="st">&#39;Error&#39;</span>, <span class="st">&#39;This action requires the ORS Tools plugin. Please install and configure the plugin.&#39;</span>)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>    input_point <span class="op">=</span> <span class="ss">f&#39;</span><span class="sc">{</span>x_coord<span class="sc">}</span><span class="ss">,</span><span class="sc">{</span>y_coord<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>    result <span class="op">=</span> processing.run(</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>        <span class="st">&#39;ORS Tools:isochrones_from_point&#39;</span>,{</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>        <span class="st">&#39;INPUT_PROVIDER&#39;</span>:<span class="dv">0</span>,<span class="st">&#39;INPUT_PROFILE&#39;</span>:<span class="dv">6</span>,<span class="st">&#39;INPUT_POINT&#39;</span>: input_point,</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>        <span class="st">&#39;INPUT_METRIC&#39;</span>:<span class="dv">1</span>,<span class="st">&#39;INPUT_RANGES&#39;</span>:<span class="ss">f&#39;</span><span class="sc">{</span>distance<span class="sc">}</span><span class="ss">&#39;</span>, <span class="st">&#39;INPUT_AVOID_FEATURES&#39;</span>:[],</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>        <span class="st">&#39;INPUT_AVOID_BORDERS&#39;</span>:<span class="va">None</span>,<span class="st">&#39;INPUT_AVOID_COUNTRIES&#39;</span>:<span class="st">&#39;&#39;</span>,</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>        <span class="st">&#39;INPUT_SMOOTHING&#39;</span>: <span class="va">None</span>, <span class="st">&#39;LOCATION_TYPE&#39;</span>: <span class="dv">0</span>,</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>        <span class="st">&#39;INPUT_AVOID_POLYGONS&#39;</span>:<span class="va">None</span>,<span class="st">&#39;OUTPUT&#39;</span>:<span class="st">&#39;TEMPORARY_OUTPUT&#39;</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>        }</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>    )</span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>    new_layer <span class="op">=</span> result[<span class="st">&#39;OUTPUT&#39;</span>]</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>    new_layer.setName(<span class="ss">f&#39;Isochrone Polygon (</span><span class="sc">{</span>distance<span class="sc">}</span><span class="ss">m)&#39;</span>)</span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>    QgsProject.instance().addMapLayer(new_layer)</span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>    layer <span class="op">=</span> QgsProject.instance().mapLayer(layer_id)</span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>    iface.setActiveLayer(layer)</span></code></pre></div>
<p>Select the layer and use the action <strong>Calculate Isochrone
(1km)</strong> and click on any point. The OpenRouteService API will
generate a isochrone using the OpenStreetMap(OSM) network and you will
see a polygon of all areas reachable by walk within 1 km of the station.
Similarly, you can try out other actions for different distances.</p>
<p><img src="images/qgis_actions/isochrone.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="view-panorama-from-mapillary" class="section level2">
<h2>View Panorama from Mapillary</h2>
<p>QGIS actions can also be used to query an external API and display
the results. The example below shows how to use the <a
href="https://www.mapillary.com/developer/api-documentation">Mapillary
API</a> to fetch street-level imagery and display them in QGIS.</p>
<p>To try the action, open the <code>Mapillary_Images.qgz</code> project
from the data package. The <code>pharmacies</code> layer has an action
defined called <strong>Show Panorama from Mapillary</strong> with the
code below. Before you can use this action, you will need a <em>Client
Token</em> from Mapillary. <a
href="https://www.mapillary.com/developer">Sign-up for a Mapillary
Developer Account</a> and register a new application. Click on
<em>View</em> under <em>Client Token</em> and obtain your access
token.</p>
<p><img src="images/qgis_actions/mapillary1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Open the code for the action and replace
<code>YOUR_ACCESS_TOKEN</code> with your access token.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="im">from</span> qgis.PyQt.QtCore <span class="im">import</span> QUrl</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="im">from</span> qgis.PyQt.QtWebKitWidgets <span class="im">import</span> QWebView</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="im">from</span> qgis.utils <span class="im">import</span> iface</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co"># Sign up at https://www.mapillary.com/developer</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co"># Replace YOUR_ACCESS_TOKEN with your own token below</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>    <span class="st">&#39;access_token&#39;</span>: <span class="st">&#39;YOUR_ACCESS_TOKEN&#39;</span>,</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>    <span class="st">&#39;bbox&#39;</span>: <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>([<span class="op">%</span>$x<span class="op">%</span>]<span class="op">-</span><span class="fl">0.001</span>,[<span class="op">%</span>$y<span class="op">%</span>]<span class="op">-</span><span class="fl">0.001</span>, [<span class="op">%</span>$x<span class="op">%</span>]<span class="op">+</span><span class="fl">0.001</span>, [<span class="op">%</span>$y<span class="op">%</span>]<span class="op">+</span><span class="fl">0.001</span>),</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>    <span class="st">&#39;fields&#39;</span>: <span class="st">&#39;thumb_1024_url&#39;</span>,</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>    <span class="st">&#39;limit&#39;</span>: <span class="dv">1</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>}</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>        <span class="st">&#39;https://graph.mapillary.com/images&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>    data_json <span class="op">=</span> response.json()</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>    <span class="cf">if</span> data_json[<span class="st">&#39;data&#39;</span>]:</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>        url <span class="op">=</span> data_json[<span class="st">&#39;data&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;thumb_1024_url&#39;</span>]</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>        myWV <span class="op">=</span> QWebView(<span class="va">None</span>)</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>        myWV.load(QUrl(url))</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>        myWV.show()</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>        qgis.utils.iface.messageBar().pushMessage(<span class="st">&#39;No images found&#39;</span>)</span></code></pre></div>
<p>Once the token is updated, you can select the action and click on any
pharmacy location. The action will send a request to mapillary API to
fetch the nearest imagery. It will be then displayed in a new window in
QGIS.</p>
<p><img src="images/qgis_actions/mapillary2.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>Admin0 boundaries: Made with Natural Earth. Free vector and raster
map data @ naturalearthdata.com.</li>
<li>Parcels and Neighborhood boundaries downloaded from <a
href="https://datasf.org/opendata/">DataSF Open Data Portal</a></li>
<li>NAIP 2016 Aerial Imagery for California: The National Agriculture
Imagery Program (NAIP). USDA-FSA-APFO Aerial Photography Field Office.
Downloaded from <a
href="https://nrcs.app.box.com/v/naip/folder/18144379349">NRCS</a></li>
<li>OpenStreetMap (osm) data layers: Data/Maps Copyright 2023 Geofabrik
GmbH and OpenStreetMap Contributors.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This workshop material is licensed under a <a
href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International (CC BY 4.0)</a>. You are free to re-use
and adapt the material but are required to give appropriate credit to
the original author as below:</p>
<p><em>QGIS Automation using Actions</em> by Ujaval Gandhi <a
href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
</div>

<!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to report any issues with this page, please comment below.</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/courses"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
