<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Cloud Native Geospatial Workflows with QGIS (Full workshop)</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<style>
.copy-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  padding: 4px 8px;
  font-size: 18px;
  background: #969696;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.3s;
}

.copy-btn:hover {
  opacity: 1;
}

.copy-btn.copied {
  background: #636363;
}

pre {
  position: relative;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Find all code blocks
  const codeBlocks = document.querySelectorAll('pre code');
  
  codeBlocks.forEach(function(codeBlock) {
    const pre = codeBlock.parentElement;
    
    // Create copy button
    const button = document.createElement('button');
    button.className = 'copy-btn';
    button.textContent = '⎘';
    
    // Add button to pre element
    pre.appendChild(button);
    
    // Add click event
    button.addEventListener('click', function() {
      // Create temporary textarea to copy text
      const textarea = document.createElement('textarea');
      textarea.value = codeBlock.textContent;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      
      // Update button text
      button.textContent = 'Copied!';
      button.classList.add('copied');
      
      // Reset button after 2 seconds
      setTimeout(function() {
        button.textContent = '⎘';
        button.classList.remove('copied');
      }, 2000);
    });
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>










<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Cloud Native Geospatial Workflows with QGIS
(Full workshop)</h1>
<h3 class="subtitle">Using QGIS for visualizing and analyzing large
cloud-hosted raster and vector datasets.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#installation-and-setting-up-the-environment"
id="toc-installation-and-setting-up-the-environment">Installation and
Setting up the Environment</a>
<ul>
<li><a href="#install-qgis" id="toc-install-qgis">Install QGIS</a></li>
<li><a href="#get-the-data-package" id="toc-get-the-data-package">Get
the Data Package</a></li>
</ul></li>
<li><a href="#cloud-native-geospatial-formats"
id="toc-cloud-native-geospatial-formats">1. Cloud Native Geospatial
Formats</a>
<ul>
<li><a href="#load-a-cloud-optimized-geotiff-cog"
id="toc-load-a-cloud-optimized-geotiff-cog">1.1 Load a Cloud-Optimized
GeoTIFF (COG)</a></li>
<li><a href="#load-a-flatgeobuf-fgb-vector-layer"
id="toc-load-a-flatgeobuf-fgb-vector-layer">1.2 Load a FlatGeoBuf (FGB)
Vector Layer</a></li>
</ul></li>
<li><a href="#spatiotemporal-asset-catalogs-stac"
id="toc-spatiotemporal-asset-catalogs-stac">2. SpatioTemporal Asset
Catalogs (STAC)</a>
<ul>
<li><a href="#explore-stac-catalogs" id="toc-explore-stac-catalogs">2.1
Explore STAC Catalogs</a></li>
<li><a href="#load-a-stac-asset" id="toc-load-a-stac-asset">2.2 Load a
STAC Asset</a></li>
<li><a href="#zonal-statistics-with-cloud-hosted-data"
id="toc-zonal-statistics-with-cloud-hosted-data">2.3 Zonal Statistics
with Cloud-hosted Data</a></li>
</ul></li>
<li><a href="#stac-api-browser-plugin"
id="toc-stac-api-browser-plugin">3. STAC API Browser Plugin</a>
<ul>
<li><a href="#query-a-stac-api-catalog"
id="toc-query-a-stac-api-catalog">3.1 Query a STAC API Catalog</a></li>
<li><a href="#analyze-landcover-change"
id="toc-analyze-landcover-change">3.2 Analyze Landcover Change</a></li>
</ul></li>
<li><a href="#working-with-cloud-hosted-satellite-imagery"
id="toc-working-with-cloud-hosted-satellite-imagery">4. Working with
Cloud-Hosted Satellite Imagery</a>
<ul>
<li><a href="#loading-bands-and-creating-a-rgb-composite"
id="toc-loading-bands-and-creating-a-rgb-composite">4.1 Loading Bands
and Creating a RGB Composite</a></li>
<li><a href="#computing-a-spectral-index"
id="toc-computing-a-spectral-index">4.2 Computing a Spectral
Index</a></li>
</ul></li>
<li><a href="#creating-and-hosting-cloud-native-geospatial-data"
id="toc-creating-and-hosting-cloud-native-geospatial-data">5. Creating
and Hosting Cloud Native Geospatial Data</a>
<ul>
<li><a href="#creating-cloud-native-geospatial-data"
id="toc-creating-cloud-native-geospatial-data">5.1 Creating Cloud Native
Geospatial Data</a></li>
<li><a href="#hosting-cloud-native-geospatial-data"
id="toc-hosting-cloud-native-geospatial-data">5.2 Hosting Cloud Native
Geospatial Data</a></li>
</ul></li>
<li><a href="#data-credits" id="toc-data-credits">Data Credits</a></li>
<li><a href="#license" id="toc-license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This workshop introduces participants to the modern approach to
working with large datasets in QGIS. Modern data formats - such as
Cloud-Optimized GeoTIFFs (COG), Cloud-Optimized Point Clouds (COPC), and
FlatGeoBuf (FGB) allow datasets to be streamed from cloud storage
without having to download entire files. Spatial Temporal Asset Catalog
(STAC) provides a standardized way to query cloud-hosted datasets.
Combined with QGIS, these technologies allow users to visualize and
analyze large datasets which was not possible before.</p>
<p><a
href="https://docs.google.com/presentation/d/1cpu1PcEX1pCpFvGZ9yyNH_YKfndmSoxV6qi2Bf7p_jk/edit?usp=sharing"
target="_blank"><img
src="images/qgis_cloud_native_geospatial/introduction.png" width="400"
alt="View Presentation" /></a></p>
<p><a
href="https://docs.google.com/presentation/d/1cpu1PcEX1pCpFvGZ9yyNH_YKfndmSoxV6qi2Bf7p_jk/edit?usp=sharing"
target="_blank">View the Presentation ↗</a></p>
</div>
<div id="installation-and-setting-up-the-environment"
class="section level1">
<h1>Installation and Setting up the Environment</h1>
<div id="install-qgis" class="section level2">
<h2>Install QGIS</h2>
<p>This workshop requires QGIS LTR version 3.40. Please review <a
href="install-qgis-ltr.html">QGIS-LTR Installation Guide</a> for
step-by-step instructions.</p>
</div>
<div id="get-the-data-package" class="section level2">
<h2>Get the Data Package</h2>
<p>We have created a data package containing checkpoint projects that
will allow you to load the results of each section. You can download the
data package from <a
href="https://github.com/spatialthoughts/courses/releases/download/data/qgis_cloud_native_geospatial.zip">qgis_cloud_native_geospatial.zip</a>.
Once downloaded, unzip the contents to a folder on your computer.</p>
</div>
</div>
<div id="cloud-native-geospatial-formats" class="section level1">
<h1>1. Cloud Native Geospatial Formats</h1>
<div id="load-a-cloud-optimized-geotiff-cog" class="section level2">
<h2>1.1 Load a Cloud-Optimized GeoTIFF (COG)</h2>
<ol style="list-style-type: decimal">
<li>Open QGIS. We’ll first load a basemap. From the <em>Browser</em>
panel, scroll down and locate <strong>XYZ Tiles → OpenStreetMap</strong>
tile layer. Drag and drop it to the main canvas.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/cog1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Once the <code>OpenStreetMap</code> layer is loaded, go to your
region of interest. Now we will load a 8GB cloud-optimized geotiff file
stored on Google Cloud Storage and stream the pixels over this region.
Click the <em>Open Data Source Manager</em> button.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/cog2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Select the <em>Raster</em> tab. Select
<code>Protocol: HTTP(S), cloud etc.</code> as the <em>Source Type</em>.
Enter the following URL as the <em>URI</em>. Click <em>Add</em>.</li>
</ol>
<pre><code>https://storage.googleapis.com/spatialthoughts-public-data/ntl/viirs/viirs_ntl_2021_global.tif</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/cog3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>A new layer <code>viirs_ntl_2021_global</code> will be added to the
<em>Layers</em> panel. This is a global layer showing nighttime lights
intensity values recorded by the VIIRS instrument. Note that the file
loaded instantly and as you zoom in further, higher resolution pixels
are fetched dynamically from the file. While this file is located on a
remote location, you can use it just as if it was a regular GeoTIFF
file. Let’s visualize the layer using a color-ramp. Click the <em>Open
Layer Styling Panel</em> button on the <em>Layers</em> panel.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/cog4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>In the <em>Layer Styling</em> panel, change the renderer to
<code>Singleband pseudocolor</code>. Select a color ramp of your choice.
The layer rendering will be updated.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/cog5.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="load-a-flatgeobuf-fgb-vector-layer" class="section level2">
<h2>1.2 Load a FlatGeoBuf (FGB) Vector Layer</h2>
<ol style="list-style-type: decimal">
<li>Next, we will learn how to load a cloud-hosted vector layer to QGIS.
We will stream a 800MB line layer hosted on GitHub file storage and
stream the features in the current canvas extent. Click the <em>Open
Data Source Manager</em> button.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/fgb1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Select the <em>Vector</em> tab. Select
<code>Protocol: HTTP(S), cloud etc.</code> as the <em>Source Type</em>.
Enter the following URL as the <em>URI</em>. Click <em>Add</em>.</li>
</ol>
<pre><code>https://github.com/spatialthoughts/cloud-native-geospatial/releases/download/hydrorivers/hydrorivers.fgb</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/fgb2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>A new layer <code>hydrorivers -- rivers</code> will be added to the
<em>Layers</em> panel. This is a large line layer containing over 2.5
million features. QGIS will request and load only the features within
the current canvas extent. FlatGeoBuf format does not contain simplified
versions of features that can be loaded at lower zoom levels. So if you
zoom out to a large region, all the features within that region will be
requested. To prevent fetching unnecessarily large amounts of data - we
can enable scale dependent visibility. Right-click the
<code>hydrorivers -- rivers</code> layer and select
<em>Properties</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/fgb3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Select the <em>Rendering</em> tab and enable the <em>Scale Dependent
Visibility</em>. From the drop-down selector for <em>Minimum
(exclusive)</em> scale, select <code>1:1000000</code>. Click
<em>OK</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/fgb4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Now only when your canvas is zoomed in beyond the selected scale,
the features will be requested and rendered. Next, we will apply some
style to the vector layer. Click the <em>Open Layer Styling Panel</em>
button on the <em>Layers</em> panel. Change the <em>Color</em> to any
color of your choice. You can also adjust the <em>Width</em> of the
lines if required.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/fgb5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Zoom/Pan around the map and go to any region in the world. Data from
both the cloud-hosted files will be requested and rendered in the chosen
style.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/fgb6.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Your output should match the contents of the
<code>cloud_native_geospatial_checkpoint1.qgz</code> file in your data
package.</p>
</div>
</div>
<div id="spatiotemporal-asset-catalogs-stac" class="section level1">
<h1>2. SpatioTemporal Asset Catalogs (STAC)</h1>
<div id="explore-stac-catalogs" class="section level2">
<h2>2.1 Explore STAC Catalogs</h2>
<p>There are many publicly accessible STAC catalogs available - with
more providers making their data available through STAC. To explore all
the available catalogs, you can visit the <a
href="https://stacindex.org/">STAC Index</a>. Click on <em>Catalogs</em>
and explore the listings.</p>
<p><img src="images/qgis_cloud_native_geospatial/stacindex.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="load-a-stac-asset" class="section level2">
<h2>2.2 Load a STAC Asset</h2>
<ol style="list-style-type: decimal">
<li>Visit the <a href="https://stac.openlandmap.org/">OpenLandMap
STAC</a> catalog in a web browser. Locate the <strong>JRC Global Human
Settlement annual population (GHS)</strong> collection and click to view
more details.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stac1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>This collection consists of GHSL Gridded Population rasters from
year 2000-2021. Sort the collection in <em>Descending</em> order. The
first item will be the latest population raster. Click on it to explore
it further.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stac2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>This STAC Item consists of a Cloud-Optimized GeoTIFF image of
population for the year 2021. Click <strong>Copy URL</strong> button to
get the direct link to access the file.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stac3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Open QGIS. From the <em>Browser</em> panel, scroll down and locate
<strong>XYZ Tiles → OpenStreetMap</strong> tile layer. Drag and drop it
to the main canvas. Once the <code>OpenStreetMap</code> layer is loaded,
go to your region of interest. Click the <em>Open Data Source
Manager</em> button.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stac4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Select the <em>Raster</em> tab. Select
<code>Protocol: HTTP(S), cloud etc.</code> as the <em>Source Type</em>.
Enter the URL copied in the previous step as the <em>URI</em>. Click
<em>Add</em>.</li>
</ol>
<pre><code>https://s3.openlandmap.org/arco/pop.count_ghs.jrc_m_100m_s_20210101_20211231_go_epsg.4326_v20230620.tif</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/stac5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>A new layer
<code>pop.count_ghs.jrc_m_100m_s_20210101_20211231_go_epsg.4326_v20230620</code>
will be added to the <em>Layers</em> panel. This image represents the
population count in each 100m x 100m grid cell. The original data comes
with decimal values, but to optimize the storage space and transfer of
data, the image is saved with the data type <em>UInt32</em> (Integers).
To preserve the full fidelity of the data, the original pixel values are
multiplied by 100. Hence if the the pixel value is <code>2068</code> -
it represents a population count of <code>20.68</code>. Keep this in
mind and we will appropriately scale our results with this factor.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stac6.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="zonal-statistics-with-cloud-hosted-data"
class="section level2">
<h2>2.3 Zonal Statistics with Cloud-hosted Data</h2>
<ol style="list-style-type: decimal">
<li>Let’s load some vector data. Click the <em>Open Data Source
Manager</em> button. Select the <em>Vector</em> tab. Select
<code>Protocol: HTTP(S), cloud etc.</code> as the <em>Source Type</em>.
Enter the following URL as the <em>URI</em>. Click <em>Add</em>.</li>
</ol>
<pre><code>https://storage.googleapis.com/spatialthoughts-public-data/geoboundaries/admin2.fgb</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/zonal1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>A new layer <code>admin2 -- adm2_polygons</code> will be added to
the <em>Layers</em> panel. This is a very large vector polygon layer and
the polygons for Admin2 regions within the current canvas extents will
be fetched and loaded. We will pick a region of interest. To make the
selection easier, let’s add some labels to the polygons. Click the
<em>Open Layer Styling Panel</em> button on the <em>Layers</em>
panel.Select the <em>Labels</em> tab. Select <code>Single Labels</code>
from the drop-down menu and select <code>adm2_name</code> as the
<em>Value</em>. The name of the administrative region will be rendered
on the map.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/zonal2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Click on the <em>Select Features by Area or Single Click</em> button
on the <em>Selection Toolbar</em>. Once activated, click on your chosen
administrative region to select it. Go to <strong>Processing →
Toolbox</strong>. From the <em>Processing Toolbox</em>, search and
locate the <strong>Raster analysis → Zonal statistics</strong>
algorithm. Double-click to open it.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/zonal3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the <em>Zonal Statistics</em> dialog, select
<code>admin2 -- adm2_polygons</code> as the <em>Input layer</em>. Make
sure to check the <em>Selected features only</em> box. Select the
<code>pop.count_ghs.jrc_m_100m_s_20210101_20211231_go_epsg.4326_v20230620</code>
layer as the <em>Raster layer</em>. Enter <code>population_</code> as
the <em>Output column prefix</em>. For the <em>Statistics to
calculate</em>, click the <em>…</em> button and select only
<code>Sum</code>. Save the output as a file
<code>zonal_stats.gpkg</code> and click <em>Run</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/zonal4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>The algorithm will fetch the pixels required to perform the
calculation and once complete, a new layer <code>zonal_stats</code> will
be added to the <em>Layers</em> panel. This layer contains the result of
the Zonal Statistics that was computed directed from the cloud-hosted
dataset by fetching only required pixels and features - saving us time,
bandwidth and storage.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/zonal5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>The resulting value needs to be scaled by a factor of 100 to get the
actual population count. Search and locate the <strong>Vector table →
Field calculator</strong> algorithm and double-click to open it. Select
<code>zonal_stats</code> as the <em>Input layer</em> and enter
<code>population</code> as the <em>Field name</em>. Enter the following
expression to scale the population value. Enter the output file name as
<code>zonal_stats_final.gpkg</code> and click <em>Run</em>.</li>
</ol>
<pre><code>&quot;population_sum&quot; / 100</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/zonal6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Once the computation finishes and the new layer
<code>zonal_stats_final</code> is loaded, right-click the layer and
select <em>Open Attribute Table</em>. The field
<strong>population</strong> contains the total population within the
selected administrative region.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/zonal7.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Your output should match the contents of the
<code>cloud_native_geospatial_checkpoint2.qgz</code> file in your data
package.</p>
</div>
</div>
<div id="stac-api-browser-plugin" class="section level1">
<h1>3. STAC API Browser Plugin</h1>
<div id="query-a-stac-api-catalog" class="section level2">
<h2>3.1 Query a STAC API Catalog</h2>
<ol style="list-style-type: decimal">
<li>Let’s install the <em>STAC API Browser</em> plugin. Go to
<strong>Plugins → Manage and Install Plugins</strong>. Select the
<em>All</em> tab and search for <code>STAC API Browser</code>. Once you
find the plugin, click <em>Install</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Once installed, open the plugin from <strong>Web → STAC API Browser
Plugin → Open STAC API Browser</strong>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>In the <em>STAC API Browser</em> window, select
<code>Microsoft Planetary Computer STAC API</code> as the
<em>Connections</em>. Click <em>Fetch collections</em> to get all the
collections available through the API. Scroll down and select the
<code>ESA WorldCover</code> collection.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the same window, scroll down and check the <em>Extent</em> box.
Click the <em>Map Canvas Extent</em> to load the current extent. Click
<em>Search</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>This collection contains global landcover data for the years 2020
and 2021. The global dataset is split into several small tiles. You will
see the matching tiles as items in the result. Click <em>View
assets</em> for the item for the year 2021.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>We will load the <code>Land Cover Classes</code> asset. Check the
box <em>Select to add as a layer</em> and click <em>Add select assets as
layers</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>A new layer <code>Land Cover Classes</code> will be added to the
<em>Layers</em> panel and the landcover pixels for the region will be
streamed in. Let’s rename the layer so we can easily identify it later.
Right-click and select <em>Rename Layer</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Enter the layer name as <code>2021</code> and press
<em>Enter</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Switch back to the <em>STAC API Browser</em> window and load the
<code>Land Cover Classes</code> asset for the year 2020.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Once the layer is loaded, rename it to <code>2020</code>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>We queries and successfully loaded 2 remote layers for the landcover
classification for the year 2020 and 2021.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/stacplugin11.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="analyze-landcover-change" class="section level2">
<h2>3.2 Analyze Landcover Change</h2>
<p>We will now analyze the change in water class between the year 2020
and 2021 to locate all areas where surface water was lost.</p>
<ol style="list-style-type: decimal">
<li>To perform raster algebra on cloud layers, we need to use a special
version of the raster calculator. Open the Processing Toolbox from
<strong>Processing → Toolbox</strong>. Search and locate the
<strong>Raster analysis → Raster calculator (virtual)</strong>.
Double-click to open it.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>In the <em>Raster calculator (virtual)</em> dialog, click the
<em>…</em> button next to <em>Input layers</em> and select the
<code>2020</code> layer. Next click the <em>Expression</em> button.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>ESA WorldCover classification assigns the pixel value 80 to
Permanent Water Bodies <a
href="https://worldcover2020.esa.int/data/docs/WorldCover_PUM_V1.1.pdf">View
Documentation</a>. Enter the following expression to select all pixels
classified as water. Click <em>OK</em>.</li>
</ol>
<pre><code>&quot;2020@1&quot; = 80</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/landcover3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Back in the <em>Raster calculator (virtual)</em> dialog, enter
<code>water_2020</code> as the <em>Output layer name</em> and click
<em>Run</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>A new layer <code>water_2020</code> will be added to the
<em>Layers</em> panel. This is a boolean layer with pixel values 1 for
water and 0 for all other classes.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Repeat the process for the 2021 layer. This time enter
<code>water_2021</code> as the <em>Output layer name</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>We have now isolated the water pixels for both the years. Let’s
analyze the change between the years. Search and locate the
<strong>Raster analysis → Raster calculator (virtual)</strong>.
Double-click to open it.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>In the <em>Raster calculator (virtual)</em> dialog, click the
<em>…</em> button next to <em>Input layers</em> and select both the
<code>water_2020</code> and <code>water_2021</code> layers. Next click
the <em>Expression</em> button.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>We want to identify the loss in surface water. This can be done by
selecting all pixels which were water in 2020 but not water in 2021.
Enter the following expression to match these pixels.</li>
</ol>
<pre><code>(&quot;water_2020@1&quot; = 1) AND (&quot;water_2021@1&quot; != 1)</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/landcover9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Back in the <em>Raster calculator (virtual)</em> dialog, enter
<code>waterlost</code> as the <em>Output layer name</em> and click
<em>Run</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>A new layer <code>waterlost</code> will be added to the
<em>Layers</em> panel. Everything we have done so far is a dynamic
computation on the remote data layers. Let’s perform the actual
computation and save the results as a local raster. Right-click the
<code>waterlost</code> layer and go to <strong>Export → Save
As…</strong>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>In the <em>Save Raster Layer as…</em> dialog, click the <em>…</em>
button and browse to a folder on your computer. Enter
<code>waterlost_export.tif</code> as the output file name. Expand the
<em>Extent</em> section and click the <em>Map Canvas Extent</em> button
to load the current extent. It is always a good idea to apply a lossless
compression to raster files. Check the <em>Create Options</em> box and
select <code>Low Compression</code> as the <em>Profile</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Scroll down and check the <em>No data values</em> box. Click the
<strong>+</strong> button and enter the values <code>0</code> as
<em>From</em> and <em>To</em>. This will only keep the pixels with value
1 as data values in the output. Click <em>OK</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover13.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>QGIS will now request the pixels within the given extent and perform
the calculations as requested. It may take a few minutes depending on
the size of the region and available internet bandwidth. Once complete,
a new layer <code>waterlost_export</code> will be added to the
<em>Layers</em> panel.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>The <code>waterlost_export</code> is a local raster with pixels
showing regions that experienced loss in surface water. Let’s convert
this layer to polygons. From the Processing Toolbox, search and locate
the <strong>GDAL → Raster Conversion → Polygonize (raster to
vector)</strong> algorithm.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover15.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="16" style="list-style-type: decimal">
<li>In the <em>Polygonize (raster to vector)</em> dialog, select
<code>waterlost_export</code> as the <em>Input layer</em>. Keep all
other parameters to their default values. Click <em>…</em> next to
<em>Vectorized</em> and browse to a folder on your computer. Enter the
filename as <code>waterlost_polygons.gpkg</code>. Click
<em>Run</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover16.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="17" style="list-style-type: decimal">
<li>Once the conversion is complete, a new layer
<code>waterlost_polygons</code> will be added to QGIS. Using a
cloud-native workflow, we were able to do a landcover change analysis
without downloading any data or incurring any cloud computation
cost.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/landcover17.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Your output should match the contents of the
<code>cloud_native_geospatial_checkpoint3.qgz</code> file in your data
package.</p>
</div>
</div>
<div id="working-with-cloud-hosted-satellite-imagery"
class="section level1">
<h1>4. Working with Cloud-Hosted Satellite Imagery</h1>
<p>In this section, we will learn how to query a STAC catalog of
Sentinel-2 L2A data, load and create a RGB composite and compute a
spectral index using a cloud-native approach.</p>
<div id="loading-bands-and-creating-a-rgb-composite"
class="section level2">
<h2>4.1 Loading Bands and Creating a RGB Composite</h2>
<ol style="list-style-type: decimal">
<li>Start by loading a basemap. From the <em>Browser</em> panel, scroll
down and locate <strong>XYZ Tiles → OpenStreetMap</strong> tile layer.
Drag and drop it to the main canvas. Zoom to your region of interest. We
will use the <em>STAC API Browser</em> plugin to query for satellite
images over this area. Open the plugin from <strong>Plugins → STAC API
Browser Plugin → Open STAC API Browser</strong>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Select <code>Earth Search</code> from the <em>Connections</em>
dropdown. Click <em>Edit</em> to view the connection details.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Make sure the URL is
<code>https://earth-search.aws.element84.com/v1</code> and click
<em>OK</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the <em>STAC API Browser</em> window, click the <em>Fetch
collections</em> button. Once the list updates, select the
<code>Sentinel-2 Level-2A</code> collection. If you do not see this
dataset listed, please go to the previous step and verify the URL is
correct.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Check the <em>Filter by date</em> option and enter a start and end
date. Sentinel-2 Level-2A dataset is available from 2017 onward and a
new image is collected every 5 days. Check the <em>Extent</em> option
and click <em>Map Canvas Extent</em> button to fill the coordinates of
the region visible on the map. Click <em>Search</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>In the <em>Results</em> tab, you will see the list of matching
images. From the preview of the image, locate a reasonably cloud-free
image and click <em>View assets</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>For this exercise, we will load data for 4 image bands. Check the
<em>Select to add as a layer</em> box for <code>Blue (band 2)</code>,
<code>Green (band 3)</code>, <code>Red (band 4)</code> and
<code>SWIR 1 (band 11)</code>. Click <em>Add select assets as layers
(4)</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>The selected bands will be loaded as new layers in the main QGIS
canvas. Each band is a Cloud-Optimized GeoTIFF (COG) that is hosted on
AWS and being streamed to your QGIS. We can combine multiple bands into
a single image and visualize it. These are called <em>Color
Composites</em>. Let’s stack the Red, Green and Blue bands to create an
natural color composite. Go to <strong>Processing → Toolbox</strong>.
From the <em>Processing Toolbox</em>, search and locate the <strong>GDAL
→ Raster miscellaneous → Build virtual raster</strong> algorithm.
Double-click to open it.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>This algorithm creates a new layer in the <a
href="https://gdal.org/en/latest/drivers/raster/vrt.html">Virtual
Raster</a> format which allows you to combine multiple raster layers in
to a single file without consuming extra disk space. Select
<code>Blue (band 2)</code>, <code>Green (band 3)</code>,
<code>Red (band 4)</code> as <em>Input layers</em> and check <em>Place
each input file into a separate band</em>. Click the <code>...</code>
button next to <em>Virtual</em> and save the output file as
<code>rgb.vrt</code>. Next click <em>Run</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>A new layer <code>rgb</code> will be added to the <em>Layers</em>
panel. This layer contains references to the 3 different images. Note
that the order of the bands in alphabetical, so the mapping in the
virtual raster is as follows: <em>Band 1 → Blue (band 2)</em>, <em>Band
2 → Green (band 3)</em> and <em>Band 3 → Red (band 4)</em>. Open the
<em>Layer Styling Panel</em> and place <code>Band 3</code>,
<code>Band 2</code> and <code>Band 1</code> as <em>Red</em>,
<em>Green</em> and <em>Blue</em> bands. Change the <em>Min</em> and
<em>Max</em> values to <code>0</code> and <code>3000</code>
respectively. You will see the image now appear in natural colors.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/satellite10.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="computing-a-spectral-index" class="section level2">
<h2>4.2 Computing a Spectral Index</h2>
<ol style="list-style-type: decimal">
<li>We can also do some analysis with the satellite image bands. Let’s
calculate the <strong>Modified Normalized Difference Water Index
(MNDWI)</strong>. This is a widely used spectral index for identifying
and extracting water pixels from satellite images. This index is
calculated by taking the normalized ratio of the Green (band 3) and the
SWIR-1 (band 11) bands. From the <em>Processing Toolbox</em>, search and
locate the <strong>GDAL → Raster analysis → Raster calculator
(virtual)</strong> algorithm. Double-click to open it.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>In the <em>Raster calculator (virtual)</em> dialog, click the
<code>..</code> button for <em>Input layers</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Select the <code>Green (band 3)</code> and the
<code>SWIR 1 (band 11)</code> layers and click <em>OK</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Next click the <em>Expression</em> button.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Remember the formula for MNDWI is (Green - SWIR1)/(Green + SWIR1).
You can click on the layer names to enter it in the <em>Raster
Calculator Expression</em> and construct the expression as shown below.
Once done, click <em>OK</em>.</li>
</ol>
<pre><code>(&quot;Green (band 3) - 10m@1&quot; - &quot;SWIR 1 (band 11) - 10m@1&quot;)
/ (&quot;Green (band 3) - 10m@1&quot; + &quot;SWIR 1 (band 11) - 10m@1&quot;)</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/index5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Enter the <em>Output layer name</em> as <code>MNDWI</code> and click
<em>Run</em>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>A new layer <code>MNDWI</code> will be added to the <em>Layers</em>
panel. Click the open the <em>Layer Styling Panel</em> button. Change
the renderer to <code>Singleband psuedocolor</code>. Set the
<em>Min</em> and <em>Max</em> values to <code>0</code> and
<code>0.8</code> respectively. Choose the <code>Blues</code> as the
<em>Color ramp</em>. You will see a visualization where all detected
water pixels are highlighted in the blue color.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>The MNDWI image contains values in the range -1 to +1 with pixel
values 0 and above typically indicating presence of water. We can
extract the water pixels to a new layer by applying a threshold of 0.
From the <em>Processing Toolbox</em>, search and locate the <strong>GDAL
→ Raster analysis → Raster calculator (virtual)</strong> algorithm.
Double-click to open it.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Select the <code>MNDWI</code> layer as the <em>Input layers</em> and
enter the expression shown below. Set the <em>Output layer name</em> to
<code>Water</code> and click <em>Run</em>.</li>
</ol>
<pre><code>&quot;MNDWI@1&quot; &gt; 0</code></pre>
<p><img src="images/qgis_cloud_native_geospatial/index9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>A new layer named <code>Water</code> will be added to the
<em>Layers</em> panel. Click the open the <em>Layer Styling Panel</em>
button. Set the <em>Min</em> and <em>Max</em> values to <code>0</code>
and <code>1</code> respectively. You will see all the extracted water
pixels in white. Remember this image is still a virtual image being
computed on-the-fly by streaming in the required data directly from the
cloud-hosted COGs. You can Zoom and Pan the map and the water pixels
will be extracted dynamically. We can save the results as a local
GeoTIFF. Right-click on the <code>Water</code> layer and select
<strong>Export → Save As…</strong>.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Click the <code>..</code> button next to <em>File name</em> and save
the file as <code>extracted_water.tif</code>. Expand the <em>Extent</em>
section and click the <em>Map Canvas Extent</em> button. Set both both
<em>Horizontal</em> and <em>Vertical</em> values for <em>Resolution</em>
to be <code>10</code> meters. Check the <em>Create options</em> box and
select <code>Low Compression</code> as the <em>Profile</em>. Click
<em>OK</em> to start the export process. At this stage, QGIS will fetch
the required pixels from the cloud dataset at the required resolution,
perform the computation to calculate MNDWI and extract the water pixels.
Depending on how big is your region, this process may take a few
minutes.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>Once complete, a new layer <code>extracted_water</code> will be
added to the <em>Layers</em> panel. You were able visualize a satellite
image and perform a complex calculation to extract water from the image
without first having to download the entire scene. Saving time,
bandwidth and computation resources.</li>
</ol>
<p><img src="images/qgis_cloud_native_geospatial/index12.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Your output should match the contents of the
<code>cloud_native_geospatial_checkpoint4.qgz</code> file in your data
package.</p>
</div>
</div>
<div id="creating-and-hosting-cloud-native-geospatial-data"
class="section level1">
<h1>5. Creating and Hosting Cloud Native Geospatial Data</h1>
<div id="creating-cloud-native-geospatial-data" class="section level2">
<h2>5.1 Creating Cloud Native Geospatial Data</h2>
<p>The easiest way to create data in a cloud-optimized format is to use
the GDAL/OGR Command-Line Tools. Please check our course material for <a
href="gdal-tools.html">Mastering GDAL Tools</a> course for step-by-step
instructions for installation and usage.</p>
<p>You can use the <code>gdal_translate</code> command to take any
raster data and create a Cloud-Optimized GeoTIFF by specifying the
<code>-of COG</code> option.</p>
<pre><code>gdal_translate -of COG viirs_ntl_2021_global.tif viirs_ntl_2021_global_cog.tif</code></pre>
<p>Similarly, <code>ogr2ogr</code> can convert any supported vector data
format to a cloud-otpmized data format. The command below converts a
GeoPackage to a FGB format using the <code>-f FlatGeobuf</code>
option.</p>
<pre><code>ogr2ogr -f FlatGeobuf hydrorivers.fgb hydrorivers.gpkg</code></pre>
<p>You can create the output dataset by specifying a subset of columns
using the <code>-select</code> option.</p>
<pre><code>ogr2ogr -f FlatGeobuf admin2.fgb admin2.gpkg -select &quot;adm2_name,adm1_name,adm0_name,iso_2,iso_3&quot;</code></pre>
</div>
<div id="hosting-cloud-native-geospatial-data" class="section level2">
<h2>5.2 Hosting Cloud Native Geospatial Data</h2>
<p>The main advantage of cloud-native data formats is that they can be
streamed directly from files, without needing specialized servers. This
is achieved by making a HTTP-range request from the file. This means the
file needs to be accessible by HTTP as static file objects. Most
consumer cloud storage servies such as Google Drive, Microsoft OneDrive,
Dropbox etc. do <strong>NOT</strong> allow direct access to file objects
and cannot be used to serve files via HTTP. Below are some recommended
options for storing files for cloud-native applications.</p>
<p><strong>Cloud Object Stores</strong></p>
<ul>
<li>Google Cloud Storage</li>
<li>Microsoft Azure Blob Storage</li>
<li>Amazon S3</li>
<li>Cloudflare R2</li>
<li>…</li>
</ul>
<p><strong>GitHub</strong></p>
<ul>
<li>Upload your files to a Github Release (Unlimited free storage for
files upto 2GB)</li>
</ul>
<p><strong>Any Simple HTTP Server</strong></p>
<p>Use any simple HTTP server that can serve static files.</p>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>Global Edge-matched Subnational Boundaries: Humanitarian Edge
Matched, FieldMaps, OCHA, geoBoundaries, U.S. Department of State,
OpenStreetMap. Downloaded from <a href="https://fieldmaps.io/data"
class="uri">https://fieldmaps.io/data</a></li>
<li>Sentinel-2 Level-2A: Contains Copernicus Sentinel data.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This workshop material is licensed under a <a
href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International (CC BY 4.0)</a>. You are free to re-use
and adapt the material but are required to give appropriate credit to
the original author as below:</p>
<p><em>Cloud Native Geospatial Workflows with QGIS</em> by Ujaval Gandhi
<a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<p>© 2024 Spatial Thoughts <a
href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
</div>

<!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to report any issues with this page, please comment below.</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/courses"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
