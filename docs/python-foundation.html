<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Python Foundation for Spatial Analysis (Full Course Material)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Python Foundation for Spatial Analysis (Full Course Material)</h1>
<h3 class="subtitle">A gentle introduction to Python programming with a focus on spatial data.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#get-the-data-package">Get the Data Package</a></li>
<li><a href="#installation-and-setting-up-the-environment">Installation and Setting up the Environment</a>
<ul>
<li><a href="#graphical-user-interface-anaconda-navigator">Graphical User Interface (Anaconda Navigator)</a></li>
<li><a href="#command-line-interface-anaconda-prompt-terminal">Command Line Interface (Anaconda Prompt / Terminal)</a></li>
</ul></li>
<li><a href="#using-jupyter-notebooks">Using Jupyter Notebooks</a></li>
<li><a href="#hello-world">Hello World</a></li>
<li><a href="#variables">Variables</a>
<ul>
<li><a href="#strings">Strings</a></li>
<li><a href="#numbers">Numbers</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul></li>
<li><a href="#data-structures">Data Structures</a>
<ul>
<li><a href="#tuples">Tuples</a></li>
<li><a href="#lists">Lists</a></li>
<li><a href="#sets">Sets</a></li>
<li><a href="#dictionaries">Dictionaries</a></li>
<li><a href="#exercise-1">Exercise</a></li>
</ul></li>
<li><a href="#string-operations">String Operations</a>
<ul>
<li><a href="#escaping-characters">Escaping characters</a></li>
<li><a href="#printing-strings">Printing Strings</a></li>
<li><a href="#exercise-2">Exercise</a></li>
</ul></li>
<li><a href="#loops-and-conditionals">Loops and Conditionals</a>
<ul>
<li><a href="#for-loops">For Loops</a></li>
</ul></li>
<li><a href="#conditionals">Conditionals</a>
<ul>
<li><a href="#control-statements">Control Statements</a></li>
<li><a href="#exercise-3">Exercise</a></li>
</ul></li>
<li><a href="#functions">Functions</a>
<ul>
<li><a href="#exercise-4">Exercise</a></li>
</ul></li>
<li><a href="#the-python-standard-library">The Python Standard Library</a>
<ul>
<li><a href="#calculating-distance">Calculating Distance</a></li>
<li><a href="#discover-python-easter-eggs">Discover Python Easter Eggs</a></li>
<li><a href="#exercise-5">Exercise</a></li>
</ul></li>
<li><a href="#third-party-modules">Third-party Modules</a>
<ul>
<li><a href="#installing-third-party-libraries">Installing third-party libraries</a></li>
<li><a href="#calculating-distance-1">Calculating Distance</a></li>
<li><a href="#exercise-6">Exercise</a></li>
</ul></li>
<li><a href="#using-web-apis">Using Web APIs</a>
<ul>
<li><a href="#understanding-json-and-geojson">Understanding JSON and GeoJSON</a></li>
<li><a href="#the-requests-module">The <code>requests</code> module</a></li>
<li><a href="#calculating-distance-using-openrouteservice-api">Calculating Distance using OpenRouteService API</a></li>
<li><a href="#api-rate-limiting">API Rate Limiting</a>
<ul>
<li><a href="#the-time-module">The <code>time</code> module</a></li>
</ul></li>
<li><a href="#exercise-7">Exercise</a></li>
</ul></li>
<li><a href="#reading-files">Reading Files</a>
<ul>
<li><a href="#exercise-8">Exercise</a></li>
</ul></li>
<li><a href="#reading-csv-files">Reading CSV Files</a>
<ul>
<li><a href="#using-enumerate-function">Using <code>enumerate()</code> function</a></li>
<li><a href="#using-with-statement">Using <code>with</code> statement</a></li>
<li><a href="#filtering-rows">Filtering rows</a></li>
<li><a href="#calculating-distance-2">Calculating distance</a></li>
<li><a href="#writing-files">Writing files</a></li>
<li><a href="#exercise-9">Exercise</a></li>
</ul></li>
<li><a href="#working-with-pandas">Working with Pandas</a>
<ul>
<li><a href="#reading-files-1">Reading Files</a></li>
<li><a href="#filtering-data">Filtering Data</a></li>
<li><a href="#performing-calculations">Performing calculations</a></li>
<li><a href="#exercise-10">Exercise</a></li>
</ul></li>
<li><a href="#working-with-geopandas">Working with Geopandas</a>
<ul>
<li><a href="#reading-spatial-data">Reading Spatial Data</a></li>
<li><a href="#filtering-data-1">Filtering Data</a></li>
<li><a href="#working-with-projections">Working with Projections</a></li>
<li><a href="#performing-spatial-joins">Performing Spatial joins</a></li>
<li><a href="#group-statistics">Group Statistics</a></li>
<li><a href="#exercise-11">Exercise</a></li>
</ul></li>
<li><a href="#creating-spatial-data">Creating Spatial Data</a>
<ul>
<li><a href="#reading-tab-delimited-files">Reading Tab-Delimited Files</a></li>
<li><a href="#filtering-data-2">Filtering Data</a></li>
<li><a href="#creating-geometries">Creating Geometries</a></li>
<li><a href="#writing-files-1">Writing Files</a></li>
<li><a href="#exercise-12">Exercise</a></li>
</ul></li>
<li><a href="#introduction-to-numpy">Introduction to NumPy</a>
<ul>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#array-operations">Array Operations</a></li>
<li><a href="#exercise-13">Exercise</a></li>
</ul></li>
<li><a href="#working-with-rasterio">Working with RasterIO</a>
<ul>
<li><a href="#reading-raster-data">Reading Raster Data</a></li>
<li><a href="#merging-datasets">Merging Datasets</a></li>
<li><a href="#writing-raster-data">Writing Raster Data</a></li>
<li><a href="#exercise-14">Exercise</a></li>
</ul></li>
<li><a href="#writing-standalone-python-scripts">Writing Standalone Python Scripts</a>
<ul>
<li><a href="#get-a-text-editor">Get a Text Editor</a></li>
<li><a href="#writing-a-script">Writing a Script</a></li>
<li><a href="#executing-a-script">Executing a Script</a>
<ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#mac-and-linux">Mac and Linux</a></li>
</ul></li>
</ul></li>
<li><a href="#what-next">What next?</a>
<ul>
<li><a href="#do-a-project">Do a Project</a></li>
<li><a href="#keep-learning">Keep Learning</a></li>
</ul></li>
<li><a href="#supplement">Supplement</a>
<ul>
<li><a href="#creating-maps-with-geopandas">Creating Maps with GeoPandas</a>
<ul>
<li><a href="#matplotlib-basics">Matplotlib Basics</a></li>
<li><a href="#rendering-map-layouts">Rendering Map Layouts</a></li>
<li><a href="#creating-a-map-with-multiple-layers">Creating A Map with Multiple Layers</a></li>
<li><a href="#labelling-features">Labelling Features</a></li>
</ul></li>
<li><a href="#working-with-xarray">Working with Xarray</a>
<ul>
<li><a href="#xarray-and-rioxarray-basics">XArray and rioxarray Basics</a></li>
<li><a href="#merging-rasters">Merging Rasters</a></li>
<li><a href="#visualizing-rasters-using-matplotlib">Visualizing Rasters using Matplotlib</a></li>
</ul></li>
</ul></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This class covers Python from the very basics. Suitable for GIS practitioners with no programming background or python knowledge. The course will introduce participants to basic programming concepts, libraries for spatial analysis, geospatial APIs and techniques for building spatial data processing pipelines.</p>
<p>Learn more about my views on why and how to learn Python in this <a href="https://docs.google.com/presentation/d/125LV0qR47S_OGaZZr5Zv-7lbWfdZ5pNo3iFm6IOX7uI/edit?usp=sharing" target="_blank">Introductory Presentation</a>.</p>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The code examples in this class use a variety of datasets. All the required datasets and Jupyter notebooks are supplied to you in the <code>python_foundation.zip</code> file. Unzip this file to a directory - preferably to the <code>&lt;home folder&gt;/Downloads/python_foundation/</code> folder.</p>
<p><em>Not enrolled in our instructor-led class but want to work through the material on your own?</em> <a href="https://docs.google.com/forms/d/e/1FAIpQLSeSrQH38dutYRLLy4kOxw_ltpKG_jKkB4aSZc0dRjHhbma0ow/viewform" target="_blank">Get free access to the data package</a></p>
</div>
<div id="installation-and-setting-up-the-environment" class="section level1">
<h1>Installation and Setting up the Environment</h1>
<p>There are many ways to install Python on your system. Many operating systems comes with a Python distribution built-in too. If you use software such as QGIS - it comes with its own version of Python. Working on Python projects typically require installing third-party packages (i.e. tools). As these packages have different dependencies - they often cause conflicts and errors due to different versions of Python on your system.</p>
<p>An easy and reliable way to get a Python installation on your system is via <a href="https://www.anaconda.com/">Anaconda</a>. For this course, we will use the Anaconda3 Individual Edition to install Python and required spatial analysis packages.</p>
<blockquote>
<p>Many Python tool names have references to the reptile world. The default Python package manager is called <a href="https://pypi.org/project/pip/">Pip</a> which references the process of hatching eggs. Interestingly, the naming of the Python language itself had <a href="https://en.wikipedia.org/wiki/Guido_van_Rossum#Python">nothing to do with reptiles</a>.</p>
</blockquote>
<p>There are 2 ways to install Anaconda and the required packages.</p>
<ol style="list-style-type: decimal">
<li><strong>Graphical User Interface (GUI)</strong>: This method uses the <em>Anaconda Navigator</em> program which provides a user-friendly interface to create environments and install packages. This is the preferred way for beginners.</li>
<li><strong>Command Line Interface (CLI)</strong>: Anaconda also provides the <code>conda</code> command that can be run from the <em>Command Prompt</em> on Windows or the <em>Terminal</em> on Mac/Linux. This method is faster but requires some familiarity with the command-line.</li>
</ol>
<p>You may follow any of the above methods using the instructions below. We recommend you try the GUI method first and if you face problems, you can try setting up the environment using the CLI method. Both methods will result in an identical setup.</p>
<div id="graphical-user-interface-anaconda-navigator" class="section level2">
<h2>Graphical User Interface (Anaconda Navigator)</h2>
<ol style="list-style-type: decimal">
<li><a href="https://www.anaconda.com/products/individual">Download the Anaconda Installer</a> for Python 3.8 (or a higher version) for your operating system. Once downloaded, double click the installer and install it into the default suggested directory. Select an install for <em>Just Me</em> and <strong>use default settings</strong>.</li>
</ol>
<blockquote>
<p>Note: If your username has spaces, or non-English characters, it causes problems. In that case, you can install it to a path such as <code>C:\anaconda</code>.</p>
</blockquote>
<p><img src="images/python_foundation/conda1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Once installed, launch the <em>Anaconda Navigator</em> program. It is a good practice to create a new <em>environment</em> for each of your Python projects. An environment is a space where you will install required packages. Many packages may contain conflicting requirements which could prevent them all being installed into a single environment. Having a separate environment isolates your project from such problems. Click on the <em>Environments</em> tab.</li>
</ol>
<blockquote>
<p>Linux users can open a terminal and type <code>anaconda-navigator</code> to launch the program.</p>
</blockquote>
<p><img src="images/python_foundation/conda2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Click the <em>+ Create</em> button and name the environment as <code>python_foundation</code>. Tick python and leave it to default version. Click <em>Create</em>.</li>
</ol>
<p><img src="images/python_foundation/conda3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Once created, click the <em>Channels</em> button. A channel is a repository where packages are hosted. The default channel is good for most purposes. But some packages we require for this class are not available in the default channel, so we need to add another channel. In the <em>Manage channels</em> dialog, click <em>Add</em> and enter <code>conda-forge</code>. Press <em>Enter</em>.</li>
</ol>
<blockquote>
<p>Learn more about <a href="https://conda-forge.org/docs/user/introduction.html">conda-forge</a></p>
</blockquote>
<p><img src="images/python_foundation/conda4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Click the <em>Update Channels</em> button.</li>
</ol>
<p><img src="images/python_foundation/conda5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Once the update is done, search for the package <code>geopandas</code>. This is a package that allows you to work with vector geospatial data in Python. Select the check-box next to the first result and click <em>Apply</em> to install the package with all its dependencies.</li>
</ol>
<blockquote>
<p>If you do not see any results, make sure you have selected <em>All</em> in the dropdown selector next to <em>Channels</em> instead of <em>Installed</em>.</p>
</blockquote>
<p><img src="images/python_foundation/conda6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Similarly, search and install the following packages</li>
</ol>
<ul>
<li><code>geopy</code></li>
<li><code>rasterio</code></li>
<li><code>matplotlib</code></li>
</ul>
<p><img src="images/python_foundation/conda7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Switch to the <em>Home</em> tab. Ensure that you have the <em>python_foundation</em> environment selected. We will now install some programs which allow us to write and execute Python scripts. From the home screen, install the <code>JupyterLab</code> application. Windows users may optionally install the <code>CMD.exe prompt</code> application.</li>
</ol>
<p><img src="images/python_foundation/conda8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>After the installation completes, click <em>Launch</em> button for the <em>JupyterLab</em> application. JupyterLab is a web application that allows you to write, document and run Python code. It allow you to interactively run small bits of code and see the results. It also support a variety of output formats such as charts or maps - making it an ideal platform for data science projects. The name Jupyter comes from the 3 primary programming languages it supports - Julia, Python and R. We will be using Jupyter notebooks for all exercises in this course.</li>
</ol>
<blockquote>
<p>Linux users can open a terminal and first switch to the correct environment using the command <code>conda activate python_foundation</code>. After that, JupyterLab can be opened using the <code>jupyter-lab</code> command.</p>
</blockquote>
<p><img src="images/python_foundation/conda9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>A new browser tab will open with an instance of JupterLab. Click the <em>Python 3</em> button under <em>Notebook</em>.</li>
</ol>
<p><img src="images/python_foundation/conda10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Enter the following statements in the first cell and click the <em>Run</em> button. <strong>If nothing happens - it means your installation was successful!</strong>. If you get an <em>ImportError</em>, repeat the installation steps carefully again. If you continue getting errors, try the <em>Command Line Interface</em> procure outlined in the next section.</li>
</ol>
<pre><code>import geopandas
import geopy
import rasterio</code></pre>
<p><img src="images/python_foundation/conda11.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="command-line-interface-anaconda-prompt-terminal" class="section level2">
<h2>Command Line Interface (Anaconda Prompt / Terminal)</h2>
<p>This section outlines an alternative installation procedure using the command prompt. If you already installed the packages successfully using the GUI method in the previous section, you may skip this part.</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.anaconda.com/products/individual#Downloads">Download the Anaconda Installer</a> for Python 3.8 (or a higher version) for your operating system. Once downloaded, double click the installer and install it into the default suggested directory. Select an install for <em>Just Me</em> and <strong>use default settings</strong>.</li>
</ol>
<blockquote>
<p>Note: If your username has spaces, or non-English characters, it causes problems. In that case, you can install it to a path such as <code>C:\anaconda</code>.</p>
</blockquote>
<p><img src="images/python_foundation/condacli1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Once installed, launch the <em>Anaconda Prompt</em> program from the Windows Start Menu or the <em>Terminal</em> app on Mac/Linux. It is a good practice to create a new <em>environment</em> for each of your Python projects. An environment is a space where you will install required packages. Many packages may contain conflicting requirements, preventing them from all being installed into a single environment. Having a separate environment isolates your project from such problems. Enter the command below and pres <em>Enter</em> to create your new environment.</li>
</ol>
<pre><code>conda create --name python_foundation</code></pre>
<p><img src="images/python_foundation/condacli2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Now you will be asked for confirmation; press <em>y + Enter</em> to proceed and complete your environment creation.</li>
</ol>
<p><img src="images/python_foundation/condacli3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Now that the environment is created, you need to activate it. Type the command below and press <em>Enter</em>. Once the environment activates, the <code>(base)</code> will change to <code>(python_foundation)</code>.</li>
</ol>
<pre><code>conda activate python_foundation</code></pre>
<p><img src="images/python_foundation/condacli4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Now we are ready to install the required packages using the <code>conda install</code> command. First we will install <code>geopandas</code>. This is a module that allows you to work with vector geospatial data in Python. We will use the <code>conda-forge</code> channel to install the package. The <code>-y</code> option will skip the confirmation dialog. Enter the command below and press <em>Enter</em>.</li>
</ol>
<pre><code>conda install --channel conda-forge geopandas -y</code></pre>
<blockquote>
<p>Learn more about <a href="https://conda-forge.org/docs/user/introduction.html">conda-forge</a></p>
</blockquote>
<p><img src="images/python_foundation/condacli5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>If the installation is successful, you should see a message as shown here.</li>
</ol>
<p><img src="images/python_foundation/condacli6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li><code>geopandas</code> installation is a bit tricky and can sometimes fail. So it is a good idea to check if it can be imported without errors. We will use the <code>python</code> command with the <code>-c</code> option which will execute a python statement. Enter the below command and press Enter.</li>
</ol>
<pre><code>python -c &quot;import geopandas&quot;</code></pre>
<p><img src="images/python_foundation/condacli7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>If your geopandas installation was successful, the command will run without any output. <strong>If nothing happens - it means your installation was successful!</strong></li>
</ol>
<p><img src="images/python_foundation/condacli8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>We can now install other required packages for this class. Run the command below to install <code>geopy</code>, <code>rasterio</code>, <code>matplotlib</code> and <code>jupyterlab</code> packages.</li>
</ol>
<pre><code>conda install --channel conda-forge geopy rasterio matplotlib jupyterlab -y</code></pre>
<p><img src="images/python_foundation/condacli9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Once the command finishes, you should see a screen such as below.</li>
</ol>
<p><img src="images/python_foundation/condacli10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Your Python environment is now ready. Launch the <em>JupyterLab</em> application using the command below. This will initiate and run a local server in your system and opens in your default browser.</li>
</ol>
<blockquote>
<p>Note: Do not close your anaconda prompt after <em>JupyterLab</em> opens up. You need to keep it running as long as you want to use JupyterLab.</p>
</blockquote>
<pre><code>jupyter-lab</code></pre>
<p><img src="images/python_foundation/condacli11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>A new browser tab will open with an instance of JupyterLab. Click the <em>Python 3</em> button under <em>Notebook</em>.</li>
</ol>
<p><img src="images/python_foundation/condacli12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Enter the following statements in the first cell and click the <em>Run</em> button. <strong>If nothing happens - it means your installation was successful!</strong>. If you get an <em>ImportError</em>, repeat the installation steps carefully again.</li>
</ol>
<pre><code>import geopandas
import geopy
import rasterio</code></pre>
<p><img src="images/python_foundation/condacli13.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="using-jupyter-notebooks" class="section level1">
<h1>Using Jupyter Notebooks</h1>
<p>Your class data package contain multiple Jupyter notebooks containing code and exercises for this class.</p>
<ol style="list-style-type: decimal">
<li>Launch the <em>JupyterLab</em> application. It will open your Web Browser and load the application in a new tab. From the left-hand panel, navigate to the directory where you extracted the data package.</li>
</ol>
<p><img src="images/python_foundation/setup1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Jupyter notebooks have a <code>.ipynb</code> extensions. Double-click on a notebook file to open it. Code in the notebook is executed cell-by-cell. You can select a cell and click the <em>Run</em> button to execute the code and see the output.</li>
</ol>
<p><img src="images/python_foundation/setup2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>At the end of each notebook, you will find an exercise. Before adding a new cell and attempting to complete the exercise, make sure you go to <strong>Run → Run All Cells</strong> to execute all the code in the notebook. Doing this will ensure all the required variables are avalable to you to use in the exervise.</li>
</ol>
<p><img src="images/python_foundation/setup3.png" width="75%" style="display: block; margin: auto;" /> </p>
<hr />
<p>Open the notebook named <code>00_hello_world.ipynb</code>.</p>
<hr />
</div>
<div id="hello-world" class="section level1">
<h1>Hello World</h1>
<p>When learning a new programming language, it is customary to first learn how to print ‘Hello World!’. While a bit quirky, it is a useful first step to know how to send input to the program and where to see the output. In Python, you can use the built-in <code>print()</code> function to print the greeting <code>"Hello World!"</code></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Hello World!&#39;</span>)</span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>01_variables.ipynb</code>.</p>
<hr />
</div>
<div id="variables" class="section level1">
<h1>Variables</h1>
<div id="strings" class="section level2">
<h2>Strings</h2>
<p>A string is a sequence of letters, numbers, and punctuation marks - or commonly known as <strong>text</strong></p>
<p>In Python you can create a string by typing letters between single or double quotation marks.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">&#39;San Fransico&#39;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="st">&#39;California&#39;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city, state)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city <span class="op">+</span> state)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city <span class="op">+</span> <span class="st">&#39;,&#39;</span> <span class="op">+</span> state)</span></code></pre></div>
</div>
<div id="numbers" class="section level2">
<h2>Numbers</h2>
<p>Python can handle several types of numbers, but the two most common are:</p>
<ul>
<li><strong>int</strong>, which represents integer values like 100, and</li>
<li><strong>float</strong>, which represents numbers that have a fraction part, like 0.5</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> <span class="dv">881549</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">37.7739</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="op">-</span><span class="fl">121.5687</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(population))</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(latitude))</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>elevation_feet <span class="op">=</span> <span class="dv">934</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>elevation_meters <span class="op">=</span> elevation_feet <span class="op">*</span> <span class="fl">0.3048</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(elevation_meters)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>area_sqmi <span class="op">=</span> <span class="fl">46.89</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>density <span class="op">=</span> population <span class="op">/</span> area_sqmi</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(density)</span></code></pre></div>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>We have a variable named <code>distance_km</code> below with the value <code>4135</code> - indicating the straight-line distance between San Francisco and New York in Kilometers. Create another variable called <code>distance_mi</code> and store the distance value in miles.</p>
<ul>
<li>Hint1: 1 mile = 1.60934 kilometers</li>
</ul>
<p>Add the code in the cell below and run it. The output should be 2569.37</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>distance_km <span class="op">=</span> <span class="dv">4135</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove this line and add code here</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>02_data_structures.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="data-structures" class="section level1">
<h1>Data Structures</h1>
<div id="tuples" class="section level2">
<h2>Tuples</h2>
<p>A <em>tuple</em> is a sequence of objects. It can have any number of objects inside. In Python tuples are written with round brackets <strong>()</strong>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">37.7739</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="op">-</span><span class="fl">121.5687</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>coordinates <span class="op">=</span> (latitude, longitude)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coordinates)</span></code></pre></div>
<p>You can access each item by its position, i.e. <em>index</em>. In programming, the counting starts from 0. So the first item has an index of 0, the second item an index of 1 and so now. The index has to be put inside square brackets <strong>[]</strong>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> coordinates[<span class="dv">0</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> coordinates[<span class="dv">1</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x, y)</span></code></pre></div>
</div>
<div id="lists" class="section level2">
<h2>Lists</h2>
<p>A <strong>list</strong> is similar to a tuple - but with a key difference. With tuples, once created, they cannot be changed, i.e. they are immutable. But lists are mutable. You can add, delete or change elements within a list. In Python, lists are written with square brackets <strong>[]</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> [<span class="st">&#39;San Francisco&#39;</span>, <span class="st">&#39;Los Angeles&#39;</span>, <span class="st">&#39;New York&#39;</span>, <span class="st">&#39;Atlanta&#39;</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cities)</span></code></pre></div>
<p>You can access the elements from a list using index the same way as tuples.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cities[<span class="dv">0</span>])</span></code></pre></div>
<p>You can call <code>len()</code> function with any Python object and it will calculates the size of the object.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(cities))</span></code></pre></div>
<p>We can add items to the list using the <code>append()</code> method</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cities.append(<span class="st">&#39;Boston&#39;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cities)</span></code></pre></div>
<p>As lists are <em>mutable</em>, you will see that the size of the list has now changed</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(cities))</span></code></pre></div>
<p>Another useful method for lists is <code>sort()</code> - which can sort the elements in a list.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>cities.sort()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cities)</span></code></pre></div>
<p>The default sorting is in <em>ascending</em> order. If we wanted to sort the list in a <em>decending</em> order, we can call the function with <code>reverse=True</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cities.sort(reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cities)</span></code></pre></div>
</div>
<div id="sets" class="section level2">
<h2>Sets</h2>
<p>Sets are like lists, but with some interesting properties. Mainly that they contain only unique values. It also allows for <em>set operations</em> - such as <em>intersection</em>, <em>union</em> and <em>difference</em>. In practice, the sets are typically created from lists.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>capitals <span class="op">=</span> [<span class="st">&#39;Sacramento&#39;</span>, <span class="st">&#39;Boston&#39;</span>, <span class="st">&#39;Austin&#39;</span>, <span class="st">&#39;Atlanta&#39;</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>capitals_set <span class="op">=</span> <span class="bu">set</span>(capitals)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>cities_set <span class="op">=</span> <span class="bu">set</span>(cities)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>capital_cities <span class="op">=</span> capitals_set.intersection(cities_set)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(capital_cities)</span></code></pre></div>
<p>Sets are also useful in finding unique elements in a list. Let’s merge the two lists using the <code>extend()</code> method. The resulting list will have duplicate elements. Creating a set from the list removes the duplicate elements.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cities.extend(capitals)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cities)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">set</span>(cities))</span></code></pre></div>
</div>
<div id="dictionaries" class="section level2">
<h2>Dictionaries</h2>
<p>In Python dictionaries are written with curly brackets <strong>{}</strong>. Dictionaries have <em>keys</em> and <em>values</em>. With lists, we can access each element by its index. But a dictionary makes it easy to access the element by name. Keys and values are separated by a colon <strong>:</strong>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">&#39;city&#39;</span>: <span class="st">&#39;San Francisco&#39;</span>, <span class="st">&#39;population&#39;</span>: <span class="dv">881549</span>, <span class="st">&#39;coordinates&#39;</span>: (<span class="op">-</span><span class="fl">122.4194</span>, <span class="fl">37.7749</span>) }</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code></pre></div>
<p>You can access an item of a dictionary by referring to its key name, inside square brackets.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data[<span class="st">&#39;city&#39;</span>])</span></code></pre></div>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise</h2>
<p>From the dictionary below, how do you access the latitude and longitude values? print the latitude and longitude of new york city by extracting it from the dictionary below.</p>
<p>The expected output should look like below.</p>
<pre><code>40.661
-73.944</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nyc_data <span class="op">=</span> {<span class="st">&#39;city&#39;</span>: <span class="st">&#39;New York&#39;</span>, <span class="st">&#39;population&#39;</span>: <span class="dv">8175133</span>, <span class="st">&#39;coordinates&#39;</span>: (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>) }</span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>03_string_operations.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="string-operations" class="section level1">
<h1>String Operations</h1>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">&#39;San Francisco&#39;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(city))</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city.split())</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city.upper())</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>city[<span class="dv">0</span>]</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>city[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>city[<span class="dv">0</span>:<span class="dv">3</span>]</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>city[<span class="dv">4</span>:]</span></code></pre></div>
<div id="escaping-characters" class="section level2">
<h2>Escaping characters</h2>
<p>Certain characters are special since they are by Python language itself. For example, the quote character <strong>’</strong> is used to define a string. What do you do if your string contains a quote character?</p>
<p>In Python strings, the backslash <strong>\</strong> is a special character, also called the <strong>escape</strong> character. Prefixing any character with a backslash makes it an ordinary character. (Hint: Prefixing a backslash with a backshalsh makes it ordinary too!)</p>
<p>It is also used for representing certain whitespace characters, \n is a newline, \t is a tab etc.</p>
<p>Remove the # from the cell below and run it.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># my_string = &#39;It&#39;s a beautiful day!&#39;</span></span></code></pre></div>
<p>We can fix the error by espacing the single quote within the string.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>my_string <span class="op">=</span> <span class="st">&#39;It</span><span class="ch">\&#39;</span><span class="st">s a beautiful day!&#39;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_string)</span></code></pre></div>
<p>Alternatively, you can also use double-quotes if your string contains a single-quote.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>my_string <span class="op">=</span> <span class="st">&quot;It&#39;s a beautiful day!&quot;</span></span></code></pre></div>
<p>What if our string contains both single and double quotes?</p>
<p>We can use triple-quotes! Enclosing the string in triple quotes ensures both single and double quotes are treated correctly.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="st">&#39;&#39;&#39;37° 46&#39; 26.2992&quot; N&#39;&#39;&#39;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="st">&#39;&#39;&#39;122° 25&#39; 52.6692&quot; W&#39;&#39;&#39;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(latitude, longitude)</span></code></pre></div>
<p>Backslashes pose another problem when dealing with Windows paths</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#path = &#39;C:\Users\ujaval&#39;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(path)</span></span></code></pre></div>
<p>Prefixing a string with <strong>r</strong> makes is a <em>Raw string</em>. Which doesn’t interpret backslash as a special character</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="vs">r&#39;C:\Users\ujaval&#39;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(path)</span></code></pre></div>
</div>
<div id="printing-strings" class="section level2">
<h2>Printing Strings</h2>
<p>Modern way of creating strings from variables is using the <code>format()</code> method</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">&#39;San Fransico&#39;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> <span class="dv">881549</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> <span class="st">&#39;Population of </span><span class="sc">{}</span><span class="st"> is </span><span class="sc">{}</span><span class="st">.&#39;</span>.<span class="bu">format</span>(city, population)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(output)</span></code></pre></div>
<p>You can also use the format method to control the precision of the numbers</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">37.7749</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="op">-</span><span class="fl">122.4194</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>coordinates <span class="op">=</span> <span class="st">&#39;</span><span class="sc">{:.2f}</span><span class="st">,</span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(latitude, longitude)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coordinates)</span></code></pre></div>
<hr />
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise</h2>
<p>Use the string slicing to extract and print the degrees, minutes and second parts of the string below. The output should be as follows</p>
<pre><code>37
46
26.2992</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="st">&#39;&#39;&#39;37° 46&#39; 26.2992&quot;&#39;&#39;&#39;</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>04_loops_and_conditionals.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="loops-and-conditionals" class="section level1">
<h1>Loops and Conditionals</h1>
<div id="for-loops" class="section level2">
<h2>For Loops</h2>
<p>A for loop is used for iterating over a sequence. The sequence can be a list, a tuple, a dictionary, a set, or a string.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> [<span class="st">&#39;San Francisco&#39;</span>, <span class="st">&#39;Los Angeles&#39;</span>, <span class="st">&#39;New York&#39;</span>, <span class="st">&#39;Atlanta&#39;</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cities:</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(city)</span></code></pre></div>
<p>To iterate over a dictionary, you can call the <code>items()</code> method on it which returns a tuple of key and value for each item.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">&#39;city&#39;</span>: <span class="st">&#39;San Francisco&#39;</span>, <span class="st">&#39;population&#39;</span>: <span class="dv">881549</span>, <span class="st">&#39;coordinates&#39;</span>: (<span class="op">-</span><span class="fl">122.4194</span>, <span class="fl">37.7749</span>) }</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> data.items():</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x, y)</span></code></pre></div>
<p>The built-in <code>range()</code> function allows you to create sequence of numbers that you can iterate over</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<p>The range function can also take a start and an end number</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>):</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
</div>
</div>
<div id="conditionals" class="section level1">
<h1>Conditionals</h1>
<p>Python supports logical conditions such as equals, not equals, greater than etc. These conditions can be used in several ways, most commonly in <em>if statements</em> and loops.</p>
<p>An <em>if statement</em> is written by using the <code>if</code> keyword.</p>
<p>Note: A very common error that programmers make is to use <em>=</em> to evaluate a <em>equals to</em> condition. The <em>=</em> in Python means assignment, not equals to. Always ensure that you use the <em>==</em> for an equals to condition.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cities:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> city <span class="op">==</span> <span class="st">&#39;Atlanta&#39;</span>:</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(city)</span></code></pre></div>
<p>You can use <code>else</code> keywords along with <code>if</code> to match elements that do not meet the condition</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cities:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> city <span class="op">==</span> <span class="st">&#39;Atlanta&#39;</span>:</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(city)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;This is not Atlanta&#39;</span>)</span></code></pre></div>
<p>Python relies on indentation (whitespace at the beginning of a line) to define scope in the for loop and if statements. So make sure your code is properly indented.</p>
<p>You can evaluate a series of conditions using the <code>elif</code> keyword.</p>
<p>Multiple criteria can be combined using the <code>and</code> and <code>or</code> keywords.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>cities_population <span class="op">=</span> {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;San Francisco&#39;</span>: <span class="dv">881549</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Los Angeles&#39;</span>: <span class="dv">3792621</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;New York&#39;</span>: <span class="dv">8175133</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Atlanta&#39;</span>:<span class="dv">498044</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city, population <span class="kw">in</span> cities_population.items():</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> population <span class="op">&lt;</span> <span class="dv">1000000</span>:</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> is a small city&#39;</span>.<span class="bu">format</span>(city))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> population <span class="op">&gt;</span> <span class="dv">1000000</span> <span class="kw">and</span> population <span class="op">&lt;</span> <span class="dv">5000000</span>:</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> is a big city&#39;</span>.<span class="bu">format</span>(city))</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> is a mega city&#39;</span>.<span class="bu">format</span>(city))</span></code></pre></div>
<div id="control-statements" class="section level2">
<h2>Control Statements</h2>
<p>A for-loop iterates over each item in the sequence. Sometimes is desirable to stop the execution, or skip certain parts of the for-loops. Python has special statements, <code>break</code>, <code>continue</code> and <code>pass</code>.</p>
<p>A <code>break</code> statement will stop the loop and exit out of it</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cities:</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(city)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> city <span class="op">==</span> <span class="st">&#39;Los Angeles&#39;</span>:</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;I found Los Angeles&#39;</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span></code></pre></div>
<p>A <code>continue</code> statement will skip the remaining part of the loop and go to the next iteration</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cities:</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> city <span class="op">==</span> <span class="st">&#39;Los Angeles&#39;</span>:</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(city)</span></code></pre></div>
<p>A <code>pass</code> statement doesn’t do anything. It is useful when some code is required to complete the syntax, but you do not want any code to execute. It is typically used as a placeholder when a function is not complete.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city <span class="kw">in</span> cities:</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> city <span class="op">==</span> <span class="st">&#39;Los Angeles&#39;</span>:</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(city)</span></code></pre></div>
</div>
<div id="exercise-3" class="section level2">
<h2>Exercise</h2>
<p>The Fizz Buzz challenge.</p>
<p>Write a program that prints the numbers from 1 to 100 and for multiples of 3 print <strong>Fizz</strong> instead of the number and for the multiples of 5 print <strong>Buzz</strong>. If it is divisible by both, print <strong>FizzBuzz</strong>.</p>
<p>So the output should be something like below</p>
<p><code>1, 2, Fizz, 4, Buzz, Fizz, 7, 8, Fizz, Buzz, 11, Fizz, 13, 14, FizzBuzz, ...</code></p>
<p>Breaking down the problem further, we need to create for-loop with following conditions</p>
<ul>
<li>If the number is a multiple of both 3 and 5 (i.e. 15), print FizzBuzz</li>
<li>If the number is multiple of 3, print Fizz</li>
<li>If the number is multiple of 5, print Buzz</li>
<li>Otherwise print the number</li>
</ul>
<p>Hint: See the code cell below. Use the modulus operator <strong>%</strong> to check if a number is divisible by another. <code>10 % 5</code> equals 0, meaning it is divisible by 5.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>):</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x<span class="op">%</span><span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> is divisible by 2&#39;</span>.<span class="bu">format</span>(x))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> is not divisible by 2&#39;</span>.<span class="bu">format</span>(x))</span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>05_functions.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>A function is a block of code that takes one or more <em>inputs</em>, does some processing on them and returns one or more <em>outputs</em>. The code within the function runs only when it is called.</p>
<p>A funtion is defined using the <code>def</code> keyword</p>
<pre><code>def my_function():
    ....
    ....
    return something</code></pre>
<p>Functions are useful because they allow us to capture the logic of our code and we can run it with differnt inputs without having to write the same code again and again.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greet(name):</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&#39;Hello &#39;</span> <span class="op">+</span> name</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(greet(<span class="st">&#39;World&#39;</span>))</span></code></pre></div>
<p>Functions can take multiple arguments. Let’s write a function to convert coordinates from degrees, minutes, seconds to decimal degrees. This conversion is needed quite often when working with data collected from GPS devices.</p>
<ul>
<li>1 degree is equal to 60 minutes</li>
<li>1 minute is equal to 60 seconds (3600 seconds)</li>
</ul>
<p>To calculate decimal degrees, we can use the formula below:</p>
<p>If degrees are positive:</p>
<p><code>Decimal Degrees = degrees + (minutes/60) + (seconds/3600)</code></p>
<p>If degrees are negative</p>
<p><code>Decimal Degrees = degrees - (minutes/60) - (seconds/3600)</code></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dms_to_decimal(degrees, minutes, seconds):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> degrees <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> degrees <span class="op">-</span> minutes<span class="op">/</span><span class="dv">60</span> <span class="op">-</span> seconds<span class="op">/</span><span class="dv">3600</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> degrees <span class="op">+</span> minutes<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> seconds<span class="op">/</span><span class="dv">3600</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> dms_to_decimal(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(output)</span></code></pre></div>
<div id="exercise-4" class="section level2">
<h2>Exercise</h2>
<p>Given a coordinate string with value in degree, minutes and seconds, convert it to decimal degrees by calling the <code>dms_to_decimal</code> function.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dms_to_decimal(degrees, minutes, seconds):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> degrees <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> degrees <span class="op">-</span> minutes<span class="op">/</span><span class="dv">60</span> <span class="op">-</span> seconds<span class="op">/</span><span class="dv">3600</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> degrees <span class="op">+</span> minutes<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> seconds<span class="op">/</span><span class="dv">3600</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>coordinate <span class="op">=</span> <span class="st">&#39;&#39;&#39;37° 46&#39; 26.2992&quot;&#39;&#39;&#39;</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the code below to extract the parts from the coordinate string,</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># call the function to convert to decimal degrees and print the result</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The expected answer is 37.773972</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint: Converting strings to numbers</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># When you extract the parts from the coordinate string, they are strings</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># You will need to use the built-in int() / float() functions to</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert them to numbers</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="st">&#39;25&#39;</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x, <span class="bu">type</span>(x))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">int</span>(x)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y, <span class="bu">type</span>(y))</span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>06_standard_library.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="the-python-standard-library" class="section level1">
<h1>The Python Standard Library</h1>
<p>Python comes with many built-in modules that offer ready-to-use solutions to common programming problems. To use these modules, you must use the <code>import</code> keyword. Once imported in your Python script, you can use the functions provided by the module in your script.</p>
<p>We will use the built-in <code>math</code> module that allows us to use advanced mathematical functions.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span></code></pre></div>
<p>You can also import specific functions or constants from the module like below</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> pi</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pi)</span></code></pre></div>
<div id="calculating-distance" class="section level2">
<h2>Calculating Distance</h2>
<p>Given 2 points with their Latitude and Longitude coordinates, the Haversine Formula calculates the straight-line distance in meters, assuming that Earth is a sphere.</p>
<p>The formula is simple enough to be implemented in a spreadsheet too. If you are curious, see <a href="https://spatialthoughts.com/2013/07/06/calculate-distance-spreadsheet/">my post</a> about using this formula for calculating distances in a spreadsheet.</p>
<p>We can write a function that accepts a pair of origin and destination coordinates and computes the distance.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> haversine_distance(origin, destination):</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  lat1, lon1 <span class="op">=</span> origin</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  lat2, lon2 <span class="op">=</span> destination</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  radius <span class="op">=</span> <span class="dv">6371000</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  dlat <span class="op">=</span> math.radians(lat2<span class="op">-</span>lat1)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  dlon <span class="op">=</span> math.radians(lon2<span class="op">-</span>lon1)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> math.sin(dlat<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> math.sin(dlat<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> math.cos(math.radians(lat1)) <span class="op">\</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> math.cos(math.radians(lat2)) <span class="op">*</span> math.sin(dlon<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> math.sin(dlon<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> math.atan2(math.sqrt(a), math.sqrt(<span class="dv">1</span><span class="op">-</span>a))</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  distance <span class="op">=</span> radius <span class="op">*</span> c</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> distance</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> haversine_distance(san_francisco, new_york)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(distance<span class="op">/</span><span class="dv">1000</span>, <span class="st">&#39;km&#39;</span>)</span></code></pre></div>
</div>
<div id="discover-python-easter-eggs" class="section level2">
<h2>Discover Python Easter Eggs</h2>
<p>Programmers love to hide secret jokes in their programs for gun. These are known as <em>Easter Eggs</em>. Python has an easter egg that you can see when you try to import the module named <code>this</code>. Try writing the command <code>import this</code> below.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> this</span></code></pre></div>
<p>Let’s try one more. Try importing the <code>antigravity</code> module.</p>
<p>Here’s a complete list of <a href="https://towardsdatascience.com/7-easter-eggs-in-python-7765dc15a203">easter eggs in Python</a>.</p>
</div>
<div id="exercise-5" class="section level2">
<h2>Exercise</h2>
<p>Find the coordinates of 2 cities near you and calculate the distance between them by calling the <code>haversine_distance</code> function below.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> haversine_distance(origin, destination):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  lat1, lon1 <span class="op">=</span> origin</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  lat2, lon2 <span class="op">=</span> destination</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  radius <span class="op">=</span> <span class="dv">6371000</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  dlat <span class="op">=</span> math.radians(lat2<span class="op">-</span>lat1)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  dlon <span class="op">=</span> math.radians(lon2<span class="op">-</span>lon1)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> math.sin(dlat<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> math.sin(dlat<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> math.cos(math.radians(lat1)) <span class="op">\</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> math.cos(math.radians(lat2)) <span class="op">*</span> math.sin(dlon<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> math.sin(dlon<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> math.atan2(math.sqrt(a), math.sqrt(<span class="dv">1</span><span class="op">-</span>a))</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  distance <span class="op">=</span> radius <span class="op">*</span> c</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> distance</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># city1 = (lat1, lng1)</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co"># city2 = (lat2, lng2)</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co"># call the function and print the result</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>07_third_party_modules.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="third-party-modules" class="section level1">
<h1>Third-party Modules</h1>
<p>Python has a thriving ecosystem of third-party modules (i.e. libraries or packages) available for you to install. There are hundreds of thousands of such modules available for you to install and use.</p>
<div id="installing-third-party-libraries" class="section level2">
<h2>Installing third-party libraries</h2>
<p>Python comes with a package manager called <code>pip</code>. It can install all the packages listed at <a href="https://pypi.org/">PyPI (Python Package Index)</a>. To install a package using pip, you need to run a command like following in a Terminal or CMD prompt.</p>
<p><code>pip install &lt;package name&gt;</code></p>
<p>For this course, we are using Anancoda platform - which comes with its own package manager called <code>conda</code>. You can use Anaconda Navigator to search and install packages. Or run the command like following in a Terminal or CMD Prompt.</p>
<p><code>conda install &lt;package name&gt;</code></p>
<p>See this <a href="https://www.anaconda.com/blog/understanding-conda-and-pip">comparison of pip and conda</a> to understand the differences.</p>
</div>
<div id="calculating-distance-1" class="section level2">
<h2>Calculating Distance</h2>
<p>We have already installed the <code>geopy</code> package in our environment. <code>geopy</code> comes with functions that have already implemented many distance calculation formulae.</p>
<ul>
<li><code>distance.great_circle()</code>: Calculates the distance on a great circle using haversine formula</li>
<li><code>distance.geodesic()</code>: Calculates the distance using a chosen ellipsoid using vincenty’s formula</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy <span class="im">import</span> distance</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>straight_line_distance <span class="op">=</span> distance.great_circle(san_francisco, new_york)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>ellipsoid_distance <span class="op">=</span> distance.geodesic(san_francisco, new_york, ellipsoid<span class="op">=</span><span class="st">&#39;WGS-84&#39;</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(straight_line_distance, ellipsoid_distance)</span></code></pre></div>
</div>
<div id="exercise-6" class="section level2">
<h2>Exercise</h2>
<p>Repeat the distance calculation exercise from the previous module but perform the calculation using the geopy library.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy <span class="im">import</span> distance</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># city1 = (lat1, lng1)</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># city2 = (lat2, lng2)</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># call the geopy distance function and print the great circle and ellipsoid distance</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>08_using_web_apis.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="using-web-apis" class="section level1">
<h1>Using Web APIs</h1>
<p>An API, or Application Program Interface, allows one program to <em>talk</em> to another program. Many websites or services provide an API so you can query for information in an automated way.</p>
<p>For mapping and spatial analysis, being able to use APIs is critical. For the longest time, Google Maps API was the most popular API on the web. APIs allow you to query web servers and get results without downloading data or running computation on your machine.</p>
<p>Common use cases for using APIs for spatial analysis are</p>
<ul>
<li>Getting directions / routing</li>
<li>Route optimization</li>
<li>Geocoding</li>
<li>Downloading data</li>
<li>Getting real-time weather data</li>
<li>…</li>
</ul>
<p>The provide of such APIs have many ways to implement an API. There are standards such as REST, SOAP, GraphQL etc. <em>REST</em> is the most populat standard for web APIs, and for geospatial APIs. REST APIs are used over HTTP and thus called web APIs.</p>
<div id="understanding-json-and-geojson" class="section level2">
<h2>Understanding JSON and GeoJSON</h2>
<p>JSON stands for <strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation. It is a format for storing and transporting data, and is the de-facto standard for data exchanged by APIs. GeoJSON is an extension of the JSON format that is commonly used to represent spatial data.</p>
<p>Python has a built-in <code>json</code> module that has methods for reading json data and converting it to Python objects, and vice-versa. In this example, we are using the <code>requests</code> module for querying the API which conveniently does the conversion for us. But it is useful to learn the basics of working with JSON in Python.</p>
<p>The GeoJSON data contains <em>features</em>, where each feature has some <em>properties</em> and a <em>geometry</em>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>geojson_string <span class="op">=</span> <span class="st">&#39;&#39;&#39;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="st">{</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;type&quot;: &quot;FeatureCollection&quot;,</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;features&quot;: [</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="st">    {&quot;type&quot;: &quot;Feature&quot;,</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="st">      &quot;properties&quot;: {&quot;name&quot;: &quot;San Francisco&quot;},</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="st">      &quot;geometry&quot;: {&quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [-121.5687, 37.7739]}</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="st">  ]</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;&#39;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(geojson_string)</span></code></pre></div>
<p>To convert a JSON string to a Python object (i.e. parsing JSON), we can use the <code>json.loads()</code> method.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> json.loads(geojson_string)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(data))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code></pre></div>
<p>Now that we have <em>parsed</em> the GeoJSON string and have a Python object, we can extract infromation from it. The data is stored in a <em>FeatureCollection</em> - which is a list of <em>features</em>. In our example, we have just 1 feature inside the feature collection, so we can access it by using index <strong>0</strong>.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>city_data <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>]</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city_data)</span></code></pre></div>
<p>The feature representation is a dictionary, and individual items can be accesses using the <em>keys</em></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>city_name <span class="op">=</span> city_data[<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;name&#39;</span>]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>city_coordinates <span class="op">=</span> city_data[<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;coordinates&#39;</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(city_name, city_coordinates)</span></code></pre></div>
</div>
<div id="the-requests-module" class="section level2">
<h2>The <code>requests</code> module</h2>
<p>To query a server, we send a <strong>GET</strong> request with some parameters and the server sends a response back. The <code>requests</code> module allows you to send HTTP requests and parse the responses using Python.</p>
<p>The response contains the data received from the server. It contains the HTTP <em>status_code</em> which tells us if the request was successful. HTTP code 200 stands for <em>Sucess OK</em>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">&#39;https://www.spatialthoughts.com&#39;</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response.status_code)</span></code></pre></div>
</div>
<div id="calculating-distance-using-openrouteservice-api" class="section level2">
<h2>Calculating Distance using OpenRouteService API</h2>
<p><img src="images/python_foundation/ors_direction.png" /></p>
<p><a href="https://openrouteservice.org/">OpenRouteService (ORS)</a> provides a free API for routing, distance matrix, geocoding, route optimization etc. using OpenStreetMap data. We will learn how to use this API through Python and get real-world distance between cities.</p>
<p>Almost all APIs require you to sign-up and obtain a <em>key</em>. The <em>key</em> is used to identify you and enforce usage limits so that you do not overwhelm the servers. We will obtain a key from OpenRouteServie so we can use their API</p>
<p>Visit <a href="https://openrouteservice.org/dev/#/signup">OpenRouteService Sign-up page</a> and create an account. Once your account is activated, visit your Dashboard and request a token. Select <em>Free</em> as the Token type and enter <code>python_foundation</code> as the Token name. Click <em>CREATE TOKEN</em>. Once created, copy the long string displayed under Key and enter below.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>ORS_API_KEY <span class="op">=</span> <span class="st">&#39;&lt;replace this with your key&gt;&#39;</span></span></code></pre></div>
<p>We will use the OpenRouteServices’s <a href="https://openrouteservice.org/dev/#/api-docs/v2/directions/%7Bprofile%7D/get">Directions Service</a>. This service returns the driving, biking or walking directions between the given origin and destination points.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;api_key&#39;</span>: ORS_API_KEY,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;start&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(san_francisco[<span class="dv">1</span>], san_francisco[<span class="dv">0</span>]),</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;end&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(new_york[<span class="dv">1</span>], new_york[<span class="dv">0</span>])</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;https://api.openrouteservice.org/v2/directions/driving-car&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request successful.&#39;</span>)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request failed.&#39;</span>)</span></code></pre></div>
<p>We can read the <code>response</code> in JSON format by calling <code>json()</code> method on it.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> response.json()</span></code></pre></div>
<p>The response is a GeoJSON object representing the driving direction between the 2 points. The object is a feature collection with just 1 feature. We can access it using the index <strong>0</strong>. The feature’s property contains <code>summary</code> information which has the data we need.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;summary&#39;</span>]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary)</span></code></pre></div>
<p>We can extract the <code>distance</code> and convert it to kilometers.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> summary[<span class="st">&#39;distance&#39;</span>]</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(distance<span class="op">/</span><span class="dv">1000</span>)</span></code></pre></div>
<p>You can compare this distance to the straight-line distance and see the difference.</p>
</div>
<div id="api-rate-limiting" class="section level2">
<h2>API Rate Limiting</h2>
<p>Many web APIs enforce <em>rate limiting</em> - allowing a limited number of requests over time. With computers it is easy to write a for loop, or have multiple programs send hundrends or thousands of queries per second. The server may not be configured to handle such volume. So the providers specify the limits on how many and how fast the queries can be sent.</p>
<p>OpenRouteService lists several <a href="https://openrouteservice.org/plans/">API Restrictions</a>. The free plan allows for upto 40 direction requests/minute.</p>
<p>There are many libraries available to implement various strategies for rate limiting. But we can use the built-in <code>time</code> module to implement a very simple rate limiting method.</p>
<div id="the-time-module" class="section level3">
<h3>The <code>time</code> module</h3>
<p>Python Standard Library has a <code>time</code> module that allows for time related operation. It contains a method <code>time.sleep()</code> which delays the execution of the program for the specified number of seconds.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code></pre></div>
</div>
</div>
<div id="exercise-7" class="section level2">
<h2>Exercise</h2>
<p>Below cell contains a dictionary with 3 destination cities and their coordinates. Write a <code>for</code> loop to iterate over the <code>destination_cities</code> disctionary and call <code>get_driving_distance()</code> function to print real driving distance between San Fransico and each city. Rate limit your queries by adding <code>time.sleep(2)</code> between successive function calls.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>ORS_API_KEY <span class="op">=</span> <span class="st">&#39;&lt;replace this with your key&gt;&#39;</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_driving_distance(source_coordinates, dest_coordinates):</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">=</span> {</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;api_key&#39;</span>: ORS_API_KEY,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;start&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(source_coordinates[<span class="dv">1</span>], source_coordinates[<span class="dv">0</span>]),</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;end&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(dest_coordinates[<span class="dv">1</span>], dest_coordinates[<span class="dv">0</span>])</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;https://api.openrouteservice.org/v2/directions/driving-car&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>        summary <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;summary&#39;</span>]</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> summary[<span class="st">&#39;distance&#39;</span>]</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> distance<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Request failed.&#39;</span>)</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">9999</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>destination_cities <span class="op">=</span> {</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Los Angeles&#39;</span>: (<span class="fl">34.0522</span>, <span class="op">-</span><span class="fl">118.2437</span>),</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Boston&#39;</span>: (<span class="fl">42.3601</span>, <span class="op">-</span><span class="fl">71.0589</span>),</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Atlanta&#39;</span>: (<span class="fl">33.7490</span>, <span class="op">-</span><span class="fl">84.3880</span>)</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>09_reading_files.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="reading-files" class="section level1">
<h1>Reading Files</h1>
<p>Python provides built-in functions for reading and writing files.</p>
<p>To read a file, we must know the path of the file on the disk. Python has a module called <code>os</code> that has helper functions that helps dealing with the the operating system. Advantage of using the <code>os</code> module is that the code you write will work without change on any suppored operating systems.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code></pre></div>
<p>To open a file, we need to know the path to the file. We will now open and read the file <code>worldcitites.csv</code> located in your data package. In your data package the data folder is in the <code>data/</code> directory. We can construct the relative path to the file using the <code>os.path.join()</code> method.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;worldcities.csv&#39;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(path)</span></code></pre></div>
<p>To open the file, use the built-in <code>open()</code> function. We specify the <em>mode</em> as <code>r</code> which means read-only. If we wanted to change the file contents or write a new file, we would open it with <code>w</code> mode.</p>
<p>Our input file also contains Unicode characters, so we specify <code>UTF-8</code> as the encoding.</p>
<p>The open() function returns a file object. We can call the <code>readline()</code> method for reading the content of the file, one line at a time.</p>
<p>It is a good practice to always close the file when you are done with it. To close the file, we must call the <code>close()</code> method on the file object.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f.readline())</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f.readline())</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>f.close()</span></code></pre></div>
<p>Calling <code>readline()</code> for each line of the file is tedious. Ideally, we want to loop through all the lines in file. You can iterate through the file object like below.</p>
<p>We can loop through each line of the file and increase the <code>count</code> variable by 1 for each iteration of the loop. At the end, the count variable’s value will be equal to the number of lines in the file.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count)</span></code></pre></div>
<div id="exercise-8" class="section level2">
<h2>Exercise</h2>
<p>Print first 5 lines of the file.</p>
<ul>
<li>Hint: Use break statement</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;worldcities.csv&#39;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add code to open the file and read first 5 lines</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>10_reading_csv_files.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="reading-csv-files" class="section level1">
<h1>Reading CSV Files</h1>
<p>Comma-separated Values (CSV) are the most common text-based file format for sharing geospatial data. The structure of the file is 1 data record per line, with individual <em>columns</em> separated by a comma.</p>
<p>In general, the separator character is called a delimiter. Other popular delimiters include the tab (\t), colon (:) and semi-colon (;) characters.</p>
<p>Reading CSV file properly requires us to know which delimiter is being used, along with quote character to surround the field values that contain space of the delimiter character. Since reading delimited text file is a very common operation, and can be tricky to handle all the corner cases, Python comes with its own library called <code>csv</code> for easy reading and writing of CSV files. To use it, you just have to import it.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span></code></pre></div>
<p>The preferred way to read CSV files is using the <code>DictReader()</code> method. Which directly reads each row and creates a dictionary from it - with column names as <em>key</em> and column values as <em>value</em>. Let’s see how to read a file using the <code>csv.DictReader()</code> method.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;worldcities.csv&#39;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>csv_reader <span class="op">=</span> csv.DictReader(f, delimiter<span class="op">=</span><span class="st">&#39;,&#39;</span>, quotechar<span class="op">=</span><span class="st">&#39;&quot;&#39;</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(csv_reader)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>f.close()</span></code></pre></div>
<div id="using-enumerate-function" class="section level2">
<h2>Using <code>enumerate()</code> function</h2>
<p>When iterating over an object, many times we need a counter. We saw in the previous example, how to use a variable like <code>count</code> and increase it with every iteration. There is an easy way to do this using the built-in <code>enumerate()</code> function.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> [<span class="st">&#39;San Francisco&#39;</span>, <span class="st">&#39;Los Angeles&#39;</span>, <span class="st">&#39;New York&#39;</span>, <span class="st">&#39;Atlanta&#39;</span>]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> <span class="bu">enumerate</span>(cities):</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x)</span></code></pre></div>
<p>We can use enumerate() on any iterable object and get a tuple with an index and the iterable value with each iteration. Let’s use it to print the first 5 lines from the DictReader object.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>csv_reader <span class="op">=</span> csv.DictReader(f, delimiter<span class="op">=</span><span class="st">&#39;,&#39;</span>, quotechar<span class="op">=</span><span class="st">&#39;&quot;&#39;</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> <span class="bu">enumerate</span>(csv_reader):</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> index <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>f.close()</span></code></pre></div>
</div>
<div id="using-with-statement" class="section level2">
<h2>Using <code>with</code> statement</h2>
<p>The code for file handling requires we open a file, do something with the file object and then close the file. That is tedious and it is possible that you may forget to call <code>close()</code> on the file. If the code for processing encounters an error the file is not closed property, it may result in bugs - especially when writing files.</p>
<p>The preferred way to work with file objects is using the <code>with</code> statement. It results in simpler and cleaer code - which also ensures file objects are closed properly in case of errors.</p>
<p>As you see below, we open the file and use the file object <code>f</code> in a <code>with</code> statement. Python takes care of closing the file when the execution of code within the statement is complete.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(f)</span></code></pre></div>
</div>
<div id="filtering-rows" class="section level2">
<h2>Filtering rows</h2>
<p>We can use conditional statement while iterating over the rows, to select and process rows that meet certain criterial. Let’s count how many cities from a particular country are present in the file.</p>
<p>Replace the <code>home_country</code> variable with your home country below.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>home_country <span class="op">=</span> <span class="st">&#39;India&#39;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>num_cities <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> home_country:</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>            num_cities <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(num_cities)</span></code></pre></div>
</div>
<div id="calculating-distance-2" class="section level2">
<h2>Calculating distance</h2>
<p>Let’s apply the skills we have learnt so far to solve a complete problem. We want to read the <code>worldcities.csv</code> file, find all cities within a home country, calculate the distance to each cities from a home city and write the results to a new CSV file.</p>
<p>First we find the coordinates of the out selected <code>home_city</code> from the file. Replace the <code>home_city</code> below with your hometown or a large city within your country. Note that we are using the <code>city_ascii</code> field for city name comparison, so make sure the <code>home_city</code> variable contains the ASCII version of the city name.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>home_city <span class="op">=</span> <span class="st">&#39;Bengaluru&#39;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>home_city_coordinates <span class="op">=</span> ()</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">&#39;city_ascii&#39;</span>] <span class="op">==</span> home_city:</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>            lat <span class="op">=</span> row[<span class="st">&#39;lat&#39;</span>]</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>            lng <span class="op">=</span> row[<span class="st">&#39;lng&#39;</span>]</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>            home_city_coordinates <span class="op">=</span> (lat, lng)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(home_city_coordinates)</span></code></pre></div>
<p>Now we can loop through the file, find a city in the chosen home country and call the <code>geopy.distance.geodesic()</code> function to calculate the distance. In the code below, we are just computing first 5 matches.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy <span class="im">import</span> distance</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (row[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> home_country <span class="kw">and</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">&#39;city_ascii&#39;</span>] <span class="op">!=</span> home_city):</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>            city_coordinates <span class="op">=</span> (row[<span class="st">&#39;lat&#39;</span>], row[<span class="st">&#39;lng&#39;</span>])</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>            city_distance <span class="op">=</span> distance.geodesic(</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                city_coordinates, home_city_coordinates).km</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(row[<span class="st">&#39;city_ascii&#39;</span>], city_distance)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>            counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> counter <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>            </span></code></pre></div>
</div>
<div id="writing-files" class="section level2">
<h2>Writing files</h2>
<p>Instead of printing the results, let’s write the results to a new file. Similar to csv.DictReader(), there is a companion <code>csv.DictWriter()</code> method to write files. We create a <code>csv_writer</code> object and then write rows to it using the <code>writerow()</code> method.</p>
<p>First we create an <code>output</code> folder to save the results. We can first check if the folder exists and if it doesn’t exist, we can create it.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_dir)</span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;cities_distance.csv&#39;</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(output_path, mode<span class="op">=</span><span class="st">&#39;w&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> output_file:</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    fieldnames <span class="op">=</span> [<span class="st">&#39;city&#39;</span>, <span class="st">&#39;distance_from_home&#39;</span>]</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    csv_writer <span class="op">=</span> csv.DictWriter(output_file, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    csv_writer.writeheader()</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Now we read the input file, calculate distance and</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># write a row to the output </span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>        csv_reader <span class="op">=</span> csv.DictReader(f)</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (row[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> home_country <span class="kw">and</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>                row[<span class="st">&#39;city_ascii&#39;</span>] <span class="op">!=</span> home_city):</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                city_coordinates <span class="op">=</span> (row[<span class="st">&#39;lat&#39;</span>], row[<span class="st">&#39;lng&#39;</span>])</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>                city_distance <span class="op">=</span> distance.geodesic(</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>                    city_coordinates, home_city_coordinates).km</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>                csv_writer.writerow(</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&#39;city&#39;</span>: row[<span class="st">&#39;city_ascii&#39;</span>],</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;distance_from_home&#39;</span>: city_distance}</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<p>Below is the complete code for our task of reading a file, filtering it, calculating distance and writing the results to a file.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy <span class="im">import</span> distance</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>input_filename <span class="op">=</span> <span class="st">&#39;worldcities.csv&#39;</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>input_path <span class="op">=</span> os.path.join(data_pkg_path, input_filename)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;cities_distance.csv&#39;</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_dir)</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>home_city <span class="op">=</span> <span class="st">&#39;Bengaluru&#39;</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>home_country <span class="op">=</span> <span class="st">&#39;India&#39;</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(input_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> input_file:</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(input_file)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row[<span class="st">&#39;city_ascii&#39;</span>] <span class="op">==</span> home_city:</span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>            home_city_coordinates <span class="op">=</span> (row[<span class="st">&#39;lat&#39;</span>], row[<span class="st">&#39;lng&#39;</span>])</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(output_path, mode<span class="op">=</span><span class="st">&#39;w&#39;</span>) <span class="im">as</span> output_file:</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>    fieldnames <span class="op">=</span> [<span class="st">&#39;city&#39;</span>, <span class="st">&#39;distance_from_home&#39;</span>]</span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>    csv_writer <span class="op">=</span> csv.DictWriter(output_file, fieldnames<span class="op">=</span>fieldnames)</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>    csv_writer.writeheader()</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(input_path, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>) <span class="im">as</span> input_file:</span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>        csv_reader <span class="op">=</span> csv.DictReader(input_file)</span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (row[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> home_country <span class="kw">and</span></span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>                row[<span class="st">&#39;city_ascii&#39;</span>] <span class="op">!=</span> home_city):</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>                city_coordinates <span class="op">=</span> (row[<span class="st">&#39;lat&#39;</span>], row[<span class="st">&#39;lng&#39;</span>])</span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>                city_distance <span class="op">=</span> distance.geodesic(</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>                    city_coordinates, home_city_coordinates).km</span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>                csv_writer.writerow(</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>                    {<span class="st">&#39;city&#39;</span>: row[<span class="st">&#39;city_ascii&#39;</span>],</span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;distance_from_home&#39;</span>: city_distance}</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Successfully written output file at </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output_path))</span></code></pre></div>
</div>
<div id="exercise-9" class="section level2">
<h2>Exercise</h2>
<p>Replace the <code>home_city</code> and <code>home_country</code> variables with your own home city and home country and create a CSV file containing distance from your home city to every other city in your country.</p>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>11_working_with_pandas.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="working-with-pandas" class="section level1">
<h1>Working with Pandas</h1>
<p><img src="images/python_foundation/pandas-logo.png" /></p>
<p>Pandas is a powerful library for working with data. Pandas provides fast and easy functions for reading data from files, and analyzing it.</p>
<p>Pandas is based on another library called <code>numpy</code> - which is widely used in scientific computing. Pandas extends <code>numpy</code> and provides new data types such as <strong>Index</strong>, <strong>Series</strong> and <strong>DataFrames</strong>.</p>
<p>Pandas implementation is very fast and efficient - so compared to other methods of data processing - using <code>pandas</code> results is simpler code and quick processing. We will now re-implement our code for reading a file and computing distance using Pandas.</p>
<p>By convention, <code>pandas</code> is commonly imported as <code>pd</code></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<div id="reading-files-1" class="section level2">
<h2>Reading Files</h2>
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;worldcities.csv&#39;</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span></code></pre></div>
<p>A <strong>DataFrame</strong> is the most used Pandas object. You can think of a DataFrame being equivalent to a Spreadsheet or an Attribute Table of a GIS layer.</p>
<p>Pandas provide easy methods to directly read files into a DataFrame. You can use methods such as <code>read_csv()</code>, <code>read_excel()</code>, <code>read_hdf()</code> and so forth to read a variety of formats. Here we will read the <code>worldcitites.csv</code> file using <code>read_csv()</code> method.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(path)</span></code></pre></div>
<p>Once the file is read and a DataFrame object is created, we can inspect it using the <code>head()</code> method.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code></pre></div>
<p>There is also a <code>info()</code> method that shows basic information about the dataframe, such as number of rows/columns and data types of each column.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.info())</span></code></pre></div>
</div>
<div id="filtering-data" class="section level2">
<h2>Filtering Data</h2>
<p>Pandas have many ways of selecting and filtered data from a dataframe. We will now see how to use the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#boolean-indexing">Boolean Filtering</a> to filter the dataframe to rows that match a condition.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>home_country <span class="op">=</span> <span class="st">&#39;India&#39;</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> df[df[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> home_country]</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered)</span></code></pre></div>
<p>Filtered dataframe is a just view of the original data and we cannot make changes to it. We can save the filtered view to a new dataframe using the <code>copy()</code> method.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>country_df <span class="op">=</span> df[df[<span class="st">&#39;country&#39;</span>] <span class="op">==</span> home_country].copy()</span></code></pre></div>
<p>To locate a particular row or column from a dataframe, Pandas providea <code>loc[]</code> and <code>iloc[]</code> methods - that allows you to <em>locate</em> particular slices of data. Learn about <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#different-choices-for-indexing">different indexing methods</a> in Pandas. Here we can use <code>iloc[]</code> to find the row matching the <code>home_city</code> name. Since <code>iloc[]</code> uses index, the <em>0</em> here refers to the first row.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>home_city <span class="op">=</span> <span class="st">&#39;Bengaluru&#39;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> country_df[country_df[<span class="st">&#39;city_ascii&#39;</span>] <span class="op">==</span> home_city]</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered.iloc[<span class="dv">0</span>])</span></code></pre></div>
<p>Now that we have filtered down the data to a single row, we can select individual column values using column names.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>home_city_coordinates <span class="op">=</span> (filtered.iloc[<span class="dv">0</span>][<span class="st">&#39;lat&#39;</span>], filtered.iloc[<span class="dv">0</span>][<span class="st">&#39;lng&#39;</span>])</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(home_city_coordinates)</span></code></pre></div>
</div>
<div id="performing-calculations" class="section level2">
<h2>Performing calculations</h2>
<p>Let’s learn how to do calculations on a dataframe. We can iterate over each row and perform some calculations. But pandas provide a much more efficient way. You can use the <code>apply()</code> method to run a function on each row. This is fast and makes it easy to complex computations on large datasets.</p>
<p>The <code>apply()</code> function takes 2 arguments. A function to apply, and the axis along which to apply it. <code>axis=0</code> means it will be applied to columns and <code>axis=1</code> means it will apply to rows.</p>
<p><img src="images/python_foundation/pandas_axis.png" /></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy <span class="im">import</span> distance</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_distance(row):</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    city_coordinates <span class="op">=</span> (row[<span class="st">&#39;lat&#39;</span>], row[<span class="st">&#39;lng&#39;</span>])</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> distance.geodesic(city_coordinates, home_city_coordinates).km</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> country_df.<span class="bu">apply</span>(calculate_distance, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span></code></pre></div>
<p>We can add these results to the dataframe by simply assigning the result to a new column.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>country_df[<span class="st">&#39;distance&#39;</span>] <span class="op">=</span> result</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(country_df)</span></code></pre></div>
<p>We are done with our analysis and ready to save the results. We can further filter the results to only certain columns.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> country_df[[<span class="st">&#39;city_ascii&#39;</span>,<span class="st">&#39;distance&#39;</span>]]</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered)</span></code></pre></div>
<p>Let’s rename the <code>city_ascii</code> column to give it a more readable name.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> filtered.rename(columns <span class="op">=</span> {<span class="st">&#39;city_ascii&#39;</span>: <span class="st">&#39;city&#39;</span>})</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered)</span></code></pre></div>
<p>Now that we have added filtered the original data and computed the distance for all cities, we can save the resulting dataframe to a file. Similar to read methods, Pandas have several write methods, such as <code>to_csv()</code>, <code>to_excel()</code> etc.</p>
<p>Here we will use the <code>to_csv()</code> method to write a CSV file. Pandas assigns an index column (unique integer values) to a dataframe by default. We specify <code>index=False</code> so that this index is not added to our output.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;cities_distance_pandas.csv&#39;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>filtered.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Successfully written output file at </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output_path))</span></code></pre></div>
</div>
<div id="exercise-10" class="section level2">
<h2>Exercise</h2>
<p>You will notice that the output file contains a row with the <code>home_city</code> as well. Modify the <code>filtered</code> dataframe to remove this row and write it to a file.</p>
<p>Hint: Use the Boolean filtering method we learnt earlier to select rows that do not match the <code>home_city</code>.</p>
<hr />
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="working-with-geopandas" class="section level1">
<h1>Working with Geopandas</h1>
<p><img src="images/python_foundation/geopandas.png" /></p>
<p>GeoPandas extends the Pandas library to enable spatial operations. It provides new data types such as <strong>GeoDataFrame</strong> and <strong>GeoSeries</strong> which are subclasses of Pandas <strong>DataFrame</strong> and <strong>Series</strong> and enables efficient vector data processing in Python.</p>
<p>GeoPandas make use of many other widely used spatial libraries - but it provides an interface similar to Pandas that make it intuitive to use it with spatial analysis. GeoPandas is built on top of the following libraries that allow it to be spatially aware.</p>
<ul>
<li><a href="https://shapely.readthedocs.io/en/latest/manual.html">Shapely</a> for geometric operations (i.e. buffer, intersections etc.)</li>
<li><a href="https://pyproj4.github.io/pyproj/stable/index.html">PyProj</a> for working with projections</li>
<li><a href="https://pypi.org/project/Fiona/">Fiona</a> for file input and output, which itself is based on the widely used <a href="https://gdal.org/">GDAL/OGR</a> library</li>
</ul>
<p>We will carry out a geoprocessing task that shows various features of this library and show how to do geo data processing in Python. The task is to take a roads data layer from OpenStreetMap and compute the total length of National Highways for each district in a state. The problem is described in detail in my <a href="https://courses.spatialthoughts.com/advanced-qgis.html#exercise-find-the-length-of-national-highways-in-a-state">Advanced QGIS</a> course and show the steps needed to perform this analysis in QGIS. We will replicate this example in Python.</p>
<p><img src="images/python_foundation/karnataka.png" /></p>
<p>By convention, <code>geopandas</code> is commonly imported as <code>gpd</code></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code></pre></div>
<div id="reading-spatial-data" class="section level2">
<h2>Reading Spatial Data</h2>
<div class="sourceCode" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;karnataka.gpkg&#39;</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span></code></pre></div>
<p>GeoPandas has a <code>read_file()</code> method that is able to open a wide variety of vector datasets, including zip files. Here we will open the GeoPackage <code>karnataka.gpkg</code> and read a layer called <code>karnataka_major_roads</code>. The result of the read method is a <strong>GeoDataFrame</strong>.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>roads_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_major_roads&#39;</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roads_gdf.info())</span></code></pre></div>
<p>A GeoDataFrame contains a special column called <em>geometry</em>. All spatial operations on the GeoDataFrame are applied to the geomety column. The geometry column can be accessed using the <code>geometry</code> attribute.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roads_gdf.geometry)</span></code></pre></div>
</div>
<div id="filtering-data-1" class="section level2">
<h2>Filtering Data</h2>
<p>One can use the standard Pandas filtering methods to select a subset of the GeoDataFrame. In addition, GeoPandas also provide way to subset the data based on a bounding box with the <a href="https://geopandas.readthedocs.io/en/latest/indexing.html"><code>cx[]</code> indexer</a>.</p>
<p>For our analysis, we need to apply a filter to extract only the road segments where the <code>ref</code> attribute starts with <strong>‘NH’</strong> - indicating a national highway. We can apply boolean filtering using Panda’s <code>str.match()</code> method with a regular expression.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> roads_gdf[roads_gdf[<span class="st">&#39;ref&#39;</span>].<span class="bu">str</span>.match(<span class="st">&#39;^NH&#39;</span>) <span class="op">==</span> <span class="va">True</span>]</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered.head())</span></code></pre></div>
</div>
<div id="working-with-projections" class="section level2">
<h2>Working with Projections</h2>
<p>Dealing with projetions is a key aspect of working with spatial data. GeoPandas uses the <code>pyproj</code> library to assign and manage projections. Each GeoDataFrame as a <code>crs</code> attribute that contains the projection info. Our source dataset is in EPSG:4326 WGS84 CRS.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered.crs)</span></code></pre></div>
<p>Since our task is to compute line lengths, we need to use a Projected CRS. We can use the <code>to_crs()</code> method to reproject the GeoDataFrame.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>roads_reprojected <span class="op">=</span> filtered.to_crs(<span class="st">&#39;EPSG:32643&#39;</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(roads_reprojected.crs)</span></code></pre></div>
<p>Now that the layer has been reprojected, we can calculate the length of each geometry using the <code>length</code> attribute. The result would be in meters. We can add the line lengths in a new column named <code>length</code>.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>roads_reprojected[<span class="st">&#39;length&#39;</span>] <span class="op">=</span> roads_reprojected[<span class="st">&#39;geometry&#39;</span>].length</span></code></pre></div>
<p>We can apply statistical operations on a DataFrame columns. Here we can compute the total length of national highways in the state by calling the <code>sum()</code> method.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>total_length <span class="op">=</span> roads_reprojected[<span class="st">&#39;length&#39;</span>].<span class="bu">sum</span>()</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Total length of national highways in the state is </span><span class="sc">{}</span><span class="st"> KM&#39;</span>.<span class="bu">format</span>(total_length<span class="op">/</span><span class="dv">1000</span>))</span></code></pre></div>
</div>
<div id="performing-spatial-joins" class="section level2">
<h2>Performing Spatial joins</h2>
<p>There are two ways to combine datasets in geopandas – table joins and spatial joins. For our task, we need information about which district each road segments belongs to. This can be achived using another spatial layer for the districts and doing a spatial join to transfer the attributes of the district layer to the matching road segment.</p>
<p>The <code>karnataka.gpkg</code> contains a layer called <code>karnataka_districts</code> with the district boundaries and names.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_districts&#39;</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(districts_gdf.head())</span></code></pre></div>
<p>Before joining this layer to the roads, we must reproject it to match the CRS of the roads layer.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>districts_reprojected <span class="op">=</span> districts_gdf.to_crs(<span class="st">&#39;EPSG:32643&#39;</span>)</span></code></pre></div>
<p>A spatial join is performed using the <code>sjoin()</code> method. It takes 2 core arguments.</p>
<ul>
<li><code>op</code>: The spatial predicate to decdie which objects to join. Options are <em>intersects</em>, <em>within</em> and <em>contains</em>.</li>
<li><code>how</code>: The type of join to perform. Options are <em>left</em>, <em>right</em> and <em>inner</em>.</li>
</ul>
<p>For our task, we can do a <em>left</em> join and add attributes of the district that <em>intersect</em> the road.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(roads_reprojected, districts_reprojected, how<span class="op">=</span><span class="st">&#39;left&#39;</span>, op<span class="op">=</span><span class="st">&#39;intersects&#39;</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(joined.head())</span></code></pre></div>
</div>
<div id="group-statistics" class="section level2">
<h2>Group Statistics</h2>
<p>The resulting geodataframe now has the matching column from the intersecting district feature. We can now sum the length of the roads and group them by districts. This type of <em>Group Statistics</em> is performed using Panda’s <code>group_by()</code> method.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> joined.groupby(<span class="st">&#39;DISTRICT&#39;</span>)[<span class="st">&#39;length&#39;</span>].<span class="bu">sum</span>()<span class="op">/</span><span class="dv">1000</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results)</span></code></pre></div>
<p>The result of the <code>group_by()</code> method is a Pandas <em>Series</em>. It can be saved to a CSV file using the <code>to_csv()</code> method.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;national_highways_by_districts.csv&#39;</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>results.to_csv(output_path)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Successfully written output file at </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output_path))</span></code></pre></div>
</div>
<div id="exercise-11" class="section level2">
<h2>Exercise</h2>
<p>Before writing the output to the file, round the distance numbers to a whole number.</p>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>13_creating_spatial_data.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="creating-spatial-data" class="section level1">
<h1>Creating Spatial Data</h1>
<p>A common operation in spatial analysis is to take non-spatial data, such as CSV files, and creating a spatial dataset from it using coordinate information contained in the file. GeoPandas provides a convenient way to take data from a delimited-text file, create geometry and write the results as a spatial dataset.</p>
<p>We will read a tab-delimited file of places, filter it to a feature class, create a GeoDataFrame and export it as a GeoPackage file.</p>
<p><img src="images/python_foundation/geonames_mountains.png" /></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data/geonames/&#39;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;US.txt&#39;</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span></code></pre></div>
<div id="reading-tab-delimited-files" class="section level2">
<h2>Reading Tab-Delimited Files</h2>
<p>The source data comes from <a href="https://en.wikipedia.org/wiki/GeoNames">GeoNames</a> - a free and open database of geographic names of the world. It is a huge database containing millions of records per country. The data is distributed as country-level text files in a tab-delimited format. The files do not contain a header row with column names, so we need to specify them when reading the data. The data format is described in detail on the <a href="https://www.geonames.org/export/">Data Export</a> page.</p>
<p>We specify the separator as <strong>\t</strong> (tab) as an argument to the <code>read_csv()</code> method. Note that the file for USA has more than 2M records.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>column_names <span class="op">=</span> [</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;geonameid&#39;</span>, <span class="st">&#39;name&#39;</span>, <span class="st">&#39;asciiname&#39;</span>, <span class="st">&#39;alternatenames&#39;</span>, </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;latitude&#39;</span>, <span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;feature class&#39;</span>, <span class="st">&#39;feature code&#39;</span>,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;country code&#39;</span>, <span class="st">&#39;cc2&#39;</span>, <span class="st">&#39;admin1 code&#39;</span>, <span class="st">&#39;admin2 code&#39;</span>,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;admin3 code&#39;</span>, <span class="st">&#39;admin4 code&#39;</span>, <span class="st">&#39;population&#39;</span>, <span class="st">&#39;elevation&#39;</span>,</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;dem&#39;</span>, <span class="st">&#39;timezone&#39;</span>, <span class="st">&#39;modification date&#39;</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(path, sep<span class="op">=</span><span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>, names<span class="op">=</span>column_names)</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.info())</span></code></pre></div>
</div>
<div id="filtering-data-2" class="section level2">
<h2>Filtering Data</h2>
<p>The input data as a column <code>feature_class</code> categorizing the place into <a href="https://www.geonames.org/export/codes.html">9 feature classes</a>. We can select all rows with the value <code>T</code> with the category <em>mountain,hill,rock…</em></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>mountains <span class="op">=</span> df[df[<span class="st">&#39;feature class&#39;</span>]<span class="op">==</span><span class="st">&#39;T&#39;</span>]</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mountains.head()[[<span class="st">&#39;name&#39;</span>, <span class="st">&#39;latitude&#39;</span>, <span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;dem&#39;</span>,<span class="st">&#39;feature class&#39;</span>]])</span></code></pre></div>
</div>
<div id="creating-geometries" class="section level2">
<h2>Creating Geometries</h2>
<p>GeoPandas has a conveinent function <code>points_from_xy()</code> that creates a Geometry column from X and Y coordinates. We can then take a Pandas dataframe and create a GeoDataFrame by specifying a CRS and the geometry column.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>geometry <span class="op">=</span> gpd.points_from_xy(mountains.longitude, mountains.latitude)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(mountains, crs<span class="op">=</span><span class="st">&#39;EPSG:4326&#39;</span>, geometry<span class="op">=</span>geometry)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf.info())</span></code></pre></div>
</div>
<div id="writing-files-1" class="section level2">
<h2>Writing Files</h2>
<p>We can write the resulting GeoDataFrame to any of the supported vector data format. Here we are writing it as a new GeoPackage file.</p>
<p>You can open the resulting geopackage in a GIS and view the data.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;mountains.gpkg&#39;</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>gdf.to_file(driver<span class="op">=</span><span class="st">&#39;GPKG&#39;</span>, filename<span class="op">=</span>output_path, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Successfully written output file at </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output_path))</span></code></pre></div>
</div>
<div id="exercise-12" class="section level2">
<h2>Exercise</h2>
<p>The data package contains multiple geonames text files from different countries in the <code>geonames/</code> folder. Write code to read all the files, merge them and extract the mountain features to a single geopackage.</p>
<ul>
<li>Hint1: Use the <code>os.listdir()</code> method to get all files in a directory.</li>
<li>Hint2: Use the Pandas method <code>concat()</code> to merge multiple dataframes.</li>
</ul>
<div class="sourceCode" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data/geonames/&#39;</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> os.listdir(data_pkg_path)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>filepaths <span class="op">=</span> []</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>    filepaths.append(os.path.join(data_pkg_path, <span class="bu">file</span>))</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filepaths)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the files, read them using pandas and create a list of dataframes. </span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="co"># You can then use pd.concat() function to merge them</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>14_introduction_to_numpy.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="introduction-to-numpy" class="section level1">
<h1>Introduction to NumPy</h1>
<p><img src="images/python_foundation/numpy.png" /></p>
<p>NumPy (Numerical Python) is an important Python library for scientific computation. Libraries such as Pandas and GeoPandas are built on top of NumPy.</p>
<p>It provides a fast and efficient ways to work with <em>Arrays</em>. In the domain of spatial data analysis, it plays a critical role in working with Raster data - such as satellite imagery, aerial photos, elevation data etc. Since the underlying structure of raster data is a 2D array for each band - learning NumPy is critical in processing raster data using Python.</p>
<p>By convention, <code>numpy</code> is commonly imported as <code>np</code></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div>
<div id="arrays" class="section level2">
<h2>Arrays</h2>
<p>The array object in NumPy is called <code>ndarray</code>. It provides a lot of supporting functions that make working with arrays fast and easy. Arrays may seem like Python Lists, but <code>ndarray</code> is upto 50x faster in mathematical operations. You can create an array using the <code>array()</code> method. As you can see, the rsulting object is of type <code>numpy.ndarray</code></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(a))</span></code></pre></div>
<p>Arrays can have any <em>dimensions</em>. We can create a 2D array like below. <code>ndarray</code> objects have the property <code>ndim</code> that stores the number of array dimensions. You can also check the array size using the <code>shape</code> property.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]])</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b.ndim)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b.shape)</span></code></pre></div>
<p>You can access elements of arrays like Python lists using <code>[]</code> notation.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b[<span class="dv">0</span>])</span></code></pre></div>
<div class="sourceCode" id="cb145"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b[<span class="dv">0</span>][<span class="dv">2</span>])</span></code></pre></div>
</div>
<div id="array-operations" class="section level2">
<h2>Array Operations</h2>
<p>Mathematical operations on numpy arrays are easy and fast. NumPy as many built-in functions for common operations.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">sum</span>(b))</span></code></pre></div>
<p>You can also use the functions operations on arrays.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> np.array([[<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>]])</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.divide(b, c))</span></code></pre></div>
<p>If the objects are numpy objects, you can use the Python operators as well</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b<span class="op">/</span>c)</span></code></pre></div>
<p>You can also combine array and scalar objects. The scalar operation is applied to each item in the array.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b<span class="op">/</span><span class="dv">2</span>)</span></code></pre></div>
<p>An important concept in NumPy is the <em>Array Axes</em>. Similar to the <code>pandas</code> library, In a 2D array, Axis 0 is the direction of rows and Axis 1 is the direction of columns. The diagram below show the directions.</p>
<p><img src="images/python_foundation/pandas_axis.png" /></p>
<p>Let’s see how we can apply a function on a specific axis. Here when we apply <code>sum</code> function on axis-0 of a 2D array, it gives us a 1D-array with values summed across rows.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>row_sum <span class="op">=</span> b.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(row_sum)</span></code></pre></div>
</div>
<div id="exercise-13" class="section level2">
<h2>Exercise</h2>
<p>Sum the array <code>b</code> along Axis-1. What do you think will be the result?</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]])</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
<p>Open the notebook named <code>15_working_with_rasterio.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="working-with-rasterio" class="section level1">
<h1>Working with RasterIO</h1>
<p><a href="https://rasterio.readthedocs.io/en/latest/">RasterIO</a> is a modern library to work with geospatial data in a gridded format. It excels at providing an easy way to read/write raster data and access individual bands and pixels as <code>numpy</code> arrays.</p>
<p>RasterIO is built on top of the popular <a href="https://gdal.org/">GDAL (Geospatial Data Abstraction Library)</a>. GDAL is written in C++ so the Python API provided by GDAL is not very intuitive for Python users. RaserIO aims to make it easy for Python users to use the underlying GDAL library in an intuitive way.</p>
<p>In this section, we will take 4 individual SRTM tiles around the Mt. Everest region and merge them to a single GeoTiff using RasterIO.</p>
<p><img src="images/python_foundation/srtm.png" /></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span></code></pre></div>
<div class="sourceCode" id="cb153"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>srtm_dir <span class="op">=</span> <span class="st">&#39;srtm&#39;</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;N28E087.hgt&#39;</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, srtm_dir, filename)</span></code></pre></div>
<div id="reading-raster-data" class="section level2">
<h2>Reading Raster Data</h2>
<p>RasterIO can read any raster format supported by the GDAL library. We can call the <code>open()</code> method with the file path of the raster. The resulting dataset behaves much like Python’s File object.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> rasterio.<span class="bu">open</span>(path)</span></code></pre></div>
<p>You can check information about the raster using the <code>meta</code> attribute.</p>
<p>An important property is the dataset <em>transform</em>. The transform contains the pixel resolution of the dataset and the row and column coordinates of the upper left corner of the dataset.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> dataset.meta</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>metadata</span></code></pre></div>
<p>To read the pixel values, we need to call the <code>read()</code> method by passing it a band’s index number. Following the GDAL convention, bands are indexed from 1. Since our dataset contain just 1-band, we can read it as follows.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>band1 <span class="op">=</span> dataset.read(<span class="dv">1</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(band1)</span></code></pre></div>
<p>Finally, when we are done with the dataset, we must close it. It is especially important when writing a dataset.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>dataset.close()</span></code></pre></div>
</div>
<div id="merging-datasets" class="section level2">
<h2>Merging Datasets</h2>
<p>Let’s see how we can read the 4 individual tiles and mosaic them together. RasterIO provides multiple sub-modules for various raster operations. We can use the <code>rasterio.merge</code> module to carry out this operation.</p>
<p>We first find all the individual files in the directory using the <code>os.listdir()</code> function.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>srtm_path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;srtm&#39;</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>all_files <span class="op">=</span> os.listdir(srtm_path)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(all_files)</span></code></pre></div>
<p>The rasterio.merge module has a <code>merge()</code> method that takes a list of <em>datasets</em> and returns the merged dataset. So we create an empty list, open each of the files and append it to the list.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>dataset_list <span class="op">=</span> []</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> all_files:</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> os.path.join(srtm_path, <span class="bu">file</span>)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    dataset_list.append(rasterio.<span class="bu">open</span>(path))</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset_list)</span></code></pre></div>
<p>We can pass on the list of tile dataset to the merge method, which will return us the merged data and a new <em>transform</em> which contains the updated extent of the merged raster.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio <span class="im">import</span> merge</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>merged_result <span class="op">=</span> merge.merge(dataset_list)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(merged_result)</span></code></pre></div>
<p>We save the data and the transform to separate variables.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> merged_result[<span class="dv">0</span>]</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>merged_transform <span class="op">=</span> merged_result[<span class="dv">1</span>]</span></code></pre></div>
<p>Verify that the resulting array shape the sum of individual rasters</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(merged_data.shape)</span></code></pre></div>
</div>
<div id="writing-raster-data" class="section level2">
<h2>Writing Raster Data</h2>
<p>Similar to regular Python files, to create a new file, we can open the output file in the <em>write</em> mode. RasterIO provides a <code>write()</code> method that we can use to write individual bands.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;merged.tif&#39;</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span></code></pre></div>
<p>We need to specify many metadata parameters to initialize the output dataset. Some of these parameter values can be directly copied from the input files, such as <code>crs</code>, <code>dtype</code>, <code>nodata</code> etc. , while others can be obtained from the merged dataset, such as <code>height</code> and <code>width</code>.</p>
<p>Remember to call the <code>close()</code> method which will finalize the file and write the data to disk.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>new_dataset <span class="op">=</span> rasterio.<span class="bu">open</span>(output_path, <span class="st">&#39;w&#39;</span>, </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>                            driver<span class="op">=</span><span class="st">&#39;GTiff&#39;</span>,</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>                            height<span class="op">=</span>merged_data.shape[<span class="dv">1</span>],</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span>merged_data.shape[<span class="dv">2</span>],</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>                            count<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>                            nodata<span class="op">=-</span><span class="fl">32768.0</span>,</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>                            dtype<span class="op">=</span>merged_data.dtype,</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>                            crs<span class="op">=</span><span class="st">&#39;+proj=latlong&#39;</span>,</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>                            transform<span class="op">=</span>merged_transform)</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>new_dataset.write(merged_data)</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>new_dataset.close()</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Successfully written output file at </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(output_path))</span></code></pre></div>
</div>
<div id="exercise-14" class="section level2">
<h2>Exercise</h2>
<p>The merged array represents elevation values. The extent of the tiles cover Mt. Everest. Read the resulting raster and find the maximum elevation value contained in it.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;merged.tif&#39;</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the output file as a NumPy array and find the maximum value</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="writing-standalone-python-scripts" class="section level1">
<h1>Writing Standalone Python Scripts</h1>
<p>So far we have used Jupyter Notebooks to write and execute Python code. A notebook is a great choice to interactively explore, visualize and document workflows. But they are not suited for writing scripts for automation. If you have tasks that are long running or want to execute certain tasks on a schedule, you have to write scripts in a standalone <code>.py</code> file and run it from a Terminal or Console.</p>
<div id="get-a-text-editor" class="section level2">
<h2>Get a Text Editor</h2>
<p>Any kind of software development requires a good text editor. If you already have a favorite text editor or an IDE (Integrated Development Environment), you may use it for this course. Otherwise, each platform offers a wide variety of free or paid options for text editors. Choose the one that fits your needs.</p>
<p>Below are my recommendations editors that are simple to use for beginners.</p>
<ul>
<li>Windows: <a href="https://notepad-plus-plus.org/downloads/">Notepad++</a> is a good free editor for windows. Download and install the Notepad++ editor. Tip: Before writing Python code in Notepad+++, make sure to go to Settings → Preferences → Tab Settings and enable <code>Replace by space</code>. Python is very sensitive about whitespace and this setting will ensure tabs and spaces are treated properly.</li>
<li>Mac: <a href="https://macromates.com/">TextMate</a> is an open-source editor for Mac that is currently available for free.</li>
</ul>
</div>
<div id="writing-a-script" class="section level2">
<h2>Writing a Script</h2>
<p>Copy the following code and paste it in your text editor. Browse to the data package directory and save the file as <code>get_distance.py</code>. Make sure that there is no <code>.txt</code> extension at the end.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy <span class="im">import</span> distance</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>ellipsoid_distance <span class="op">=</span> distance.geodesic(san_francisco, new_york, ellipsoid<span class="op">=</span><span class="st">&#39;WGS-84&#39;</span>).km</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Source Coordinates: </span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(san_francisco[<span class="dv">0</span>], san_francisco[<span class="dv">1</span>]))</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Destination Coordinates: </span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(san_francisco[<span class="dv">0</span>], san_francisco[<span class="dv">1</span>]))</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Elliosoid Distance: </span><span class="sc">{}</span><span class="st"> km&#39;</span>.<span class="bu">format</span>(ellipsoid_distance))</span></code></pre></div>
</div>
<div id="executing-a-script" class="section level2">
<h2>Executing a Script</h2>
<div id="windows" class="section level3">
<h3>Windows</h3>
<ol style="list-style-type: decimal">
<li>Launch the <em>Anaconda Navigator</em> program. Select the <code>python_foundation</code> environment and launch the <code>CMD.exe Prompt</code> program.</li>
</ol>
<p><img src="images/python_foundation/win_script1.png" width="80%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Navigate to the directory containing the script using the <code>cd</code> command.</li>
</ol>
<pre><code>cd Downloads\python_foundation</code></pre>
<p><img src="images/python_foundation/win_script2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Run the script using the <code>python</code> command. The script will run and print the distance.</li>
</ol>
<pre><code>python get_distance.py</code></pre>
<p><img src="images/python_foundation/win_script3.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="mac-and-linux" class="section level3">
<h3>Mac and Linux</h3>
<ol style="list-style-type: decimal">
<li>Open a Terminal Window.</li>
</ol>
<p><img src="images/python_foundation/mac_script1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Switch to the correct conda environment.</li>
</ol>
<pre><code>conda activate python_foundation</code></pre>
<p><img src="images/python_foundation/mac_script2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Navigate to the directory containing the script using the <code>cd</code> command.</li>
</ol>
<pre><code>cd Downloads/python_foundation</code></pre>
<p><img src="images/python_foundation/mac_script3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Run the script using the <code>python</code> command. The script will run and print the distance.</li>
</ol>
<blockquote>
<p>If you have multiple python installations on your system, you will have to pick the right Python binary. If the command fails, try <code>python3.7</code> instead of just <code>python</code> in the command below. The script will run and print the distance.</p>
</blockquote>
<pre><code>python get_distance.py</code></pre>
<p><img src="images/python_foundation/mac_script4.png" width="75%" style="display: block; margin: auto;" /></p>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="what-next" class="section level1">
<h1>What next?</h1>
<p>To achieve mastery in programming, you need to practice writing code and solve many diverse type of problems. I strongly recommend picking up a project and implementing it in Python to improve your skills. You can also take other courses to learn aspects of Python and spatial data processing.</p>
<div id="do-a-project" class="section level2">
<h2>Do a Project</h2>
<p>I have some recommendation for projects that are a good fit for beginners, but are still challenging to help you become proficient. You can try to work on as many of the following problems as you like.</p>
<ul>
<li><strong>Geocoding</strong>: Find list of addresses and geocode them to create a point layer. Here’s a good overview of <a href="https://towardsdatascience.com/geocode-with-python-161ec1e62b89">geocoding using geopy</a></li>
<li><strong>Network Analysis</strong>: Use the <a href="https://github.com/gboeing/osmnx">osmnx package</a> to do network analysis with OpenStreetMap data and Python. Start by looking at <a href="https://github.com/gboeing/osmnx-examples/tree/master/notebooks">examples</a></li>
<li><strong>Visualization and Interactive Mapping</strong>: Use the plotting library <a href="https://residentmario.github.io/geoplot/index.html">geoplot</a> or mapping library <a href="https://python-visualization.github.io/folium/">folium</a> to create an interactive map. See this <a href="https://medium.com/analytics-vidhya/interactive-choropleth-map-in-python-using-folium-4e1479d9e568">example</a></li>
<li><strong>Geo-processing</strong>: I have several intermediate level geoprocessing tutorials that use QGIS. You can take any of the following tutorials and implement it using libraries such as <em>geopandas</em> and <em>rasterio</em>.
<ul>
<li><a href="https://www.qgistutorials.com/en/docs/3/performing_table_joins.html">Performing Table Joins</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/performing_spatial_joins.html">Performing Spatial Joins</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/performing_spatial_queries.html">Performing Spatial Queries</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/nearest_neighbor_analysis.html">Nearest Neighbor Analysis</a></li>
<li><a href="https://www.qgistutorials.com/en/docs/3/sampling_raster_data.html">Sampling Raster Data using Points or Polygons</a></li>
</ul></li>
</ul>
<p>You may want to check out this <a href="https://github.com/sacridini/Awesome-Geospatial/blob/master/README.md#python">list of useful python geo-spatial libraries</a> for your project.</p>
</div>
<div id="keep-learning" class="section level2">
<h2>Keep Learning</h2>
<p>Here are some recommendations for courses you could take after you have completed this course.</p>
<ul>
<li>University of Helsinki’s Free <a href="https://geo-python.github.io/site/">Geo-Python Course</a></li>
<li>University of Helsinki’s Free <a href="https://automating-gis-processes.github.io/site/">Automating GIS Processes Course</a></li>
<li>Kaggle’s Free <a href="https://www.kaggle.com/learn">Python Courses</a>, including <a href="https://www.kaggle.com/learn/geospatial-analysis">Geospatial Analysis</a></li>
<li>Allen Downey’s Free <a href="https://allendowney.github.io/ElementsOfDataScience/">Elements of Data Science Course</a></li>
<li><a href="https://geopython.github.io/geopython-workshop/">Doing Geospatial in Python</a> online workshop. Covers some more geospatial libraries, with a focus on OGC services and metadata.</li>
</ul>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="supplement" class="section level1">
<h1>Supplement</h1>
<hr />
<div id="creating-maps-with-geopandas" class="section level2">
<h2>Creating Maps with GeoPandas</h2>
<p>GeoPandas comes with built-in functions for visualizing geospatial data and creating maps. It uses the very powerful <code>matplotlib</code> library to do the plotting. If you are not familiar with matplotlib, check out this <a href="https://www.data-blogger.com/2017/11/15/python-matplotlib-pyplot-a-perfect-combination/">introductory tutorial</a>.</p>
<p>This notebook shows how we can create visualizaion using the datasets from the <a href="#working-with-geopandas">Working with GeoPandas</a> exercise.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;karnataka.gpkg&#39;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>districts <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_districts&#39;</span>)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_major_roads&#39;</span>)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>national_highways <span class="op">=</span> roads[roads[<span class="st">&#39;ref&#39;</span>].<span class="bu">str</span>.match(<span class="st">&#39;^NH&#39;</span>) <span class="op">==</span> <span class="va">True</span>]</span></code></pre></div>
<div id="matplotlib-basics" class="section level3">
<h3>Matplotlib Basics</h3>
<p>Before we start using <code>matplotlib</code> inside a Jupyter notebook, it is useful to set the matplotlib backend to <code>inline</code>. This setting makes the matplotlib graphs included in your notebook, next to the code. We use the <a href="https://ipython.readthedocs.io/en/stable/interactive/tutorial.html#magics-explained">magic function</a> <code>%matplotlib</code> to achieve this.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>It is important to understand the 2 matplotlib objects</p>
<ul>
<li>Figure: This is the main container of the plot. A figure can contain multiple plots inside it</li>
<li>Axes: Axes refers to an individual plot or graph. A figure contains 1 or more axes.</li>
</ul>
<p>We can now work on creating a <em>figure</em> with multiple <em>axes</em> - each with a different rendering on a map layer.</p>
</div>
<div id="rendering-map-layouts" class="section level3">
<h3>Rendering Map Layouts</h3>
<p>The <code>subplots()</code> function creates one or more plots within the figure. You can design a map layout with multiple rows/columns. In the code below, we create a map with <strong>1</strong> row and <strong>3</strong> columns. Using the <code>set_size_inches()</code> function, we set the size of the map to 15in x 7in.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_10_0.png" /></p>
<p>The <code>subplots()</code> function returns 2 items. The figure and a tuple with all the axes within the figure. As we have 3 axes, we unpack them into separate variables</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>ax0, ax1, ax2 <span class="op">=</span> axes</span></code></pre></div>
<p>GeoDataFrame objects have a <code>plot()</code> method that uses <code>pyplot</code> and creates a plot. We supply the <code>ax</code> object to the function so the resulting plot is displayed in the Axes created previously. Here we add the <code>districts</code> polygon layer into the <code>ax0</code> object - which refers to the first subplot.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>districts.plot(ax<span class="op">=</span>ax0, linewidth<span class="op">=</span><span class="dv">1</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#252525&#39;</span>)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_14_0.png" /></p>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<p>Similarly, we add the <code>roads</code> layer to the second axes.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>roads.plot(ax<span class="op">=</span>ax1, linewidth<span class="op">=</span><span class="fl">0.4</span>, color<span class="op">=</span><span class="st">&#39;#2b8cbe&#39;</span>)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_16_0.png" /></p>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<p>Lastly, we add the <code>national_highways</code> layer to the third axes.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>national_highways.plot(ax<span class="op">=</span>ax2, linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">&#39;#de2d26&#39;</span>)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_18_0.png" /></p>
<pre><code>&lt;Figure size 432x288 with 0 Axes&gt;</code></pre>
<p>We can turn off the coordinates display on the X-axis and Y-axis using <code>plt.axis('off')</code>. It is useful to set a title to each map. The <code>set_title()</code> function adds the title to the approproate axes. We specify a negative <code>y</code> parameter to place the title at the bottom of the map instead of top.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>ax0.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>ax0.set_title(<span class="st">&#39;Karnataka Districts&#39;</span>, y<span class="op">=-</span><span class="fl">0.1</span>)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>ax1.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;Karnataka Major Roads&#39;</span>, y<span class="op">=-</span><span class="fl">0.1</span>)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>ax2.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&#39;Karnataka National Highways&#39;</span>, y<span class="op">=-</span><span class="fl">0.1</span>)</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_20_0.png" /></p>
<p>Now that our map is ready, we can save the map to the computer using the <code>savefig()</code> function.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;map_layout.png&#39;</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_dir)</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>fig.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="creating-a-map-with-multiple-layers" class="section level3">
<h3>Creating A Map with Multiple Layers</h3>
<p>If we want to display multiple layers, we simply create new plots on the same <code>Axes</code>. Here we create a figure with a single axes and add the <code>districts</code>,<code>roads</code> and <code>national_highways</code> layers to the same axes.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">15</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>districts.plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">1</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#252525&#39;</span>)</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>roads.plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="fl">0.4</span>, color<span class="op">=</span><span class="st">&#39;#2b8cbe&#39;</span>)</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>national_highways.plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">&#39;#de2d26&#39;</span>)</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;multiple_layers.png&#39;</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_25_0.png" /></p>
</div>
<div id="labelling-features" class="section level3">
<h3>Labelling Features</h3>
<p>We can also add labels to the maps, but that requires a bit of pre-processing. Let’s say we want to add a label for each of the distrit polygons. First, we need to decide the anchor position of the label. We can use <code>representative_point()</code> to get a point inside each polygon that best represents the geometry. It is similar to a centroid, but is guranteed to be inside the polygon. Below code creates a new field in the GeoDataFrame called <code>label_position</code> with the coordinates of the anchor point.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>districts[<span class="st">&#39;label_position&#39;</span>] <span class="op">=</span> districts[<span class="st">&#39;geometry&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.representative_point().coords[:])</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>districts[<span class="st">&#39;label_position&#39;</span>] <span class="op">=</span> [coords[<span class="dv">0</span>] <span class="cf">for</span> coords <span class="kw">in</span> districts[<span class="st">&#39;label_position&#39;</span>]]</span></code></pre></div>
<p>Now we can use the <code>annotate()</code> function and iterate over each polygon to add labels with the name of the district from the <em>DISTRICT</em> column and place it at the coordinates from the <em>label_position</em> column.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">15</span>))</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>districts.plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">1</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#252525&#39;</span>)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> districts.iterrows():</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>    plt.annotate(text<span class="op">=</span>row[<span class="st">&#39;DISTRICT&#39;</span>], xy<span class="op">=</span>row[<span class="st">&#39;label_position&#39;</span>], horizontalalignment<span class="op">=</span><span class="st">&#39;center&#39;</span>)</span></code></pre></div>
<p><img src="supplement1_plotting_files/supplement1_plotting_30_0.png" /></p>
<p><a href="https://nbviewer.jupyter.org/github/spatialthoughts/courses/blob/master/code/python_foundation/supplement1_plotting.ipynb">View the Notebook ↗</a></p>
</div>
</div>
<div id="working-with-xarray" class="section level2">
<h2>Working with Xarray</h2>
<p><a href="http://xarray.pydata.org/">Xarray</a> is an evolution of rasterio and is inspired by libraries like pandas to work with raster datasets. It is particularly suited for working with multi-dimensional time-series raster datasets. It also integrates tightly with <a href="https://dask.org/">dask</a> that allows one to scale raster data processing using parallel computing.</p>
<p><a href="https://corteva.github.io/rioxarray/stable/index.html">rioxarray</a> is an extension of xarray that makes it easy to work with geospatial rasters. You can install the <code>rioxarray</code> package from the <code>conda-forge</code> channel.</p>
<p>This notebook shows how we can replicate the analysis from the <a href="#working-with-rasterio">Working with RasterIO</a> exercise and also covers raster data visualization using <code>matplotlib</code>.</p>
<div id="xarray-and-rioxarray-basics" class="section level3">
<h3>XArray and rioxarray Basics</h3>
<p>We start by reading a single SRTM tile containing elevation values.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>srtm_dir <span class="op">=</span> <span class="st">&#39;srtm&#39;</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;N28E087.hgt&#39;</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, srtm_dir, filename)</span></code></pre></div>
<p>By convention, <code>rioxarray</code> is imported as <code>rxr</code></p>
<div class="sourceCode" id="cb188"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rxr</span></code></pre></div>
<p>The <code>open_rasterio()</code> method is able to read any data source supported by <code>rasterio</code> library.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>rds <span class="op">=</span> rxr.open_rasterio(path)</span></code></pre></div>
<p>The result is a <code>xarray.DataArray</code> object.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(rds)</span></code></pre></div>
<pre><code>xarray.core.dataarray.DataArray</code></pre>
<p>You can access the pixel values using the <code>values</code> property which returns the array’s data as a numpy array.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>rds.values</span></code></pre></div>
<pre><code>array([[[5217, 5211, 5208, ..., 5097, 5098, 5089],
        [5206, 5201, 5200, ..., 5080, 5075, 5069],
        [5199, 5194, 5191, ..., 5063, 5055, 5048],
        ...,
        [5347, 5345, 5343, ..., 5747, 5750, 5757],
        [5338, 5338, 5336, ..., 5737, 5740, 5747],
        [5332, 5331, 5332, ..., 5734, 5736, 5744]]], dtype=int16)</code></pre>
<p>A <code>xarray.DataArray</code> object also contains 1 or more <code>coordinates</code>. Each corrdinate is a 1-dimensional array representing values along one of the data axes. In case of the 1-band SRTM elevation data, we have 3 coordinates - <code>x</code>, <code>y</code> and <code>band</code>.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>rds.coords</span></code></pre></div>
<pre><code>Coordinates:
  * band         (band) int64 1
  * x            (x) float64 87.0 87.0 87.0 87.0 87.0 ... 88.0 88.0 88.0 88.0
  * y            (y) float64 29.0 29.0 29.0 29.0 29.0 ... 28.0 28.0 28.0 28.0
    spatial_ref  int64 0</code></pre>
<p>A key feature of <code>xarray</code> is the ability to access slices of the dataset using <a href="http://xarray.pydata.org/en/stable/user-guide/indexing.html">index lookup</a> methods. For example, we can slice the main dataset and get the data for Band1 using the <code>sel()</code> method.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>band1 <span class="op">=</span> rds.sel(band<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<p>The raster metadata is stored in the <a href="https://corteva.github.io/rioxarray/stable/rioxarray.html#rioxarray-rio-accessors"><code>rio</code></a> accessor. This is enabled by the <code>rioxarray</code> library which provides geospatial functions on top of <code>xarray</code>.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;CRS:&#39;</span>, rds.rio.crs)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Resolution:&#39;</span>, rds.rio.resolution())</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Bounds:&#39;</span>, rds.rio.bounds())</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Width:&#39;</span>, rds.rio.width)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Height:&#39;</span>, rds.rio.height)</span></code></pre></div>
<pre><code>CRS: EPSG:4326
Resolution: (0.0002777777777777778, -0.0002777777777777778)
Bounds: (86.99986111111112, 27.999861111111112, 88.00013888888888, 29.000138888888888)
Width: 3601
Height: 3601</code></pre>
</div>
<div id="merging-rasters" class="section level3">
<h3>Merging Rasters</h3>
<p>Now that you understand the basic data structure of <em>xarray</em> and the &amp;rio* extension, let’s use it to process some data. We will take 4 individual SRTM tiles and merge them to a single GeoTiff. You will note that <code>rioxarray</code> handles the CRS and transform much better - taking care of internal details and providing a simple API.</p>
<blockquote>
<p>Remember to always import <code>rioxarray</code> even if you are using sub-modules. Importing <code>rioxarray</code> activates the <code>rio</code> accessor which is required for all operations.</p>
</blockquote>
<div class="sourceCode" id="cb199"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rxr</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rioxarray.merge <span class="im">import</span> merge_arrays</span></code></pre></div>
<p>Define input and output paths.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>srtm_path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;srtm&#39;</span>)</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>all_files <span class="op">=</span> os.listdir(srtm_path)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;merged.tif&#39;</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span></code></pre></div>
<p>Open each source file using <code>open_rasterio()</code> method and store the resulting datasets in a list.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>datasets <span class="op">=</span> []</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> all_files:</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> os.path.join(srtm_path, <span class="bu">file</span>)</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    datasets.append(rxr.open_rasterio(path))</span></code></pre></div>
<p>Use the <code>merge_arrays()</code> method from the <code>rioxarray.merge</code> module to merge the rasters.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> merge_arrays(datasets)</span></code></pre></div>
<p>Finally, save the merged array to disk as a GeoTiff file.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>merged.rio.to_raster(output_path)</span></code></pre></div>
</div>
<div id="visualizing-rasters-using-matplotlib" class="section level3">
<h3>Visualizing Rasters using Matplotlib</h3>
<p><code>xarray</code> plotting functionality is built on top of the the popular <code>matplotlib</code> library.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>You cna visualize any <code>DataArray</code> object by calling <code>plot()</code> method. Here we create a row of 4 plots and render each of the source SRTM rasters. We can use the <code>cmap</code> option to specify a color ramp. Here we are using the built-in <em>Greys</em> ramp. Appending **_r** gives us the inverted ramp with blacks representing lower elevation values.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">3</span>)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, dataset <span class="kw">in</span> <span class="bu">enumerate</span>(datasets):</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[index]</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>    dataset.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> all_files[index]</span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>    ax.set_title(filename)</span></code></pre></div>
<p><img src="supplement2_working_with_xarray_files/supplement2_working_with_xarray_32_0.png" /></p>
<p>Similarly, we can visualize the merged raster.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>merged.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;merged&#39;</span>)</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="supplement2_working_with_xarray_files/supplement2_working_with_xarray_34_0.png" /></p>
<p><a href="https://nbviewer.jupyter.org/github/spatialthoughts/courses/blob/master/code/python_foundation/supplement2_working_with_xarray.ipynb">View the Notebook ↗</a></p>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li><a href="https://simplemaps.com/data/world-cities">World Cities Database</a>: Basic database. Copyright SimpleMaps.com 2010-2020</li>
<li><a href="https://www.geonames.org">Geonames</a> places database for USA, Canada and Mexico</li>
<li>Karnataka Admin Boundaries: Downloaded from <a href="https://github.com/datameet/maps/tree/master/States">Datameet Spatial Data repository</a>.</li>
<li>OpenStreetMap (osm) data layers: Data/Maps Copyright 2019 Geofabrik GmbH and OpenStreetMap Contributors. <a href="https://download.geofabrik.de/asia/india.html">OSM India free extract</a> downloaded from Geofabrik.</li>
<li>Bangalore Sentinel-2 Imagery. Downloaded from <a href="https://scihub.copernicus.eu/">Copernicus Open Access Hub</a>. Copyright European Space Agency - ESA.</li>
<li>NASA Shuttle Radar Topography Mission (SRTM) Elevation Dataset. Downloaded from <a href="https://dwtkns.com/srtm30m/%5D">30m SRTM Tile Downloader</a>.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course material is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author.</p>
<!--
This material is part of the *Trainer's Package* and the buyer gets a non-exclusive, non-transferable, perpetual license to the material. You can fully customise and brand the materials to your requirements.
-->
<p>© 2020 Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
<p><strong>This course is offered as an instructor-led online class. Visit <a href="https://spatialthoughts.com/events/">Spatial Thoughts</a> to know details of upcoming sessions.</strong></p>
</div>

<div id="disqus_thread" class="standardPadding"></div>

<!-- disqus -->
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = 'https://courses.spatialthoughts.com' + location.pathname;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://spatialthoughts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
