<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Advanced QGIS (Full Course Material)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Advanced QGIS (Full Course Material)</h1>
<h3 class="subtitle">Learn techniques for automating GIS workflows and advanced Visualizations</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#get-the-data-package">Get the Data Package</a></li>
<li><a href="#processing-framework">Processing Framework</a><ul>
<li><a href="#processing-toolbox">Processing Toolbox</a><ul>
<li><a href="#why-should-you-use-processing-algorithms">Why should you use Processing Algorithms</a></li>
<li><a href="#review-default-settings">Review default settings</a></li>
<li><a href="#exercise-find-the-length-of-national-highways-in-a-state">Exercise: Find the length of national highways in a state</a></li>
<li><a href="#learn-more">Learn more</a></li>
<li><a href="#the-locator-bar">The Locator Bar</a></li>
<li><a href="#in-place-editing">In-place Editing</a></li>
</ul></li>
<li><a href="#batch-processing">Batch Processing</a><ul>
<li><a href="#exercise-clip-multiple-layers-to-a-polygon">Exercise: Clip multiple layers to a polygon</a></li>
</ul></li>
<li><a href="#graphical-modeler">Graphical Modeler</a><ul>
<li><a href="#exercise-find-the-hotspots-of-piracy-incidents">Exercise: Find the hotspots of piracy incidents</a></li>
<li><a href="#challenge-improve-the-model">Challenge: Improve the model</a></li>
<li><a href="#spatial-indexing">Spatial Indexing</a></li>
<li><a href="#conditional-branching">Conditional Branching</a></li>
<li><a href="#enabling-reproducible-workflows">Enabling Reproducible Workflows</a></li>
</ul></li>
</ul></li>
<li><a href="#d-animations">2D Animations</a><ul>
<li><a href="#exercise-create-a-gif-showing-changes-in-piracy-hotspots-over-time">Exercise: Create a GIF showing changes in piracy hotspots over time</a></li>
<li><a href="#challenge-improve-the-animation">Challenge: Improve the animation</a></li>
</ul></li>
<li><a href="#d-animations-1">3D Animations</a><ul>
<li><a href="#exercise-create-a-3d-flythrough">Exercise: Create a 3D Flythrough</a></li>
</ul></li>
<li><a href="#summary-aggregate-expressions">Summary Aggregate Expressions</a><ul>
<li><a href="#exercise-count-features-from-another-layer">Exercise: Count features from another layer</a></li>
<li><a href="#learn-more-1">Learn more</a></li>
</ul></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This class focuses on techniques for automation of GIS workflows. You will learn techniques that will help you be more productive, create beautiful visualizations and solve complex spatial analysis problems. This class is ideal for participants who already use QGIS and want to take their skills to the next level.</p>
<p>Below are the topics covered in this class</p>
<ul>
<li>Processing Framework - Algorithms, Batch processing and Modeler</li>
<li>Animating time-series data</li>
<li>Creating 3D fly-through from aerial imagery</li>
<li>Advanced Expressions for enabling faster data editing, fuzzy matching and more.</li>
</ul>
<p>Before we do the exercises, it will help you to learn a bit more about open-source and how QGIS project operates. Review the <a href="https://docs.google.com/presentation/d/13R-RbR5LJmBr5F-VAN0OXh7fRxRC8olFIl2yrOFgG-w/edit?usp=sharing" target="_blank">Introductory Presentation</a>.</p>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The examples in this class use a variety of datasets. All the required layers, project files etc. are supplied to you in the <code>advanced_qgis.zip</code> file along with your class materials. Unzip this file to the <code>Downloads</code> directory.</p>
<p><em>Not enrolled in our instructor-led class but want to work through the material on your own?</em> <a href="https://docs.google.com/forms/d/e/1FAIpQLSeU4jJDVUFjxPpBoMHjxcy8z6BH6TVhS-jtyYL8TPDvWxn6sw/viewform" target="_blank">Get free access to the data package</a></p>
</div>
<div id="processing-framework" class="section level1">
<h1>Processing Framework</h1>
<p>QGIS 2.0 introduced a new concept called Processing Framework. Previously known as Sextante, the Processing Framework provides an environment within QGIS to run native and third-party algorithms for processing data. It is now the recommended way to run any type of data processing and analysis within QGIS - including tasks such as selecting features, altering attributes, saving layers etc. - that can be accomplished by other means. But leveraging the processing framework allows you to be more productive, fast, and less error prone.</p>
<p>The Processing Framework consists of the following distinct elements that work together.</p>
<ul>
<li><strong>Processing Toolbox</strong>: Contains individual tools (i.e. algorithms) grouped by providers and functionality</li>
<li><strong>Batch Processing Interface</strong>: Allows any processing tool to be executed on multiple layers together.</li>
<li><strong>Graphical Modeler</strong>: Allows the user to define the workflow and chain multiple processing steps together using a drag-and-drop mechanism.</li>
<li><strong>History Manager</strong>: Records and stores all executions of algorithms to allow users to reproduce past analysis.</li>
<li><strong>Results Viewer</strong>: An interface to view non-spatial outputs from algorithms - such as tables and charts.</li>
</ul>
<p>We will learn about each of these through hands-on exercises in the following sections.</p>
<div id="processing-toolbox" class="section level2">
<h2>Processing Toolbox</h2>
<p>Processing Toolbox is available from the top-level menu <strong>Processing → Toolbox</strong>. There are hundreds of algorithms available out of the box. They are organized by <em>Providers</em>. The tools created by QGIS developers is available as a <strong>Native</strong> QGIS provider. Processing Framework providers an easy way to integrate tools written by other software and libraries such as GDAL, GRASS and SAGA. QGIS Plugins can also add new functionality via processing algorithms in the toolbox.</p>
<p><img src="images/advanced_qgis/toolbox_algorithms.png" width="75%" style="display: block; margin: auto;" /></p>
<div id="why-should-you-use-processing-algorithms" class="section level3">
<h3>Why should you use Processing Algorithms</h3>
<ul>
<li>Well tested and rigorous implementations</li>
<li>Majority are written in C++ and are faster than alternatives</li>
<li>Long processes can run the the background while you continue to use QGIS</li>
<li>Many multi-threaded algorithms can take advantage of multi-core CPU on your machines and give you better performance</li>
<li>Robust handling of invalid geometry</li>
<li>Ability to see progress of the operation and cancel it</li>
<li>Easily run on all or just selected features</li>
</ul>
</div>
<div id="review-default-settings" class="section level3">
<h3>Review default settings</h3>
<p>You can control what providers are available in settings. The Processing Options menu also provides a way to fine-tune the configuration of the framework.</p>
<p><img src="images/advanced_qgis/processing_settings1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>I strongly recommend changing the default settings and enable the option <em>Prefer output filename for layer names</em>. This option ensures that when you use batch processing, the resulting layers are unique.</p>
<p><img src="images/advanced_qgis/processing_settings2.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-find-the-length-of-national-highways-in-a-state" class="section level3">
<h3>Exercise: Find the length of national highways in a state</h3>
<p>The aim of this exercise is to show how a multi-step spatial analysis problem can be solved using a purely processing-based workflow. This exercise also shows the richness of available algorithms in QGIS that are able to do sophisticated operations that previously needed plugins or were more complex.</p>
<p>We will work with roads extracted from OpenStreetMap for the state of Karnataka in India. The admin boundary for the state and the districts come from DataMeet.</p>
<ol style="list-style-type: decimal">
<li>Browse to the data directory and expand <code>karnataka.gpkg</code>. Drag and drop the <code>karnataka</code>, <code>karnataka_districts</code> and <code>karnataka_major_roads</code> layers to the canvas.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>The layer <code>karnataka_major_roads</code> contain all major roads, including national highways, state highways, major arterial roads etc. Select the layer and use the keyboard shortcut <strong>F6</strong> to open the attribute table.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>You will notice that the <code>ref</code> column has information about road designation. As we are interested in only national highways, we can use the information in this column to extract relevant road segments.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>You can use tools such as <em>Select by expression</em>, export the selected features as a new layer and continue to work. But the processing toolbox providers a much seamless workflow. Search for the algorithm <strong>Extract by expression</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Enter the following expression to extract the features where the value of the <code>ref</code> field starts with the letters <code>NH</code>.</li>
</ol>
<blockquote>
<p>We are using <em>Regular Expression (or RegEx)</em> to match the field value to a specific pattern. Regular expressions are quite powerful and can be used for many complex data filtering operations. <a href="https://medium.com/factory-mind/regex-tutorial-a-simple-cheatsheet-by-examples-649dc1c3f285">Here’s a good tutorial</a> that explains the basics of regular expressions.</p>
</blockquote>
<pre><code>regexp_match(&quot;ref&quot;, &#39;^NH&#39;)</code></pre>
<p><img src="images/advanced_qgis/karnataka5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>You will get a new layer <code>Matching Features</code> in the Layers Panel. Next, we want to calculate the length of each segment. You can use the built-in algorithm <strong>Add geometry attributes</strong></li>
</ol>
<p><img src="images/advanced_qgis/karnataka6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>The source layer is in the Geographic CRS EPSG:4326. But for the analysis, we want the lengths to be measured in meters/kilometers. The algorithm provides us with a handy option to calculate the distances in <strong>Elliposidal</strong> math - which is ideal for layers in the geographic CRS.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>A new layer with an additional field called <code>length</code> will be added to the Layers panel. The distances in this field are in meters. Let’s convert them to kilometers. You may reach out for the trusty QGIS field calculator to add a new field. That’s a perfectly valid way - but as mentioned earlier, there is a <em>processing</em> way to do things which is the preferred way. Search and open the <strong>Field Calculator</strong> processing algorithm instead and enter the following expression.</li>
</ol>
<pre><code>&quot;length&quot;/1000</code></pre>
<p><img src="images/advanced_qgis/karnataka8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>A new layer with the field <code>length_km</code> will be added to the Layers panel. Now we are ready to find out the answer. We just need to sum of the values in the <code>length_km</code> field. Use the <strong>Basic Statictics for Fields</strong> algorithm.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>The result is a table of different statistics on the column. As the result is not a layer, it will be displayed in the <em>Results Viewer</em>. The panel will contain the link to a HTML file containing the statistics. The <strong>Sum</strong> contains the total length of national highways in the state.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka10.png" width="75%" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>What do you think of the results?</em> The resulting number may not be perfect because the OpenStreetMap database may have missing roads or are classified differently. But it is close to the number provided in the <a href="https://morth.nic.in/sites/default/files/PragatiKiNayiGati/pdf/karnataka.pdf">official statistics</a>.</p>
</blockquote>
<ol start="11" style="list-style-type: decimal">
<li>The final layer is called <code>Calculated</code> and is a temporary memory layer. Let’s save it to the disk so we can use it later. The layer contains many fields which are not relevant to us, so let’s delete some columns before saving. The <em>classic</em> way to do this is to toggle editing and use the <em>Delete Column</em> button from the Attribute Table. If you wanted to rename/reorder certain fields, that needed a plugin. But now, we have a really easy processing algorithm called <strong>Refactor Fields</strong> that can add, delete, rename, re-order and change the field types all at once. Delete fields that are not required and save the result as the layer <code>national_highways</code> in the source <code>karnataka.gpkg</code>.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>The layer <code>national_highways</code> will be added to the Layers panel. We achieved the goal of the exercise, but we can explore the results a bit better if we can break down the results by a smaller administrative unit. Let’s try to calculate the length of national highways for each district in the state.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>We have the district information in the <code>karnataka_districts</code> layer, but not in the <code>national_highways</code> layer. To add the name of the district to the roads layer, we need to perform a spatial-join. This is done using the <strong>Join attributes by Location</strong> algorithm.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka13.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>Select the <code>national_highways</code> as the input layer and do a one-to-one join with the <code>karnataka_districts</code> layer. Select only the <strong>DISTRICT</strong> field to be added to the output.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>The new layer <code>Joined layer</code> now has the intersecting district name in the <strong>DISTRICT</strong> field. We can now sum the road lengths and group them for each district. You may recall that in earlier versions of QGIS ,you needed a plugin called Group Stats to do this. But now we can do this via the built-in <strong>Statistic by Categories</strong> algorithm.</li>
</ol>
<p><img src="images/advanced_qgis/karnataka15.png" width="75%" style="display: block; margin: auto;" /></p>
<p>The output of the algorithm is a table containing various statistics on the <code>length_km</code> column for each district. The values in the <strong>Sum</strong> column is the total length of national highways in the district.</p>
<p>Note that we did data processing, spatial analysis and statistical analysis - all using just processing algorithms in a fast, re-producible and intuitive workflow.</p>
</div>
<div id="learn-more" class="section level3">
<h3>Learn more</h3>
<p>Did you know there are over 1000 tools in the Processing Toolbox that can help you do many different tasks? Click on the image to see my video where I share a few of my favorites tools.</p>
<p><a href="https://www.youtube.com/watch?v=Tkqj3VCxrqI" target="_blank"><img src="images/advanced_qgis/processing_tour_qgisna.jpg" alt="Video" style="width:70.0%" /></a></p>
</div>
<div id="the-locator-bar" class="section level3">
<h3>The Locator Bar</h3>
<p>To take your processing experience to the next-level, you can use the built-in <strong>Locator Bar</strong>. At the bottom-left of QGIS main window, there is a universal search bar that can do keyword-search across layers, settings, processing algorithms and more. You can open the locator bar using the keyboard shortcut <strong>Ctrl+K</strong>.</p>
<p><img src="images/advanced_qgis/locator1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>I find that rather than clicking-around the processing toolbox, you can just use locator bar to search and open the algorithms. Type <strong>Ctrl+K</strong>, followed by <strong>a</strong> (to restrict search to algorithms), followed by a <strong>space</strong> and <strong>a few characters</strong>. Use the arrow keys to select and press <strong>Enter</strong> to open the algorithm.</p>
<div class="figure">
<img src="images/advanced_qgis/locator.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/locator.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
<div id="in-place-editing" class="section level3">
<h3>In-place Editing</h3>
<p>Processing algorithms are designed to take inputs and produce outputs. The default behavior is to create a new layer after each operation. This is useful for many workflows, especially in an enterprise setting, where you may not have the ability to edit the source data. If your algorithms are altering the source data, that also means that the workflows cannot be reproduced easily. So you would want a setup where the algorithms read from a source data and create modified outputs.</p>
<p>An exception to this workflow is when you are doing data editing. When your workflow involves creating new features or editing them - creating a new layer for every edit is undesirable. A recent <a href="https://north-road.com/edit-features-in-place-using-qgis-spatial-operations-campaign/">QGIS crowd-funding campaign</a> added the ability for processing algorithms to modify the features in-place and this functionality is available out-of-the-box in QGIS now.</p>
<ol style="list-style-type: decimal">
<li>Load the <strong>basic_network_analysis</strong> project from the data package. This project contains a street network for Washington DC from DCGISopendata where the arrows display the digitizing direction of the line segments. You can click the <strong>Edit Features In-Place</strong> button in the processing toolbox to use algorithms that support this functionality. Once this mode is activated, processing algorithms will modify the selected features in the chosen layer instead of creating a new layer.</li>
</ol>
<p><img src="images/advanced_qgis/inplace1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Select a line segment and run the <strong>Reverse line direction</strong> algorithm. The algorithm will enable editing on the layer, perform the operation and overwrite the existing feature with a segment in the reverse direction. You will see that the arrow rendering is now in the opposite direction.</li>
</ol>
<div class="figure">
<img src="images/advanced_qgis/inplace2.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/inplace2.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
</div>
<div id="batch-processing" class="section level2">
<h2>Batch Processing</h2>
<p>So far we have run the algorithm on 1 layer at a time. But each processing algorithm can also be run in a <strong>Batch</strong> mode on multiple inputs. This provides an easy way to process large amounts of data and automate repetitive tasks.</p>
<p>The batch processing interface can be invoked by right-clicking any processing algorithm and choosing <strong>Execute as Batch Process</strong>.</p>
<div id="exercise-clip-multiple-layers-to-a-polygon" class="section level3">
<h3>Exercise: Clip multiple layers to a polygon</h3>
<p>We will take multiple country-level data layers and use the batch processing operation to clip them to a state polygon in a single operation.</p>
<ol style="list-style-type: decimal">
<li>Open the <strong>batch_processing</strong> project from the data package.Select the <code>India-States</code> layer and use the <strong>Select Features</strong> tool to select a state by clicking it.</li>
</ol>
<p><img src="images/advanced_qgis/batch1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Next, use the <strong>Extract selected features</strong> processing algorithm to create a new layer from the selected feature. This will create a new layer called <code>Selected features</code></li>
</ol>
<p><img src="images/advanced_qgis/batch2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Search for the <strong>Vector Overlay → Clip</strong> algorithm and right-click on it. Select <strong>Execute as Batch Process</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/batch3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the batch processing dialog, click the <em>…</em> button on the first row of the <em>Input layer</em> column and choose <em>Select from Open Layers..</em>. Select all data layers that you want to clip.</li>
</ol>
<p><img src="images/advanced_qgis/batch4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Similarly, select the <code>Selected features</code> layer as the <em>Overlay layer</em>.</li>
</ol>
<p><img src="images/advanced_qgis/batch5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>As all input layers need to be clipped with the same overlay layer, you can click <em>Autofill..</em> and select <em>Fill Down</em> to autofill all the remaining rows with the same value.</li>
</ol>
<p><img src="images/advanced_qgis/batch6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>In the last <em>Clipped</em> column, click the <em>…</em> button and name the output <code>clipped_</code>. When prompted, choose <em>Fill with parameter values</em> as the <em>autofill mode</em>, and <em>Input layer</em> as the <em>Parameter to use</em>.</li>
</ol>
<p><img src="images/advanced_qgis/batch7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Make sure the <em>Load layers on completion</em> box is checked and click <em>Run</em>.</li>
</ol>
<p><img src="images/advanced_qgis/batch8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Resulting clipped layers will be added to the Layers panel. We can combine all the clipped layers into a single geopackage file for ease of sharing. Run the <strong>Package Layers</strong> processing algorithms.</li>
</ol>
<p><img src="images/advanced_qgis/batch9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Choose all the clipped layers and save the output as <code>clipped.gpkg</code>.</li>
</ol>
<p><img src="images/advanced_qgis/batch10.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="graphical-modeler" class="section level2">
<h2>Graphical Modeler</h2>
<p>GIS Workflows typically involve many steps - with each step generating intermediate output that is used by the next step. If you change the input data or want to tweak a parameter, you will need to run through the entire process again manually. Fortunately, Processing Framework provides a graphical modeler that can help you define your workflow and run it with a single invocation. You can also run these workflows as a batch over a large number of inputs.</p>
<div id="exercise-find-the-hotspots-of-piracy-incidents" class="section level3">
<h3>Exercise: Find the hotspots of piracy incidents</h3>
<p>National Geospatial-Intelligence Agency’s Maritime Safety Information portal provides a shapefile of all incidents of maritime piracy in the form of Anti-shipping Activity Messages. We can create a density map by aggregating the incident points over a global hexagonal grid.</p>
<p>The steps needed to create a hex-bin layer suitable for visualization is as follows:</p>
<ul>
<li>Reproject the input to an equal-area projection</li>
<li>Create a global hexagonal grid layer</li>
<li>Select all grids that intersect with at least 1 point</li>
<li>Count points within each grid</li>
</ul>
<p>We will now learn how to build a model that runs the above processing steps in a single workflow.</p>
<ol style="list-style-type: decimal">
<li>Open the <strong>maritime_piracy</strong> project.</li>
</ol>
<p><img src="images/advanced_qgis/modeler1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Launch the modeler from <strong>Processing → Graphical Modeler</strong></li>
</ol>
<p><img src="images/advanced_qgis/modeler2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>In the Processing Modeler dialog, locate the <em>Model Properties</em> panel. Enter <code>piracy_hexbin</code> as the Name of the model and <code>projects</code> as the Groups. Note that there is a History panel in the bottom left, which keeps track of all the work done in Model Builder. Click the Save button.</li>
</ol>
<p><img src="images/advanced_qgis/modeler3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Save the model as <code>piracy_hexbin.model3</code>. Also, check the folder in which it is being saved. <em>Processing → models</em>, from this location QGIS will read the model by default.</li>
</ol>
<p><img src="images/advanced_qgis/modeler4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Now, we can start building a graphical model of our processing pipeline. The Processing modeler dialog contains a left-hand panel and the main canvas. On the left-hand panel, locate the Inputs panel listing various types of input data types. Scroll down and select the <strong>+ Vector Layer</strong> input. Drag it to the canvas.</li>
</ol>
<p><img src="images/advanced_qgis/modeler5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Enter <strong>Input Points</strong> as the <em>Description</em> and <strong>Point</strong> as the <em>Geometry type</em>. This input represents the piracy incidents point layer.</li>
</ol>
<p><img src="images/advanced_qgis/modeler6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Next, drag another <strong>+ Vector Layer</strong> input to the canvas. Enter <strong>Base Layer</strong> as the <em>Description</em> and <strong>Polygon</strong> as the <em>Geometry type</em>. This input represents the natural earth global land layer in which we will use as the extent of the grid layer.</li>
</ol>
<p><img src="images/advanced_qgis/modeler7.png" width="50%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>As we are generating a global hexagonal grid, we can ask the user to supply us with the grid size as an input instead of hard-coding it as part of our model. This way, the user can quickly experiment with different grid sizes without changing the model at all. Select a <strong>+ Number</strong> input and drag it to the canvas. Enter <strong>Grid Size</strong> as the Parameter name, <strong>Integer</strong> as the Number Type, <strong>200000</strong> as Default Value, and click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler8.png" width="50%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Now that we have our user inputs defined, we are ready to add processing steps. All of the processing algorithms are available to you under the <em>Algorithms</em> tab. The first step in our pipeline will be to reproject the base layer to the Project CRS. Search for <strong>Reproject layer</strong> algorithm and drag it to the canvas.</li>
</ol>
<p><img src="images/advanced_qgis/modeler9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>In the <em>Reproject layer</em> dialog, select <strong>Base Layer</strong>, by clicking the button under the <em>Input Layer</em> and select <strong>Model Input</strong> as the <em>Input layer</em>. Check the Use <strong>project CRS</strong> as the <em>Target CRS</em>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>In the Processing Modeler canvas, you will notice a connection appear between the <code>+ Base Layer</code> input and the <code>Reproject layer</code> algorithm. This connection indicates the flow of our processing pipeline. The next step is to create a hexagonal grid. Now search for the <strong>Create grid</strong> algorithm and drag it to the canvas.</li>
</ol>
<p><img src="images/advanced_qgis/modeler11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>In the Create grid dialog, choose <strong>Hexagon (polygon)</strong> as the <em>Grid type</em>. Select <strong>Algorithm Output</strong> by clicking the button under <em>Grid extent</em> and choose <strong>‘Reprojected’ from the algorithm ‘Reproject Layer’</strong> as the Grid extent.</li>
</ol>
<p><img src="images/advanced_qgis/modeler12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Select <strong>Model input</strong> by clicking the button under <em>Horizontal Spacing</em> and choose <strong>Grid Size</strong> as the <em>Horizontal Spacing</em>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler13.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>Select <strong>Model input</strong> by clicking the button under <em>Vertical Spacing</em> and choose <strong>Grid Size</strong> as the <em>Vertical Spacing</em>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>At this point, we have a global hexagonal grid. The grid spans the full extent of the base layer, including land areas and places where there are no points. Let us filter out those grid polygons where there are no input points. Search for <strong>Extract by location</strong> algorithm and drag it to the canvas.</li>
</ol>
<p><img src="images/advanced_qgis/modeler15.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="16" style="list-style-type: decimal">
<li>Select <strong>Algorithm Output</strong> from the icon below <em>Extract features from</em>. Now choose <strong>‘Grid’ from the algorithm ‘Generate Grid’</strong>. Click <strong>…</strong> at the right end.</li>
</ol>
<p><img src="images/advanced_qgis/modeler16.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="17" style="list-style-type: decimal">
<li>Select <strong>Intersect</strong> by clicking the button, as Where the features(geometric predicate). And click the triangle button to go back to the previous window. Now click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler17.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="18" style="list-style-type: decimal">
<li>Select <strong>Model input</strong> by clicking the button under <em>By comparing to the features from</em> and choose <strong>Input Points</strong> as <em>By comparing to the features from</em>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler18.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="19" style="list-style-type: decimal">
<li>Now, we have only those grid polygons that contain some input points. To aggregate these points, we will use <strong>Count points in polygon</strong> algorithm. Search and drag it to the canvas.</li>
</ol>
<p><img src="images/advanced_qgis/modeler19.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="20" style="list-style-type: decimal">
<li>Select <strong>Algorithm Output</strong> by clicking the button under <em>Polygons</em> and choose <strong>‘Extracted (location)’ from algorithm ‘Extract by location’</strong> for <em>Polygons</em>. Now, Select <strong>Model Input</strong> by clicking the button under <em>Points</em> and choose <strong>Input Points</strong> for <em>Points</em>. Type <strong>NUMPOINTS</strong> in <strong>Count field name</strong>. At the bottom, name the Count output layer as <strong>Aggregated</strong>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/modeler20.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="21" style="list-style-type: decimal">
<li>The model is now complete. Click the <em>Save</em> button. If the model is saved, then a green notification will pop on the screen.</li>
</ol>
<p><img src="images/advanced_qgis/modeler21.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="22" style="list-style-type: decimal">
<li>Switch to the main QGIS window. You can find your newly created model in the <em>Processing Toolbox</em> under <strong>Models → projects → piracy_hexbin</strong>. Double-click to run the model.</li>
</ol>
<p><img src="images/advanced_qgis/modeler22.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="23" style="list-style-type: decimal">
<li>Our <em>Base Layer</em> is the <code>ne_10m_land</code> and the <em>Input Points</em> layer is <code>ASAM_events</code>. The Grid Size needs to be specified in the units of the selected CRS. Enter <code>100000</code> as the Grid Size. Grid size is in the unit of the current CRS, which is meters. Click Run to start the processing pipeline. Once the process finishes, click Close.</li>
</ol>
<p><img src="images/advanced_qgis/modeler23.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="24" style="list-style-type: decimal">
<li>You will see a new layer <code>Aggregated</code> loaded as the result of the model. As you explore, you will notice the layer contains an attribute called <em>NUMPOINTS</em> containing the number of piracy incidents points contained within that grid feature. Let’s style this layer to display this information better. Click the <em>Open Layer Styling Panel</em> button from the <em>Layers panel.</em> Select <strong>Graduated</strong> symbology and <strong>NUMPOINTS</strong> as the Column. Click the dropdown next to the Color ramp and select the <strong>Viridis</strong> ramp. Click the dropdown again and select <strong>Invert Color Ramp</strong> to reverse the order of color. The Graduated symbology will divide the values in the selected column into distinct classes and assign a different color to each of the classes. Select <strong>Natural Breaks (Jenks)</strong> as the Mode and click <strong>Classify</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/modeler24.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="25" style="list-style-type: decimal">
<li>We will use a clever trick to make the visualization better. We can use QGIS variables to set the edges of the hexagon with a slightly darker shade of the fill color. Click on the <strong>Symbol</strong>. Click <strong>Simple Fill</strong>. Click the <strong>Data defined override</strong> button next to <strong>Stroke color</strong> and select <strong>Edit</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/modeler25.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="26" style="list-style-type: decimal">
<li>Enter the following expression to set the stroke color to 30% darker than the fill color and click OK. The map rendering will change to a much smoother visualization.</li>
</ol>
<pre><code>darker( @symbol_color , 130)</code></pre>
<p><img src="images/advanced_qgis/modeler26.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="27" style="list-style-type: decimal">
<li>To save this model in the project, right-click on the layer <code>piracy_hexabin</code> and choose <strong>Edit</strong>. In the <em>Model Designer - piracy_hexabin</em> dialog box, click <strong>Save model in project</strong>. Now the model is saved in <code>maritime_piracy</code> project.</li>
</ol>
<p><img src="images/advanced_qgis/modeler27.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="challenge-improve-the-model" class="section level3">
<h3>Challenge: Improve the model</h3>
<p>Can you change the model so that instead of entering the grid size in meters, the user can enter the size in kilometers?</p>
<blockquote>
<p>Hint: The <strong>Create Grid</strong> algorithm expects the size in meters, so you will have to convert the input to meters.</p>
</blockquote>
</div>
<div id="spatial-indexing" class="section level3">
<h3>Spatial Indexing</h3>
<p>When you ran your model, you may have noticed a warning message <strong>No spatial index exists for the input layer, performance will be severely degraded</strong>. This is because certain spatial queries make use of a spatial index and QGIS warns you when having a spatial index can speed up your operations. PostGIS documentation has a good <a href="https://postgis.net/workshops/postgis-intro/indexing.html">overview of spatial indexes</a> and why they are important.</p>
<p>You can compare a <em>spatial index</em> to a book <em>index</em>. When you want to search for a particular term, rather than scanning each page sequentially, you can speed up your search by looking up the index and directly going to the pages where the word appears. Spatial indexes work in a similar way. You spent the effort once to create the index and all subsequent operations can make use of it. When you create a spatial index, each feature’s bounding box is used to establish its relationship with other features. This is stored alongside the dataset and can be used by algorithms. When trying to determine spatial relationships, the algorithms speed-up the look-up using the following <em>two-pass</em> method:</p>
<ul>
<li>Step 1: Use the spatial index to determine which target features’ bounding boxes intersect with the source feature’s bounding box. Since the spatial index already has computed this - this is very fast. The result is a list of candidate features.</li>
<li>Step 2: Now that there is a small subset of candidate features, iterate over them and use their full geometry to evaluate exact intersections.</li>
</ul>
<p>For large datasets, this approach helps reduce the processing time significantly. QGIS has built-in tools to create and use spatial indexes. Let’s see how we can create a spatial index for a layer and use it in our model.</p>
<p>1.Double click on the <code>piracy_hexbin</code> model from <em>Processing Toolbox</em>, select <strong>ne_10m_land</strong> as <em>Base Layer</em>, <strong>200000</strong> as <em>Grid size</em> and <strong>ASAM_events</strong> as <em>Inputs Points</em>. Click Run.</p>
<p><img src="images/advanced_qgis/index1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Switch to <em>Log</em>, and note down the execution time of the model. In this instance we got <em>48.504s</em> (The exact time will vary depending on your computer configuration). Also note that it prompts a warning <em>No spatial index exists for input layer, performance will be severely degraded</em>.</li>
</ol>
<p><img src="images/advanced_qgis/index2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>To create spatial index right-click the <strong>Aggregated</strong> layer and select <em>Properties</em>.</li>
</ol>
<p><img src="images/advanced_qgis/index3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the <em>Properties</em> dialog, switch to the <em>Source</em> tab. You will see the <em>Create Spatial Index</em> button. This button indicates that this layer does not currently have a spatial index. Click that button to create a spatial index. But we will use a better and more scalable way. Close the <em>Properties</em> dialog.</li>
</ol>
<p><img src="images/advanced_qgis/index4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Go to <strong>Processing → Toolbox</strong>. Search for the algorithm <strong>Vector general → Create spatial index</strong> and double-click to launch it.</li>
</ol>
<p><img src="images/advanced_qgis/index5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Select <strong>Aggregated</strong> layer as the <em>Input layer</em> and click <em>Run</em>.</li>
</ol>
<p><img src="images/advanced_qgis/index6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Creating a spatial index is usually a fast operation. Once the algorithm finishes, right-click on the <strong>Aggregated</strong> layer and select <em>Properties</em>. Switch to the <em>Source</em> tab and you will see that the button has now changed to <em>Spatial Index Exists</em> - indicating that the layer now has a spatial index.</li>
</ol>
<p><img src="images/advanced_qgis/index7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>While creating spatial index on a layer like this is useful, it is even more poweful to have the spatial index created during the execution of our model. We will see how to add spatial index creation step in our model. Right-click the <code>piracy_hexbin</code> model and select <em>Edit Model…</em>. Search <strong>Create spatial index</strong> in <em>Algorithms</em> tab and drag it to the model canvas.</li>
</ol>
<p><img src="images/advanced_qgis/index8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Choose <strong>Algorithm output</strong> from the button below <em>Input Layer</em>, and select <strong>“Grid” from algorithm “Create Grid”.</strong> Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/index9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>You will see that the newly added <code>Create spatial index</code> algorithm is connected to the <code>Create grid</code> algorithm. But the workflow should be, <code>Create grid</code> → <code>Create spatial index</code> → <code>Extract from location</code>.</li>
</ol>
<p><img src="images/advanced_qgis/index10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Right-click the <code>Extract by location</code> layer and select <em>Edit</em>. In <em>Extract features from</em> select <strong>“Indexed Layer” from algorithm “Create spatial index”</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/index11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>Now you will see the model diagram updated and the connection changed between the <code>Create Grid</code> and <code>Extract by location</code> layer. Click <em>Save model</em>.</li>
</ol>
<p><img src="images/advanced_qgis/index12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Now return to main canvas and select <code>piracy_hexbin</code> model.</li>
</ol>
<p><img src="images/advanced_qgis/index13.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>Select <strong>ne_10m_land</strong> as <em>Base Layer</em>, <strong>200000</strong> as <em>Grid size</em> and <strong>ASAM_events</strong> as <em>Inputs Points</em>. Click Run.</li>
</ol>
<p><img src="images/advanced_qgis/index14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>In this instance we got <em>15.207 s</em> (The exact time will vary depending on your computer configuration). Also note that it has executed 5 algorithms which is including creating the spatial index.</li>
</ol>
<p><img src="images/advanced_qgis/index15.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="conditional-branching" class="section level3">
<h3>Conditional Branching</h3>
<p>A key feature introduced in QGIS 3.14 was the ability for models to have a conditional branch. This allows models to check for a condition and execute a different part of the model based on the output of the condition. This is equivalent to <em>If/Else statements</em> in a programming language.</p>
<p>Let us develop a <em>Conditional branch</em> in the <code>piracy_hexbin</code> model. We will add a new checkbox input <em>Use Spatial Index</em> - that allows the user to specify whether to use a spatial index in the model. We will add a conditional branch that takes the following actions:</p>
<ul>
<li>If the <em>Use Spatial Index</em> option is selected, the model will proceed, create a spatial index for the grid layer and generate the output.</li>
<li>If the option is not selected, the model will raise an error.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Right-click the <code>piracy_hexbin</code> model and select <strong>Edit Model…</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch01.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Search for <strong>+Boolean</strong> in <em>Inputs</em> tab and drag to canvas.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch02.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Give <em>Description</em> as <strong>use spatial index</strong>, leave <strong>Checked</strong> unticked. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch03.png" width="50%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Now, search for <strong>Conditional branch</strong> in <em>Algorithms</em> tabs and drag to canvas.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch04.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Click the Add button and select the Expression Dialog button.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch05.png" width="75%" style="display: block; margin: auto;" /> 6. Search <strong>usespatialindex</strong> and double click on it. Click OK.</p>
<p><img src="images/advanced_qgis/conditionalBranch06.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Now, in <em>Branch Name</em> type <strong>Use Spatial Index.</strong> Then click Add button and select the Expression Dialog button. Now in the <em>Expression</em> tab type <strong>NOT <span class="citation">@usespatialindex</span></strong> Click OK. Now in the <em>Conditional branch</em> dialog box, under <em>Branch Name</em> type <strong>Don’t Use spatial index.</strong> click OK.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch07.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Right click on <code>Create spatial index</code> in canvas and click … in <em>Dependencies.</em></li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch08.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Choose <strong>Condition “Use Spatial Index” from algorithm “Conditional branch”</strong> and click OK.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch09.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Search for <strong>Raise exception</strong> in <em>Algorithms</em> tab and drag to canvas.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch10.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>In the <em>Error message</em> type <strong>Must use Spatial Index</strong> and click … in <em>Dependencies</em>.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>Choose <strong>Condition “Didn’t use Spatial Index” from algorithm “Conditional branch”</strong>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Click <em>Save model</em>.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch13.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>Now close <em>Model Designer</em> and switch back to main QGIS canvas and double click on <code>piracy_hexbin</code> model in the <strong>Processing toolbox → Models → Projects</strong>. In the <em>Base Layer</em> select <strong>ne_10m_land</strong>, <em>Grid size</em> as <strong>200000</strong>, and <em>Input points</em> as <strong>ASAM_events</strong>. Keep <em>use spatial index</em> as <strong>unchecked</strong> and click Run.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>An Error message <em>Must use Spatial Index</em> will be displayed and execution will be terminated.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch15.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="16" style="list-style-type: decimal">
<li>Now switch to <em>Parameters</em> tab and <strong>check</strong> <em>use spatial index</em>. Click Run.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch16.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="17" style="list-style-type: decimal">
<li>Model execution will be successful and also the spatial indexing has enhanced the model performance by reducing the time.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch17.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="enabling-reproducible-workflows" class="section level3">
<h3>Enabling Reproducible Workflows</h3>
<ol style="list-style-type: decimal">
<li>To ensure that you are always able to reproduce your results, it is recommended to bundle the model in your project. The modeler interface has a button <strong>save model in project</strong> that will embed the model in your QGIS project file.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch18.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Once the model is embedded, Whenever you open the project, the model will be available to the user under the <strong>Project models</strong> in the Processing Toolbox.</li>
</ol>
<p><img src="images/advanced_qgis/conditionalBranch19.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="d-animations" class="section level1">
<h1>2D Animations</h1>
<p>Time is an important component of many spatial datasets. Along with location information, time providers another dimension for analysis and visualization of data. If you are working with dataset that contains timestamps or have observations recorded at multiple time-steps, you can easily visualize it using the <strong>Temporal Controller</strong> in QGIS 3.14 or above.</p>
<div id="exercise-create-a-gif-showing-changes-in-piracy-hotspots-over-time" class="section level2">
<h2>Exercise: Create a GIF showing changes in piracy hotspots over time</h2>
<p>We will continue to work with the maritime piracy dataset. First, we will create a heatmap visualization and then animate the heatmap to show how the piracy hot-spots have changed over the past 2 decades.</p>
<ol style="list-style-type: decimal">
<li>Open the <strong>maritime_piracy</strong> project from the data package. There are thousands of incidents and it is difficult to determine with more piracy. Rather than individual points, a better way to visualize this data is through a heatmap. Select the <code>ASAM_events</code> layers and click the <strong>Open the layer Styling Panel</strong> button in the Layers panel. Click the <strong>Single symbol</strong> drop-down.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>In the renderer selection drop-down, select <strong>Heatmap</strong> renderer. Next, select the <strong>Viridis</strong> color ramp from the Color ramp selector. Adjust the Radius value to <strong>5.0.</strong> At the bottom, expand the <em>Layer Rendering</em> section and adjust the opacity to <strong>75.0%</strong>. This gives a nice visual effect of the hotspots with the land layer below.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Now let’s animate this data to show the yearly map of piracy incidents. Right click on <code>ASAM_event</code> layer, and choose <em>Properties.</em></li>
</ol>
<p><img src="images/advanced_qgis/timeseries3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the layer properties dialog box, select the <em>Temporal</em> tab and enable it by clicking the checkbox.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>The source data contains an attribute <code>dateofocc</code> - representing the date on which the incident took place. This is the field that will be used to determine the points that are rendered for each time period. Select <strong>Single Field with Data/Time</strong> in <em>Configuration</em> Drop down menu, <strong>dateofocc</strong> as Field and <strong>1 Year</strong> for Event duration.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Now a <em>Clock symbol</em> will appear next to the layer name. Click on the <strong>Temporal Control Panel</strong> (Clock icon) from Map Navigation Toolbar.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Click on the <em>Animated Temporal Navigation</em> (play icon) to start the rendering. To increase the duration click <em>Temporal Settings</em> (yellow gear icon) and increase the input frame rate (frames per second).</li>
</ol>
<p><img src="images/advanced_qgis/timeseries7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>To show the year of display, goto <strong>View → Decorations → Title Label Decorations.</strong> Click the checkbox to enable it.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Click <strong>Insert an Expression</strong> button and enter the following expression to display the year.</li>
</ol>
<p><code>format_date(@map_start_time, 'yyyy-MM-dd')</code></p>
<p><img src="images/advanced_qgis/timeseries9.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>Select font size as <strong>25</strong>, set background colour as <strong>white.</strong> In placement choose <strong>Bottom Right.</strong> Now click Ok.</li>
</ol>
<div class="figure">
<img src="images/advanced_qgis/timeseries10.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/timeseries10.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
<ol start="11" style="list-style-type: decimal">
<li>Once the parameters are set accordingly, the year will display as shown. To export these as images and convert them as GIF select the <strong>Export Animation</strong> (save icon) in the Temporal control window.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries11.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>Choose the directory to save the images and select the <code>ne_10_land</code> for map extent.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Once the export finishes, you will see PNG images for each year in the output directory. Now let’s create an animated GIF from these images. There are many options for creating animations from individual image frames. I like [<a href="https://ezgif.com/maker">ezgif.com</a>] for an easy and online tool. Visit the site and click Choose Files and select all the .png files. You may want to sort the images by Type to allow easy bulk selection of only .png files. Once selected, click the Upload and make a GIF! button.</li>
</ol>
<p><img src="images/advanced_qgis/timeseries13.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="challenge-improve-the-animation" class="section level2">
<h2>Challenge: Improve the animation</h2>
<p>You will notice that for each frame of the animation, the year is displayed at the top-centre. But instead of the full date and time, let’s change it to display the year that the map represents. Also place the copyrights info at bottom right. The output should look something like below.</p>
<div class="figure">
<img src="images/advanced_qgis/timeseries14.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/timeseries14.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
</div>
<div id="d-animations-1" class="section level1">
<h1>3D Animations</h1>
<p>Recent versions of QGIS include native support for 3D data. Using this feature, you can easily view, explore and animate 3D elevation data. Note that your computer must have a supported graphics card for this feature to work.</p>
<div id="exercise-create-a-3d-flythrough" class="section level2">
<h2>Exercise: Create a 3D Flythrough</h2>
<p>We will work with a 5m Digital Elevation Model (DEM) of Denali peak in Alaska and create an animation showing a 3D visualization of the dataset.</p>
<ol style="list-style-type: decimal">
<li>Open the <strong>denali</strong> project from the data package. The data contains the raw DEM layer and a hillshade layer created from the DEM.</li>
</ol>
<p><img src="images/advanced_qgis/3d1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Go to <strong>View → New 3D Map View</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/3d2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>A new map window will open containing the rendered map layers from the main canvas. Click the <strong>Configure</strong> button.</li>
</ol>
<p><img src="images/advanced_qgis/3d3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>In the <em>Terrain</em> section, select <strong>DEM (Raster Layer)</strong> as the <em>Type</em>. Select <code>denali_dem</code> layer as the <em>Elevation</em>. Click OK.</li>
</ol>
<p><img src="images/advanced_qgis/3d4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>In the 3D view, you can hold the <strong>Shift</strong> key and drag your mouse to tilt the top-down view. You will see the map in 3D. You can also use the controls on the right-hand panel to tilt,zoom and pan the view.</li>
</ol>
<p><img src="images/advanced_qgis/3d5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Now we will create an animation. Click the <strong>Animations</strong> button in the toolbar. To animate the view, we must define certain <strong>keyframes</strong>. Once you define a specific view for keyframes at different times, the system will try to smoothly animate the views between them. You can use the slider to go to a specific time, use the controls to set a specific view and click the <strong>+</strong> button to add a keyframe. Click the <strong>Play</strong> button to see the animation in action.</li>
</ol>
<p><img src="images/advanced_qgis/3d6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Once you are satisfied, click the <strong>Export Animation Frames</strong> button. Choose an output directory on your computer and click OK. Individual frames will be rendered and saved as separate files.</li>
</ol>
<p><img src="images/advanced_qgis/3d7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>As we did in the previous section, you can use a service such as <strong><a href="https://ezgif.com/maker">ezgif.com</a></strong> to create a GIF/Video from these frames.</li>
</ol>
<div class="figure">
<img src="images/advanced_qgis/3d.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/3d.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
</div>
<div id="summary-aggregate-expressions" class="section level1">
<h1>Summary Aggregate Expressions</h1>
<p>QGIS expression engine has a powerful function called ‘summary aggregates’ that allows evaluating a feature’s geometry and attributes with those of another layer. Expressions can be used for static calculations as well as on-the-fly computations, such as labels, virtual fields, symbology etc. This enables some powerful use cases.</p>
<p>The summary aggregate function operates on all the values from a different layer, returning a single summary value. The syntax of the aggregate function is as follows</p>
<pre><code>aggregate(
  layer:=&#39;layer name or id&#39;,
  aggregate:=&#39;aggegate type&#39;,
  expression:=&#39;expression to aggregate&#39;,
  filter:=&#39;optional filter expression,
  concatenator:=&#39;optional string to use to join values&#39;,
  order_by:=&#39;optional expression to order the features&#39;
  )</code></pre>
<div id="exercise-count-features-from-another-layer" class="section level2">
<h2>Exercise: Count features from another layer</h2>
<p>We will work with a land parcels data layer provided by the City of San Francisco. The goal of this exercise is to demonstrate the use of aggregate expression for on-the-fly computation when digitizing new features.</p>
<ol style="list-style-type: decimal">
<li>Open the <strong>parcels</strong> project from the data package. Select the <code>boundary</code> layer and click the <strong>Open Field Calculator</strong> button.</li>
</ol>
<p><img src="images/advanced_qgis/aggregate1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Add a new field named <code>count</code> with the following expression. The expression is reading the features from the <code>parcels</code> layer and giving an aggregate count of the features. You will notice that the the result will be displayed at the bottom of the window.</li>
</ol>
<pre><code>aggregate(
 layer:= &#39;parcels&#39;,
 aggregate:=&#39;count&#39;,
 expression:=fid
 )</code></pre>
<p><img src="images/advanced_qgis/aggregate2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Now we can apply the same concept in a dynamic calculation. Back in the main QGIS window, select the <code>polygons</code> layer and right-click it. Select <strong>Properties</strong>.</li>
</ol>
<p><img src="images/advanced_qgis/aggregate3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Switch to the <strong>Attributes Form</strong> tab. Select the field <code>count</code> and choose <strong>Text Edit</strong> as the <em>Widget Type</em>. At the <strong>Default Value</strong> field at the bottom, enter the following expression. Note that additional filter value. Here the <code>$geometry</code> refers to the geometry of the <code>parcels</code> layer and <code>geometry(@parent)</code> refers to the geometry of feature from the <code>polygons</code> layer. Click OK.</li>
</ol>
<pre><code>aggregate(
 layer:= &#39;parcels&#39;,
 aggregate:=&#39;count&#39;,
 expression:=fid,
 filter:=intersects($geometry, geometry(@parent))
 )</code></pre>
<p><img src="images/advanced_qgis/aggregate4.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Back in QGIS, click the <strong>Toggle Editing</strong> button and draw a polygon using the <strong>Add Polygon Feature</strong> button. Right-click to finish the drawing. As soon as you finish, the count of intersecting features will be calculated by the aggregate expression and displayed in the <code>count</code> field.</li>
</ol>
<div class="figure">
<img src="images/advanced_qgis/aggregate5.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/aggregate5.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
<ol start="6" style="list-style-type: decimal">
<li>There are many different types of aggregates available. We can use an aggregate called <strong>concatanate</strong> to compute a comma-separated text of all feature ids. Go to the <strong>Attribute Form</strong> properties again and select <code>parcels</code> field. Enter the following expression as the <strong>Default Value</strong>.</li>
</ol>
<pre><code>aggregate(
 layer:= &#39;parcels&#39;,
 aggregate:=&#39;concatenate&#39;,
 concatenator:=&#39;,&#39;,
 expression:=to_string(fid),
 filter:=intersects($geometry, geometry(@parent))
 )</code></pre>
<p><img src="images/advanced_qgis/aggregate6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>Now when to add a new feature, all the intersecting feature ids will be displayed along with the count.</li>
</ol>
<div class="figure">
<img src="images/advanced_qgis/aggregate7.png" alt="View Animated GIF ↗" />
<p class="caption"><a href="images/advanced_qgis/aggregate7.gif" target="_blank">View Animated GIF ↗</a></p>
</div>
</div>
<div id="learn-more-1" class="section level2">
<h2>Learn more</h2>
<p>Apart from <code>aggregate()</code>, there are other advanced functions such as <code>array_foreach()</code> and <code>eval()</code> that are very powerful. Learn about them in the following video where I explain some use cases.</p>
<p><a href="https://www.youtube.com/watch?v=IXPCec8vgLA" target="_blank"><img src="images/advanced_qgis/advanced_expressions_qgisna.jpg" alt="Video" style="width:70.0%" /></a></p>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>OpenStreetMap (osm) data layers: Data/Maps Copyright 2019 Geofabrik GmbH and OpenStreetMap Contributors. <a href="https://download.geofabrik.de/asia/india.html">OSM India free extract</a> downloaded from Geofabrik.</li>
<li>India State boundary: Downloaded from <a href="https://github.com/datameet/maps/tree/master/States">Datameet Spatial Data repository</a>.</li>
<li>Anti-shipping Activity Messages: <a href="https://msi.nga.mil/NGAPortal/MSI.porta">Maritime Safety Information portal</a> , National Geospatial-Intelligence Agency</li>
<li>Land boundaries: Made with Natural Earth. Free vector and raster map data @ naturalearthdata.com.</li>
<li>Road Network: District of Columbia <a href="https://opendata.dc.gov/">Open Data Catalog</a>.</li>
<li><a href="https://www.usgs.gov/centers/eros/science/usgs-eros-archive-digital-elevation-interferometric-synthetic-aperture-radar">Alaska IFSAR DTM</a> distributed by USGS Earth Resources Observation and Science (EROS), Downloaded from USGS Earth Explorer</li>
<li>Parcels and Neighborhood boundaries downloaded from <a href="https://datasf.org/opendata/">DataSF Open Data Portal</a></li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course material is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author.</p>
<!--
This material is part of the *Trainer's Package* and the buyer gets a non-exclusive, non-transferable, perpetual license to the material. You can fully customise and brand the materials to your requirements.
-->
<p>© 2020 Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
<p><strong>This course is offered as an instructor-led online class. Visit <a href="https://spatialthoughts.com/events/">Spatial Thoughts</a> to know details of upcoming sessions.</strong></p>
</div>

<div id="disqus_thread" class="standardPadding"></div>

<!-- disqus -->
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = 'https://courses.spatialthoughts.com' + location.pathname;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://spatialthoughts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
